<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: folly::fibers::Baton Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfolly_1_1fibers_1_1Baton.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="classfolly_1_1fibers_1_1Baton-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::fibers::Baton Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton_1_1FiberWaiter.html">FiberWaiter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton_1_1TimeoutHandler.html">TimeoutHandler</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton_1_1Waiter.html">Waiter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a7965342f2fdb101af72f711e681592c2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a7965342f2fdb101af72f711e681592c2">Baton</a> () noexcept</td></tr>
<tr class="separator:a7965342f2fdb101af72f711e681592c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae15255302a1f161f4ec97bfebbef82e0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#ae15255302a1f161f4ec97bfebbef82e0">~Baton</a> () noexcept=default</td></tr>
<tr class="separator:ae15255302a1f161f4ec97bfebbef82e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3101227bd6f3f68111a378dd81105e24"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a3101227bd6f3f68111a378dd81105e24">ready</a> () const </td></tr>
<tr class="separator:a3101227bd6f3f68111a378dd81105e24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95da0359b3274879ef59f750838733c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a95da0359b3274879ef59f750838733c9">setWaiter</a> (<a class="el" href="classfolly_1_1fibers_1_1Baton_1_1Waiter.html">Waiter</a> &amp;waiter)</td></tr>
<tr class="separator:a95da0359b3274879ef59f750838733c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c93a1e9e70b7a2f95c9d60d57814e11"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a1c93a1e9e70b7a2f95c9d60d57814e11">wait</a> ()</td></tr>
<tr class="separator:a1c93a1e9e70b7a2f95c9d60d57814e11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb91c3df072dcb3944421733aa0c06aa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#adb91c3df072dcb3944421733aa0c06aa">wait</a> (<a class="el" href="classfolly_1_1fibers_1_1Baton_1_1TimeoutHandler.html">TimeoutHandler</a> &amp;timeoutHandler)</td></tr>
<tr class="separator:adb91c3df072dcb3944421733aa0c06aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7333c05f9c1ba0c766c89fc025add90"><td class="memTemplParams" colspan="2">template&lt;typename F &gt; </td></tr>
<tr class="memitem:ad7333c05f9c1ba0c766c89fc025add90"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#ad7333c05f9c1ba0c766c89fc025add90">wait</a> (F &amp;&amp;mainContextFunc)</td></tr>
<tr class="separator:ad7333c05f9c1ba0c766c89fc025add90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa67d6ca4a742d8e3e7039e097fd41257"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#aa67d6ca4a742d8e3e7039e097fd41257">try_wait</a> ()</td></tr>
<tr class="separator:aa67d6ca4a742d8e3e7039e097fd41257"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addc4745a6d4de91763067eb148784833"><td class="memTemplParams" colspan="2">template&lt;typename Rep , typename Period &gt; </td></tr>
<tr class="memitem:addc4745a6d4de91763067eb148784833"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#addc4745a6d4de91763067eb148784833">try_wait_for</a> (const std::chrono::duration&lt; Rep, Period &gt; &amp;timeout)</td></tr>
<tr class="separator:addc4745a6d4de91763067eb148784833"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08b10b90d640dc133559352c3b672247"><td class="memTemplParams" colspan="2">template&lt;typename Rep , typename Period , typename F &gt; </td></tr>
<tr class="memitem:a08b10b90d640dc133559352c3b672247"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a08b10b90d640dc133559352c3b672247">try_wait_for</a> (const std::chrono::duration&lt; Rep, Period &gt; &amp;timeout, F &amp;&amp;mainContextFunc)</td></tr>
<tr class="separator:a08b10b90d640dc133559352c3b672247"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ce8d44c8688d8b51553eca3a8854628"><td class="memTemplParams" colspan="2">template&lt;typename Clock , typename Duration &gt; </td></tr>
<tr class="memitem:a3ce8d44c8688d8b51553eca3a8854628"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a3ce8d44c8688d8b51553eca3a8854628">try_wait_until</a> (const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; &amp;deadline)</td></tr>
<tr class="separator:a3ce8d44c8688d8b51553eca3a8854628"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2a7582fcaec7ea71e95b1a919af3b9d"><td class="memTemplParams" colspan="2">template&lt;typename Clock , typename Duration , typename F &gt; </td></tr>
<tr class="memitem:ae2a7582fcaec7ea71e95b1a919af3b9d"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#ae2a7582fcaec7ea71e95b1a919af3b9d">try_wait_until</a> (const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; &amp;deadline, F &amp;&amp;mainContextFunc)</td></tr>
<tr class="separator:ae2a7582fcaec7ea71e95b1a919af3b9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb74bb39c305b7a98b32eb9ca02b0fa4"><td class="memTemplParams" colspan="2">template&lt;typename Clock , typename Duration , typename F &gt; </td></tr>
<tr class="memitem:abb74bb39c305b7a98b32eb9ca02b0fa4"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#abb74bb39c305b7a98b32eb9ca02b0fa4">try_wait_for</a> (const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; &amp;deadline, F &amp;&amp;mainContextFunc)</td></tr>
<tr class="separator:abb74bb39c305b7a98b32eb9ca02b0fa4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc8567290792a769318c15ea526c14ee"><td class="memTemplParams" colspan="2">template&lt;typename Rep , typename Period &gt; </td></tr>
<tr class="memitem:acc8567290792a769318c15ea526c14ee"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#acc8567290792a769318c15ea526c14ee">timed_wait</a> (const std::chrono::duration&lt; Rep, Period &gt; &amp;timeout)</td></tr>
<tr class="memdesc:acc8567290792a769318c15ea526c14ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Alias to try_wait_for. Deprecated.  <a href="#acc8567290792a769318c15ea526c14ee">More...</a><br /></td></tr>
<tr class="separator:acc8567290792a769318c15ea526c14ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a462d52360bdbe218fd1443696b3cdc2e"><td class="memTemplParams" colspan="2">template&lt;typename Rep , typename Period , typename F &gt; </td></tr>
<tr class="memitem:a462d52360bdbe218fd1443696b3cdc2e"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a462d52360bdbe218fd1443696b3cdc2e">timed_wait</a> (const std::chrono::duration&lt; Rep, Period &gt; &amp;timeout, F &amp;&amp;mainContextFunc)</td></tr>
<tr class="memdesc:a462d52360bdbe218fd1443696b3cdc2e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Alias to try_wait_for. Deprecated.  <a href="#a462d52360bdbe218fd1443696b3cdc2e">More...</a><br /></td></tr>
<tr class="separator:a462d52360bdbe218fd1443696b3cdc2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6b3362332862d3e8760cdffab3e0750"><td class="memTemplParams" colspan="2">template&lt;typename Clock , typename Duration &gt; </td></tr>
<tr class="memitem:af6b3362332862d3e8760cdffab3e0750"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#af6b3362332862d3e8760cdffab3e0750">timed_wait</a> (const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; &amp;deadline)</td></tr>
<tr class="memdesc:af6b3362332862d3e8760cdffab3e0750"><td class="mdescLeft">&#160;</td><td class="mdescRight">Alias to try_wait_until. Deprecated.  <a href="#af6b3362332862d3e8760cdffab3e0750">More...</a><br /></td></tr>
<tr class="separator:af6b3362332862d3e8760cdffab3e0750"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92ceb5a82f25d63026d6c43344a55292"><td class="memTemplParams" colspan="2">template&lt;typename Clock , typename Duration , typename F &gt; </td></tr>
<tr class="memitem:a92ceb5a82f25d63026d6c43344a55292"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a92ceb5a82f25d63026d6c43344a55292">timed_wait</a> (const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; &amp;deadline, F &amp;&amp;mainContextFunc)</td></tr>
<tr class="memdesc:a92ceb5a82f25d63026d6c43344a55292"><td class="mdescLeft">&#160;</td><td class="mdescRight">Alias to try_wait_until. Deprecated.  <a href="#a92ceb5a82f25d63026d6c43344a55292">More...</a><br /></td></tr>
<tr class="separator:a92ceb5a82f25d63026d6c43344a55292"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ffca7ae1f6b0fe902d4afd44b870c7f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a3ffca7ae1f6b0fe902d4afd44b870c7f">post</a> ()</td></tr>
<tr class="separator:a3ffca7ae1f6b0fe902d4afd44b870c7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24bb7714423f468f05c0d50167a27b62"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a24bb7714423f468f05c0d50167a27b62">reset</a> ()</td></tr>
<tr class="separator:a24bb7714423f468f05c0d50167a27b62"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a01914a52a493bcd283040fe51e4aa23a"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="classfolly_1_1fibers_1_1Baton.html#a01914a52a493bcd283040fe51e4aa23aacc13c0c23eb51741c64dfae83ce0ee57">PreBlockAttempts</a> = 300
 }</td></tr>
<tr class="separator:a01914a52a493bcd283040fe51e4aa23a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a0d5f766984b8bbcb84d2bac88b52e837"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a0d5f766984b8bbcb84d2bac88b52e837">Baton</a> (intptr_t <a class="el" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>)</td></tr>
<tr class="separator:a0d5f766984b8bbcb84d2bac88b52e837"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34a8ffd197ae96d669fe4cf1953dafb2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a34a8ffd197ae96d669fe4cf1953dafb2">postHelper</a> (intptr_t new_value)</td></tr>
<tr class="separator:a34a8ffd197ae96d669fe4cf1953dafb2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8588de9f69d92b7b5aa2a93f104e3398"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a8588de9f69d92b7b5aa2a93f104e3398">postThread</a> ()</td></tr>
<tr class="separator:a8588de9f69d92b7b5aa2a93f104e3398"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5b5896dca075fbc7d2c9677ea43f061"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#ac5b5896dca075fbc7d2c9677ea43f061">waitThread</a> ()</td></tr>
<tr class="separator:ac5b5896dca075fbc7d2c9677ea43f061"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7a965e64157463735291716261db264"><td class="memTemplParams" colspan="2">template&lt;typename F &gt; </td></tr>
<tr class="memitem:ab7a965e64157463735291716261db264"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#ab7a965e64157463735291716261db264">waitFiber</a> (<a class="el" href="classfolly_1_1fibers_1_1FiberManager.html">FiberManager</a> &amp;fm, F &amp;&amp;mainContextFunc)</td></tr>
<tr class="separator:ab7a965e64157463735291716261db264"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a454cbf71be71ac9e1ec540e1197aa544"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a454cbf71be71ac9e1ec540e1197aa544">spinWaitForEarlyPost</a> ()</td></tr>
<tr class="separator:a454cbf71be71ac9e1ec540e1197aa544"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ebd1d0f5f566a3aebeb43fb4e2d56ca"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a7ebd1d0f5f566a3aebeb43fb4e2d56ca">timedWaitThread</a> (<a class="el" href="classfolly_1_1fibers_1_1TimeoutController.html#add622a62cba3b3b75469bb9fea80a78f">TimeoutController::Duration</a> timeout)</td></tr>
<tr class="separator:a7ebd1d0f5f566a3aebeb43fb4e2d56ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ae1b79e48ab89349b98247dcc31b02a2e"><td class="memItemLeft" >union {</td></tr>
<tr class="memitem:a5b2b2ab2f8051331ce2d66890ab72339"><td class="memItemLeft" >&#160;&#160;&#160;std::atomic&lt; intptr_t &gt;&#160;&#160;&#160;<a class="el" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a></td></tr>
<tr class="separator:a5b2b2ab2f8051331ce2d66890ab72339"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81849ec845739513f9b8906ff3284db9"><td class="memItemLeft" >&#160;&#160;&#160;struct {</td></tr>
<tr class="memitem:ab4debb12f316afa80b1f829bc3e9b3fe"><td class="memItemLeft" >&#160;&#160;&#160;&#160;&#160;&#160;<a class="el" href="namespacefolly_1_1detail.html#a119b8d460f481815f833da41cdc33141">folly::detail::Futex</a>&#160;&#160;&#160;<a class="el" href="classfolly_1_1fibers_1_1Baton.html#a93135780b01aaed0916b78c3a6b117b2">futex</a> {}</td></tr>
<tr class="separator:ab4debb12f316afa80b1f829bc3e9b3fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdb15c5e15b6cf689b991c963e3f4e5a"><td class="memItemLeft" >&#160;&#160;&#160;&#160;&#160;&#160;<a class="el" href="ConstexprMathBenchmark_8cpp.html#afd12020da5a235dfcf0c3c748fb5baed">int32_t</a>&#160;&#160;&#160;<a class="el" href="classfolly_1_1fibers_1_1Baton.html#aaf6e3d376fc0268666565e3234f446a9">_unused_packing</a></td></tr>
<tr class="separator:acdb15c5e15b6cf689b991c963e3f4e5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81849ec845739513f9b8906ff3284db9"><td class="memItemLeft" valign="top">&#160;&#160;&#160;}&#160;&#160;&#160;<a class="el" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a></td></tr>
<tr class="separator:a81849ec845739513f9b8906ff3284db9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1b79e48ab89349b98247dcc31b02a2e"><td class="memItemLeft" valign="top">};&#160;</td><td class="memItemRight" valign="bottom"></td></tr>
<tr class="separator:ae1b79e48ab89349b98247dcc31b02a2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a9db4e076b6e7dd77c3fc452d6334367d"><td class="memItemLeft" align="right" valign="top">static constexpr intptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">NO_WAITER</a> = 0</td></tr>
<tr class="separator:a9db4e076b6e7dd77c3fc452d6334367d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab008d6c0401d270597f99c9d3676b23"><td class="memItemLeft" align="right" valign="top">static constexpr intptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a> = -1</td></tr>
<tr class="separator:aab008d6c0401d270597f99c9d3676b23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa72139cdcd74ea1e3625bd459fdb27df"><td class="memItemLeft" align="right" valign="top">static constexpr intptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">TIMEOUT</a> = -2</td></tr>
<tr class="separator:aa72139cdcd74ea1e3625bd459fdb27df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b0c70377704dac8dda06230f1a4b8a4"><td class="memItemLeft" align="right" valign="top">static constexpr intptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a> = -3</td></tr>
<tr class="separator:a4b0c70377704dac8dda06230f1a4b8a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Primitive which allows one to put current <a class="el" href="classfolly_1_1fibers_1_1Fiber.html" title="Fiber object used by FiberManager to execute tasks. ">Fiber</a> to sleep and wake it from another Fiber/thread. </p>

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00040">40</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="a01914a52a493bcd283040fe51e4aa23a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a01914a52a493bcd283040fe51e4aa23aacc13c0c23eb51741c64dfae83ce0ee57"></a>PreBlockAttempts&#160;</td><td class="fielddoc">
<p>Must be positive. If multiple threads are actively using a higher-level data structure that uses batons internally, it is likely that the <a class="el" href="classfolly_1_1fibers_1_1Baton.html#a3ffca7ae1f6b0fe902d4afd44b870c7f">post()</a> and <a class="el" href="classfolly_1_1fibers_1_1Baton.html#a1c93a1e9e70b7a2f95c9d60d57814e11">wait()</a> calls happen almost at the same time. In this state, we lose big 50% of the time if the wait goes to sleep immediately. On circa-2013 devbox hardware it costs about 7 usec to FUTEX_WAIT and then be awoken (half the t/iter as the posix_sem_pingpong test in BatonTests). We can improve our chances of early post by spinning for a bit, although we have to balance this against the loss if we end up sleeping any way. Spins on this hw take about 7 nanos (all but 0.5 nanos is the pause instruction). We give ourself 300 spins, which is about 2 usec of waiting. As a partial consolation, since we are using the pause instruction we are giving a speed boost to the colocated hyperthread. </p>
</td></tr>
</table>

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00236">236</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;       {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a01914a52a493bcd283040fe51e4aa23aacc13c0c23eb51741c64dfae83ce0ee57">PreBlockAttempts</a> = 300,</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  };</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a01914a52a493bcd283040fe51e4aa23aacc13c0c23eb51741c64dfae83ce0ee57"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a01914a52a493bcd283040fe51e4aa23aacc13c0c23eb51741c64dfae83ce0ee57">folly::fibers::Baton::PreBlockAttempts</a></div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00252">Baton.h:252</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a7965342f2fdb101af72f711e681592c2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::fibers::Baton::Baton </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Baton-inl_8h_source.html#l00037">37</a> of file <a class="el" href="Baton-inl_8h_source.html">Baton-inl.h</a>.</p>

<p>References <a class="el" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00274">POSTED</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00276">THREAD_WAITING</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00275">TIMEOUT</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00279">waiter_</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00048">folly::fibers::Baton::Waiter::~Waiter()</a>.</p>
<div class="fragment"><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                             : <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a7965342f2fdb101af72f711e681592c2">Baton</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">NO_WAITER</a>) {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  assert(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a7965342f2fdb101af72f711e681592c2">Baton</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">NO_WAITER</a>).<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>.futex == static_cast&lt;uint32_t&gt;(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">NO_WAITER</a>));</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  assert(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a7965342f2fdb101af72f711e681592c2">Baton</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>).<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>.futex == static_cast&lt;uint32_t&gt;(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>));</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  assert(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a7965342f2fdb101af72f711e681592c2">Baton</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">TIMEOUT</a>).<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>.futex == static_cast&lt;uint32_t&gt;(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">TIMEOUT</a>));</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  assert(</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a7965342f2fdb101af72f711e681592c2">Baton</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>).<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>.futex ==</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      static_cast&lt;uint32_t&gt;(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>));</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  assert(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>.futex.is_lock_free());</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  assert(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.is_lock_free());</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9db4e076b6e7dd77c3fc452d6334367d"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">folly::fibers::Baton::NO_WAITER</a></div><div class="ttdeci">static constexpr intptr_t NO_WAITER</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00273">Baton.h:273</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aab008d6c0401d270597f99c9d3676b23"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">folly::fibers::Baton::POSTED</a></div><div class="ttdeci">static constexpr intptr_t POSTED</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00274">Baton.h:274</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a7965342f2fdb101af72f711e681592c2"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a7965342f2fdb101af72f711e681592c2">folly::fibers::Baton::Baton</a></div><div class="ttdeci">Baton() noexcept</div><div class="ttdef"><b>Definition:</b> <a href="Baton-inl_8h_source.html#l00037">Baton-inl.h:37</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aa72139cdcd74ea1e3625bd459fdb27df"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">folly::fibers::Baton::TIMEOUT</a></div><div class="ttdeci">static constexpr intptr_t TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00275">Baton.h:275</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a1225fdc6a9afb7ca9ab7d7129c3252d3"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">folly::fibers::Baton::futex_</a></div><div class="ttdeci">struct folly::fibers::Baton::@51::@53 futex_</div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9c8214c70b9183d5ae7fbdcb402fb76a"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">folly::fibers::Baton::waiter_</a></div><div class="ttdeci">std::atomic&lt; intptr_t &gt; waiter_</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00279">Baton.h:279</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a4b0c70377704dac8dda06230f1a4b8a4"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">folly::fibers::Baton::THREAD_WAITING</a></div><div class="ttdeci">static constexpr intptr_t THREAD_WAITING</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00276">Baton.h:276</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae15255302a1f161f4ec97bfebbef82e0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::fibers::Baton::~Baton </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00048">folly::fibers::Baton::Waiter::~Waiter()</a>.</p>

</div>
</div>
<a class="anchor" id="a0d5f766984b8bbcb84d2bac88b52e837"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::fibers::Baton::Baton </td>
          <td>(</td>
          <td class="paramtype">intptr_t&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00255">255</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">postHelper()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00178">postThread()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00094">spinWaitForEarlyPost()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">timedWaitThread()</a>, <a class="el" href="Baton-inl_8h_source.html#l00061">waitFiber()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">waitThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;: <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>(<a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>) {}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9c8214c70b9183d5ae7fbdcb402fb76a"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">folly::fibers::Baton::waiter_</a></div><div class="ttdeci">std::atomic&lt; intptr_t &gt; waiter_</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00279">Baton.h:279</a></div></div>
<div class="ttc" id="http__parser_8c_html_adc6e5733fc3c22f0a7b2914188c49c90"><div class="ttname"><a href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a></div><div class="ttdeci">state</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8c_source.html#l00272">http_parser.c:272</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a3ffca7ae1f6b0fe902d4afd44b870c7f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::fibers::Baton::post </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Wakes up <a class="el" href="classfolly_1_1fibers_1_1Fiber.html" title="Fiber object used by FiberManager to execute tasks. ">Fiber</a> which was waiting on this <a class="el" href="classfolly_1_1fibers_1_1Baton.html">Baton</a> (or if no <a class="el" href="classfolly_1_1fibers_1_1Fiber.html" title="Fiber object used by FiberManager to execute tasks. ">Fiber</a> is waiting, next <a class="el" href="classfolly_1_1fibers_1_1Baton.html#a1c93a1e9e70b7a2f95c9d60d57814e11">wait()</a> call will return immediately). </p>

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00150">150</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00274">POSTED</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">postHelper()</a>.</p>

<p>Referenced by <a class="el" href="BlockingWait_8h_source.html#l00043">folly::coro::detail::BlockingWaitPromiseBase::FinalAwaiter::await_suspend()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">postHelper()</a>, <a class="el" href="FibersTest_8cpp_source.html#l00086">TEST()</a>, and <a class="el" href="TimedMutex-inl_8h_source.html#l00136">folly::fibers::TimedMutex::unlock()</a>.</p>
<div class="fragment"><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                 {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a34a8ffd197ae96d669fe4cf1953dafb2">postHelper</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aab008d6c0401d270597f99c9d3676b23"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">folly::fibers::Baton::POSTED</a></div><div class="ttdeci">static constexpr intptr_t POSTED</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00274">Baton.h:274</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a34a8ffd197ae96d669fe4cf1953dafb2"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a34a8ffd197ae96d669fe4cf1953dafb2">folly::fibers::Baton::postHelper</a></div><div class="ttdeci">void postHelper(intptr_t new_value)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00154">Baton.cpp:154</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a34a8ffd197ae96d669fe4cf1953dafb2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::fibers::Baton::postHelper </td>
          <td>(</td>
          <td class="paramtype">intptr_t&#160;</td>
          <td class="paramname"><em>new_value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">154</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00273">NO_WAITER</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00150">post()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00274">POSTED</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00178">postThread()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00276">THREAD_WAITING</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00275">TIMEOUT</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00279">waiter_</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00255">Baton()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00150">post()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00049">wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                                         {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keyword">auto</span> waiter = <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.load();</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span> (waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>) {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      assert(new_value == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a8588de9f69d92b7b5aa2a93f104e3398">postThread</a>();</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span> (waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a> || waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">TIMEOUT</a>) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  } <span class="keywordflow">while</span> (!<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.compare_exchange_weak(waiter, new_value));</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="keywordflow">if</span> (waiter != <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">NO_WAITER</a>) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keyword">reinterpret_cast&lt;</span>Waiter*<span class="keyword">&gt;</span>(waiter)-&gt;<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a3ffca7ae1f6b0fe902d4afd44b870c7f">post</a>();</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9db4e076b6e7dd77c3fc452d6334367d"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">folly::fibers::Baton::NO_WAITER</a></div><div class="ttdeci">static constexpr intptr_t NO_WAITER</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00273">Baton.h:273</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aab008d6c0401d270597f99c9d3676b23"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">folly::fibers::Baton::POSTED</a></div><div class="ttdeci">static constexpr intptr_t POSTED</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00274">Baton.h:274</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aa72139cdcd74ea1e3625bd459fdb27df"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">folly::fibers::Baton::TIMEOUT</a></div><div class="ttdeci">static constexpr intptr_t TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00275">Baton.h:275</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9c8214c70b9183d5ae7fbdcb402fb76a"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">folly::fibers::Baton::waiter_</a></div><div class="ttdeci">std::atomic&lt; intptr_t &gt; waiter_</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00279">Baton.h:279</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a4b0c70377704dac8dda06230f1a4b8a4"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">folly::fibers::Baton::THREAD_WAITING</a></div><div class="ttdeci">static constexpr intptr_t THREAD_WAITING</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00276">Baton.h:276</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a3ffca7ae1f6b0fe902d4afd44b870c7f"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a3ffca7ae1f6b0fe902d4afd44b870c7f">folly::fibers::Baton::post</a></div><div class="ttdeci">void post()</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00150">Baton.cpp:150</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a8588de9f69d92b7b5aa2a93f104e3398"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a8588de9f69d92b7b5aa2a93f104e3398">folly::fibers::Baton::postThread</a></div><div class="ttdeci">void postThread()</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00178">Baton.cpp:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8588de9f69d92b7b5aa2a93f104e3398"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::fibers::Baton::postThread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00178">178</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00281">futex</a>, <a class="el" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>, <a class="el" href="Futex-inl_8h_source.html#l00107">folly::detail::futexWake()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00274">POSTED</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00276">THREAD_WAITING</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00279">waiter_</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00255">Baton()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">postHelper()</a>.</p>
<div class="fragment"><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                       {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <span class="keyword">auto</span> expected = <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keyword">auto</span>* <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a93135780b01aaed0916b78c3a6b117b2">futex</a> = &amp;<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>.futex;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.compare_exchange_strong(expected, <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>)) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <a class="code" href="namespacefolly_1_1detail.html#aeba3f67ff8fb877e9e460b417afdf82f">futexWake</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a93135780b01aaed0916b78c3a6b117b2">futex</a>, 1);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aab008d6c0401d270597f99c9d3676b23"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">folly::fibers::Baton::POSTED</a></div><div class="ttdeci">static constexpr intptr_t POSTED</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00274">Baton.h:274</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a1225fdc6a9afb7ca9ab7d7129c3252d3"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">folly::fibers::Baton::futex_</a></div><div class="ttdeci">struct folly::fibers::Baton::@51::@53 futex_</div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9c8214c70b9183d5ae7fbdcb402fb76a"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">folly::fibers::Baton::waiter_</a></div><div class="ttdeci">std::atomic&lt; intptr_t &gt; waiter_</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00279">Baton.h:279</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a4b0c70377704dac8dda06230f1a4b8a4"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">folly::fibers::Baton::THREAD_WAITING</a></div><div class="ttdeci">static constexpr intptr_t THREAD_WAITING</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00276">Baton.h:276</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a93135780b01aaed0916b78c3a6b117b2"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a93135780b01aaed0916b78c3a6b117b2">folly::fibers::Baton::futex</a></div><div class="ttdeci">folly::detail::Futex futex</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00281">Baton.h:281</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_aeba3f67ff8fb877e9e460b417afdf82f"><div class="ttname"><a href="namespacefolly_1_1detail.html#aeba3f67ff8fb877e9e460b417afdf82f">folly::detail::futexWake</a></div><div class="ttdeci">int futexWake(const Futex *futex, int count, uint32_t wakeMask)</div><div class="ttdef"><b>Definition:</b> <a href="Futex-inl_8h_source.html#l00107">Futex-inl.h:107</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3101227bd6f3f68111a378dd81105e24"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::ready </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00055">55</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00274">POSTED</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00030">setWaiter()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00174">try_wait()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00045">wait()</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00279">waiter_</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8cpp_source.html#l00174">try_wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                     {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keyword">auto</span> <a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a> = <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.load();</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a> == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  }</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aab008d6c0401d270597f99c9d3676b23"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">folly::fibers::Baton::POSTED</a></div><div class="ttdeci">static constexpr intptr_t POSTED</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00274">Baton.h:274</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9c8214c70b9183d5ae7fbdcb402fb76a"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">folly::fibers::Baton::waiter_</a></div><div class="ttdeci">std::atomic&lt; intptr_t &gt; waiter_</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00279">Baton.h:279</a></div></div>
<div class="ttc" id="http__parser_8c_html_adc6e5733fc3c22f0a7b2914188c49c90"><div class="ttname"><a href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a></div><div class="ttdeci">state</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8c_source.html#l00272">http_parser.c:272</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a24bb7714423f468f05c0d50167a27b62"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::fibers::Baton::reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset's the baton (equivalent to destroying the object and constructing another one in place). Caller is responsible for making sure no one is waiting on/posting the baton when <a class="el" href="classfolly_1_1fibers_1_1Baton.html#a24bb7714423f468f05c0d50167a27b62">reset()</a> is called. </p>

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00188">188</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00273">NO_WAITER</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00279">waiter_</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00190">timed_wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                  {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.store(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">NO_WAITER</a>, std::memory_order_relaxed);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9db4e076b6e7dd77c3fc452d6334367d"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">folly::fibers::Baton::NO_WAITER</a></div><div class="ttdeci">static constexpr intptr_t NO_WAITER</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00273">Baton.h:273</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9c8214c70b9183d5ae7fbdcb402fb76a"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">folly::fibers::Baton::waiter_</a></div><div class="ttdeci">std::atomic&lt; intptr_t &gt; waiter_</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00279">Baton.h:279</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a95da0359b3274879ef59f750838733c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::fibers::Baton::setWaiter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1fibers_1_1Baton_1_1Waiter.html">Waiter</a> &amp;&#160;</td>
          <td class="paramname"><em>waiter</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Registers a waiter for the baton. The waiter will be notified when the baton is posted. </p>

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00030">30</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>References <a class="el" href="Likely_8h_source.html#l00047">LIKELY</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00273">NO_WAITER</a>, <a class="el" href="classfolly_1_1fibers_1_1Baton_1_1Waiter.html#a56091eff1228a9ad419d23b6b596b59e">folly::fibers::Baton::Waiter::post()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00274">POSTED</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00275">TIMEOUT</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00279">waiter_</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00055">ready()</a>, and <a class="el" href="Baton-inl_8h_source.html#l00061">waitFiber()</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                    {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keyword">auto</span> curr_waiter = <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.load();</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="Likely_8h.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(curr_waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">NO_WAITER</a>)) {</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curr_waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a> || curr_waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">TIMEOUT</a>) {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      waiter.post();</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;Some waiter is already waiting on this Baton.&quot;</span>);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  } <span class="keywordflow">while</span> (!<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.compare_exchange_weak(</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      curr_waiter, reinterpret_cast&lt;intptr_t&gt;(&amp;waiter)));</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9db4e076b6e7dd77c3fc452d6334367d"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">folly::fibers::Baton::NO_WAITER</a></div><div class="ttdeci">static constexpr intptr_t NO_WAITER</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00273">Baton.h:273</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aab008d6c0401d270597f99c9d3676b23"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">folly::fibers::Baton::POSTED</a></div><div class="ttdeci">static constexpr intptr_t POSTED</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00274">Baton.h:274</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aa72139cdcd74ea1e3625bd459fdb27df"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">folly::fibers::Baton::TIMEOUT</a></div><div class="ttdeci">static constexpr intptr_t TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00275">Baton.h:275</a></div></div>
<div class="ttc" id="Likely_8h_html_affde14445f49f65ff4f5b592e44ee71a"><div class="ttname"><a href="Likely_8h.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)</div><div class="ttdef"><b>Definition:</b> <a href="Likely_8h_source.html#l00047">Likely.h:47</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9c8214c70b9183d5ae7fbdcb402fb76a"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">folly::fibers::Baton::waiter_</a></div><div class="ttdeci">std::atomic&lt; intptr_t &gt; waiter_</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00279">Baton.h:279</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a454cbf71be71ac9e1ec540e1197aa544"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::spinWaitForEarlyPost </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Spin for "some time" (see discussion on PreBlockAttempts) waiting for a post. </p><dl class="section return"><dt>Returns</dt><dd>true if we received a post the spin wait, false otherwise. If the function returns true then <a class="el" href="classfolly_1_1fibers_1_1Baton.html">Baton</a> state is guaranteed to be POSTED </dd></dl>

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00094">94</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>References <a class="el" href="Asm_8h_source.html#l00037">folly::asm_volatile_pause()</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">i</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00252">PreBlockAttempts</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00174">try_wait()</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00255">Baton()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">timedWaitThread()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">waitThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                                 {</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  static_assert(</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a01914a52a493bcd283040fe51e4aa23aacc13c0c23eb51741c64dfae83ce0ee57">PreBlockAttempts</a> &gt; 0,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="stringliteral">&quot;isn&#39;t this assert clearer than an uninitialized variable warning?&quot;</span>);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a01914a52a493bcd283040fe51e4aa23aacc13c0c23eb51741c64dfae83ce0ee57">PreBlockAttempts</a>; ++<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>) {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1fibers_1_1Baton.html#aa67d6ca4a742d8e3e7039e097fd41257">try_wait</a>()) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="comment">// hooray!</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    }</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">// The pause instruction is the polite way to spin, but it doesn&#39;t</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// actually affect correctness to omit it if we don&#39;t have it.</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// Pausing donates the full capabilities of the current core to</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// its other hyperthreads for a dozen cycles or so</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="namespacefolly.html#aaf13bc11e412f3e0899525ee0eef1443">asm_volatile_pause</a>();</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div><div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_html_a7e98b8a17c0aad30ba64d47b74e2a6c1"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">gtest_output_test_golden_lin.txt:83</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aa67d6ca4a742d8e3e7039e097fd41257"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aa67d6ca4a742d8e3e7039e097fd41257">folly::fibers::Baton::try_wait</a></div><div class="ttdeci">bool try_wait()</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00174">Baton.cpp:174</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a01914a52a493bcd283040fe51e4aa23aacc13c0c23eb51741c64dfae83ce0ee57"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a01914a52a493bcd283040fe51e4aa23aacc13c0c23eb51741c64dfae83ce0ee57">folly::fibers::Baton::PreBlockAttempts</a></div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00252">Baton.h:252</a></div></div>
<div class="ttc" id="namespacefolly_html_aaf13bc11e412f3e0899525ee0eef1443"><div class="ttname"><a href="namespacefolly.html#aaf13bc11e412f3e0899525ee0eef1443">folly::asm_volatile_pause</a></div><div class="ttdeci">void asm_volatile_pause()</div><div class="ttdef"><b>Definition:</b> <a href="Asm_8h_source.html#l00037">Asm.h:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acc8567290792a769318c15ea526c14ee"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Rep , typename Period &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::timed_wait </td>
          <td>(</td>
          <td class="paramtype">const std::chrono::duration&lt; Rep, Period &gt; &amp;&#160;</td>
          <td class="paramname"><em>timeout</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Alias to try_wait_for. Deprecated. </p>

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00170">170</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00105">try_wait_for()</a>.</p>
<div class="fragment"><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                                                                 {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#addc4745a6d4de91763067eb148784833">try_wait_for</a>(timeout);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  }</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_addc4745a6d4de91763067eb148784833"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#addc4745a6d4de91763067eb148784833">folly::fibers::Baton::try_wait_for</a></div><div class="ttdeci">bool try_wait_for(const std::chrono::duration&lt; Rep, Period &gt; &amp;timeout)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00105">Baton.h:105</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a462d52360bdbe218fd1443696b3cdc2e"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Rep , typename Period , typename F &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::timed_wait </td>
          <td>(</td>
          <td class="paramtype">const std::chrono::duration&lt; Rep, Period &gt; &amp;&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">F &amp;&amp;&#160;</td>
          <td class="paramname"><em>mainContextFunc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Alias to try_wait_for. Deprecated. </p>

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00176">176</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00105">try_wait_for()</a>.</p>
<div class="fragment"><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                           {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#addc4745a6d4de91763067eb148784833">try_wait_for</a>(timeout, static_cast&lt;F&amp;&amp;&gt;(mainContextFunc));</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  }</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_addc4745a6d4de91763067eb148784833"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#addc4745a6d4de91763067eb148784833">folly::fibers::Baton::try_wait_for</a></div><div class="ttdeci">bool try_wait_for(const std::chrono::duration&lt; Rep, Period &gt; &amp;timeout)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00105">Baton.h:105</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af6b3362332862d3e8760cdffab3e0750"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Clock , typename Duration &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::timed_wait </td>
          <td>(</td>
          <td class="paramtype">const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>deadline</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Alias to try_wait_until. Deprecated. </p>

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00184">184</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00133">try_wait_until()</a>.</p>
<div class="fragment"><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                                                        {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a3ce8d44c8688d8b51553eca3a8854628">try_wait_until</a>(deadline);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  }</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a3ce8d44c8688d8b51553eca3a8854628"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a3ce8d44c8688d8b51553eca3a8854628">folly::fibers::Baton::try_wait_until</a></div><div class="ttdeci">bool try_wait_until(const std::chrono::time_point&lt; Clock, Duration &gt; &amp;deadline)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00133">Baton.h:133</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a92ceb5a82f25d63026d6c43344a55292"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Clock , typename Duration , typename F &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::timed_wait </td>
          <td>(</td>
          <td class="paramtype">const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>deadline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">F &amp;&amp;&#160;</td>
          <td class="paramname"><em>mainContextFunc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Alias to try_wait_until. Deprecated. </p>

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00190">190</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>References <a class="el" href="classfolly_1_1fibers_1_1Baton_1_1Waiter.html#a56091eff1228a9ad419d23b6b596b59e">folly::fibers::Baton::Waiter::post()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00188">reset()</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00133">try_wait_until()</a>.</p>
<div class="fragment"><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                           {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a3ce8d44c8688d8b51553eca3a8854628">try_wait_until</a>(deadline, static_cast&lt;F&amp;&amp;&gt;(mainContextFunc));</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  }</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a3ce8d44c8688d8b51553eca3a8854628"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a3ce8d44c8688d8b51553eca3a8854628">folly::fibers::Baton::try_wait_until</a></div><div class="ttdeci">bool try_wait_until(const std::chrono::time_point&lt; Clock, Duration &gt; &amp;deadline)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00133">Baton.h:133</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7ebd1d0f5f566a3aebeb43fb4e2d56ca"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::timedWaitThread </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1fibers_1_1TimeoutController.html#add622a62cba3b3b75469bb9fea80a78f">TimeoutController::Duration</a>&#160;</td>
          <td class="paramname"><em>timeout</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">113</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00281">futex</a>, <a class="el" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>, <a class="el" href="MemoryIdlerTest_8cpp_source.html#l00101">futexWaitUntil()</a>, <a class="el" href="Likely_8h_source.html#l00047">LIKELY</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00273">NO_WAITER</a>, <a class="el" href="TimekeeperTest_8cpp_source.html#l00031">now()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00274">POSTED</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00094">spinWaitForEarlyPost()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00276">THREAD_WAITING</a>, <a class="el" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a">folly::detail::TIMEDOUT</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00275">TIMEOUT</a>, <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00186">uint32_t</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00279">waiter_</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00255">Baton()</a>, and <a class="el" href="Baton-inl_8h_source.html#l00075">try_wait_for()</a>.</p>
<div class="fragment"><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                                             {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a454cbf71be71ac9e1ec540e1197aa544">spinWaitForEarlyPost</a>()) {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    assert(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.load(std::memory_order_acquire) == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  }</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keyword">auto</span> waiter = <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.load();</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="Likely_8h.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;          waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">NO_WAITER</a> &amp;&amp;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;          <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.compare_exchange_strong(waiter, <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>))) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keyword">auto</span> deadline = <a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">TimeoutController::Clock::now</a>() + <a class="code" href="namespacefolly_1_1detail.html#a87c55c2d12ad5b5dc9b7416bbed13720a90272dda245ae1fb3cf197e91a8689dc">timeout</a>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="keyword">auto</span>* <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a93135780b01aaed0916b78c3a6b117b2">futex</a> = &amp;<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>.futex;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> wait_rv =</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;          <a class="code" href="MemoryIdlerTest_8cpp.html#ab28ba4fe7e472e56f1c809bdaad1f3a2">futexWaitUntil</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a93135780b01aaed0916b78c3a6b117b2">futex</a>, <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>), deadline);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">if</span> (wait_rv == <a class="code" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a">folly::detail::FutexResult::TIMEDOUT</a>) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      }</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      waiter = <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.load(std::memory_order_relaxed);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    } <span class="keywordflow">while</span> (waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="Likely_8h.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>)) {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  }</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="comment">// Handle errors</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">if</span> (waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">TIMEOUT</a>) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;Thread baton can&#39;t have timeout status&quot;</span>);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="keywordflow">if</span> (waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;Other thread is already waiting on this baton&quot;</span>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;Other waiter is already waiting on this baton&quot;</span>);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9db4e076b6e7dd77c3fc452d6334367d"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">folly::fibers::Baton::NO_WAITER</a></div><div class="ttdeci">static constexpr intptr_t NO_WAITER</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00273">Baton.h:273</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aab008d6c0401d270597f99c9d3676b23"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">folly::fibers::Baton::POSTED</a></div><div class="ttdeci">static constexpr intptr_t POSTED</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00274">Baton.h:274</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_a87c55c2d12ad5b5dc9b7416bbed13720a90272dda245ae1fb3cf197e91a8689dc"><div class="ttname"><a href="namespacefolly_1_1detail.html#a87c55c2d12ad5b5dc9b7416bbed13720a90272dda245ae1fb3cf197e91a8689dc">folly::detail::spin_result::timeout</a></div></div>
<div class="ttc" id="MemoryIdlerTest_8cpp_html_ab28ba4fe7e472e56f1c809bdaad1f3a2"><div class="ttname"><a href="MemoryIdlerTest_8cpp.html#ab28ba4fe7e472e56f1c809bdaad1f3a2">futexWaitUntil</a></div><div class="ttdeci">FutexResult futexWaitUntil(const Futex&lt; MockAtom &gt; *futex, std::uint32_t expected, std::chrono::time_point&lt; Clock, Duration &gt; const &amp;deadline, uint32_t waitMask)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdlerTest_8cpp_source.html#l00101">MemoryIdlerTest.cpp:101</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aa72139cdcd74ea1e3625bd459fdb27df"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">folly::fibers::Baton::TIMEOUT</a></div><div class="ttdeci">static constexpr intptr_t TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00275">Baton.h:275</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a1225fdc6a9afb7ca9ab7d7129c3252d3"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">folly::fibers::Baton::futex_</a></div><div class="ttdeci">struct folly::fibers::Baton::@51::@53 futex_</div></div>
<div class="ttc" id="TimekeeperTest_8cpp_html_a562b4baa36dcf267f35a4ba4e0aef329"><div class="ttname"><a href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a></div><div class="ttdeci">std::chrono::steady_clock::time_point now()</div><div class="ttdef"><b>Definition:</b> <a href="TimekeeperTest_8cpp_source.html#l00031">TimekeeperTest.cpp:31</a></div></div>
<div class="ttc" id="Likely_8h_html_affde14445f49f65ff4f5b592e44ee71a"><div class="ttname"><a href="Likely_8h.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)</div><div class="ttdef"><b>Definition:</b> <a href="Likely_8h_source.html#l00047">Likely.h:47</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9c8214c70b9183d5ae7fbdcb402fb76a"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">folly::fibers::Baton::waiter_</a></div><div class="ttdeci">std::atomic&lt; intptr_t &gt; waiter_</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00279">Baton.h:279</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a4b0c70377704dac8dda06230f1a4b8a4"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">folly::fibers::Baton::THREAD_WAITING</a></div><div class="ttdeci">static constexpr intptr_t THREAD_WAITING</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00276">Baton.h:276</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a93135780b01aaed0916b78c3a6b117b2"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a93135780b01aaed0916b78c3a6b117b2">folly::fibers::Baton::futex</a></div><div class="ttdeci">folly::detail::Futex futex</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00281">Baton.h:281</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a"><div class="ttname"><a href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a">folly::detail::FutexResult::TIMEDOUT</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a454cbf71be71ac9e1ec540e1197aa544"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a454cbf71be71ac9e1ec540e1197aa544">folly::fibers::Baton::spinWaitForEarlyPost</a></div><div class="ttdeci">bool spinWaitForEarlyPost()</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00094">Baton.cpp:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa67d6ca4a742d8e3e7039e097fd41257"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::try_wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Checks if the baton has been posted without blocking.</p>
<dl class="section return"><dt>Returns</dt><dd>true iff the baton has been posted. </dd></dl>

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00174">174</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00055">ready()</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00055">ready()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00094">spinWaitForEarlyPost()</a>, <a class="el" href="FibersTest_8cpp_source.html#l00197">TEST()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00049">wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                     {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a3101227bd6f3f68111a378dd81105e24">ready</a>();</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a3101227bd6f3f68111a378dd81105e24"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a3101227bd6f3f68111a378dd81105e24">folly::fibers::Baton::ready</a></div><div class="ttdeci">bool ready() const </div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00055">Baton.h:55</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="addc4745a6d4de91763067eb148784833"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Rep , typename Period &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::try_wait_for </td>
          <td>(</td>
          <td class="paramtype">const std::chrono::duration&lt; Rep, Period &gt; &amp;&#160;</td>
          <td class="paramname"><em>timeout</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Puts active fiber to sleep. Returns when post is called or the timeout expires.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeout</td><td><a class="el" href="classfolly_1_1fibers_1_1Baton.html">Baton</a> will be automatically awaken if timeout expires</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if was posted, false if timeout expired </dd></dl>

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00105">105</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>References <a class="el" href="namespacefolly_1_1detail.html#a87c55c2d12ad5b5dc9b7416bbed13720a90272dda245ae1fb3cf197e91a8689dc">folly::detail::timeout</a>.</p>

<p>Referenced by <a class="el" href="FibersTest_8cpp_source.html#l00043">TEST()</a>, <a class="el" href="TimedMutex-inl_8h_source.html#l00095">folly::fibers::TimedMutex::timed_lock()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00170">timed_wait()</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00133">try_wait_until()</a>.</p>
<div class="fragment"><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                                                   {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#addc4745a6d4de91763067eb148784833">try_wait_for</a>(timeout, [] {});</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_addc4745a6d4de91763067eb148784833"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#addc4745a6d4de91763067eb148784833">folly::fibers::Baton::try_wait_for</a></div><div class="ttdeci">bool try_wait_for(const std::chrono::duration&lt; Rep, Period &gt; &amp;timeout)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00105">Baton.h:105</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a08b10b90d640dc133559352c3b672247"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Rep , typename Period , typename F &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::try_wait_for </td>
          <td>(</td>
          <td class="paramtype">const std::chrono::duration&lt; Rep, Period &gt; &amp;&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">F &amp;&amp;&#160;</td>
          <td class="paramname"><em>mainContextFunc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Puts active fiber to sleep. Returns when post is called or the timeout expires.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeout</td><td><a class="el" href="classfolly_1_1fibers_1_1Baton.html">Baton</a> will be automatically awaken if timeout expires </td></tr>
    <tr><td class="paramname">mainContextFunc</td><td>this function is immediately executed on the main context.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if was posted, false if timeout expired </dd></dl>

<p>Definition at line <a class="el" href="Baton-inl_8h_source.html#l00075">75</a> of file <a class="el" href="Baton-inl_8h_source.html">Baton-inl.h</a>.</p>

<p>References <a class="el" href="FiberManagerInternal-inl_8h_source.html#l00488">folly::fibers::FiberManager::getFiberManagerUnsafe()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00274">POSTED</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">timedWaitThread()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00275">TIMEOUT</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00279">waiter_</a>, and <a class="el" href="Baton-inl_8h_source.html#l00061">waitFiber()</a>.</p>
<div class="fragment"><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                         {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keyword">auto</span> fm = <a class="code" href="classfolly_1_1fibers_1_1FiberManager.html#ab0d53ca18d2f41f6a5663afe1f0fe3b6">FiberManager::getFiberManagerUnsafe</a>();</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordflow">if</span> (!fm || !fm-&gt;activeFiber_) {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    mainContextFunc();</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a7ebd1d0f5f566a3aebeb43fb4e2d56ca">timedWaitThread</a>(timeout);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keyword">auto</span>&amp; baton = *<span class="keyword">this</span>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordtype">bool</span> canceled = <span class="keyword">false</span>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keyword">auto</span> timeoutFunc = [&amp;baton, &amp;canceled]() <span class="keyword">mutable</span> {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    baton.postHelper(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">TIMEOUT</a>);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    canceled = <span class="keyword">true</span>;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  };</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keyword">auto</span> <span class="keywordtype">id</span> =</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      fm-&gt;timeoutManager_-&gt;registerTimeout(std::ref(timeoutFunc), timeout);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <a class="code" href="classfolly_1_1fibers_1_1Baton.html#ab7a965e64157463735291716261db264">waitFiber</a>(*fm, static_cast&lt;F&amp;&amp;&gt;(mainContextFunc));</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keyword">auto</span> posted = <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a> == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordflow">if</span> (!canceled) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    fm-&gt;timeoutManager_-&gt;cancel(<span class="keywordtype">id</span>);</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keywordflow">return</span> posted;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aab008d6c0401d270597f99c9d3676b23"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">folly::fibers::Baton::POSTED</a></div><div class="ttdeci">static constexpr intptr_t POSTED</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00274">Baton.h:274</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aa72139cdcd74ea1e3625bd459fdb27df"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">folly::fibers::Baton::TIMEOUT</a></div><div class="ttdeci">static constexpr intptr_t TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00275">Baton.h:275</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9c8214c70b9183d5ae7fbdcb402fb76a"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">folly::fibers::Baton::waiter_</a></div><div class="ttdeci">std::atomic&lt; intptr_t &gt; waiter_</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00279">Baton.h:279</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a7ebd1d0f5f566a3aebeb43fb4e2d56ca"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a7ebd1d0f5f566a3aebeb43fb4e2d56ca">folly::fibers::Baton::timedWaitThread</a></div><div class="ttdeci">bool timedWaitThread(TimeoutController::Duration timeout)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00113">Baton.cpp:113</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1FiberManager_html_ab0d53ca18d2f41f6a5663afe1f0fe3b6"><div class="ttname"><a href="classfolly_1_1fibers_1_1FiberManager.html#ab0d53ca18d2f41f6a5663afe1f0fe3b6">folly::fibers::FiberManager::getFiberManagerUnsafe</a></div><div class="ttdeci">static FiberManager * getFiberManagerUnsafe()</div><div class="ttdef"><b>Definition:</b> <a href="FiberManagerInternal-inl_8h_source.html#l00488">FiberManagerInternal-inl.h:488</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_ab7a965e64157463735291716261db264"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#ab7a965e64157463735291716261db264">folly::fibers::Baton::waitFiber</a></div><div class="ttdeci">void waitFiber(FiberManager &amp;fm, F &amp;&amp;mainContextFunc)</div><div class="ttdef"><b>Definition:</b> <a href="Baton-inl_8h_source.html#l00061">Baton-inl.h:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abb74bb39c305b7a98b32eb9ca02b0fa4"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Clock , typename Duration , typename F &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::try_wait_for </td>
          <td>(</td>
          <td class="paramtype">const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>deadline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">F &amp;&amp;&#160;</td>
          <td class="paramname"><em>mainContextFunc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Puts active fiber to sleep. Returns when post is called or the deadline expires.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeout</td><td><a class="el" href="classfolly_1_1fibers_1_1Baton.html">Baton</a> will be automatically awaken if deadline expires </td></tr>
    <tr><td class="paramname">mainContextFunc</td><td>this function is immediately executed on the main context.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if was posted, false if timeout expired </dd></dl>

</div>
</div>
<a class="anchor" id="a3ce8d44c8688d8b51553eca3a8854628"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Clock , typename Duration &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::try_wait_until </td>
          <td>(</td>
          <td class="paramtype">const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>deadline</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Puts active fiber to sleep. Returns when post is called or the deadline expires.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeout</td><td><a class="el" href="classfolly_1_1fibers_1_1Baton.html">Baton</a> will be automatically awaken if deadline expires</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if was posted, false if timeout expired </dd></dl>

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00133">133</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8h_source.html#l00105">try_wait_for()</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00184">timed_wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                                                            {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a3ce8d44c8688d8b51553eca3a8854628">try_wait_until</a>(deadline, [] {});</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  }</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a3ce8d44c8688d8b51553eca3a8854628"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a3ce8d44c8688d8b51553eca3a8854628">folly::fibers::Baton::try_wait_until</a></div><div class="ttdeci">bool try_wait_until(const std::chrono::time_point&lt; Clock, Duration &gt; &amp;deadline)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00133">Baton.h:133</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae2a7582fcaec7ea71e95b1a919af3b9d"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Clock , typename Duration , typename F &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">bool folly::fibers::Baton::try_wait_until </td>
          <td>(</td>
          <td class="paramtype">const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>deadline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">F &amp;&amp;&#160;</td>
          <td class="paramname"><em>mainContextFunc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Puts active fiber to sleep. Returns when post is called or the deadline expires.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeout</td><td><a class="el" href="classfolly_1_1fibers_1_1Baton.html">Baton</a> will be automatically awaken if deadline expires </td></tr>
    <tr><td class="paramname">mainContextFunc</td><td>this function is immediately executed on the main context.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if was posted, false if timeout expired </dd></dl>

<p>Definition at line <a class="el" href="Baton-inl_8h_source.html#l00107">107</a> of file <a class="el" href="Baton-inl_8h_source.html">Baton-inl.h</a>.</p>

<p>References <a class="el" href="Likely_8h_source.html#l00047">LIKELY</a>, <a class="el" href="TimekeeperTest_8cpp_source.html#l00031">now()</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00105">try_wait_for()</a>.</p>
<div class="fragment"><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                         {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keyword">auto</span> <a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a> = <a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">Clock::now</a>();</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="Likely_8h.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(<a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a> &lt;= deadline)) {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#addc4745a6d4de91763067eb148784833">try_wait_for</a>(deadline - <a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a>, static_cast&lt;F&amp;&amp;&gt;(mainContextFunc));</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#addc4745a6d4de91763067eb148784833">try_wait_for</a>(<a class="code" href="TimeSeriesTest_8cpp.html#aa7b45ef0ac6d2e5cf59a059d915b925e">Duration</a>{}, <span class="keyword">static_cast&lt;</span>F&amp;&amp;<span class="keyword">&gt;</span>(mainContextFunc));</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  }</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;}</div><div class="ttc" id="TimekeeperTest_8cpp_html_a562b4baa36dcf267f35a4ba4e0aef329"><div class="ttname"><a href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a></div><div class="ttdeci">std::chrono::steady_clock::time_point now()</div><div class="ttdef"><b>Definition:</b> <a href="TimekeeperTest_8cpp_source.html#l00031">TimekeeperTest.cpp:31</a></div></div>
<div class="ttc" id="Likely_8h_html_affde14445f49f65ff4f5b592e44ee71a"><div class="ttname"><a href="Likely_8h.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)</div><div class="ttdef"><b>Definition:</b> <a href="Likely_8h_source.html#l00047">Likely.h:47</a></div></div>
<div class="ttc" id="TimeSeriesTest_8cpp_html_aa7b45ef0ac6d2e5cf59a059d915b925e"><div class="ttname"><a href="TimeSeriesTest_8cpp.html#aa7b45ef0ac6d2e5cf59a059d915b925e">Duration</a></div><div class="ttdeci">StatsClock::duration Duration</div><div class="ttdef"><b>Definition:</b> <a href="TimeSeriesTest_8cpp_source.html#l00038">TimeSeriesTest.cpp:38</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_addc4745a6d4de91763067eb148784833"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#addc4745a6d4de91763067eb148784833">folly::fibers::Baton::try_wait_for</a></div><div class="ttdeci">bool try_wait_for(const std::chrono::duration&lt; Rep, Period &gt; &amp;timeout)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00105">Baton.h:105</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1c93a1e9e70b7a2f95c9d60d57814e11"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::fibers::Baton::wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Puts active fiber to sleep. Returns when post is called. </p>

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00045">45</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>Referenced by <a class="el" href="ForEach-inl_8h_source.html#l00041">folly::fibers::forEach()</a>, <a class="el" href="TimedMutex-inl_8h_source.html#l00081">folly::fibers::TimedMutex::lock()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00055">ready()</a>, <a class="el" href="FibersTest_8cpp_source.html#l00230">TEST()</a>, <a class="el" href="BlockingWait_8h_source.html#l00063">folly::coro::detail::BlockingWaitPromiseBase::wait()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00049">wait()</a>, and <a class="el" href="fibers_2Semaphore_8cpp_source.html#l00059">folly::fibers::Semaphore::waitSlow()</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                 {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a1c93a1e9e70b7a2f95c9d60d57814e11">wait</a>([]() {});</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a1c93a1e9e70b7a2f95c9d60d57814e11"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a1c93a1e9e70b7a2f95c9d60d57814e11">folly::fibers::Baton::wait</a></div><div class="ttdeci">void wait()</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00045">Baton.cpp:45</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adb91c3df072dcb3944421733aa0c06aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::fibers::Baton::wait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1fibers_1_1Baton_1_1TimeoutHandler.html">TimeoutHandler</a> &amp;&#160;</td>
          <td class="paramname"><em>timeoutHandler</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Put active fiber to sleep indefinitely. However, timeoutHandler may be used elsewhere on the same thread in order to schedule a wakeup for the active fiber. Users of timeoutHandler must be on the same thread as the active fiber and may only schedule one timeout, which must occur after the active fiber calls wait. </p>

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00049">49</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>References <a class="el" href="fibers_2Baton_8cpp_source.html#l00204">folly::fibers::Baton::TimeoutHandler::cancelTimeout()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00228">folly::fibers::Baton::TimeoutHandler::fiberManager_</a>, <a class="el" href="FiberManagerInternal-inl_8h_source.html#l00488">folly::fibers::FiberManager::getFiberManagerUnsafe()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">postHelper()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00275">TIMEOUT</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00227">folly::fibers::Baton::TimeoutHandler::timeoutFunc_</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00230">folly::fibers::Baton::TimeoutHandler::timeoutPtr_</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00174">try_wait()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00045">wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                               {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keyword">auto</span> timeoutFunc = [<span class="keyword">this</span>, &amp;timeoutHandler] {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classfolly_1_1fibers_1_1Baton.html#aa67d6ca4a742d8e3e7039e097fd41257">try_wait</a>()) {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a34a8ffd197ae96d669fe4cf1953dafb2">postHelper</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">TIMEOUT</a>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    }</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    timeoutHandler.timeoutPtr_ = 0;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  };</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  timeoutHandler.timeoutFunc_ = std::ref(timeoutFunc);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  timeoutHandler.fiberManager_ = <a class="code" href="classfolly_1_1fibers_1_1FiberManager.html#ab0d53ca18d2f41f6a5663afe1f0fe3b6">FiberManager::getFiberManagerUnsafe</a>();</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a1c93a1e9e70b7a2f95c9d60d57814e11">wait</a>();</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  timeoutHandler.cancelTimeout();</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aa72139cdcd74ea1e3625bd459fdb27df"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">folly::fibers::Baton::TIMEOUT</a></div><div class="ttdeci">static constexpr intptr_t TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00275">Baton.h:275</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aa67d6ca4a742d8e3e7039e097fd41257"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aa67d6ca4a742d8e3e7039e097fd41257">folly::fibers::Baton::try_wait</a></div><div class="ttdeci">bool try_wait()</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00174">Baton.cpp:174</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a1c93a1e9e70b7a2f95c9d60d57814e11"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a1c93a1e9e70b7a2f95c9d60d57814e11">folly::fibers::Baton::wait</a></div><div class="ttdeci">void wait()</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00045">Baton.cpp:45</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1FiberManager_html_ab0d53ca18d2f41f6a5663afe1f0fe3b6"><div class="ttname"><a href="classfolly_1_1fibers_1_1FiberManager.html#ab0d53ca18d2f41f6a5663afe1f0fe3b6">folly::fibers::FiberManager::getFiberManagerUnsafe</a></div><div class="ttdeci">static FiberManager * getFiberManagerUnsafe()</div><div class="ttdef"><b>Definition:</b> <a href="FiberManagerInternal-inl_8h_source.html#l00488">FiberManagerInternal-inl.h:488</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a34a8ffd197ae96d669fe4cf1953dafb2"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a34a8ffd197ae96d669fe4cf1953dafb2">folly::fibers::Baton::postHelper</a></div><div class="ttdeci">void postHelper(intptr_t new_value)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00154">Baton.cpp:154</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad7333c05f9c1ba0c766c89fc025add90"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename F &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void folly::fibers::Baton::wait </td>
          <td>(</td>
          <td class="paramtype">F &amp;&amp;&#160;</td>
          <td class="paramname"><em>mainContextFunc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Puts active fiber to sleep. Returns when post is called.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mainContextFunc</td><td>this function is immediately executed on the main context. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Baton-inl_8h_source.html#l00050">50</a> of file <a class="el" href="Baton-inl_8h_source.html">Baton-inl.h</a>.</p>

<p>References <a class="el" href="FiberManagerInternal-inl_8h_source.html#l00488">folly::fibers::FiberManager::getFiberManagerUnsafe()</a>, <a class="el" href="Baton-inl_8h_source.html#l00061">waitFiber()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">waitThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                                    {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keyword">auto</span> fm = <a class="code" href="classfolly_1_1fibers_1_1FiberManager.html#ab0d53ca18d2f41f6a5663afe1f0fe3b6">FiberManager::getFiberManagerUnsafe</a>();</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordflow">if</span> (!fm || !fm-&gt;activeFiber_) {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    mainContextFunc();</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#ac5b5896dca075fbc7d2c9677ea43f061">waitThread</a>();</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  }</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1fibers_1_1Baton.html#ab7a965e64157463735291716261db264">waitFiber</a>(*fm, std::forward&lt;F&gt;(mainContextFunc));</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_ac5b5896dca075fbc7d2c9677ea43f061"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#ac5b5896dca075fbc7d2c9677ea43f061">folly::fibers::Baton::waitThread</a></div><div class="ttdeci">void waitThread()</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00062">Baton.cpp:62</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1FiberManager_html_ab0d53ca18d2f41f6a5663afe1f0fe3b6"><div class="ttname"><a href="classfolly_1_1fibers_1_1FiberManager.html#ab0d53ca18d2f41f6a5663afe1f0fe3b6">folly::fibers::FiberManager::getFiberManagerUnsafe</a></div><div class="ttdeci">static FiberManager * getFiberManagerUnsafe()</div><div class="ttdef"><b>Definition:</b> <a href="FiberManagerInternal-inl_8h_source.html#l00488">FiberManagerInternal-inl.h:488</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_ab7a965e64157463735291716261db264"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#ab7a965e64157463735291716261db264">folly::fibers::Baton::waitFiber</a></div><div class="ttdeci">void waitFiber(FiberManager &amp;fm, F &amp;&amp;mainContextFunc)</div><div class="ttdef"><b>Definition:</b> <a href="Baton-inl_8h_source.html#l00061">Baton-inl.h:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab7a965e64157463735291716261db264"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename F &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::fibers::Baton::waitFiber </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1fibers_1_1FiberManager.html">FiberManager</a> &amp;&#160;</td>
          <td class="paramname"><em>fm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">F &amp;&amp;&#160;</td>
          <td class="paramname"><em>mainContextFunc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Baton-inl_8h_source.html#l00061">61</a> of file <a class="el" href="Baton-inl_8h_source.html">Baton-inl.h</a>.</p>

<p>References <a class="el" href="FiberManagerInternal_8h_source.html#l00374">folly::fibers::FiberManager::activeFiber_</a>, <a class="el" href="FiberManagerInternal_8h_source.html#l00439">folly::fibers::FiberManager::awaitFunc_</a>, <a class="el" href="Fiber_8h_source.html#l00072">folly::fibers::Fiber::AWAITING</a>, <a class="el" href="PushmiBenchmarks_8cpp_source.html#l00515">f</a>, <a class="el" href="Fiber_8cpp_source.html#l00172">folly::fibers::Fiber::preempt()</a>, <a class="el" href="Baton-inl_8h_source.html#l00024">folly::fibers::Baton::FiberWaiter::setFiber()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00030">setWaiter()</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00255">Baton()</a>, <a class="el" href="Baton-inl_8h_source.html#l00075">try_wait_for()</a>, and <a class="el" href="Baton-inl_8h_source.html#l00050">wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                                                           {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  FiberWaiter waiter;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keyword">auto</span> <a class="code" href="PushmiBenchmarks_8cpp.html#ad94c2c2f9fd35a12cc099962b7540071">f</a> = [<span class="keyword">this</span>, &amp;mainContextFunc, &amp;waiter](Fiber&amp; fiber) <span class="keyword">mutable</span> {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    waiter.setFiber(fiber);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a95da0359b3274879ef59f750838733c9">setWaiter</a>(waiter);</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    mainContextFunc();</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  };</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  fm.awaitFunc_ = std::ref(<a class="code" href="PushmiBenchmarks_8cpp.html#ad94c2c2f9fd35a12cc099962b7540071">f</a>);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  fm.activeFiber_-&gt;preempt(<a class="code" href="classfolly_1_1fibers_1_1Fiber.html#ab1540a8aeb9f1878cb48e99ebe47b394a866ad0b4e1d60a21f6bf08e65bbe07a3">Fiber::AWAITING</a>);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;}</div><div class="ttc" id="PushmiBenchmarks_8cpp_html_ad94c2c2f9fd35a12cc099962b7540071"><div class="ttname"><a href="PushmiBenchmarks_8cpp.html#ad94c2c2f9fd35a12cc099962b7540071">f</a></div><div class="ttdeci">auto f</div><div class="ttdef"><b>Definition:</b> <a href="PushmiBenchmarks_8cpp_source.html#l00515">PushmiBenchmarks.cpp:515</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a95da0359b3274879ef59f750838733c9"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a95da0359b3274879ef59f750838733c9">folly::fibers::Baton::setWaiter</a></div><div class="ttdeci">void setWaiter(Waiter &amp;waiter)</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00030">Baton.cpp:30</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Fiber_html_ab1540a8aeb9f1878cb48e99ebe47b394a866ad0b4e1d60a21f6bf08e65bbe07a3"><div class="ttname"><a href="classfolly_1_1fibers_1_1Fiber.html#ab1540a8aeb9f1878cb48e99ebe47b394a866ad0b4e1d60a21f6bf08e65bbe07a3">folly::fibers::Fiber::AWAITING</a></div><div class="ttdef"><b>Definition:</b> <a href="Fiber_8h_source.html#l00072">Fiber.h:72</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac5b5896dca075fbc7d2c9677ea43f061"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::fibers::Baton::waitThread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">62</a> of file <a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a>.</p>

<p>References <a class="el" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>, <a class="el" href="MemoryIdler_8h_source.html#l00102">folly::detail::MemoryIdler::futexWait()</a>, <a class="el" href="Likely_8h_source.html#l00047">LIKELY</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00273">NO_WAITER</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00274">POSTED</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00094">spinWaitForEarlyPost()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00276">THREAD_WAITING</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00275">TIMEOUT</a>, <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00186">uint32_t</a>, and <a class="el" href="fibers_2Baton_8h_source.html#l00279">waiter_</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8h_source.html#l00255">Baton()</a>, and <a class="el" href="Baton-inl_8h_source.html#l00050">wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                       {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a454cbf71be71ac9e1ec540e1197aa544">spinWaitForEarlyPost</a>()) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    assert(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.load(std::memory_order_acquire) == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  }</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="keyword">auto</span> waiter = <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.load();</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="Likely_8h.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;          waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">NO_WAITER</a> &amp;&amp;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;          <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.compare_exchange_strong(waiter, <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>))) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <a class="code" href="structfolly_1_1detail_1_1MemoryIdler.html#abf9784a1a3b31b6215daf5c5e3b41d6d">folly::detail::MemoryIdler::futexWait</a>(</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;          <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">futex_</a>.futex, <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>(<a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>));</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      waiter = <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">waiter_</a>.load(std::memory_order_acquire);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    } <span class="keywordflow">while</span> (waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="Likely_8h.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">POSTED</a>)) {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// Handle errors</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">if</span> (waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">TIMEOUT</a>) {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;Thread baton can&#39;t have timeout status&quot;</span>);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">if</span> (waiter == <a class="code" href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">THREAD_WAITING</a>) {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;Other thread is already waiting on this baton&quot;</span>);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;Other waiter is already waiting on this baton&quot;</span>);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div><div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9db4e076b6e7dd77c3fc452d6334367d"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9db4e076b6e7dd77c3fc452d6334367d">folly::fibers::Baton::NO_WAITER</a></div><div class="ttdeci">static constexpr intptr_t NO_WAITER</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00273">Baton.h:273</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aab008d6c0401d270597f99c9d3676b23"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aab008d6c0401d270597f99c9d3676b23">folly::fibers::Baton::POSTED</a></div><div class="ttdeci">static constexpr intptr_t POSTED</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00274">Baton.h:274</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1MemoryIdler_html_abf9784a1a3b31b6215daf5c5e3b41d6d"><div class="ttname"><a href="structfolly_1_1detail_1_1MemoryIdler.html#abf9784a1a3b31b6215daf5c5e3b41d6d">folly::detail::MemoryIdler::futexWait</a></div><div class="ttdeci">static FutexResult futexWait(Futex &amp;fut, uint32_t expected, uint32_t waitMask=-1, IdleTime const &amp;idleTimeout=defaultIdleTimeout.load(std::memory_order_acquire), size_t stackToRetain=kDefaultStackToRetain, float timeoutVariationFrac=0.5)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdler_8h_source.html#l00102">MemoryIdler.h:102</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_aa72139cdcd74ea1e3625bd459fdb27df"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#aa72139cdcd74ea1e3625bd459fdb27df">folly::fibers::Baton::TIMEOUT</a></div><div class="ttdeci">static constexpr intptr_t TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00275">Baton.h:275</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a1225fdc6a9afb7ca9ab7d7129c3252d3"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a1225fdc6a9afb7ca9ab7d7129c3252d3">folly::fibers::Baton::futex_</a></div><div class="ttdeci">struct folly::fibers::Baton::@51::@53 futex_</div></div>
<div class="ttc" id="Likely_8h_html_affde14445f49f65ff4f5b592e44ee71a"><div class="ttname"><a href="Likely_8h.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)</div><div class="ttdef"><b>Definition:</b> <a href="Likely_8h_source.html#l00047">Likely.h:47</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a9c8214c70b9183d5ae7fbdcb402fb76a"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a9c8214c70b9183d5ae7fbdcb402fb76a">folly::fibers::Baton::waiter_</a></div><div class="ttdeci">std::atomic&lt; intptr_t &gt; waiter_</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00279">Baton.h:279</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a4b0c70377704dac8dda06230f1a4b8a4"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a4b0c70377704dac8dda06230f1a4b8a4">folly::fibers::Baton::THREAD_WAITING</a></div><div class="ttdeci">static constexpr intptr_t THREAD_WAITING</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8h_source.html#l00276">Baton.h:276</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="classfolly_1_1fibers_1_1Baton_html_a454cbf71be71ac9e1ec540e1197aa544"><div class="ttname"><a href="classfolly_1_1fibers_1_1Baton.html#a454cbf71be71ac9e1ec540e1197aa544">folly::fibers::Baton::spinWaitForEarlyPost</a></div><div class="ttdeci">bool spinWaitForEarlyPost()</div><div class="ttdef"><b>Definition:</b> <a href="fibers_2Baton_8cpp_source.html#l00094">Baton.cpp:94</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="ae1b79e48ab89349b98247dcc31b02a2e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">union { ... } </td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aaf6e3d376fc0268666565e3234f446a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#afd12020da5a235dfcf0c3c748fb5baed">int32_t</a> folly::fibers::Baton::_unused_packing</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00282">282</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

</div>
</div>
<a class="anchor" id="a93135780b01aaed0916b78c3a6b117b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefolly_1_1detail.html#a119b8d460f481815f833da41cdc33141">folly::detail::Futex</a> folly::fibers::Baton::futex {}</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00281">281</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8cpp_source.html#l00178">postThread()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">timedWaitThread()</a>.</p>

</div>
</div>
<a class="anchor" id="a1225fdc6a9afb7ca9ab7d7129c3252d3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   folly::fibers::Baton::futex_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="Baton-inl_8h_source.html#l00037">Baton()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00178">postThread()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">timedWaitThread()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">waitThread()</a>.</p>

</div>
</div>
<a class="anchor" id="a9db4e076b6e7dd77c3fc452d6334367d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr intptr_t folly::fibers::Baton::NO_WAITER = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00273">273</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">postHelper()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00188">reset()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00030">setWaiter()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">timedWaitThread()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">waitThread()</a>.</p>

</div>
</div>
<a class="anchor" id="aab008d6c0401d270597f99c9d3676b23"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr intptr_t folly::fibers::Baton::POSTED = -1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00274">274</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>Referenced by <a class="el" href="Baton-inl_8h_source.html#l00037">Baton()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00150">post()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">postHelper()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00178">postThread()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00055">ready()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00030">setWaiter()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">timedWaitThread()</a>, <a class="el" href="Baton-inl_8h_source.html#l00075">try_wait_for()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">waitThread()</a>.</p>

</div>
</div>
<a class="anchor" id="a4b0c70377704dac8dda06230f1a4b8a4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr intptr_t folly::fibers::Baton::THREAD_WAITING = -3</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00276">276</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>Referenced by <a class="el" href="Baton-inl_8h_source.html#l00037">Baton()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">postHelper()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00178">postThread()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">timedWaitThread()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">waitThread()</a>.</p>

</div>
</div>
<a class="anchor" id="aa72139cdcd74ea1e3625bd459fdb27df"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr intptr_t folly::fibers::Baton::TIMEOUT = -2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00275">275</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>Referenced by <a class="el" href="Baton-inl_8h_source.html#l00037">Baton()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">postHelper()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00030">setWaiter()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">timedWaitThread()</a>, <a class="el" href="Baton-inl_8h_source.html#l00075">try_wait_for()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00049">wait()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">waitThread()</a>.</p>

</div>
</div>
<a class="anchor" id="a9c8214c70b9183d5ae7fbdcb402fb76a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;intptr_t&gt; folly::fibers::Baton::waiter_</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="fibers_2Baton_8h_source.html#l00279">279</a> of file <a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a>.</p>

<p>Referenced by <a class="el" href="Baton-inl_8h_source.html#l00037">Baton()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00154">postHelper()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00178">postThread()</a>, <a class="el" href="fibers_2Baton_8h_source.html#l00055">ready()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00188">reset()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00030">setWaiter()</a>, <a class="el" href="fibers_2Baton_8cpp_source.html#l00113">timedWaitThread()</a>, <a class="el" href="Baton-inl_8h_source.html#l00075">try_wait_for()</a>, and <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">waitThread()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/folly/folly/fibers/<a class="el" href="fibers_2Baton_8h_source.html">Baton.h</a></li>
<li>proxygen/folly/folly/fibers/<a class="el" href="Baton-inl_8h_source.html">Baton-inl.h</a></li>
<li>proxygen/folly/folly/fibers/<a class="el" href="fibers_2Baton_8cpp_source.html">Baton.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefolly.html">folly</a></li><li class="navelem"><a class="el" href="namespacefolly_1_1fibers.html">fibers</a></li><li class="navelem"><a class="el" href="classfolly_1_1fibers_1_1Baton.html">Baton</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
