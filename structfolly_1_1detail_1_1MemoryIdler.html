<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: folly::detail::MemoryIdler Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('structfolly_1_1detail_1_1MemoryIdler.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="structfolly_1_1detail_1_1MemoryIdler-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::detail::MemoryIdler Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="MemoryIdler_8h_source.html">MemoryIdler.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a224c82fba50fbe0e92ab9f1282894227"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb">kDefaultStackToRetain</a> = 1024
 }</td></tr>
<tr class="separator:a224c82fba50fbe0e92ab9f1282894227"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:af95c791c6a9e3c259e58d895e75a58f7"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#af95c791c6a9e3c259e58d895e75a58f7">flushLocalMallocCaches</a> ()</td></tr>
<tr class="separator:af95c791c6a9e3c259e58d895e75a58f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac74ffefb8c869d1d48ec5c540114839"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#aac74ffefb8c869d1d48ec5c540114839">unmapUnusedStack</a> (size_t retain=<a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb">kDefaultStackToRetain</a>)</td></tr>
<tr class="separator:aac74ffefb8c869d1d48ec5c540114839"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a758e9dd63dd3019bcb7f9daeb15399bf"><td class="memTemplParams" colspan="2">template&lt;typename IdleTime  = std::chrono::steady_clock::duration&gt; </td></tr>
<tr class="memitem:a758e9dd63dd3019bcb7f9daeb15399bf"><td class="memTemplItemLeft" align="right" valign="top">static IdleTime&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#a758e9dd63dd3019bcb7f9daeb15399bf">getVariationTimeout</a> (IdleTime const &amp;idleTimeout=defaultIdleTimeout.load(std::memory_order_acquire), float timeoutVariationFrac=0.5)</td></tr>
<tr class="separator:a758e9dd63dd3019bcb7f9daeb15399bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf9784a1a3b31b6215daf5c5e3b41d6d"><td class="memTemplParams" colspan="2">template&lt;typename Futex , typename IdleTime  = std::chrono::steady_clock::duration&gt; </td></tr>
<tr class="memitem:abf9784a1a3b31b6215daf5c5e3b41d6d"><td class="memTemplItemLeft" align="right" valign="top">static <a class="el" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273c">FutexResult</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#abf9784a1a3b31b6215daf5c5e3b41d6d">futexWait</a> (<a class="el" href="namespacefolly_1_1detail.html#a119b8d460f481815f833da41cdc33141">Futex</a> &amp;fut, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> expected, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> waitMask=-1, IdleTime const &amp;idleTimeout=defaultIdleTimeout.load(std::memory_order_acquire), size_t stackToRetain=<a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb">kDefaultStackToRetain</a>, float timeoutVariationFrac=0.5)</td></tr>
<tr class="separator:abf9784a1a3b31b6215daf5c5e3b41d6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd31d32f83b5d646dfb7dd3ff1ab434b"><td class="memTemplParams" colspan="2">template&lt;typename Futex , typename Deadline , typename IdleTime  = std::chrono::steady_clock::duration&gt; </td></tr>
<tr class="memitem:afd31d32f83b5d646dfb7dd3ff1ab434b"><td class="memTemplItemLeft" align="right" valign="top">static <a class="el" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273c">FutexResult</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#afd31d32f83b5d646dfb7dd3ff1ab434b">futexWaitUntil</a> (<a class="el" href="namespacefolly_1_1detail.html#a119b8d460f481815f833da41cdc33141">Futex</a> &amp;fut, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> expected, Deadline const &amp;deadline, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> waitMask=-1, IdleTime const &amp;idleTimeout=defaultIdleTimeout.load(std::memory_order_acquire), size_t stackToRetain=<a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb">kDefaultStackToRetain</a>, float timeoutVariationFrac=0.5)</td></tr>
<tr class="separator:afd31d32f83b5d646dfb7dd3ff1ab434b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a0449a08cc377963dc1e0e5eeb6066351"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classfolly_1_1AtomicStruct.html">AtomicStruct</a>&lt; std::chrono::steady_clock::duration &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#a0449a08cc377963dc1e0e5eeb6066351">defaultIdleTimeout</a></td></tr>
<tr class="separator:a0449a08cc377963dc1e0e5eeb6066351"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:aaa6aef2dda0626837ef9909e593b8fcc"><td class="memTemplParams" colspan="2">template&lt;typename Futex , typename Deadline , typename IdleTime &gt; </td></tr>
<tr class="memitem:aaa6aef2dda0626837ef9909e593b8fcc"><td class="memTemplItemLeft" align="right" valign="top">static bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#aaa6aef2dda0626837ef9909e593b8fcc">futexWaitPreIdle</a> (<a class="el" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273c">FutexResult</a> &amp;_ret, <a class="el" href="namespacefolly_1_1detail.html#a119b8d460f481815f833da41cdc33141">Futex</a> &amp;fut, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> expected, Deadline const &amp;deadline, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> waitMask, IdleTime idleTimeout, size_t stackToRetain, float timeoutVariationFrac)</td></tr>
<tr class="separator:aaa6aef2dda0626837ef9909e593b8fcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html">MemoryIdler</a> provides helper routines that allow routines to return some assigned memory resources back to the system. The intended use is that when a thread is waiting for a long time (perhaps it is in a LIFO thread pool and hasn't been needed for a long time) it should release its thread-local malloc caches (both jemalloc and tcmalloc use these for better performance) and unmap the stack pages that contain no useful data. </p>

<p>Definition at line <a class="el" href="MemoryIdler_8h_source.html#l00038">38</a> of file <a class="el" href="MemoryIdler_8h_source.html">MemoryIdler.h</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="a224c82fba50fbe0e92ab9f1282894227"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb"></a>kDefaultStackToRetain&#160;</td><td class="fielddoc">
<p>This value is a tradeoff between reclaiming memory and triggering a page fault immediately on wakeup. Note that the actual unit of idling for the stack is pages, so the actual stack that will be available on wakeup without a page fault is between kDefaultStackToRetain and kDefaultStackToRetain + PageSize - 1 bytes. </p>
</td></tr>
</table>

<p>Definition at line <a class="el" href="MemoryIdler_8h_source.html#l00044">44</a> of file <a class="el" href="MemoryIdler_8h_source.html">MemoryIdler.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;       {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="structfolly_1_1detail_1_1MemoryIdler.html#a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb">kDefaultStackToRetain</a> = 1024,</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  };</div><div class="ttc" id="structfolly_1_1detail_1_1MemoryIdler_html_a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb"><div class="ttname"><a href="structfolly_1_1detail_1_1MemoryIdler.html#a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb">folly::detail::MemoryIdler::kDefaultStackToRetain</a></div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdler_8h_source.html#l00051">MemoryIdler.h:51</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="af95c791c6a9e3c259e58d895e75a58f7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::detail::MemoryIdler::flushLocalMallocCaches </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns memory from thread-local allocation pools to the global pool, if we know how to for the current malloc implementation. jemalloc is supported. </p>

<p>Definition at line <a class="el" href="MemoryIdler_8cpp_source.html#l00041">41</a> of file <a class="el" href="MemoryIdler_8cpp_source.html">MemoryIdler.cpp</a>.</p>

<p>References <a class="el" href="GlobalThreadPoolList_8cpp_source.html#l00061">addr</a>, <a class="el" href="synchronization_2CallOnce_8h_source.html#l00056">folly::call_once()</a>, <a class="el" href="ForeachTest_8cpp_source.html#l00062">folly::test::end()</a>, <a class="el" href="GLog_8h_source.html#l00036">FB_LOG_EVERY_MS</a>, <a class="el" href="Random_8cpp_source.html#l00075">flag</a>, <a class="el" href="CPortability_8h_source.html#l00142">FOLLY_NOINLINE</a>, <a class="el" href="Portability_8h_source.html#l00264">folly::kIsDebug</a>, <a class="el" href="MallocImpl_8cpp_source.html#l00042">mallctl</a>, <a class="el" href="MallocImpl_8cpp_source.html#l00044">mallctlbymib</a>, <a class="el" href="MallocImpl_8cpp_source.html#l00043">mallctlnametomib</a>, <a class="el" href="MallctlHelper_8h_source.html#l00048">folly::mallctlRead()</a>, <a class="el" href="LogLevel_8cpp_source.html#l00031">max</a>, <a class="el" href="ScopeGuard_8h_source.html#l00274">SCOPE_EXIT</a>, <a class="el" href="structfolly_1_1CacheLocality.html#a7eb9cf59c3922234883e19b528df41cf">folly::CacheLocality::system()</a>, <a class="el" href="MemoryIdler_8cpp_source.html#l00199">unmapUnusedStack()</a>, <a class="el" href="memory_2Malloc_8h_source.html#l00147">folly::usingJEMalloc()</a>, and <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa059e9861e0400dfbe05c98a841f3f96b">folly::WARNING</a>.</p>

<p>Referenced by <a class="el" href="MemoryIdlerBenchmark_8cpp_source.html#l00029">BENCHMARK()</a>, <a class="el" href="MemoryIdler_8h_source.html#l00167">futexWaitPreIdle()</a>, <a class="el" href="IOThreadPoolExecutor_8cpp_source.html#l00044">folly::MemoryIdlerTimeout::runLoopCallback()</a>, and <a class="el" href="MemoryIdlerTest_8cpp_source.html#l00042">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                                         {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacefolly.html#afd107211692ed57ebcd9e14257f7b6bd">usingJEMalloc</a>()) {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  }</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="MallocImpl_8cpp.html#ac77af0531212e242b8a39fe7f773ce7a">mallctl</a> || !<a class="code" href="MallocImpl_8cpp.html#a82a30bf7131b57795735a56cde24f5f3">mallctlnametomib</a> || !<a class="code" href="MallocImpl_8cpp.html#abd873aefbcfa60cda7e5639f320a615c">mallctlbymib</a>) {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="GLog_8h.html#ad81a56fa7ecaf8616c7d0b96e10ccfed">FB_LOG_EVERY_MS</a>(ERROR, 10000) &lt;&lt; <span class="stringliteral">&quot;mallctl* weak link failed&quot;</span>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// Not using mallctlCall as this will fail if tcache is disabled.</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="MallocImpl_8cpp.html#ac77af0531212e242b8a39fe7f773ce7a">mallctl</a>(<span class="stringliteral">&quot;thread.tcache.flush&quot;</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, 0);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// By default jemalloc has 4 arenas per cpu, and then assigns each</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// thread to one of those arenas.  This means that in any service</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// that doesn&#39;t perform a lot of context switching, the chances that</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// another thread will be using the current thread&#39;s arena (and hence</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// doing the appropriate dirty-page purging) are low.  Some good</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// tuned configurations (such as that used by hhvm) use fewer arenas</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// and then pin threads to avoid contended access.  In that case,</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// purging the arenas is counter-productive.  We use the heuristic</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// that if narenas &lt;= 2 * num_cpus then we shouldn&#39;t do anything here,</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// which detects when the narenas has been reduced from the default</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">unsigned</span> narenas;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">unsigned</span> arenaForCurrent;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">size_t</span> mib[3];</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keywordtype">size_t</span> miblen = 3;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="namespacefolly.html#a22639fe1b7248d8ce3e18cedd38c53fe">mallctlRead</a>(<span class="stringliteral">&quot;opt.narenas&quot;</span>, &amp;narenas);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="namespacefolly.html#a22639fe1b7248d8ce3e18cedd38c53fe">mallctlRead</a>(<span class="stringliteral">&quot;thread.arena&quot;</span>, &amp;arenaForCurrent);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">if</span> (narenas &gt; 2 * <a class="code" href="structfolly_1_1CacheLocality.html#a7eb9cf59c3922234883e19b528df41cf">CacheLocality::system</a>().numCpus &amp;&amp;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <a class="code" href="MallocImpl_8cpp.html#a82a30bf7131b57795735a56cde24f5f3">mallctlnametomib</a>(<span class="stringliteral">&quot;arena.0.purge&quot;</span>, mib, &amp;miblen) == 0) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      mib[1] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(arenaForCurrent);</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <a class="code" href="MallocImpl_8cpp.html#abd873aefbcfa60cda7e5639f320a615c">mallctlbymib</a>(mib, miblen, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, 0);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::runtime_error&amp; ex) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="GLog_8h.html#ad81a56fa7ecaf8616c7d0b96e10ccfed">FB_LOG_EVERY_MS</a>(WARNING, 10000) &lt;&lt; ex.what();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;}</div><div class="ttc" id="structfolly_1_1CacheLocality_html_a7eb9cf59c3922234883e19b528df41cf"><div class="ttname"><a href="structfolly_1_1CacheLocality.html#a7eb9cf59c3922234883e19b528df41cf">folly::CacheLocality::system</a></div><div class="ttdeci">static const CacheLocality &amp; system()</div></div>
<div class="ttc" id="namespacefolly_html_afd107211692ed57ebcd9e14257f7b6bd"><div class="ttname"><a href="namespacefolly.html#afd107211692ed57ebcd9e14257f7b6bd">folly::usingJEMalloc</a></div><div class="ttdeci">bool usingJEMalloc() noexcept</div><div class="ttdef"><b>Definition:</b> <a href="memory_2Malloc_8h_source.html#l00147">Malloc.h:147</a></div></div>
<div class="ttc" id="namespacefolly_html_a22639fe1b7248d8ce3e18cedd38c53fe"><div class="ttname"><a href="namespacefolly.html#a22639fe1b7248d8ce3e18cedd38c53fe">folly::mallctlRead</a></div><div class="ttdeci">void mallctlRead(const char *cmd, T *out)</div><div class="ttdef"><b>Definition:</b> <a href="MallctlHelper_8h_source.html#l00048">MallctlHelper.h:48</a></div></div>
<div class="ttc" id="MallocImpl_8cpp_html_abd873aefbcfa60cda7e5639f320a615c"><div class="ttname"><a href="MallocImpl_8cpp.html#abd873aefbcfa60cda7e5639f320a615c">mallctlbymib</a></div><div class="ttdeci">int(* mallctlbymib)(const size_t *, size_t, void *, size_t *, void *, size_t)</div><div class="ttdef"><b>Definition:</b> <a href="MallocImpl_8cpp_source.html#l00044">MallocImpl.cpp:44</a></div></div>
<div class="ttc" id="GLog_8h_html_ad81a56fa7ecaf8616c7d0b96e10ccfed"><div class="ttname"><a href="GLog_8h.html#ad81a56fa7ecaf8616c7d0b96e10ccfed">FB_LOG_EVERY_MS</a></div><div class="ttdeci">#define FB_LOG_EVERY_MS(severity, milli_interval)</div><div class="ttdef"><b>Definition:</b> <a href="GLog_8h_source.html#l00036">GLog.h:36</a></div></div>
<div class="ttc" id="MallocImpl_8cpp_html_ac77af0531212e242b8a39fe7f773ce7a"><div class="ttname"><a href="MallocImpl_8cpp.html#ac77af0531212e242b8a39fe7f773ce7a">mallctl</a></div><div class="ttdeci">int(* mallctl)(const char *, void *, size_t *, void *, size_t)</div><div class="ttdef"><b>Definition:</b> <a href="MallocImpl_8cpp_source.html#l00042">MallocImpl.cpp:42</a></div></div>
<div class="ttc" id="MallocImpl_8cpp_html_a82a30bf7131b57795735a56cde24f5f3"><div class="ttname"><a href="MallocImpl_8cpp.html#a82a30bf7131b57795735a56cde24f5f3">mallctlnametomib</a></div><div class="ttdeci">int(* mallctlnametomib)(const char *, size_t *, size_t *)</div><div class="ttdef"><b>Definition:</b> <a href="MallocImpl_8cpp_source.html#l00043">MallocImpl.cpp:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abf9784a1a3b31b6215daf5c5e3b41d6d"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Futex , typename IdleTime  = std::chrono::steady_clock::duration&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273c">FutexResult</a> folly::detail::MemoryIdler::futexWait </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefolly_1_1detail.html#a119b8d460f481815f833da41cdc33141">Futex</a> &amp;&#160;</td>
          <td class="paramname"><em>fut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>expected</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>waitMask</em> = <code>-1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IdleTime const &amp;&#160;</td>
          <td class="paramname"><em>idleTimeout</em> = <code>defaultIdleTimeout.load(std::memory_order_acquire)</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>stackToRetain</em> = <code><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb">kDefaultStackToRetain</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>timeoutVariationFrac</em> = <code>0.5</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Equivalent to fut.futexWait(expected, waitMask), but calls <a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#af95c791c6a9e3c259e58d895e75a58f7">flushLocalMallocCaches()</a> and unmapUnusedStack(stackToRetain) after idleTimeout has passed (if it has passed). Internally uses fut.futexWait and fut.futexWaitUntil. The actual timeout will be pseudo-randomly chosen to be between idleTimeout and idleTimeout * (1 + timeoutVariationFraction), to smooth out the behavior in a system with bursty requests. The default is to wait up to 50% extra, so on average 25% extra. </p>

<p>Definition at line <a class="el" href="MemoryIdler_8h_source.html#l00102">102</a> of file <a class="el" href="MemoryIdler_8h_source.html">MemoryIdler.h</a>.</p>

<p>References <a class="el" href="Futex-inl_8h_source.html#l00100">folly::detail::futexWait()</a>, <a class="el" href="MemoryIdler_8h_source.html#l00167">futexWaitPreIdle()</a>, and <a class="el" href="LogLevel_8cpp_source.html#l00031">max</a>.</p>

<p>Referenced by <a class="el" href="fibers_2Baton_8cpp_source.html#l00062">folly::fibers::Baton::waitThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                                        {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273c">FutexResult</a> pre;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structfolly_1_1detail_1_1MemoryIdler.html#aaa6aef2dda0626837ef9909e593b8fcc">futexWaitPreIdle</a>(</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            pre,</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            fut,</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            expected,</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <a class="code" href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">std::chrono::steady_clock::time_point::max</a>(),</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            waitMask,</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            idleTimeout,</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            stackToRetain,</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            timeoutVariationFrac)) {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">return</span> pre;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keyword">using</span> <a class="code" href="namespacefolly_1_1detail.html#ac38f887dc2a632a181b751b11ebae575">folly::detail::futexWait</a>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structfolly_1_1detail_1_1MemoryIdler.html#abf9784a1a3b31b6215daf5c5e3b41d6d">futexWait</a>(&amp;fut, expected, waitMask);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  }</div><div class="ttc" id="namespacefolly_1_1detail_html_af130844a971c4ed26a0658a3e79f273c"><div class="ttname"><a href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273c">folly::detail::FutexResult</a></div><div class="ttdeci">FutexResult</div><div class="ttdef"><b>Definition:</b> <a href="Futex_8h_source.html#l00031">Futex.h:31</a></div></div>
<div class="ttc" id="LogLevel_8cpp_html_a15c8b90f03cae068a6979f32590642e2"><div class="ttname"><a href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">max</a></div><div class="ttdeci">LogLevel max</div><div class="ttdef"><b>Definition:</b> <a href="LogLevel_8cpp_source.html#l00031">LogLevel.cpp:31</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1MemoryIdler_html_abf9784a1a3b31b6215daf5c5e3b41d6d"><div class="ttname"><a href="structfolly_1_1detail_1_1MemoryIdler.html#abf9784a1a3b31b6215daf5c5e3b41d6d">folly::detail::MemoryIdler::futexWait</a></div><div class="ttdeci">static FutexResult futexWait(Futex &amp;fut, uint32_t expected, uint32_t waitMask=-1, IdleTime const &amp;idleTimeout=defaultIdleTimeout.load(std::memory_order_acquire), size_t stackToRetain=kDefaultStackToRetain, float timeoutVariationFrac=0.5)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdler_8h_source.html#l00102">MemoryIdler.h:102</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_ac38f887dc2a632a181b751b11ebae575"><div class="ttname"><a href="namespacefolly_1_1detail.html#ac38f887dc2a632a181b751b11ebae575">folly::detail::futexWait</a></div><div class="ttdeci">FutexResult futexWait(const Futex *futex, uint32_t expected, uint32_t waitMask)</div><div class="ttdef"><b>Definition:</b> <a href="Futex-inl_8h_source.html#l00100">Futex-inl.h:100</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1MemoryIdler_html_aaa6aef2dda0626837ef9909e593b8fcc"><div class="ttname"><a href="structfolly_1_1detail_1_1MemoryIdler.html#aaa6aef2dda0626837ef9909e593b8fcc">folly::detail::MemoryIdler::futexWaitPreIdle</a></div><div class="ttdeci">static bool futexWaitPreIdle(FutexResult &amp;_ret, Futex &amp;fut, uint32_t expected, Deadline const &amp;deadline, uint32_t waitMask, IdleTime idleTimeout, size_t stackToRetain, float timeoutVariationFrac)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdler_8h_source.html#l00167">MemoryIdler.h:167</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaa6aef2dda0626837ef9909e593b8fcc"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Futex , typename Deadline , typename IdleTime &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool folly::detail::MemoryIdler::futexWaitPreIdle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273c">FutexResult</a> &amp;&#160;</td>
          <td class="paramname"><em>_ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefolly_1_1detail.html#a119b8d460f481815f833da41cdc33141">Futex</a> &amp;&#160;</td>
          <td class="paramname"><em>fut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>expected</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Deadline const &amp;&#160;</td>
          <td class="paramname"><em>deadline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>waitMask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IdleTime&#160;</td>
          <td class="paramname"><em>idleTimeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>stackToRetain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>timeoutVariationFrac</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="MemoryIdler_8h_source.html#l00167">167</a> of file <a class="el" href="MemoryIdler_8h_source.html">MemoryIdler.h</a>.</p>

<p>References <a class="el" href="MemoryIdler_8cpp_source.html#l00041">flushLocalMallocCaches()</a>, <a class="el" href="Futex-inl_8h_source.html#l00112">folly::detail::futexWaitUntil()</a>, <a class="el" href="MemoryIdler_8h_source.html#l00139">futexWaitUntil()</a>, <a class="el" href="MemoryIdler_8h_source.html#l00070">getVariationTimeout()</a>, <a class="el" href="LogLevel_8cpp_source.html#l00031">max</a>, <a class="el" href="TimekeeperTest_8cpp_source.html#l00031">now()</a>, <a class="el" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a">folly::detail::TIMEDOUT</a>, and <a class="el" href="MemoryIdler_8cpp_source.html#l00199">unmapUnusedStack()</a>.</p>

<p>Referenced by <a class="el" href="MemoryIdler_8h_source.html#l00102">futexWait()</a>, and <a class="el" href="MemoryIdler_8h_source.html#l00139">futexWaitUntil()</a>.</p>
<div class="fragment"><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                                  {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="comment">// idleTimeout &lt; 0 means no flush behavior</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordflow">if</span> (idleTimeout &lt; IdleTime::zero()) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    }</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// idleTimeout == 0 means flush immediately, without variation</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// idleTimeout &gt; 0 means flush after delay, with variation</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span> (idleTimeout &gt; IdleTime::zero()) {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      idleTimeout = <a class="code" href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">std::max</a>(</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;          IdleTime::zero(),</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          <a class="code" href="structfolly_1_1detail_1_1MemoryIdler.html#a758e9dd63dd3019bcb7f9daeb15399bf">getVariationTimeout</a>(idleTimeout, timeoutVariationFrac));</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span> (idleTimeout &gt; IdleTime::zero()) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keyword">auto</span> idleDeadline = <a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">Deadline::clock::now</a>() + idleTimeout;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordflow">if</span> (idleDeadline &lt; deadline) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keyword">using</span> <a class="code" href="namespacefolly_1_1detail.html#a019c6366943c531ff2c486b93e13fb2a">folly::detail::futexWaitUntil</a>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keyword">auto</span> rv = <a class="code" href="structfolly_1_1detail_1_1MemoryIdler.html#afd31d32f83b5d646dfb7dd3ff1ab434b">futexWaitUntil</a>(&amp;fut, expected, idleDeadline, waitMask);</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordflow">if</span> (rv != <a class="code" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a">FutexResult::TIMEDOUT</a>) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;          <span class="comment">// finished before timeout hit, no flush</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;          _ret = rv;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// flush, then wait</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <a class="code" href="structfolly_1_1detail_1_1MemoryIdler.html#af95c791c6a9e3c259e58d895e75a58f7">flushLocalMallocCaches</a>();</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="structfolly_1_1detail_1_1MemoryIdler.html#aac74ffefb8c869d1d48ec5c540114839">unmapUnusedStack</a>(stackToRetain);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  }</div><div class="ttc" id="structfolly_1_1detail_1_1MemoryIdler_html_afd31d32f83b5d646dfb7dd3ff1ab434b"><div class="ttname"><a href="structfolly_1_1detail_1_1MemoryIdler.html#afd31d32f83b5d646dfb7dd3ff1ab434b">folly::detail::MemoryIdler::futexWaitUntil</a></div><div class="ttdeci">static FutexResult futexWaitUntil(Futex &amp;fut, uint32_t expected, Deadline const &amp;deadline, uint32_t waitMask=-1, IdleTime const &amp;idleTimeout=defaultIdleTimeout.load(std::memory_order_acquire), size_t stackToRetain=kDefaultStackToRetain, float timeoutVariationFrac=0.5)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdler_8h_source.html#l00139">MemoryIdler.h:139</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1MemoryIdler_html_aac74ffefb8c869d1d48ec5c540114839"><div class="ttname"><a href="structfolly_1_1detail_1_1MemoryIdler.html#aac74ffefb8c869d1d48ec5c540114839">folly::detail::MemoryIdler::unmapUnusedStack</a></div><div class="ttdeci">static void unmapUnusedStack(size_t retain=kDefaultStackToRetain)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdler_8cpp_source.html#l00199">MemoryIdler.cpp:199</a></div></div>
<div class="ttc" id="LogLevel_8cpp_html_a15c8b90f03cae068a6979f32590642e2"><div class="ttname"><a href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">max</a></div><div class="ttdeci">LogLevel max</div><div class="ttdef"><b>Definition:</b> <a href="LogLevel_8cpp_source.html#l00031">LogLevel.cpp:31</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1MemoryIdler_html_a758e9dd63dd3019bcb7f9daeb15399bf"><div class="ttname"><a href="structfolly_1_1detail_1_1MemoryIdler.html#a758e9dd63dd3019bcb7f9daeb15399bf">folly::detail::MemoryIdler::getVariationTimeout</a></div><div class="ttdeci">static IdleTime getVariationTimeout(IdleTime const &amp;idleTimeout=defaultIdleTimeout.load(std::memory_order_acquire), float timeoutVariationFrac=0.5)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdler_8h_source.html#l00070">MemoryIdler.h:70</a></div></div>
<div class="ttc" id="TimekeeperTest_8cpp_html_a562b4baa36dcf267f35a4ba4e0aef329"><div class="ttname"><a href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a></div><div class="ttdeci">std::chrono::steady_clock::time_point now()</div><div class="ttdef"><b>Definition:</b> <a href="TimekeeperTest_8cpp_source.html#l00031">TimekeeperTest.cpp:31</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_a019c6366943c531ff2c486b93e13fb2a"><div class="ttname"><a href="namespacefolly_1_1detail.html#a019c6366943c531ff2c486b93e13fb2a">folly::detail::futexWaitUntil</a></div><div class="ttdeci">FutexResult futexWaitUntil(const Futex *futex, uint32_t expected, std::chrono::time_point&lt; Clock, Duration &gt; const &amp;deadline, uint32_t waitMask)</div><div class="ttdef"><b>Definition:</b> <a href="Futex-inl_8h_source.html#l00112">Futex-inl.h:112</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1MemoryIdler_html_af95c791c6a9e3c259e58d895e75a58f7"><div class="ttname"><a href="structfolly_1_1detail_1_1MemoryIdler.html#af95c791c6a9e3c259e58d895e75a58f7">folly::detail::MemoryIdler::flushLocalMallocCaches</a></div><div class="ttdeci">static void flushLocalMallocCaches()</div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdler_8cpp_source.html#l00041">MemoryIdler.cpp:41</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a"><div class="ttname"><a href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a">folly::detail::FutexResult::TIMEDOUT</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afd31d32f83b5d646dfb7dd3ff1ab434b"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Futex , typename Deadline , typename IdleTime  = std::chrono::steady_clock::duration&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273c">FutexResult</a> folly::detail::MemoryIdler::futexWaitUntil </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefolly_1_1detail.html#a119b8d460f481815f833da41cdc33141">Futex</a> &amp;&#160;</td>
          <td class="paramname"><em>fut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>expected</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Deadline const &amp;&#160;</td>
          <td class="paramname"><em>deadline</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>waitMask</em> = <code>-1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IdleTime const &amp;&#160;</td>
          <td class="paramname"><em>idleTimeout</em> = <code>defaultIdleTimeout.load(std::memory_order_acquire)</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>stackToRetain</em> = <code><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb">kDefaultStackToRetain</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>timeoutVariationFrac</em> = <code>0.5</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Equivalent to fut.futexWaitUntil(expected, deadline, waitMask), but calls <a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#af95c791c6a9e3c259e58d895e75a58f7">flushLocalMallocCaches()</a> and unmapUnusedStack(stackToRetain) after idleTimeout has passed (if it has passed). Internally uses fut.futexWaitUntil. The actual timeout will be pseudo-randomly chosen to be between idleTimeout and idleTimeout * (1 + timeoutVariationFraction), to smooth out the behavior in a system with bursty requests. The default is to wait up to 50% extra, so on average 25% extra. </p>

<p>Definition at line <a class="el" href="MemoryIdler_8h_source.html#l00139">139</a> of file <a class="el" href="MemoryIdler_8h_source.html">MemoryIdler.h</a>.</p>

<p>References <a class="el" href="MemoryIdler_8h_source.html#l00167">futexWaitPreIdle()</a>, and <a class="el" href="Futex-inl_8h_source.html#l00112">folly::detail::futexWaitUntil()</a>.</p>

<p>Referenced by <a class="el" href="MemoryIdler_8h_source.html#l00167">futexWaitPreIdle()</a>, <a class="el" href="MemoryIdlerTest_8cpp_source.html#l00109">TEST()</a>, <a class="el" href="synchronization_2Baton_8h_source.html#l00263">folly::Baton&lt; MayBlock, Atom &gt;::tryWaitSlow()</a>, and <a class="el" href="SaturatingSemaphore_8h_source.html#l00280">folly::SaturatingSemaphore&lt; MayBlock, Atom &gt;::tryWaitSlow()</a>.</p>
<div class="fragment"><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                                        {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273c">FutexResult</a> pre;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structfolly_1_1detail_1_1MemoryIdler.html#aaa6aef2dda0626837ef9909e593b8fcc">futexWaitPreIdle</a>(</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            pre,</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            fut,</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            expected,</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            deadline,</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            waitMask,</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            idleTimeout,</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            stackToRetain,</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            timeoutVariationFrac)) {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="keywordflow">return</span> pre;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keyword">using</span> <a class="code" href="namespacefolly_1_1detail.html#a019c6366943c531ff2c486b93e13fb2a">folly::detail::futexWaitUntil</a>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structfolly_1_1detail_1_1MemoryIdler.html#afd31d32f83b5d646dfb7dd3ff1ab434b">futexWaitUntil</a>(&amp;fut, expected, deadline, waitMask);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  }</div><div class="ttc" id="namespacefolly_1_1detail_html_af130844a971c4ed26a0658a3e79f273c"><div class="ttname"><a href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273c">folly::detail::FutexResult</a></div><div class="ttdeci">FutexResult</div><div class="ttdef"><b>Definition:</b> <a href="Futex_8h_source.html#l00031">Futex.h:31</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1MemoryIdler_html_afd31d32f83b5d646dfb7dd3ff1ab434b"><div class="ttname"><a href="structfolly_1_1detail_1_1MemoryIdler.html#afd31d32f83b5d646dfb7dd3ff1ab434b">folly::detail::MemoryIdler::futexWaitUntil</a></div><div class="ttdeci">static FutexResult futexWaitUntil(Futex &amp;fut, uint32_t expected, Deadline const &amp;deadline, uint32_t waitMask=-1, IdleTime const &amp;idleTimeout=defaultIdleTimeout.load(std::memory_order_acquire), size_t stackToRetain=kDefaultStackToRetain, float timeoutVariationFrac=0.5)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdler_8h_source.html#l00139">MemoryIdler.h:139</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1MemoryIdler_html_aaa6aef2dda0626837ef9909e593b8fcc"><div class="ttname"><a href="structfolly_1_1detail_1_1MemoryIdler.html#aaa6aef2dda0626837ef9909e593b8fcc">folly::detail::MemoryIdler::futexWaitPreIdle</a></div><div class="ttdeci">static bool futexWaitPreIdle(FutexResult &amp;_ret, Futex &amp;fut, uint32_t expected, Deadline const &amp;deadline, uint32_t waitMask, IdleTime idleTimeout, size_t stackToRetain, float timeoutVariationFrac)</div><div class="ttdef"><b>Definition:</b> <a href="MemoryIdler_8h_source.html#l00167">MemoryIdler.h:167</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_a019c6366943c531ff2c486b93e13fb2a"><div class="ttname"><a href="namespacefolly_1_1detail.html#a019c6366943c531ff2c486b93e13fb2a">folly::detail::futexWaitUntil</a></div><div class="ttdeci">FutexResult futexWaitUntil(const Futex *futex, uint32_t expected, std::chrono::time_point&lt; Clock, Duration &gt; const &amp;deadline, uint32_t waitMask)</div><div class="ttdef"><b>Definition:</b> <a href="Futex-inl_8h_source.html#l00112">Futex-inl.h:112</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a758e9dd63dd3019bcb7f9daeb15399bf"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename IdleTime  = std::chrono::steady_clock::duration&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static IdleTime folly::detail::MemoryIdler::getVariationTimeout </td>
          <td>(</td>
          <td class="paramtype">IdleTime const &amp;&#160;</td>
          <td class="paramname"><em>idleTimeout</em> = <code>defaultIdleTimeout.load(std::memory_order_acquire)</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>timeoutVariationFrac</em> = <code>0.5</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Selects a timeout pseudo-randomly chosen to be between idleTimeout and idleTimeout * (1 + timeoutVariationFraction), to smooth out the behavior in a bursty system </p>

<p>Definition at line <a class="el" href="MemoryIdler_8h_source.html#l00070">70</a> of file <a class="el" href="MemoryIdler_8h_source.html">MemoryIdler.h</a>.</p>

<p>References <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc_source.html#l00176">count</a>, <a class="el" href="ThreadId_8h_source.html#l00042">folly::getCurrentThreadID()</a>, <a class="el" href="Hazptr_8h_source.html#l00116">h</a>, <a class="el" href="hash_2Hash_8h_source.html#l00669">folly::hash::hash_combine()</a>, <a class="el" href="LogLevel_8cpp_source.html#l00031">max</a>, <a class="el" href="TimekeeperTest_8cpp_source.html#l00031">now()</a>, <a class="el" href="hash_2Hash_8h_source.html#l00049">folly::hash::twang_mix64()</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00190">uint64_t</a>.</p>

<p>Referenced by <a class="el" href="MemoryIdler_8h_source.html#l00167">futexWaitPreIdle()</a>, and <a class="el" href="IOThreadPoolExecutor_8cpp_source.html#l00044">folly::MemoryIdlerTimeout::runLoopCallback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                                        {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">if</span> (idleTimeout &lt;= IdleTime::zero() || timeoutVariationFrac &lt;= 0) {</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="keywordflow">return</span> idleTimeout;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    }</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// hash the pthread_t and the time to get the adjustment</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// Standard hash func isn&#39;t very good, so bit mix the result</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a> <a class="code" href="Hazptr_8h.html#ab25155a2370ac096e61dc7e39e2816df">h</a> = <a class="code" href="namespacefolly_1_1hash.html#adc4a7d443ebea5c9dc39d64733154fb8">folly::hash::twang_mix64</a>(<a class="code" href="namespacefolly_1_1hash.html#a1099292075b60785e96c8e32858745eb">folly::hash::hash_combine</a>(</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="namespacefolly.html#a2edfdc4c15f6ef5e138238c63b48d19f">getCurrentThreadID</a>(),</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">std::chrono::system_clock::now</a>().time_since_epoch().<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc.html#afd9db40e3361ae09188795e8cbe19752">count</a>()));</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// multiplying the duration by a floating point doesn&#39;t work, grr</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keyword">auto</span> extraFrac = timeoutVariationFrac /</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(<a class="code" href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">std::numeric_limits&lt;uint64_t&gt;::max</a>()) * h;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">auto</span> tics = <a class="code" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a>(idleTimeout.count() * (1 + extraFrac));</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">return</span> IdleTime(tics);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  }</div><div class="ttc" id="Hazptr_8h_html_ab25155a2370ac096e61dc7e39e2816df"><div class="ttname"><a href="Hazptr_8h.html#ab25155a2370ac096e61dc7e39e2816df">h</a></div><div class="ttdeci">*than *hazptr_holder h</div><div class="ttdef"><b>Definition:</b> <a href="Hazptr_8h_source.html#l00116">Hazptr.h:116</a></div></div>
<div class="ttc" id="LogLevel_8cpp_html_a15c8b90f03cae068a6979f32590642e2"><div class="ttname"><a href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">max</a></div><div class="ttdeci">LogLevel max</div><div class="ttdef"><b>Definition:</b> <a href="LogLevel_8cpp_source.html#l00031">LogLevel.cpp:31</a></div></div>
<div class="ttc" id="TimekeeperTest_8cpp_html_a562b4baa36dcf267f35a4ba4e0aef329"><div class="ttname"><a href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a></div><div class="ttdeci">std::chrono::steady_clock::time_point now()</div><div class="ttdef"><b>Definition:</b> <a href="TimekeeperTest_8cpp_source.html#l00031">TimekeeperTest.cpp:31</a></div></div>
<div class="ttc" id="namespacefolly_1_1hash_html_a1099292075b60785e96c8e32858745eb"><div class="ttname"><a href="namespacefolly_1_1hash.html#a1099292075b60785e96c8e32858745eb">folly::hash::hash_combine</a></div><div class="ttdeci">size_t hash_combine(const T &amp;t, const Ts &amp;...ts) noexcept(noexcept(hash_combine_generic(StdHasher{}, t, ts...)))</div><div class="ttdef"><b>Definition:</b> <a href="hash_2Hash_8h_source.html#l00669">Hash.h:669</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc_html_afd9db40e3361ae09188795e8cbe19752"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc.html#afd9db40e3361ae09188795e8cbe19752">count</a></div><div class="ttdeci">int * count</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc_source.html#l00176">gmock_stress_test.cc:176</a></div></div>
<div class="ttc" id="namespacefolly_1_1hash_html_adc4a7d443ebea5c9dc39d64733154fb8"><div class="ttname"><a href="namespacefolly_1_1hash.html#adc4a7d443ebea5c9dc39d64733154fb8">folly::hash::twang_mix64</a></div><div class="ttdeci">uint64_t twang_mix64(uint64_t key) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="hash_2Hash_8h_source.html#l00049">Hash.h:49</a></div></div>
<div class="ttc" id="namespacefolly_html_a2edfdc4c15f6ef5e138238c63b48d19f"><div class="ttname"><a href="namespacefolly.html#a2edfdc4c15f6ef5e138238c63b48d19f">folly::getCurrentThreadID</a></div><div class="ttdeci">uint64_t getCurrentThreadID()</div><div class="ttdef"><b>Definition:</b> <a href="ThreadId_8h_source.html#l00042">ThreadId.h:42</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a5dc34568a989dd90728a4ed499cd9fab"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a></div><div class="ttdeci">uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00190">ConstexprMathBenchmark.cpp:190</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aac74ffefb8c869d1d48ec5c540114839"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::detail::MemoryIdler::unmapUnusedStack </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>retain</em> = <code><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html#a224c82fba50fbe0e92ab9f1282894227aee853382fc48d07777ad961634459fdb">kDefaultStackToRetain</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Uses madvise to discard the portion of the thread's stack that currently doesn't hold any data, trying to ensure that no page faults will occur during the next retain bytes of stack allocation </p>

<p>Definition at line <a class="el" href="MemoryIdler_8cpp_source.html#l00199">199</a> of file <a class="el" href="MemoryIdler_8cpp_source.html">MemoryIdler.cpp</a>.</p>

<p>Referenced by <a class="el" href="MemoryIdlerBenchmark_8cpp_source.html#l00023">BENCHMARK()</a>, <a class="el" href="MemoryIdler_8cpp_source.html#l00041">flushLocalMallocCaches()</a>, <a class="el" href="MemoryIdler_8h_source.html#l00167">futexWaitPreIdle()</a>, <a class="el" href="IOThreadPoolExecutor_8cpp_source.html#l00044">folly::MemoryIdlerTimeout::runLoopCallback()</a>, and <a class="el" href="MemoryIdlerTest_8cpp_source.html#l00030">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;{}</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a0449a08cc377963dc1e0e5eeb6066351"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1AtomicStruct.html">AtomicStruct</a>&lt; std::chrono::steady_clock::duration &gt; folly::detail::MemoryIdler::defaultIdleTimeout</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The system-wide default for the amount of time a blocking thread should wait before reclaiming idle memory. Set this to Duration::max() to never wait. The default value is 5 seconds. Endpoints using this idle timeout might randomly wait longer to avoid synchronizing their flushes. </p>

<p>Definition at line <a class="el" href="MemoryIdler_8h_source.html#l00064">64</a> of file <a class="el" href="MemoryIdler_8h_source.html">MemoryIdler.h</a>.</p>

<p>Referenced by <a class="el" href="IOThreadPoolExecutor_8cpp_source.html#l00044">folly::MemoryIdlerTimeout::runLoopCallback()</a>, and <a class="el" href="MemoryIdlerTest_8cpp_source.html#l00109">TEST()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following files:<ul>
<li>proxygen/folly/folly/detail/<a class="el" href="MemoryIdler_8h_source.html">MemoryIdler.h</a></li>
<li>proxygen/folly/folly/detail/<a class="el" href="MemoryIdler_8cpp_source.html">MemoryIdler.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefolly.html">folly</a></li><li class="navelem"><a class="el" href="namespacefolly_1_1detail.html">detail</a></li><li class="navelem"><a class="el" href="structfolly_1_1detail_1_1MemoryIdler.html">MemoryIdler</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
