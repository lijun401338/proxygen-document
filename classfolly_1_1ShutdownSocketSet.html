<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: folly::ShutdownSocketSet Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfolly_1_1ShutdownSocketSet.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classfolly_1_1ShutdownSocketSet-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::ShutdownSocketSet Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="ShutdownSocketSet_8h_source.html">ShutdownSocketSet.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for folly::ShutdownSocketSet:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classfolly_1_1ShutdownSocketSet.png" usemap="#folly::ShutdownSocketSet_map" alt=""/>
  <map id="folly::ShutdownSocketSet_map" name="folly::ShutdownSocketSet_map">
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1ShutdownSocketSet_1_1Free.html">Free</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:abb4891c0685e0946e680528e536f39f6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#abb4891c0685e0946e680528e536f39f6">ShutdownSocketSet</a> (int maxFd=1&lt;&lt; 18)</td></tr>
<tr class="separator:abb4891c0685e0946e680528e536f39f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a415b7df74172675e9331810c91048049"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#a415b7df74172675e9331810c91048049">add</a> (int fd)</td></tr>
<tr class="separator:a415b7df74172675e9331810c91048049"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00fc0d4b70c183e3678c97a727bd7c1e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#a00fc0d4b70c183e3678c97a727bd7c1e">remove</a> (int fd)</td></tr>
<tr class="separator:a00fc0d4b70c183e3678c97a727bd7c1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fdbae020a649b1e3e6819dd13a1913c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#a4fdbae020a649b1e3e6819dd13a1913c">close</a> (int fd)</td></tr>
<tr class="separator:a4fdbae020a649b1e3e6819dd13a1913c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13d250586894865fdaef05d9fbbe4f98"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#a13d250586894865fdaef05d9fbbe4f98">shutdown</a> (int fd, bool abortive=false)</td></tr>
<tr class="separator:a13d250586894865fdaef05d9fbbe4f98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27a3b3ce235f66b9bc3a8b6554c9cb33"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#a27a3b3ce235f66b9bc3a8b6554c9cb33">shutdownAll</a> (bool abortive=false)</td></tr>
<tr class="separator:a27a3b3ce235f66b9bc3a8b6554c9cb33"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a5d9f1589ed4adf3db85f1ad3d40e3976"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976">State</a> : uint8_t { <br />
&#160;&#160;<a class="el" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">FREE</a> = 0, 
<a class="el" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">IN_USE</a>, 
<a class="el" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e">IN_SHUTDOWN</a>, 
<a class="el" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160">SHUT_DOWN</a>, 
<br />
&#160;&#160;<a class="el" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817">MUST_CLOSE</a>
<br />
 }</td></tr>
<tr class="separator:a5d9f1589ed4adf3db85f1ad3d40e3976"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a8e1df6e38cc65d2a6e86d2690d27d6fe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#a8e1df6e38cc65d2a6e86d2690d27d6fe">doShutdown</a> (int fd, bool abortive)</td></tr>
<tr class="separator:a8e1df6e38cc65d2a6e86d2690d27d6fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a310f00e86dca4cf13ec6a00e729b6d2f"><td class="memItemLeft" align="right" valign="top">const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">maxFd_</a></td></tr>
<tr class="separator:a310f00e86dca4cf13ec6a00e729b6d2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef07e35b6f5cbb5afb861d712de2250f"><td class="memItemLeft" align="right" valign="top">std::unique_ptr&lt; std::atomic&lt; <a class="el" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> &gt;[], <a class="el" href="structfolly_1_1ShutdownSocketSet_1_1Free.html">Free</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">data_</a></td></tr>
<tr class="separator:aef07e35b6f5cbb5afb861d712de2250f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcd057ad7457cf5b4d6b09ccc5e250ad"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1File.html">folly::File</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ShutdownSocketSet.html#abcd057ad7457cf5b4d6b09ccc5e250ad">nullFile_</a></td></tr>
<tr class="separator:abcd057ad7457cf5b4d6b09ccc5e250ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Set of sockets that allows immediate, take-no-prisoners abort. </p>

<p>Definition at line <a class="el" href="ShutdownSocketSet_8h_source.html#l00032">32</a> of file <a class="el" href="ShutdownSocketSet_8h_source.html">ShutdownSocketSet.h</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="a5d9f1589ed4adf3db85f1ad3d40e3976"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976">folly::ShutdownSocketSet::State</a> : <a class="el" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1"></a>FREE&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb"></a>IN_USE&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e"></a>IN_SHUTDOWN&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160"></a>SHUT_DOWN&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817"></a>MUST_CLOSE&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="ShutdownSocketSet_8h_source.html#l00124">124</a> of file <a class="el" href="ShutdownSocketSet_8h_source.html">ShutdownSocketSet.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;             : <a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">FREE</a> = 0,</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">IN_USE</a>,</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e">IN_SHUTDOWN</a>,</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160">SHUT_DOWN</a>,</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817">MUST_CLOSE</a>,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  };</div><div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">folly::ShutdownSocketSet::FREE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00125">ShutdownSocketSet.h:125</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817">folly::ShutdownSocketSet::MUST_CLOSE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00129">ShutdownSocketSet.h:129</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00178">ConstexprMathBenchmark.cpp:178</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">folly::ShutdownSocketSet::IN_USE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00126">ShutdownSocketSet.h:126</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e">folly::ShutdownSocketSet::IN_SHUTDOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00127">ShutdownSocketSet.h:127</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160">folly::ShutdownSocketSet::SHUT_DOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00128">ShutdownSocketSet.h:128</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="abb4891c0685e0946e680528e536f39f6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::ShutdownSocketSet::ShutdownSocketSet </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxFd</em> = <code>1&#160;&lt;&lt;&#160;18</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Create a socket set that can handle file descriptors &lt; maxFd. The default value (256Ki) is high enough for just about all applications, even if you increased the number of file descriptors on your system. </p>

<p>Definition at line <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00029">29</a> of file <a class="el" href="ShutdownSocketSet_8cpp_source.html">ShutdownSocketSet.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    : <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">maxFd_</a>(maxFd),</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;      <a class="code" href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">data_</a>(<span class="keyword">static_cast&lt;</span>std::atomic&lt;uint8_t&gt;*<span class="keyword">&gt;</span>(</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;          <a class="code" href="namespacefolly.html#a33946753578396f69f91c33aa2fb95a4">folly::checkedCalloc</a>(<span class="keywordtype">size_t</span>(maxFd), <span class="keyword">sizeof</span>(std::atomic&lt;uint8_t&gt;)))),</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      <a class="code" href="classfolly_1_1ShutdownSocketSet.html#abcd057ad7457cf5b4d6b09ccc5e250ad">nullFile_</a>(<span class="stringliteral">&quot;/dev/null&quot;</span>, O_RDWR) {}</div><div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a310f00e86dca4cf13ec6a00e729b6d2f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">folly::ShutdownSocketSet::maxFd_</a></div><div class="ttdeci">const int maxFd_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00139">ShutdownSocketSet.h:139</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_abcd057ad7457cf5b4d6b09ccc5e250ad"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#abcd057ad7457cf5b4d6b09ccc5e250ad">folly::ShutdownSocketSet::nullFile_</a></div><div class="ttdeci">folly::File nullFile_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00141">ShutdownSocketSet.h:141</a></div></div>
<div class="ttc" id="namespacefolly_html_a33946753578396f69f91c33aa2fb95a4"><div class="ttname"><a href="namespacefolly.html#a33946753578396f69f91c33aa2fb95a4">folly::checkedCalloc</a></div><div class="ttdeci">void * checkedCalloc(size_t n, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="memory_2Malloc_8h_source.html#l00235">Malloc.h:235</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_aef07e35b6f5cbb5afb861d712de2250f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">folly::ShutdownSocketSet::data_</a></div><div class="ttdeci">std::unique_ptr&lt; std::atomic&lt; uint8_t &gt;[], Free &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00140">ShutdownSocketSet.h:140</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a415b7df74172675e9331810c91048049"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::ShutdownSocketSet::add </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add an already open socket to the list of sockets managed by <a class="el" href="classfolly_1_1ShutdownSocketSet.html">ShutdownSocketSet</a>. You MUST close the socket by calling <a class="el" href="classfolly_1_1ShutdownSocketSet.html#a4fdbae020a649b1e3e6819dd13a1913c">ShutdownSocketSet::close</a> (which will, as a side effect, also handle EINTR properly) and not by calling <a class="el" href="classfolly_1_1ShutdownSocketSet.html#a4fdbae020a649b1e3e6819dd13a1913c">close()</a> on the file descriptor. </p>

<p>Definition at line <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00035">35</a> of file <a class="el" href="ShutdownSocketSet_8cpp_source.html">ShutdownSocketSet.cpp</a>.</p>

<p>References <a class="el" href="ShutdownSocketSet_8h_source.html#l00140">data_</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00125">FREE</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00126">IN_USE</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00139">maxFd_</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00178">uint8_t</a>.</p>

<p>Referenced by <a class="el" href="AsyncSocket_8cpp_source.html#l00431">folly::AsyncSocket::connect()</a>, <a class="el" href="ShutdownSocketSetTest_8cpp_source.html#l00056">folly::test::Server::Server()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">folly::AsyncServerSocket::setupSocket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                                  {</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="comment">// Silently ignore any fds &gt;= maxFd_, very unlikely</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  DCHECK_GE(fd, 0);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">if</span> (fd &gt;= <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">maxFd_</a>) {</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  }</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keyword">auto</span>&amp; sref = <a class="code" href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">data_</a>[size_t(fd)];</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> prevState = <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">FREE</a>;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  CHECK(sref.compare_exchange_strong(</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      prevState, <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">IN_USE</a>, std::memory_order_relaxed))</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Invalid prev state for fd &quot;</span> &lt;&lt; fd &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <span class="keywordtype">int</span>(prevState);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;}</div><div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">folly::ShutdownSocketSet::FREE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00125">ShutdownSocketSet.h:125</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a310f00e86dca4cf13ec6a00e729b6d2f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">folly::ShutdownSocketSet::maxFd_</a></div><div class="ttdeci">const int maxFd_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00139">ShutdownSocketSet.h:139</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00178">ConstexprMathBenchmark.cpp:178</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">folly::ShutdownSocketSet::IN_USE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00126">ShutdownSocketSet.h:126</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_aef07e35b6f5cbb5afb861d712de2250f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">folly::ShutdownSocketSet::data_</a></div><div class="ttdeci">std::unique_ptr&lt; std::atomic&lt; uint8_t &gt;[], Free &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00140">ShutdownSocketSet.h:140</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4fdbae020a649b1e3e6819dd13a1913c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int folly::ShutdownSocketSet::close </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Close a socket managed by <a class="el" href="classfolly_1_1ShutdownSocketSet.html">ShutdownSocketSet</a>. Returns the same return code as <a class="el" href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">close()</a> (and sets errno accordingly). </p>

<p>Definition at line <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00073">73</a> of file <a class="el" href="ShutdownSocketSet_8cpp_source.html">ShutdownSocketSet.cpp</a>.</p>

<p>References <a class="el" href="FileUtil_8cpp_source.html#l00056">folly::closeNoInt()</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00140">data_</a>, <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc">folly::FATAL</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00125">FREE</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00127">IN_SHUTDOWN</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00126">IN_USE</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00139">maxFd_</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00129">MUST_CLOSE</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00128">SHUT_DOWN</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00178">uint8_t</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00422">folly::AsyncServerSocket::bind()</a>, <a class="el" href="ShutdownSocketSetTest_8cpp_source.html#l00105">folly::test::Server::closeClients()</a>, <a class="el" href="AsyncSocket_8cpp_source.html#l02790">folly::AsyncSocket::doClose()</a>, <a class="el" href="ShutdownSocketSetTest_8cpp_source.html#l00056">folly::test::Server::Server()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">folly::AsyncServerSocket::stopAccepting()</a>.</p>
<div class="fragment"><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                                   {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  DCHECK_GE(fd, 0);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">if</span> (fd &gt;= <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">maxFd_</a>) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a>(fd);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keyword">auto</span>&amp; sref = <a class="code" href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">data_</a>[size_t(fd)];</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> prevState = sref.load(std::memory_order_relaxed);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> newState = 0;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">switch</span> (prevState) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">IN_USE</a>:</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160">SHUT_DOWN</a>:</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        newState = <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">FREE</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e">IN_SHUTDOWN</a>:</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        newState = <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817">MUST_CLOSE</a>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        LOG(<a class="code" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc">FATAL</a>) &lt;&lt; <span class="stringliteral">&quot;Invalid prev state for fd &quot;</span> &lt;&lt; fd &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                   &lt;&lt; int(prevState);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  } <span class="keywordflow">while</span> (!sref.compare_exchange_weak(</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      prevState, newState, std::memory_order_relaxed));</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="keywordflow">return</span> newState == <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">FREE</a> ? <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a>(fd) : 0;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;}</div><div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">folly::ShutdownSocketSet::FREE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00125">ShutdownSocketSet.h:125</a></div></div>
<div class="ttc" id="namespacefolly_html_af5b0e02d1e436376f25df5c4927ad308"><div class="ttname"><a href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a></div><div class="ttdeci">int closeNoInt(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00056">FileUtil.cpp:56</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a310f00e86dca4cf13ec6a00e729b6d2f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">folly::ShutdownSocketSet::maxFd_</a></div><div class="ttdeci">const int maxFd_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00139">ShutdownSocketSet.h:139</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817">folly::ShutdownSocketSet::MUST_CLOSE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00129">ShutdownSocketSet.h:129</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00178">ConstexprMathBenchmark.cpp:178</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">folly::ShutdownSocketSet::IN_USE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00126">ShutdownSocketSet.h:126</a></div></div>
<div class="ttc" id="namespacefolly_html_a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc"><div class="ttname"><a href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc">folly::LogLevel::FATAL</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e">folly::ShutdownSocketSet::IN_SHUTDOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00127">ShutdownSocketSet.h:127</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_aef07e35b6f5cbb5afb861d712de2250f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">folly::ShutdownSocketSet::data_</a></div><div class="ttdeci">std::unique_ptr&lt; std::atomic&lt; uint8_t &gt;[], Free &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00140">ShutdownSocketSet.h:140</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160">folly::ShutdownSocketSet::SHUT_DOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00128">ShutdownSocketSet.h:128</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8e1df6e38cc65d2a6e86d2690d27d6fe"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::ShutdownSocketSet::doShutdown </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>abortive</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00143">143</a> of file <a class="el" href="ShutdownSocketSet_8cpp_source.html">ShutdownSocketSet.cpp</a>.</p>

<p>References <a class="el" href="FileUtil_8cpp_source.html#l00072">folly::dup2NoInt()</a>, <a class="el" href="File_8h_source.html#l00085">folly::File::fd()</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00141">nullFile_</a>, <a class="el" href="NetOps_8cpp_source.html#l00384">folly::netops::setsockopt()</a>, and <a class="el" href="FileUtil_8cpp_source.html#l00098">folly::shutdownNoInt()</a>.</p>

<p>Referenced by <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00102">shutdown()</a>.</p>
<div class="fragment"><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                                        {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// shutdown() the socket first, to awaken any threads blocked on the fd</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="comment">// (subsequent IO will fail because it&#39;s been shutdown); close()ing the</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="comment">// socket does not wake up blockers, see</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <span class="comment">// http://stackoverflow.com/a/3624545/1736339</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <a class="code" href="namespacefolly.html#aef8909ab9cc380e8e59c8328aff2df3c">folly::shutdownNoInt</a>(fd, SHUT_RDWR);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="comment">// If abortive shutdown is desired, we&#39;ll set the SO_LINGER option on</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="comment">// the socket with a timeout of 0; this will cause RST to be sent on</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <span class="comment">// close.</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">if</span> (abortive) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keyword">struct </span>linger l = {1, 0};</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(fd, SOL_SOCKET, SO_LINGER, &amp;l, <span class="keyword">sizeof</span>(l)) != 0) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="comment">// Probably not a socket, ignore.</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">// We can&#39;t close() the socket, as that would be dangerous; a new file</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="comment">// could be opened and get the same file descriptor, and then code assuming</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="comment">// the old fd would do IO in the wrong place. We&#39;ll (atomically) dup2</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <span class="comment">// /dev/null onto the fd instead.</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <a class="code" href="namespacefolly.html#a4076a9d457ebc504e81613eb4e1b06c4">folly::dup2NoInt</a>(<a class="code" href="classfolly_1_1ShutdownSocketSet.html#abcd057ad7457cf5b4d6b09ccc5e250ad">nullFile_</a>.<a class="code" href="classfolly_1_1File.html#ad5a7fede63287b920672e5c08899c686">fd</a>(), fd);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;}</div><div class="ttc" id="namespacefolly_html_aef8909ab9cc380e8e59c8328aff2df3c"><div class="ttname"><a href="namespacefolly.html#aef8909ab9cc380e8e59c8328aff2df3c">folly::shutdownNoInt</a></div><div class="ttdeci">int shutdownNoInt(NetworkSocket fd, int how)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00098">FileUtil.cpp:98</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a5046254be249f288deb01103b5db274d"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">folly::netops::setsockopt</a></div><div class="ttdeci">int setsockopt(NetworkSocket s, int level, int optname, const void *optval, socklen_t optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00384">NetOps.cpp:384</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_abcd057ad7457cf5b4d6b09ccc5e250ad"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#abcd057ad7457cf5b4d6b09ccc5e250ad">folly::ShutdownSocketSet::nullFile_</a></div><div class="ttdeci">folly::File nullFile_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00141">ShutdownSocketSet.h:141</a></div></div>
<div class="ttc" id="classfolly_1_1File_html_ad5a7fede63287b920672e5c08899c686"><div class="ttname"><a href="classfolly_1_1File.html#ad5a7fede63287b920672e5c08899c686">folly::File::fd</a></div><div class="ttdeci">int fd() const </div><div class="ttdef"><b>Definition:</b> <a href="File_8h_source.html#l00085">File.h:85</a></div></div>
<div class="ttc" id="namespacefolly_html_a4076a9d457ebc504e81613eb4e1b06c4"><div class="ttname"><a href="namespacefolly.html#a4076a9d457ebc504e81613eb4e1b06c4">folly::dup2NoInt</a></div><div class="ttdeci">int dup2NoInt(int oldfd, int newfd)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00072">FileUtil.cpp:72</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a00fc0d4b70c183e3678c97a727bd7c1e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::ShutdownSocketSet::remove </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove a socket from the list of sockets managed by <a class="el" href="classfolly_1_1ShutdownSocketSet.html">ShutdownSocketSet</a>. Note that <a class="el" href="classfolly_1_1ShutdownSocketSet.html#a00fc0d4b70c183e3678c97a727bd7c1e">remove()</a> might block! (which we lamely implement by <a class="el" href="namespacefolly_1_1futures.html#a4562a876ed28c23e98c168f553280c7a">sleep()</a>-ing) in the extremely rare case that the fd is currently being <a class="el" href="classfolly_1_1ShutdownSocketSet.html#a13d250586894865fdaef05d9fbbe4f98">shutdown()</a>. </p>

<p>Definition at line <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00049">49</a> of file <a class="el" href="ShutdownSocketSet_8cpp_source.html">ShutdownSocketSet.cpp</a>.</p>

<p>References <a class="el" href="ShutdownSocketSet_8h_source.html#l00140">data_</a>, <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc">folly::FATAL</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00125">FREE</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00127">IN_SHUTDOWN</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00139">maxFd_</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00178">uint8_t</a>.</p>

<p>Referenced by <a class="el" href="AsyncSocket_8cpp_source.html#l00400">folly::AsyncSocket::setShutdownSocketSet()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00179">folly::AsyncServerSocket::setShutdownSocketSet()</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                     {</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  DCHECK_GE(fd, 0);</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">if</span> (fd &gt;= <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">maxFd_</a>) {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  }</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keyword">auto</span>&amp; sref = <a class="code" href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">data_</a>[size_t(fd)];</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> prevState = 0;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  prevState = sref.load(std::memory_order_relaxed);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordflow">switch</span> (prevState) {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e">IN_SHUTDOWN</a>:</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        std::this_thread::sleep_for(std::chrono::milliseconds(1));</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        prevState = sref.load(std::memory_order_relaxed);</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">FREE</a>:</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        LOG(<a class="code" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc">FATAL</a>) &lt;&lt; <span class="stringliteral">&quot;Invalid prev state for fd &quot;</span> &lt;&lt; fd &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                   &lt;&lt; int(prevState);</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  } <span class="keywordflow">while</span> (</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      !sref.compare_exchange_weak(prevState, <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">FREE</a>, std::memory_order_relaxed));</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;}</div><div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">folly::ShutdownSocketSet::FREE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00125">ShutdownSocketSet.h:125</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a310f00e86dca4cf13ec6a00e729b6d2f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">folly::ShutdownSocketSet::maxFd_</a></div><div class="ttdeci">const int maxFd_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00139">ShutdownSocketSet.h:139</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00178">ConstexprMathBenchmark.cpp:178</a></div></div>
<div class="ttc" id="namespacefolly_html_a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc"><div class="ttname"><a href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc">folly::LogLevel::FATAL</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e">folly::ShutdownSocketSet::IN_SHUTDOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00127">ShutdownSocketSet.h:127</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_aef07e35b6f5cbb5afb861d712de2250f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">folly::ShutdownSocketSet::data_</a></div><div class="ttdeci">std::unique_ptr&lt; std::atomic&lt; uint8_t &gt;[], Free &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00140">ShutdownSocketSet.h:140</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a13d250586894865fdaef05d9fbbe4f98"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::ShutdownSocketSet::shutdown </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>abortive</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Shut down a socket. If abortive is true, we perform an abortive shutdown (send RST rather than FIN). Note that we might still end up sending FIN due to the rather interesting implementation.</p>
<p>This is async-signal-safe and ignores errors. Obviously, subsequent <a class="el" href="namespacefizz_1_1detail.html#a36dc6280bf4d04bce115a7055a78abac">read()</a> and <a class="el" href="namespacefizz_1_1detail.html#a40ead2543c07ad500214ec9dd760b706">write()</a> operations to the socket will fail. During normal operation, just call <a class="el" href="namespacefolly.html#a89e6d5d07a92c88cf24c7a3f9a02f94e">shutdown()</a> on the socket. </p>

<p>Definition at line <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00102">102</a> of file <a class="el" href="ShutdownSocketSet_8cpp_source.html">ShutdownSocketSet.cpp</a>.</p>

<p>References <a class="el" href="FileUtil_8cpp_source.html#l00056">folly::closeNoInt()</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00140">data_</a>, <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00143">doShutdown()</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00125">FREE</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00127">IN_SHUTDOWN</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00126">IN_USE</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00139">maxFd_</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00129">MUST_CLOSE</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00128">SHUT_DOWN</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00178">uint8_t</a>.</p>

<p>Referenced by <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00134">shutdownAll()</a>.</p>
<div class="fragment"><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                                                      {</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  DCHECK_GE(fd, 0);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">if</span> (fd &gt;= <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">maxFd_</a>) {</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a8e1df6e38cc65d2a6e86d2690d27d6fe">doShutdown</a>(fd, abortive);</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="keyword">auto</span>&amp; sref = <a class="code" href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">data_</a>[size_t(fd)];</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> prevState = <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">IN_USE</a>;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordflow">if</span> (!sref.compare_exchange_strong(</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;          prevState, <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e">IN_SHUTDOWN</a>, std::memory_order_relaxed)) {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  }</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a8e1df6e38cc65d2a6e86d2690d27d6fe">doShutdown</a>(fd, abortive);</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  prevState = <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e">IN_SHUTDOWN</a>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">if</span> (sref.compare_exchange_strong(</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;          prevState, <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160">SHUT_DOWN</a>, std::memory_order_relaxed)) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  CHECK_EQ(prevState, <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817">MUST_CLOSE</a>)</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Invalid prev state for fd &quot;</span> &lt;&lt; fd &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; int(prevState);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a>(fd); <span class="comment">// ignore errors, nothing to do</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  CHECK(</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      sref.compare_exchange_strong(prevState, <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">FREE</a>, std::memory_order_relaxed))</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Invalid prev state for fd &quot;</span> &lt;&lt; fd &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; <span class="keywordtype">int</span>(prevState);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div><div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976ab6e90df71c8f2c454b8f0ad3953cc7e1">folly::ShutdownSocketSet::FREE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00125">ShutdownSocketSet.h:125</a></div></div>
<div class="ttc" id="namespacefolly_html_af5b0e02d1e436376f25df5c4927ad308"><div class="ttname"><a href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a></div><div class="ttdeci">int closeNoInt(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00056">FileUtil.cpp:56</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a310f00e86dca4cf13ec6a00e729b6d2f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">folly::ShutdownSocketSet::maxFd_</a></div><div class="ttdeci">const int maxFd_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00139">ShutdownSocketSet.h:139</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a8e1df6e38cc65d2a6e86d2690d27d6fe"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a8e1df6e38cc65d2a6e86d2690d27d6fe">folly::ShutdownSocketSet::doShutdown</a></div><div class="ttdeci">void doShutdown(int fd, bool abortive)</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8cpp_source.html#l00143">ShutdownSocketSet.cpp:143</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a09c97296b632103dd7675e934c7a6817">folly::ShutdownSocketSet::MUST_CLOSE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00129">ShutdownSocketSet.h:129</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00178">ConstexprMathBenchmark.cpp:178</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">folly::ShutdownSocketSet::IN_USE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00126">ShutdownSocketSet.h:126</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a52081a0cda1f8de08f72f37b19cc7e0e">folly::ShutdownSocketSet::IN_SHUTDOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00127">ShutdownSocketSet.h:127</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_aef07e35b6f5cbb5afb861d712de2250f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">folly::ShutdownSocketSet::data_</a></div><div class="ttdeci">std::unique_ptr&lt; std::atomic&lt; uint8_t &gt;[], Free &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00140">ShutdownSocketSet.h:140</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a3da0f27353e073202a673af715f8f160">folly::ShutdownSocketSet::SHUT_DOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00128">ShutdownSocketSet.h:128</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a27a3b3ce235f66b9bc3a8b6554c9cb33"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::ShutdownSocketSet::shutdownAll </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>abortive</em> = <code>false</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Immediate shutdown of all connections. This is a hard-hitting hammer; all reads and writes will return errors and no new connections will be accepted.</p>
<p>To be used only in dire situations. We're using it from the failure signal handler to close all connections quickly, even though the server might take multiple seconds to finish crashing.</p>
<p>The optional bool parameter indicates whether to set the active connections in to not linger. The effect of that includes RST packets being immediately sent to clients which will result in errors (and not normal EOF) on the client side. This also causes the local (ip, tcp port number) tuple to be reusable immediately, instead of having to wait the standard amount of time. For full details see the <code>shutdown</code> method of <code><a class="el" href="classfolly_1_1ShutdownSocketSet.html">ShutdownSocketSet</a></code> (incl. notes about the <code>abortive</code> parameter).</p>
<p>This is async-signal-safe and ignores errors. </p>

<p>Definition at line <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00134">134</a> of file <a class="el" href="ShutdownSocketSet_8cpp_source.html">ShutdownSocketSet.cpp</a>.</p>

<p>References <a class="el" href="ShutdownSocketSet_8h_source.html#l00140">data_</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">i</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00126">IN_USE</a>, <a class="el" href="ShutdownSocketSet_8h_source.html#l00139">maxFd_</a>, and <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00102">shutdown()</a>.</p>

<p>Referenced by <a class="el" href="ShutdownSocketSetTest_8cpp_source.html#l00175">folly::test::runKillTest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                                                 {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">maxFd_</a>; ++<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>) {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keyword">auto</span>&amp; sref = <a class="code" href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">data_</a>[size_t(<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>)];</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> (sref.load(std::memory_order_relaxed) == <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">IN_USE</a>) {</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <a class="code" href="classfolly_1_1ShutdownSocketSet.html#a13d250586894865fdaef05d9fbbe4f98">shutdown</a>(<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>, abortive);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;}</div><div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_html_a7e98b8a17c0aad30ba64d47b74e2a6c1"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">gtest_output_test_golden_lin.txt:83</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a13d250586894865fdaef05d9fbbe4f98"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a13d250586894865fdaef05d9fbbe4f98">folly::ShutdownSocketSet::shutdown</a></div><div class="ttdeci">void shutdown(int fd, bool abortive=false)</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8cpp_source.html#l00102">ShutdownSocketSet.cpp:102</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a310f00e86dca4cf13ec6a00e729b6d2f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a310f00e86dca4cf13ec6a00e729b6d2f">folly::ShutdownSocketSet::maxFd_</a></div><div class="ttdeci">const int maxFd_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00139">ShutdownSocketSet.h:139</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a5d9f1589ed4adf3db85f1ad3d40e3976a6fb85b7975e7c6341f4c71b6b9cf5abb">folly::ShutdownSocketSet::IN_USE</a></div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00126">ShutdownSocketSet.h:126</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_aef07e35b6f5cbb5afb861d712de2250f"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#aef07e35b6f5cbb5afb861d712de2250f">folly::ShutdownSocketSet::data_</a></div><div class="ttdeci">std::unique_ptr&lt; std::atomic&lt; uint8_t &gt;[], Free &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8h_source.html#l00140">ShutdownSocketSet.h:140</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="aef07e35b6f5cbb5afb861d712de2250f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unique_ptr&lt;std::atomic&lt;<a class="el" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>&gt;[], <a class="el" href="structfolly_1_1ShutdownSocketSet_1_1Free.html">Free</a>&gt; folly::ShutdownSocketSet::data_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ShutdownSocketSet_8h_source.html#l00140">140</a> of file <a class="el" href="ShutdownSocketSet_8h_source.html">ShutdownSocketSet.h</a>.</p>

<p>Referenced by <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00035">add()</a>, <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00073">close()</a>, <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00049">remove()</a>, <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00102">shutdown()</a>, and <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00134">shutdownAll()</a>.</p>

</div>
</div>
<a class="anchor" id="a310f00e86dca4cf13ec6a00e729b6d2f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int folly::ShutdownSocketSet::maxFd_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ShutdownSocketSet_8h_source.html#l00139">139</a> of file <a class="el" href="ShutdownSocketSet_8h_source.html">ShutdownSocketSet.h</a>.</p>

<p>Referenced by <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00035">add()</a>, <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00073">close()</a>, <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00049">remove()</a>, <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00102">shutdown()</a>, and <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00134">shutdownAll()</a>.</p>

</div>
</div>
<a class="anchor" id="abcd057ad7457cf5b4d6b09ccc5e250ad"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1File.html">folly::File</a> folly::ShutdownSocketSet::nullFile_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ShutdownSocketSet_8h_source.html#l00141">141</a> of file <a class="el" href="ShutdownSocketSet_8h_source.html">ShutdownSocketSet.h</a>.</p>

<p>Referenced by <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00143">doShutdown()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/folly/folly/io/<a class="el" href="ShutdownSocketSet_8h_source.html">ShutdownSocketSet.h</a></li>
<li>proxygen/folly/folly/io/<a class="el" href="ShutdownSocketSet_8cpp_source.html">ShutdownSocketSet.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefolly.html">folly</a></li><li class="navelem"><a class="el" href="classfolly_1_1ShutdownSocketSet.html">ShutdownSocketSet</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
