<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: ReadStats Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classReadStats.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classReadStats-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ReadStats Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structReadStats_1_1ReaderData.html">ReaderData</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structReadStats_1_1WriterData.html">WriterData</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a049ffb625268110000a477164de44f6b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a049ffb625268110000a477164de44f6b">ReadStats</a> ()</td></tr>
<tr class="separator:a049ffb625268110000a477164de44f6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af583be8cd71d444c27378a7b95827c82"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#af583be8cd71d444c27378a7b95827c82">clearSleepDuration</a> ()</td></tr>
<tr class="separator:af583be8cd71d444c27378a7b95827c82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50b4837bb808a7a88d8103da3327d17e"><td class="memItemLeft" align="right" valign="top">std::chrono::microseconds&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a50b4837bb808a7a88d8103da3327d17e">getSleepUS</a> () const </td></tr>
<tr class="separator:a50b4837bb808a7a88d8103da3327d17e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65e71b0400bd66c377107c928697689a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a65e71b0400bd66c377107c928697689a">shouldWriterStop</a> () const </td></tr>
<tr class="separator:a65e71b0400bd66c377107c928697689a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a36379f85627db6416cb647b85efbfc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a9a36379f85627db6416cb647b85efbfc">writerFinished</a> (size_t threadID, size_t messagesWritten, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="el" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a>)</td></tr>
<tr class="separator:a9a36379f85627db6416cb647b85efbfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c801385426f758496316ace75045da2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a0c801385426f758496316ace75045da2">check</a> ()</td></tr>
<tr class="separator:a0c801385426f758496316ace75045da2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a592f53c8c73f32e3c1fe1db4ea0d9f5b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a592f53c8c73f32e3c1fe1db4ea0d9f5b">messageReceived</a> (<a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">StringPiece</a> msg)</td></tr>
<tr class="separator:a592f53c8c73f32e3c1fe1db4ea0d9f5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2c29889d4b3f3b973aecfd06330d848"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#ab2c29889d4b3f3b973aecfd06330d848">trailingData</a> (<a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">StringPiece</a> <a class="el" href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a>)</td></tr>
<tr class="separator:ab2c29889d4b3f3b973aecfd06330d848"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a3fdacb681bedcef4b2d71d6723826ec2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a3fdacb681bedcef4b2d71d6723826ec2">parseMessage</a> (<a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">StringPiece</a> msg, size_t *threadID, size_t *messageIndex)</td></tr>
<tr class="separator:a3fdacb681bedcef4b2d71d6723826ec2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ac7563c4f1154a4a67bea2958e777fe4f"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; size_t, <a class="el" href="structReadStats_1_1ReaderData.html">ReaderData</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#ac7563c4f1154a4a67bea2958e777fe4f">perThreadReadData_</a></td></tr>
<tr class="separator:ac7563c4f1154a4a67bea2958e777fe4f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aa88939a4429ca77af4347a943da7f5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a6aa88939a4429ca77af4347a943da7f5">trailingData_</a></td></tr>
<tr class="separator:a6aa88939a4429ca77af4347a943da7f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a607b322d0f5b2670d0bec990d13df3"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a2a607b322d0f5b2670d0bec990d13df3">numUnableToParse_</a> {0}</td></tr>
<tr class="separator:a2a607b322d0f5b2670d0bec990d13df3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46c1c27a557c98d99594481e3b5bbe81"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a46c1c27a557c98d99594481e3b5bbe81">numOutOfOrder_</a> {0}</td></tr>
<tr class="separator:a46c1c27a557c98d99594481e3b5bbe81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a15ec8143b930c77ca0c068a21a41fb7e"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a15ec8143b930c77ca0c068a21a41fb7e">numDiscarded_</a> {0}</td></tr>
<tr class="separator:a15ec8143b930c77ca0c068a21a41fb7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafd64b54296b9635ed9edb12fb4510e5"><td class="memItemLeft" align="right" valign="top">const std::chrono::steady_clock::time_point&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#aafd64b54296b9635ed9edb12fb4510e5">deadline_</a></td></tr>
<tr class="separator:aafd64b54296b9635ed9edb12fb4510e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3052cf0f7c5d391d72b956eef2c5c692"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; <a class="el" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a3052cf0f7c5d391d72b956eef2c5c692">readSleepUS_</a> {0}</td></tr>
<tr class="separator:a3052cf0f7c5d391d72b956eef2c5c692"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bfb17198f3380ab6028b63cd1cc48e3"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; <a class="el" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#a4bfb17198f3380ab6028b63cd1cc48e3">discardEventsSeen_</a> {0}</td></tr>
<tr class="separator:a4bfb17198f3380ab6028b63cd1cc48e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addda90d7fd1cebc352f78f31474403a1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfolly_1_1Synchronized.html">folly::Synchronized</a>&lt; std::unordered_map&lt; size_t, <a class="el" href="structReadStats_1_1WriterData.html">WriterData</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReadStats.html#addda90d7fd1cebc352f78f31474403a1">perThreadWriteData_</a></td></tr>
<tr class="separator:addda90d7fd1cebc352f78f31474403a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00271">271</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a049ffb625268110000a477164de44f6b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ReadStats::ReadStats </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00273">273</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

<p>References <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00188">int64_t</a>, <a class="el" href="LogLevel_8cpp_source.html#l00030">min</a>, <a class="el" href="TimekeeperTest_8cpp_source.html#l00031">now()</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00190">uint64_t</a>.</p>
<div class="fragment"><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      : <a class="code" href="classReadStats.html#aafd64b54296b9635ed9edb12fb4510e5">deadline_</a>{<a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">steady_clock::now</a>() +</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                  milliseconds{FLAGS_async_discard_timeout_msec}},</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <a class="code" href="classReadStats.html#a3052cf0f7c5d391d72b956eef2c5c692">readSleepUS_</a>{<span class="keyword">static_cast&lt;</span><a class="code" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a><span class="keyword">&gt;</span>(</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <a class="code" href="LogLevel_8cpp.html#a7361901234703a521a82885405734c53">std::min</a>(<a class="code" href="ConstexprMathBenchmark_8cpp.html#a21214d6ef664ff09b89c1fd75fe0a042">int64_t</a>{0}, FLAGS_async_discard_read_sleep_usec))} {}</div><div class="ttc" id="TimekeeperTest_8cpp_html_a562b4baa36dcf267f35a4ba4e0aef329"><div class="ttname"><a href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a></div><div class="ttdeci">std::chrono::steady_clock::time_point now()</div><div class="ttdef"><b>Definition:</b> <a href="TimekeeperTest_8cpp_source.html#l00031">TimekeeperTest.cpp:31</a></div></div>
<div class="ttc" id="classReadStats_html_aafd64b54296b9635ed9edb12fb4510e5"><div class="ttname"><a href="classReadStats.html#aafd64b54296b9635ed9edb12fb4510e5">ReadStats::deadline_</a></div><div class="ttdeci">const std::chrono::steady_clock::time_point deadline_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00466">AsyncFileWriterTest.cpp:466</a></div></div>
<div class="ttc" id="LogLevel_8cpp_html_a7361901234703a521a82885405734c53"><div class="ttname"><a href="LogLevel_8cpp.html#a7361901234703a521a82885405734c53">min</a></div><div class="ttdeci">LogLevel min</div><div class="ttdef"><b>Definition:</b> <a href="LogLevel_8cpp_source.html#l00030">LogLevel.cpp:30</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a5dc34568a989dd90728a4ed499cd9fab"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a></div><div class="ttdeci">uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00190">ConstexprMathBenchmark.cpp:190</a></div></div>
<div class="ttc" id="classReadStats_html_a3052cf0f7c5d391d72b956eef2c5c692"><div class="ttname"><a href="classReadStats.html#a3052cf0f7c5d391d72b956eef2c5c692">ReadStats::readSleepUS_</a></div><div class="ttdeci">std::atomic&lt; uint64_t &gt; readSleepUS_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00479">AsyncFileWriterTest.cpp:479</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a21214d6ef664ff09b89c1fd75fe0a042"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a21214d6ef664ff09b89c1fd75fe0a042">int64_t</a></div><div class="ttdeci">int64_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00188">ConstexprMathBenchmark.cpp:188</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a0c801385426f758496316ace75045da2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ReadStats::check </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00311">311</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

<p>References <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa35d82111a128b9caf33a44216dc74fa9">folly::DBG1</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01922">EXPECT_EQ</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01934">EXPECT_GT</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01928">EXPECT_LE</a>, <a class="el" href="LogWriter_8h_source.html#l00042">folly::LogWriter::NEVER_DISCARD</a>, and <a class="el" href="xlog_8h_source.html#l00057">XLOG</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00583">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;               {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keyword">auto</span> writeDataMap = <a class="code" href="classReadStats.html#addda90d7fd1cebc352f78f31474403a1">perThreadWriteData_</a>.wlock();</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(<span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classReadStats.html#a6aa88939a4429ca77af4347a943da7f5">trailingData_</a>);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(0, <a class="code" href="classReadStats.html#a2a607b322d0f5b2670d0bec990d13df3">numUnableToParse_</a>);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(0, <a class="code" href="classReadStats.html#a46c1c27a557c98d99594481e3b5bbe81">numOutOfOrder_</a>);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="comment">// Check messages received from each writer thread</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordtype">size_t</span> readerStatsChecked = 0;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordtype">size_t</span> totalMessagesWritten = 0;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordtype">size_t</span> totalMessagesRead = 0;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; writeEntry : *writeDataMap) {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; writeInfo = writeEntry.second;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      totalMessagesWritten += writeInfo.numMessagesWritten;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <span class="keyword">auto</span> iter = <a class="code" href="classReadStats.html#ac7563c4f1154a4a67bea2958e777fe4f">perThreadReadData_</a>.find(writeEntry.first);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="keywordflow">if</span> (iter == <a class="code" href="classReadStats.html#ac7563c4f1154a4a67bea2958e777fe4f">perThreadReadData_</a>.end()) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="comment">// We never received any messages from this writer thread.</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="comment">// This is okay as long as this is not a NEVER_DISCARD writer.</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(0, writeInfo.flags);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; readInfo = iter-&gt;second;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      ++readerStatsChecked;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      totalMessagesRead += readInfo.numMessagesRead;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <span class="keywordflow">if</span> (writeInfo.flags &amp; LogWriter::NEVER_DISCARD) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="comment">// Non-discarding threads should never discard anything</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(readInfo.numMessagesRead, writeInfo.numMessagesWritten);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(readInfo.lastId, writeInfo.numMessagesWritten);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="comment">// Other threads may have discarded some messages</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ae0f265632323b4a07b585dcfde10f60a">EXPECT_LE</a>(readInfo.numMessagesRead, writeInfo.numMessagesWritten);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ae0f265632323b4a07b585dcfde10f60a">EXPECT_LE</a>(readInfo.lastId, writeInfo.numMessagesWritten);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(totalMessagesWritten, totalMessagesRead + <a class="code" href="classReadStats.html#a15ec8143b930c77ca0c068a21a41fb7e">numDiscarded_</a>);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(readerStatsChecked, <a class="code" href="classReadStats.html#ac7563c4f1154a4a67bea2958e777fe4f">perThreadReadData_</a>.size());</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// This test is intended to check the discard behavior.</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// Fail the test if we didn&#39;t actually trigger any discards before we timed</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="comment">// out.</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#aa8bc8320813e1abb0016129b636e3b27">EXPECT_GT</a>(<a class="code" href="classReadStats.html#a15ec8143b930c77ca0c068a21a41fb7e">numDiscarded_</a>, 0);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <a class="code" href="xlog_8h.html#aff43beb7fa37b1deeb421a69c26432c5">XLOG</a>(DBG1) &lt;&lt; totalMessagesWritten &lt;&lt; <span class="stringliteral">&quot; messages written, &quot;</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;               &lt;&lt; totalMessagesRead &lt;&lt; <span class="stringliteral">&quot; messages read, &quot;</span> &lt;&lt; <a class="code" href="classReadStats.html#a15ec8143b930c77ca0c068a21a41fb7e">numDiscarded_</a></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;               &lt;&lt; <span class="stringliteral">&quot; messages discarded&quot;</span>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  }</div><div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_ae0f265632323b4a07b585dcfde10f60a"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ae0f265632323b4a07b585dcfde10f60a">EXPECT_LE</a></div><div class="ttdeci">#define EXPECT_LE(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01928">gtest.h:1928</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_a4159019abda84f5366acdb7604ff220a"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a></div><div class="ttdeci">#define EXPECT_EQ(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01922">gtest.h:1922</a></div></div>
<div class="ttc" id="classReadStats_html_a2a607b322d0f5b2670d0bec990d13df3"><div class="ttname"><a href="classReadStats.html#a2a607b322d0f5b2670d0bec990d13df3">ReadStats::numUnableToParse_</a></div><div class="ttdeci">size_t numUnableToParse_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00456">AsyncFileWriterTest.cpp:456</a></div></div>
<div class="ttc" id="classReadStats_html_a15ec8143b930c77ca0c068a21a41fb7e"><div class="ttname"><a href="classReadStats.html#a15ec8143b930c77ca0c068a21a41fb7e">ReadStats::numDiscarded_</a></div><div class="ttdeci">size_t numDiscarded_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00458">AsyncFileWriterTest.cpp:458</a></div></div>
<div class="ttc" id="classReadStats_html_addda90d7fd1cebc352f78f31474403a1"><div class="ttname"><a href="classReadStats.html#addda90d7fd1cebc352f78f31474403a1">ReadStats::perThreadWriteData_</a></div><div class="ttdeci">folly::Synchronized&lt; std::unordered_map&lt; size_t, WriterData &gt; &gt; perThreadWriteData_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00499">AsyncFileWriterTest.cpp:499</a></div></div>
<div class="ttc" id="classReadStats_html_a46c1c27a557c98d99594481e3b5bbe81"><div class="ttname"><a href="classReadStats.html#a46c1c27a557c98d99594481e3b5bbe81">ReadStats::numOutOfOrder_</a></div><div class="ttdeci">size_t numOutOfOrder_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00457">AsyncFileWriterTest.cpp:457</a></div></div>
<div class="ttc" id="classReadStats_html_ac7563c4f1154a4a67bea2958e777fe4f"><div class="ttname"><a href="classReadStats.html#ac7563c4f1154a4a67bea2958e777fe4f">ReadStats::perThreadReadData_</a></div><div class="ttdeci">std::unordered_map&lt; size_t, ReaderData &gt; perThreadReadData_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00450">AsyncFileWriterTest.cpp:450</a></div></div>
<div class="ttc" id="classReadStats_html_a6aa88939a4429ca77af4347a943da7f5"><div class="ttname"><a href="classReadStats.html#a6aa88939a4429ca77af4347a943da7f5">ReadStats::trailingData_</a></div><div class="ttdeci">std::string trailingData_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00455">AsyncFileWriterTest.cpp:455</a></div></div>
<div class="ttc" id="xlog_8h_html_aff43beb7fa37b1deeb421a69c26432c5"><div class="ttname"><a href="xlog_8h.html#aff43beb7fa37b1deeb421a69c26432c5">XLOG</a></div><div class="ttdeci">#define XLOG(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="xlog_8h_source.html#l00057">xlog.h:57</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_aa8bc8320813e1abb0016129b636e3b27"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#aa8bc8320813e1abb0016129b636e3b27">EXPECT_GT</a></div><div class="ttdeci">#define EXPECT_GT(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01934">gtest.h:1934</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af583be8cd71d444c27378a7b95827c82"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ReadStats::clearSleepDuration </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00279">279</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00583">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                            {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="classReadStats.html#a3052cf0f7c5d391d72b956eef2c5c692">readSleepUS_</a>.store(0);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  }</div><div class="ttc" id="classReadStats_html_a3052cf0f7c5d391d72b956eef2c5c692"><div class="ttname"><a href="classReadStats.html#a3052cf0f7c5d391d72b956eef2c5c692">ReadStats::readSleepUS_</a></div><div class="ttdeci">std::atomic&lt; uint64_t &gt; readSleepUS_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00479">AsyncFileWriterTest.cpp:479</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a50b4837bb808a7a88d8103da3327d17e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::microseconds ReadStats::getSleepUS </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00282">282</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00506">readThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                           {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">return</span> std::chrono::microseconds{<a class="code" href="classReadStats.html#a3052cf0f7c5d391d72b956eef2c5c692">readSleepUS_</a>.load()};</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  }</div><div class="ttc" id="classReadStats_html_a3052cf0f7c5d391d72b956eef2c5c692"><div class="ttname"><a href="classReadStats.html#a3052cf0f7c5d391d72b956eef2c5c692">ReadStats::readSleepUS_</a></div><div class="ttdeci">std::atomic&lt; uint64_t &gt; readSleepUS_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00479">AsyncFileWriterTest.cpp:479</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a592f53c8c73f32e3c1fe1db4ea0d9f5b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ReadStats::messageReceived </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">StringPiece</a>&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00360">360</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

<p>References <a class="el" href="Access_8h_source.html#l00071">folly::data()</a>, <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa8053a597c236f0850f38ff4ac0df845c">folly::DBG3</a>, <a class="el" href="Range_8h_source.html#l00849">folly::Range&lt; Iter &gt;::endsWith()</a>, <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aacd22bad976363fdd1bfbf6759fede482">folly::ERR</a>, <a class="el" href="Range_8h_source.html#l00721">folly::Range&lt; Iter &gt;::find()</a>, <a class="el" href="Range_8h_source.html#l00686">folly::Range&lt; Iter &gt;::subpiece()</a>, and <a class="el" href="xlog_8h_source.html#l00057">XLOG</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00506">readThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                        {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordflow">if</span> (msg.<a class="code" href="classfolly_1_1Range.html#a74fdffeeb31a40878893a478c76447b4">endsWith</a>(<span class="stringliteral">&quot; log messages discarded: &quot;</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                     <span class="stringliteral">&quot;logging faster than we can write&quot;</span>)) {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keyword">auto</span> discardCount = folly::to&lt;size_t&gt;(msg.<a class="code" href="classfolly_1_1Range.html#aeddc13c74ab4e42c04b2982e5ff7fe87">subpiece</a>(0, msg.<a class="code" href="classfolly_1_1Range.html#a68f61672432bf9e0f035092b0fefd8c0">find</a>(<span class="charliteral">&#39; &#39;</span>)));</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <a class="code" href="xlog_8h.html#aff43beb7fa37b1deeb421a69c26432c5">XLOG</a>(DBG3, <span class="stringliteral">&quot;received discard notification: &quot;</span>, discardCount);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <a class="code" href="classReadStats.html#a15ec8143b930c77ca0c068a21a41fb7e">numDiscarded_</a> += discardCount;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      ++<a class="code" href="classReadStats.html#a4bfb17198f3380ab6028b63cd1cc48e3">discardEventsSeen_</a>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordtype">size_t</span> threadID = 0;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordtype">size_t</span> messageIndex = 0;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <a class="code" href="classReadStats.html#a3fdacb681bedcef4b2d71d6723826ec2">parseMessage</a>(msg, &amp;threadID, &amp;messageIndex);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; ex) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      ++<a class="code" href="classReadStats.html#a2a607b322d0f5b2670d0bec990d13df3">numUnableToParse_</a>;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <a class="code" href="xlog_8h.html#aff43beb7fa37b1deeb421a69c26432c5">XLOG</a>(ERR, <span class="stringliteral">&quot;unable to parse log message: &quot;</span>, msg);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keyword">auto</span>&amp; <a class="code" href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a> = <a class="code" href="classReadStats.html#ac7563c4f1154a4a67bea2958e777fe4f">perThreadReadData_</a>[threadID];</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a>.numMessagesRead++;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (messageIndex &gt; <a class="code" href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a>.lastId) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      <a class="code" href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a>.lastId = messageIndex;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      ++<a class="code" href="classReadStats.html#a46c1c27a557c98d99594481e3b5bbe81">numOutOfOrder_</a>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <a class="code" href="xlog_8h.html#aff43beb7fa37b1deeb421a69c26432c5">XLOG</a>(ERR) &lt;&lt; <span class="stringliteral">&quot;received out-of-order messages from writer &quot;</span> &lt;&lt; threadID</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; messageIndex &lt;&lt; <span class="stringliteral">&quot; received after &quot;</span> &lt;&lt; <a class="code" href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a>.lastId;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    }</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  }</div><div class="ttc" id="classfolly_1_1Range_html_a68f61672432bf9e0f035092b0fefd8c0"><div class="ttname"><a href="classfolly_1_1Range.html#a68f61672432bf9e0f035092b0fefd8c0">folly::Range::find</a></div><div class="ttdeci">size_type find(const_range_type str) const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00721">Range.h:721</a></div></div>
<div class="ttc" id="classReadStats_html_a4bfb17198f3380ab6028b63cd1cc48e3"><div class="ttname"><a href="classReadStats.html#a4bfb17198f3380ab6028b63cd1cc48e3">ReadStats::discardEventsSeen_</a></div><div class="ttdeci">std::atomic&lt; uint64_t &gt; discardEventsSeen_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00490">AsyncFileWriterTest.cpp:490</a></div></div>
<div class="ttc" id="classReadStats_html_a2a607b322d0f5b2670d0bec990d13df3"><div class="ttname"><a href="classReadStats.html#a2a607b322d0f5b2670d0bec990d13df3">ReadStats::numUnableToParse_</a></div><div class="ttdeci">size_t numUnableToParse_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00456">AsyncFileWriterTest.cpp:456</a></div></div>
<div class="ttc" id="classReadStats_html_a15ec8143b930c77ca0c068a21a41fb7e"><div class="ttname"><a href="classReadStats.html#a15ec8143b930c77ca0c068a21a41fb7e">ReadStats::numDiscarded_</a></div><div class="ttdeci">size_t numDiscarded_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00458">AsyncFileWriterTest.cpp:458</a></div></div>
<div class="ttc" id="classfolly_1_1Range_html_aeddc13c74ab4e42c04b2982e5ff7fe87"><div class="ttname"><a href="classfolly_1_1Range.html#aeddc13c74ab4e42c04b2982e5ff7fe87">folly::Range::subpiece</a></div><div class="ttdeci">Range subpiece(size_type first, size_type length=npos) const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00686">Range.h:686</a></div></div>
<div class="ttc" id="classReadStats_html_a46c1c27a557c98d99594481e3b5bbe81"><div class="ttname"><a href="classReadStats.html#a46c1c27a557c98d99594481e3b5bbe81">ReadStats::numOutOfOrder_</a></div><div class="ttdeci">size_t numOutOfOrder_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00457">AsyncFileWriterTest.cpp:457</a></div></div>
<div class="ttc" id="classReadStats_html_ac7563c4f1154a4a67bea2958e777fe4f"><div class="ttname"><a href="classReadStats.html#ac7563c4f1154a4a67bea2958e777fe4f">ReadStats::perThreadReadData_</a></div><div class="ttdeci">std::unordered_map&lt; size_t, ReaderData &gt; perThreadReadData_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00450">AsyncFileWriterTest.cpp:450</a></div></div>
<div class="ttc" id="classReadStats_html_a3fdacb681bedcef4b2d71d6723826ec2"><div class="ttname"><a href="classReadStats.html#a3fdacb681bedcef4b2d71d6723826ec2">ReadStats::parseMessage</a></div><div class="ttdeci">void parseMessage(StringPiece msg, size_t *threadID, size_t *messageIndex)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00405">AsyncFileWriterTest.cpp:405</a></div></div>
<div class="ttc" id="xlog_8h_html_aff43beb7fa37b1deeb421a69c26432c5"><div class="ttname"><a href="xlog_8h.html#aff43beb7fa37b1deeb421a69c26432c5">XLOG</a></div><div class="ttdeci">#define XLOG(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="xlog_8h_source.html#l00057">xlog.h:57</a></div></div>
<div class="ttc" id="classfolly_1_1Range_html_a74fdffeeb31a40878893a478c76447b4"><div class="ttname"><a href="classfolly_1_1Range.html#a74fdffeeb31a40878893a478c76447b4">folly::Range::endsWith</a></div><div class="ttdeci">bool endsWith(const const_range_type &amp;other) const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00849">Range.h:849</a></div></div>
<div class="ttc" id="Fingerprint_8cpp_html_a4f1b470245cdebf82b7a560640fb6d56"><div class="ttname"><a href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a></div><div class="ttdeci">static constexpr uint64_t data[1]</div><div class="ttdef"><b>Definition:</b> <a href="Fingerprint_8cpp_source.html#l00043">Fingerprint.cpp:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3fdacb681bedcef4b2d71d6723826ec2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ReadStats::parseMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">StringPiece</a>&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>threadID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>messageIndex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00405">405</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

<p>References <a class="el" href="Range_8h_source.html#l00672">folly::Range&lt; Iter &gt;::advance()</a>, <a class="el" href="Range_8h_source.html#l00849">folly::Range&lt; Iter &gt;::endsWith()</a>, <a class="el" href="Range_8h_source.html#l00721">folly::Range&lt; Iter &gt;::find()</a>, <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00265">kMsgSuffix</a>, <a class="el" href="Range_8h_source.html#l00197">folly::Range&lt; const char * &gt;::npos</a>, <a class="el" href="IOBufCursorBenchmark_8cpp_source.html#l00117">prefix()</a>, <a class="el" href="Range_8h_source.html#l00431">folly::Range&lt; Iter &gt;::size()</a>, <a class="el" href="Range_8h_source.html#l00828">folly::Range&lt; Iter &gt;::startsWith()</a>, <a class="el" href="Range_8h_source.html#l00686">folly::Range&lt; Iter &gt;::subpiece()</a>, and <a class="el" href="Range_8h_source.html#l00679">folly::Range&lt; Iter &gt;::subtract()</a>.</p>
<div class="fragment"><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                                                                             {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="comment">// Validate and strip off the message prefix and suffix</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    constexpr <a class="code" href="classfolly_1_1Range.html">StringPiece</a> <a class="code" href="IOBufCursorBenchmark_8cpp.html#a347f71e94748afa4f8e4fb551546e447">prefix</a>{<span class="stringliteral">&quot;thread &quot;</span>};</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <span class="keywordflow">if</span> (!msg.<a class="code" href="classfolly_1_1Range.html#a46e987cfd7efc5525dfa4a61348196ac">startsWith</a>(<a class="code" href="IOBufCursorBenchmark_8cpp.html#a347f71e94748afa4f8e4fb551546e447">prefix</a>)) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;bad message prefix&quot;</span>);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    msg.<a class="code" href="classfolly_1_1Range.html#a5d735dba3b8f351a332b6a3eb110dd2c">advance</a>(<a class="code" href="IOBufCursorBenchmark_8cpp.html#a347f71e94748afa4f8e4fb551546e447">prefix</a>.size());</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">if</span> (!msg.<a class="code" href="classfolly_1_1Range.html#a74fdffeeb31a40878893a478c76447b4">endsWith</a>(<a class="code" href="AsyncFileWriterTest_8cpp.html#aaa2aaea45fa2c5039eea62fa412727ab">kMsgSuffix</a>)) {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;bad message suffix&quot;</span>);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    msg.<a class="code" href="classfolly_1_1Range.html#af6baf02d2df3fd0079b4f3c7401fd2ea">subtract</a>(<a class="code" href="AsyncFileWriterTest_8cpp.html#aaa2aaea45fa2c5039eea62fa412727ab">kMsgSuffix</a>.<a class="code" href="classfolly_1_1Range.html#a4c2961b90459f542312422d62ff767b2">size</a>());</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="comment">// Parse then strip off the thread index</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keyword">auto</span> threadIDEnd = msg.<a class="code" href="classfolly_1_1Range.html#a68f61672432bf9e0f035092b0fefd8c0">find</a>(<span class="charliteral">&#39; &#39;</span>);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">if</span> (threadIDEnd == StringPiece::npos) {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;no middle found&quot;</span>);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    *threadID = folly::to&lt;size_t&gt;(msg.<a class="code" href="classfolly_1_1Range.html#aeddc13c74ab4e42c04b2982e5ff7fe87">subpiece</a>(0, threadIDEnd));</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    msg.<a class="code" href="classfolly_1_1Range.html#a5d735dba3b8f351a332b6a3eb110dd2c">advance</a>(threadIDEnd);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="comment">// Validate that the middle of the message is what we expect,</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">// then strip it off</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    constexpr <a class="code" href="classfolly_1_1Range.html">StringPiece</a> middle{<span class="stringliteral">&quot; message &quot;</span>};</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">if</span> (!msg.<a class="code" href="classfolly_1_1Range.html#a46e987cfd7efc5525dfa4a61348196ac">startsWith</a>(middle)) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;bad message middle&quot;</span>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    msg.<a class="code" href="classfolly_1_1Range.html#a5d735dba3b8f351a332b6a3eb110dd2c">advance</a>(middle.size());</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">// Parse the message index</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    *messageIndex = folly::to&lt;size_t&gt;(msg);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  }</div><div class="ttc" id="classfolly_1_1Range_html_a68f61672432bf9e0f035092b0fefd8c0"><div class="ttname"><a href="classfolly_1_1Range.html#a68f61672432bf9e0f035092b0fefd8c0">folly::Range::find</a></div><div class="ttdeci">size_type find(const_range_type str) const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00721">Range.h:721</a></div></div>
<div class="ttc" id="classfolly_1_1Range_html_a5d735dba3b8f351a332b6a3eb110dd2c"><div class="ttname"><a href="classfolly_1_1Range.html#a5d735dba3b8f351a332b6a3eb110dd2c">folly::Range::advance</a></div><div class="ttdeci">void advance(size_type n)</div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00672">Range.h:672</a></div></div>
<div class="ttc" id="classfolly_1_1Range_html_a4c2961b90459f542312422d62ff767b2"><div class="ttname"><a href="classfolly_1_1Range.html#a4c2961b90459f542312422d62ff767b2">folly::Range::size</a></div><div class="ttdeci">constexpr size_type size() const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00431">Range.h:431</a></div></div>
<div class="ttc" id="IOBufCursorBenchmark_8cpp_html_a347f71e94748afa4f8e4fb551546e447"><div class="ttname"><a href="IOBufCursorBenchmark_8cpp.html#a347f71e94748afa4f8e4fb551546e447">prefix</a></div><div class="ttdeci">bool prefix(Cursor &amp;c, uint32_t expected)</div><div class="ttdef"><b>Definition:</b> <a href="IOBufCursorBenchmark_8cpp_source.html#l00117">IOBufCursorBenchmark.cpp:117</a></div></div>
<div class="ttc" id="AsyncFileWriterTest_8cpp_html_aaa2aaea45fa2c5039eea62fa412727ab"><div class="ttname"><a href="AsyncFileWriterTest_8cpp.html#aaa2aaea45fa2c5039eea62fa412727ab">kMsgSuffix</a></div><div class="ttdeci">static constexpr StringPiece kMsgSuffix</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00265">AsyncFileWriterTest.cpp:265</a></div></div>
<div class="ttc" id="classfolly_1_1Range_html_aeddc13c74ab4e42c04b2982e5ff7fe87"><div class="ttname"><a href="classfolly_1_1Range.html#aeddc13c74ab4e42c04b2982e5ff7fe87">folly::Range::subpiece</a></div><div class="ttdeci">Range subpiece(size_type first, size_type length=npos) const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00686">Range.h:686</a></div></div>
<div class="ttc" id="classfolly_1_1Range_html"><div class="ttname"><a href="classfolly_1_1Range.html">folly::Range&lt; const char * &gt;</a></div></div>
<div class="ttc" id="classfolly_1_1Range_html_a46e987cfd7efc5525dfa4a61348196ac"><div class="ttname"><a href="classfolly_1_1Range.html#a46e987cfd7efc5525dfa4a61348196ac">folly::Range::startsWith</a></div><div class="ttdeci">bool startsWith(const const_range_type &amp;other) const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00828">Range.h:828</a></div></div>
<div class="ttc" id="classfolly_1_1Range_html_af6baf02d2df3fd0079b4f3c7401fd2ea"><div class="ttname"><a href="classfolly_1_1Range.html#af6baf02d2df3fd0079b4f3c7401fd2ea">folly::Range::subtract</a></div><div class="ttdeci">void subtract(size_type n)</div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00679">Range.h:679</a></div></div>
<div class="ttc" id="classfolly_1_1Range_html_a74fdffeeb31a40878893a478c76447b4"><div class="ttname"><a href="classfolly_1_1Range.html#a74fdffeeb31a40878893a478c76447b4">folly::Range::endsWith</a></div><div class="ttdeci">bool endsWith(const const_range_type &amp;other) const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00849">Range.h:849</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a65e71b0400bd66c377107c928697689a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ReadStats::shouldWriterStop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00286">286</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

<p>References <a class="el" href="TimekeeperTest_8cpp_source.html#l00031">now()</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00190">uint64_t</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00551">writeThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                                {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// Stop after we have seen the required number of separate discard events.</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">// We stop based on discardEventsSeen_ rather than numDiscarded_ since this</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">// ensures the async writer blocks and then makes progress again multiple</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// times.</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> (FLAGS_async_discard_num_events &gt; 0 &amp;&amp;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <a class="code" href="classReadStats.html#a4bfb17198f3380ab6028b63cd1cc48e3">discardEventsSeen_</a>.load() &gt;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="keyword">static_cast&lt;</span><a class="code" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a><span class="keyword">&gt;</span>(FLAGS_async_discard_num_events)) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// Stop after a timeout, even if we don&#39;t hit the number of requested</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="comment">// discards.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">steady_clock::now</a>() &gt; <a class="code" href="classReadStats.html#aafd64b54296b9635ed9edb12fb4510e5">deadline_</a>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  }</div><div class="ttc" id="TimekeeperTest_8cpp_html_a562b4baa36dcf267f35a4ba4e0aef329"><div class="ttname"><a href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a></div><div class="ttdeci">std::chrono::steady_clock::time_point now()</div><div class="ttdef"><b>Definition:</b> <a href="TimekeeperTest_8cpp_source.html#l00031">TimekeeperTest.cpp:31</a></div></div>
<div class="ttc" id="classReadStats_html_a4bfb17198f3380ab6028b63cd1cc48e3"><div class="ttname"><a href="classReadStats.html#a4bfb17198f3380ab6028b63cd1cc48e3">ReadStats::discardEventsSeen_</a></div><div class="ttdeci">std::atomic&lt; uint64_t &gt; discardEventsSeen_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00490">AsyncFileWriterTest.cpp:490</a></div></div>
<div class="ttc" id="classReadStats_html_aafd64b54296b9635ed9edb12fb4510e5"><div class="ttname"><a href="classReadStats.html#aafd64b54296b9635ed9edb12fb4510e5">ReadStats::deadline_</a></div><div class="ttdeci">const std::chrono::steady_clock::time_point deadline_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00466">AsyncFileWriterTest.cpp:466</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a5dc34568a989dd90728a4ed499cd9fab"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a></div><div class="ttdeci">uint64_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00190">ConstexprMathBenchmark.cpp:190</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab2c29889d4b3f3b973aecfd06330d848"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ReadStats::trailingData </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">StringPiece</a>&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00391">391</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

<p>References <a class="el" href="Range_8h_source.html#l00591">folly::Range&lt; Iter &gt;::str()</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00506">readThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                      {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <a class="code" href="classReadStats.html#a6aa88939a4429ca77af4347a943da7f5">trailingData_</a> = data.<a class="code" href="classfolly_1_1Range.html#a804a40c74d797664d8ee131ae4a4f09b">str</a>();</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  }</div><div class="ttc" id="classfolly_1_1Range_html_a804a40c74d797664d8ee131ae4a4f09b"><div class="ttname"><a href="classfolly_1_1Range.html#a804a40c74d797664d8ee131ae4a4f09b">folly::Range::str</a></div><div class="ttdeci">std::string str() const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00591">Range.h:591</a></div></div>
<div class="ttc" id="classReadStats_html_a6aa88939a4429ca77af4347a943da7f5"><div class="ttname"><a href="classReadStats.html#a6aa88939a4429ca77af4347a943da7f5">ReadStats::trailingData_</a></div><div class="ttdeci">std::string trailingData_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00455">AsyncFileWriterTest.cpp:455</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9a36379f85627db6416cb647b85efbfc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ReadStats::writerFinished </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>threadID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>messagesWritten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00301">301</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

<p>References <a class="el" href="Access_8h_source.html#l00071">folly::data()</a>, and <a class="el" href="SafeAssert_8h_source.html#l00035">FOLLY_SAFE_CHECK</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00551">writeThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                                                                               {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keyword">auto</span> <a class="code" href="classmap.html">map</a> = <a class="code" href="classReadStats.html#addda90d7fd1cebc352f78f31474403a1">perThreadWriteData_</a>.wlock();</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="SafeAssert_8h.html#a2679122a9f10d6dc6c2bd975cbd96d50">FOLLY_SAFE_CHECK</a>(</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <a class="code" href="classmap.html">map</a>-&gt;find(threadID) == <a class="code" href="classmap.html">map</a>-&gt;end(),</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="stringliteral">&quot;multiple writer threads with same ID&quot;</span>);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keyword">auto</span>&amp; <a class="code" href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a> = (*map)[threadID];</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    data.numMessagesWritten = messagesWritten;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    data.flags = <a class="code" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  }</div><div class="ttc" id="http__parser_8h_html_ab6b306ef981f5e21bb41ea2c2dbe8cd9"><div class="ttname"><a href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a></div><div class="ttdeci">flags</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8h_source.html#l00127">http_parser.h:127</a></div></div>
<div class="ttc" id="classReadStats_html_addda90d7fd1cebc352f78f31474403a1"><div class="ttname"><a href="classReadStats.html#addda90d7fd1cebc352f78f31474403a1">ReadStats::perThreadWriteData_</a></div><div class="ttdeci">folly::Synchronized&lt; std::unordered_map&lt; size_t, WriterData &gt; &gt; perThreadWriteData_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriterTest_8cpp_source.html#l00499">AsyncFileWriterTest.cpp:499</a></div></div>
<div class="ttc" id="classmap_html"><div class="ttname"><a href="classmap.html">map</a></div><div class="ttdef"><b>Definition:</b> <a href="Traits_8h_source.html#l00594">Traits.h:594</a></div></div>
<div class="ttc" id="SafeAssert_8h_html_a2679122a9f10d6dc6c2bd975cbd96d50"><div class="ttname"><a href="SafeAssert_8h.html#a2679122a9f10d6dc6c2bd975cbd96d50">FOLLY_SAFE_CHECK</a></div><div class="ttdeci">#define FOLLY_SAFE_CHECK(expr, msg)</div><div class="ttdef"><b>Definition:</b> <a href="SafeAssert_8h_source.html#l00035">SafeAssert.h:35</a></div></div>
<div class="ttc" id="Fingerprint_8cpp_html_a4f1b470245cdebf82b7a560640fb6d56"><div class="ttname"><a href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a></div><div class="ttdeci">static constexpr uint64_t data[1]</div><div class="ttdef"><b>Definition:</b> <a href="Fingerprint_8cpp_source.html#l00043">Fingerprint.cpp:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="aafd64b54296b9635ed9edb12fb4510e5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const std::chrono::steady_clock::time_point ReadStats::deadline_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>deadline_ is a maximum end time for the test.</p>
<p>The writer threads quit if the deadline is reached even if they have not produced the desired number of discard events yet. </p>

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00466">466</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a4bfb17198f3380ab6028b63cd1cc48e3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;<a class="el" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a>&gt; ReadStats::discardEventsSeen_ {0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="structA.html">A</a> count of how many discard events have been seen so far.</p>
<p>The reader increments discardEventsSeen_ each time it sees a discard notification message. <a class="el" href="structA.html">A</a> "discard event" basically corresponds to a single group of dropped messages. Once the reader pulls some messages off out of the pipe the writers should be able to send more data, but the buffer will eventually fill up again, producing another discard event. </p>

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00490">490</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a15ec8143b930c77ca0c068a21a41fb7e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t ReadStats::numDiscarded_ {0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00458">458</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a46c1c27a557c98d99594481e3b5bbe81"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t ReadStats::numOutOfOrder_ {0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00457">457</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2a607b322d0f5b2670d0bec990d13df3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t ReadStats::numUnableToParse_ {0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00456">456</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ac7563c4f1154a4a67bea2958e777fe4f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt;size_t, <a class="el" href="structReadStats_1_1ReaderData.html">ReaderData</a>&gt; ReadStats::perThreadReadData_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="structData.html">Data</a> about each writer thread, as recorded by the reader thread.</p>
<p>At the end of the test we will compare perThreadReadData_ (recorded by the reader) with perThreadWriteData_ (recorded by the writers) to make sure the data matches up.</p>
<p>This is a map from writer_thread_id to <a class="el" href="structReadStats_1_1ReaderData.html">ReaderData</a>. The writer_thread_id is extracted from the received messages.</p>
<p>This field does not need locking as it is only updated by the single reader thread. </p>

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00450">450</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="addda90d7fd1cebc352f78f31474403a1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1Synchronized.html">folly::Synchronized</a>&lt;std::unordered_map&lt;size_t, <a class="el" href="structReadStats_1_1WriterData.html">WriterData</a>&gt; &gt; ReadStats::perThreadWriteData_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p><a class="el" href="structData.html">Data</a> about each writer thread, as recorded by the writers.</p>
<p>When each writer thread finishes it records how many messages it wrote, plus the flags it used to write the messages. </p>

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00499">499</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a3052cf0f7c5d391d72b956eef2c5c692"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;<a class="el" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a>&gt; ReadStats::readSleepUS_ {0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>How long the reader thread should sleep between each read event.</p>
<p>This is initially set to a non-zero value (read from the FLAGS_async_discard_read_sleep_usec flag) so that the reader thread reads slowly, which will fill up the pipe buffer and cause discard events.</p>
<p>Once we have produce enough discards and are ready to finish the test the main thread reduces readSleepUS_ to 0, so the reader will finish the remaining message backlog quickly. </p>

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00479">479</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6aa88939a4429ca77af4347a943da7f5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> ReadStats::trailingData_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00455">455</a> of file <a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>proxygen/folly/folly/logging/test/<a class="el" href="AsyncFileWriterTest_8cpp_source.html">AsyncFileWriterTest.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classReadStats.html">ReadStats</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
