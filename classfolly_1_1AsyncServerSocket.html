<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: folly::AsyncServerSocket Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfolly_1_1AsyncServerSocket.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classfolly_1_1AsyncServerSocket-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::AsyncServerSocket Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for folly::AsyncServerSocket:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classfolly_1_1AsyncServerSocket.png" usemap="#folly::AsyncServerSocket_map" alt=""/>
  <map id="folly::AsyncServerSocket_map" name="folly::AsyncServerSocket_map">
<area href="classfolly_1_1DelayedDestruction.html" alt="folly::DelayedDestruction" shape="rect" coords="0,112,211,136"/>
<area href="classfolly_1_1AsyncSocketBase.html" alt="folly::AsyncSocketBase" shape="rect" coords="221,112,432,136"/>
<area href="classfolly_1_1DelayedDestructionBase.html" alt="folly::DelayedDestructionBase" shape="rect" coords="0,56,211,80"/>
<area href="classfolly_1_1test_1_1MockAsyncServerSocket.html" alt="folly::test::MockAsyncServerSocket" shape="rect" coords="110,224,321,248"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1BackoffTimeout.html">BackoffTimeout</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AsyncServerSocket_1_1CallbackInfo.html">CallbackInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html">ConnectionEventCallback</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AsyncServerSocket_1_1QueueMessage.html">QueueMessage</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1RemoteAcceptor.html">RemoteAcceptor</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AsyncServerSocket_1_1ServerEventHandler.html">ServerEventHandler</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a1a61df9e0ee98382ed7d7e678c9e3e52"><td class="memItemLeft" align="right" valign="top">typedef std::unique_ptr&lt; <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a>, <a class="el" href="classfolly_1_1DelayedDestruction_1_1Destructor.html">Destructor</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a1a61df9e0ee98382ed7d7e678c9e3e52">UniquePtr</a></td></tr>
<tr class="separator:a1a61df9e0ee98382ed7d7e678c9e3e52"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae77f32b67bc4d56d92aa7cdec7231cb1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ae77f32b67bc4d56d92aa7cdec7231cb1">AsyncServerSocket</a> (<a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> &amp;&amp;)=delete</td></tr>
<tr class="separator:ae77f32b67bc4d56d92aa7cdec7231cb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7ff4ac90e51ad15356fac3d1b50f20a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ad7ff4ac90e51ad15356fac3d1b50f20a">AsyncServerSocket</a> (<a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *eventBase=<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>)</td></tr>
<tr class="separator:ad7ff4ac90e51ad15356fac3d1b50f20a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13fb84e85da1aef5f59fc66fbc8ccef5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a13fb84e85da1aef5f59fc66fbc8ccef5">setShutdownSocketSet</a> (const std::weak_ptr&lt; <a class="el" href="classfolly_1_1ShutdownSocketSet.html">ShutdownSocketSet</a> &gt; &amp;wNewSS)</td></tr>
<tr class="separator:a13fb84e85da1aef5f59fc66fbc8ccef5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81ffdd396f2f65b8360aa6bd718714ac"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a81ffdd396f2f65b8360aa6bd718714ac">destroy</a> () override</td></tr>
<tr class="separator:a81ffdd396f2f65b8360aa6bd718714ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c3df3cfec55d9966c64667ecc41536c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a0c3df3cfec55d9966c64667ecc41536c">attachEventBase</a> (<a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *eventBase)</td></tr>
<tr class="separator:a0c3df3cfec55d9966c64667ecc41536c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca9753a1f13d6a4a23d6a2649e620a84"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#aca9753a1f13d6a4a23d6a2649e620a84">detachEventBase</a> ()</td></tr>
<tr class="separator:aca9753a1f13d6a4a23d6a2649e620a84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addd3c7a17313e81a16a4c9e40e5f6f03"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#addd3c7a17313e81a16a4c9e40e5f6f03">getEventBase</a> () const override</td></tr>
<tr class="separator:addd3c7a17313e81a16a4c9e40e5f6f03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb79d74e35d1addb16e96194f791d6b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#aeb79d74e35d1addb16e96194f791d6b4">useExistingSocket</a> (int fd)</td></tr>
<tr class="separator:aeb79d74e35d1addb16e96194f791d6b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab84474eb8bc3f03e98927e06feb7e55a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ab84474eb8bc3f03e98927e06feb7e55a">useExistingSockets</a> (const std::vector&lt; int &gt; &amp;fds)</td></tr>
<tr class="separator:ab84474eb8bc3f03e98927e06feb7e55a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a131c614961fbc96a568475bcc82ded1f"><td class="memItemLeft" align="right" valign="top">std::vector&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a131c614961fbc96a568475bcc82ded1f">getSockets</a> () const </td></tr>
<tr class="separator:a131c614961fbc96a568475bcc82ded1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e2721305cbdb1df9b8146fc0e11c08b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a2e2721305cbdb1df9b8146fc0e11c08b">getSocket</a> () const </td></tr>
<tr class="separator:a2e2721305cbdb1df9b8146fc0e11c08b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaafab2dc98e0cb2190ece7857d40e15b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#aaafab2dc98e0cb2190ece7857d40e15b">setZeroCopy</a> (bool enable)</td></tr>
<tr class="separator:aaafab2dc98e0cb2190ece7857d40e15b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a23e193758638022c15803d87bd622b"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a0a23e193758638022c15803d87bd622b">bind</a> (const <a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> &amp;address)</td></tr>
<tr class="separator:a0a23e193758638022c15803d87bd622b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecc76e34e4040c5933a58cfd44fcf739"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#aecc76e34e4040c5933a58cfd44fcf739">bind</a> (const std::vector&lt; IPAddress &gt; &amp;ipAddresses, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> port)</td></tr>
<tr class="separator:aecc76e34e4040c5933a58cfd44fcf739"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4e53c91e2a1e6ca74e86919c0589f6d"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ab4e53c91e2a1e6ca74e86919c0589f6d">bind</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> port)</td></tr>
<tr class="separator:ab4e53c91e2a1e6ca74e86919c0589f6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af940f12891dda51c351295fe89652102"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#af940f12891dda51c351295fe89652102">getAddress</a> (<a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> *addressReturn) const override</td></tr>
<tr class="separator:af940f12891dda51c351295fe89652102"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6692ebc8e9e9f6ce7f766919389636e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#af6692ebc8e9e9f6ce7f766919389636e">getAddress</a> () const </td></tr>
<tr class="separator:af6692ebc8e9e9f6ce7f766919389636e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12139327a3a63318fc01b10db7bba215"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a12139327a3a63318fc01b10db7bba215">getAddresses</a> () const </td></tr>
<tr class="separator:a12139327a3a63318fc01b10db7bba215"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d72081ece353ce084d066547e1b5f4b"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a3d72081ece353ce084d066547e1b5f4b">listen</a> (int backlog)</td></tr>
<tr class="separator:a3d72081ece353ce084d066547e1b5f4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a054f650a28760b166f109194ea15cbf1"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a054f650a28760b166f109194ea15cbf1">addAcceptCallback</a> (<a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a> *callback, <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *eventBase, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> maxAtOnce=<a class="el" href="classfolly_1_1AsyncServerSocket.html#a0d25a4169140ac6b397c8a9d66895f9c">kDefaultCallbackAcceptAtOnce</a>)</td></tr>
<tr class="separator:a054f650a28760b166f109194ea15cbf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72c7640a46aeb62b1d4ee1368bf3edf1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a72c7640a46aeb62b1d4ee1368bf3edf1">removeAcceptCallback</a> (<a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a> *callback, <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *eventBase)</td></tr>
<tr class="separator:a72c7640a46aeb62b1d4ee1368bf3edf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a125620843204dec2bc63d3d50bad5e39"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting</a> ()</td></tr>
<tr class="separator:a125620843204dec2bc63d3d50bad5e39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af18b5c583d18cb824ecb83630c7e4fa1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#af18b5c583d18cb824ecb83630c7e4fa1">pauseAccepting</a> ()</td></tr>
<tr class="separator:af18b5c583d18cb824ecb83630c7e4fa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d18fd90cd3075db3051d46d4914c666"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a8d18fd90cd3075db3051d46d4914c666">stopAccepting</a> (int shutdownFlags=-1)</td></tr>
<tr class="separator:a8d18fd90cd3075db3051d46d4914c666"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaae09d03c88c6a5bd58e2f0a1df0c434"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#aaae09d03c88c6a5bd58e2f0a1df0c434">getMaxAcceptAtOnce</a> () const </td></tr>
<tr class="separator:aaae09d03c88c6a5bd58e2f0a1df0c434"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2297e5809bd9c6842af60ed9788907ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a2297e5809bd9c6842af60ed9788907ee">setMaxAcceptAtOnce</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> numConns)</td></tr>
<tr class="separator:a2297e5809bd9c6842af60ed9788907ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11d76410a98b6de4775991b0c98a104f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a11d76410a98b6de4775991b0c98a104f">getMaxNumMessagesInQueue</a> () const </td></tr>
<tr class="separator:a11d76410a98b6de4775991b0c98a104f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2e166e56df26f94c9125514faa5d988"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ab2e166e56df26f94c9125514faa5d988">setMaxNumMessagesInQueue</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> num)</td></tr>
<tr class="separator:ab2e166e56df26f94c9125514faa5d988"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb21f5f89a7fea0aa2e00b1ad4f6a74e"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#aeb21f5f89a7fea0aa2e00b1ad4f6a74e">getAcceptRateAdjustSpeed</a> () const </td></tr>
<tr class="separator:aeb21f5f89a7fea0aa2e00b1ad4f6a74e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36ae305e0e4e34fed2a92650a49b8f8b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a36ae305e0e4e34fed2a92650a49b8f8b">setAcceptRateAdjustSpeed</a> (double speed)</td></tr>
<tr class="separator:a36ae305e0e4e34fed2a92650a49b8f8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad66a91b5bf3a439cef33d349809a4f18"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ad66a91b5bf3a439cef33d349809a4f18">setTosReflect</a> (bool enable)</td></tr>
<tr class="separator:ad66a91b5bf3a439cef33d349809a4f18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3004a10388ca6fe093919e86089f6837"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a3004a10388ca6fe093919e86089f6837">getTosReflect</a> ()</td></tr>
<tr class="separator:a3004a10388ca6fe093919e86089f6837"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad630c1d8fa323f46b1eff8de0a6069c2"><td class="memItemLeft" align="right" valign="top">std::size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ad630c1d8fa323f46b1eff8de0a6069c2">getNumDroppedConnections</a> () const </td></tr>
<tr class="separator:ad630c1d8fa323f46b1eff8de0a6069c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87d316a711b026a43fe0da34bc0cd7d7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a21214d6ef664ff09b89c1fd75fe0a042">int64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a87d316a711b026a43fe0da34bc0cd7d7">getNumPendingMessagesInQueue</a> () const </td></tr>
<tr class="separator:a87d316a711b026a43fe0da34bc0cd7d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00b0a6ed3031d48c57866ae3686f1725"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a00b0a6ed3031d48c57866ae3686f1725">setKeepAliveEnabled</a> (bool enabled)</td></tr>
<tr class="separator:a00b0a6ed3031d48c57866ae3686f1725"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a71f09e5574e04908ea3c6ea2b50ebc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a2a71f09e5574e04908ea3c6ea2b50ebc">getKeepAliveEnabled</a> () const </td></tr>
<tr class="separator:a2a71f09e5574e04908ea3c6ea2b50ebc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af27e128da9abf295f5f1d3fab279a010"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#af27e128da9abf295f5f1d3fab279a010">setReusePortEnabled</a> (bool enabled)</td></tr>
<tr class="separator:af27e128da9abf295f5f1d3fab279a010"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a478cb75197260c84b9832b80152421f5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a478cb75197260c84b9832b80152421f5">getReusePortEnabled_</a> () const </td></tr>
<tr class="separator:a478cb75197260c84b9832b80152421f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f886df6b9be8f0339437586784c1d33"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a8f886df6b9be8f0339437586784c1d33">setCloseOnExec</a> (bool closeOnExec)</td></tr>
<tr class="separator:a8f886df6b9be8f0339437586784c1d33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a591aa1b36c82bd3a478bd393052f8d0a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a591aa1b36c82bd3a478bd393052f8d0a">getCloseOnExec</a> () const </td></tr>
<tr class="separator:a591aa1b36c82bd3a478bd393052f8d0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c80f4f8fabdab23719d41444250aef2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a8c80f4f8fabdab23719d41444250aef2">setTFOEnabled</a> (bool enabled, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> maxTFOQueueSize)</td></tr>
<tr class="separator:a8c80f4f8fabdab23719d41444250aef2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff7521f4bf9fef35432184e55c1b3fc6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#aff7521f4bf9fef35432184e55c1b3fc6">disableTransparentTls</a> ()</td></tr>
<tr class="separator:aff7521f4bf9fef35432184e55c1b3fc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5587710f4d8a8988d571a85d084d56e5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a5587710f4d8a8988d571a85d084d56e5">getAccepting</a> () const </td></tr>
<tr class="separator:a5587710f4d8a8988d571a85d084d56e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e85f6e35d3570102ed3966ca2d38c33"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a4e85f6e35d3570102ed3966ca2d38c33">setConnectionEventCallback</a> (<a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html">ConnectionEventCallback</a> *const connectionEventCallback)</td></tr>
<tr class="separator:a4e85f6e35d3570102ed3966ca2d38c33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acac69507b65526100185bf60de99e4b4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html">ConnectionEventCallback</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#acac69507b65526100185bf60de99e4b4">getConnectionEventCallback</a> () const </td></tr>
<tr class="separator:acac69507b65526100185bf60de99e4b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfolly_1_1DelayedDestruction"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfolly_1_1DelayedDestruction')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfolly_1_1DelayedDestruction.html">folly::DelayedDestruction</a></td></tr>
<tr class="memitem:a2b64caadd65cdae43185e05eb4beb3fa inherit pub_methods_classfolly_1_1DelayedDestruction"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestruction.html#a2b64caadd65cdae43185e05eb4beb3fa">getDestroyPending</a> () const </td></tr>
<tr class="separator:a2b64caadd65cdae43185e05eb4beb3fa inherit pub_methods_classfolly_1_1DelayedDestruction"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfolly_1_1DelayedDestructionBase"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfolly_1_1DelayedDestructionBase')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfolly_1_1DelayedDestructionBase.html">folly::DelayedDestructionBase</a></td></tr>
<tr class="memitem:a50c17a3675426754e89707ded8566f9f inherit pub_methods_classfolly_1_1DelayedDestructionBase"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestructionBase.html#a50c17a3675426754e89707ded8566f9f">~DelayedDestructionBase</a> ()=default</td></tr>
<tr class="separator:a50c17a3675426754e89707ded8566f9f inherit pub_methods_classfolly_1_1DelayedDestructionBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfolly_1_1AsyncSocketBase"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfolly_1_1AsyncSocketBase')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfolly_1_1AsyncSocketBase.html">folly::AsyncSocketBase</a></td></tr>
<tr class="memitem:adf9568117cc2889a7da37deb48de2171 inherit pub_methods_classfolly_1_1AsyncSocketBase"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncSocketBase.html#adf9568117cc2889a7da37deb48de2171">~AsyncSocketBase</a> ()=default</td></tr>
<tr class="separator:adf9568117cc2889a7da37deb48de2171 inherit pub_methods_classfolly_1_1AsyncSocketBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a77ef98039c764a1a6e35ceb95b7fc46d"><td class="memItemLeft" align="right" valign="top">static std::shared_ptr&lt; <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a77ef98039c764a1a6e35ceb95b7fc46d">newSocket</a> (<a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *evb=<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>)</td></tr>
<tr class="separator:a77ef98039c764a1a6e35ceb95b7fc46d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:afbd22010be704480c2396c6e19aca023"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#afbd22010be704480c2396c6e19aca023">kDefaultMaxAcceptAtOnce</a> = 30</td></tr>
<tr class="separator:afbd22010be704480c2396c6e19aca023"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d25a4169140ac6b397c8a9d66895f9c"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a0d25a4169140ac6b397c8a9d66895f9c">kDefaultCallbackAcceptAtOnce</a> = 5</td></tr>
<tr class="separator:a0d25a4169140ac6b397c8a9d66895f9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f47b5b536258612b3aba4403055a4d6"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a6f47b5b536258612b3aba4403055a4d6">kDefaultMaxMessagesInQueue</a> = 1024</td></tr>
<tr class="separator:a6f47b5b536258612b3aba4403055a4d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a438c9bc7e16c10a76aacc181e61c922e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a438c9bc7e16c10a76aacc181e61c922e">~AsyncServerSocket</a> () override</td></tr>
<tr class="separator:a438c9bc7e16c10a76aacc181e61c922e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_methods_classfolly_1_1DelayedDestruction"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_classfolly_1_1DelayedDestruction')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="classfolly_1_1DelayedDestruction.html">folly::DelayedDestruction</a></td></tr>
<tr class="memitem:adc9a58eaf38e0e9afea76101942ae7df inherit pro_methods_classfolly_1_1DelayedDestruction"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestruction.html#adc9a58eaf38e0e9afea76101942ae7df">~DelayedDestruction</a> () override=default</td></tr>
<tr class="separator:adc9a58eaf38e0e9afea76101942ae7df inherit pro_methods_classfolly_1_1DelayedDestruction"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42db04c8a694b8584822371afb67012c inherit pro_methods_classfolly_1_1DelayedDestruction"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestruction.html#a42db04c8a694b8584822371afb67012c">DelayedDestruction</a> ()</td></tr>
<tr class="separator:a42db04c8a694b8584822371afb67012c inherit pro_methods_classfolly_1_1DelayedDestruction"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_methods_classfolly_1_1DelayedDestructionBase"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_classfolly_1_1DelayedDestructionBase')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="classfolly_1_1DelayedDestructionBase.html">folly::DelayedDestructionBase</a></td></tr>
<tr class="memitem:ad0257a1b700f005ee75d45ecf67abf76 inherit pro_methods_classfolly_1_1DelayedDestructionBase"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestructionBase.html#ad0257a1b700f005ee75d45ecf67abf76">DelayedDestructionBase</a> ()</td></tr>
<tr class="separator:ad0257a1b700f005ee75d45ecf67abf76 inherit pro_methods_classfolly_1_1DelayedDestructionBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31591f967cbdb0b071bff2880de37cb0 inherit pro_methods_classfolly_1_1DelayedDestructionBase"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestructionBase.html#a31591f967cbdb0b071bff2880de37cb0">getDestructorGuardCount</a> () const </td></tr>
<tr class="separator:a31591f967cbdb0b071bff2880de37cb0 inherit pro_methods_classfolly_1_1DelayedDestructionBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a255d3a1e871a51764727504f290fbc9d"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a255d3a1e871a51764727504f290fbc9d">MessageType</a> { <a class="el" href="classfolly_1_1AsyncServerSocket.html#a255d3a1e871a51764727504f290fbc9dabff78c1634882da30cebaf4a51c44117">MessageType::MSG_NEW_CONN</a> = 0, 
<a class="el" href="classfolly_1_1AsyncServerSocket.html#a255d3a1e871a51764727504f290fbc9da5c89a276ac7877e1de49cdc1b4750ce4">MessageType::MSG_ERROR</a> = 1
 }</td></tr>
<tr class="separator:a255d3a1e871a51764727504f290fbc9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ad8bc016a87884c14e4e7855688f2d360"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ad8bc016a87884c14e4e7855688f2d360">handlerReady</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> events, int socket, sa_family_t family) noexcept</td></tr>
<tr class="separator:ad8bc016a87884c14e4e7855688f2d360"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20fa204e321d7f899f5cea9d145adc07"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a20fa204e321d7f899f5cea9d145adc07">createSocket</a> (int family)</td></tr>
<tr class="separator:a20fa204e321d7f899f5cea9d145adc07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6d4face307be53e9deef54e08d294a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ac6d4face307be53e9deef54e08d294a4">setupSocket</a> (int fd, int family)</td></tr>
<tr class="separator:ac6d4face307be53e9deef54e08d294a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74ff5451c48d43dc63d02f7f8ea617c1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a74ff5451c48d43dc63d02f7f8ea617c1">bindSocket</a> (int fd, const <a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> &amp;address, bool isExistingSocket)</td></tr>
<tr class="separator:a74ff5451c48d43dc63d02f7f8ea617c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a099dfb224be0986e78872b8b704f07b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a099dfb224be0986e78872b8b704f07b8">dispatchSocket</a> (int socket, <a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> &amp;&amp;address)</td></tr>
<tr class="separator:a099dfb224be0986e78872b8b704f07b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9388286b8e865c28801ecd3d7b8df5b0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a9388286b8e865c28801ecd3d7b8df5b0">dispatchError</a> (const char *msg, int <a class="el" href="Subprocess_8cpp.html#ab78a8e14b1ed8af9a3ab22879ba64873">errnoValue</a>)</td></tr>
<tr class="separator:a9388286b8e865c28801ecd3d7b8df5b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae77d15bf0bf88ef84f4114fcfaf5635e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ae77d15bf0bf88ef84f4114fcfaf5635e">enterBackoff</a> ()</td></tr>
<tr class="separator:ae77d15bf0bf88ef84f4114fcfaf5635e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81f974cef89b33cdd381167f03199f1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a81f974cef89b33cdd381167f03199f1a">backoffTimeoutExpired</a> ()</td></tr>
<tr class="separator:a81f974cef89b33cdd381167f03199f1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a387db3b642ca8f005458077e30c9c9bb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfolly_1_1AsyncServerSocket_1_1CallbackInfo.html">CallbackInfo</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a387db3b642ca8f005458077e30c9c9bb">nextCallback</a> ()</td></tr>
<tr class="separator:a387db3b642ca8f005458077e30c9c9bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a9c785d226c23e0664137bae64b03eac0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a></td></tr>
<tr class="separator:a9c785d226c23e0664137bae64b03eac0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20f34533f96bf8a250e29d6bcc0f38e1"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structfolly_1_1AsyncServerSocket_1_1ServerEventHandler.html">ServerEventHandler</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a></td></tr>
<tr class="separator:a20f34533f96bf8a250e29d6bcc0f38e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96ea77dfc1b55dd71460cf318e048ba2"><td class="memItemLeft" align="right" valign="top">std::vector&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a96ea77dfc1b55dd71460cf318e048ba2">pendingCloseSockets_</a></td></tr>
<tr class="separator:a96ea77dfc1b55dd71460cf318e048ba2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac336ecd3a05e2f5775e7c38843f3e7fa"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a></td></tr>
<tr class="separator:ac336ecd3a05e2f5775e7c38843f3e7fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fd9bb6743ad7777813ea08b036b22d1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a1fd9bb6743ad7777813ea08b036b22d1">maxAcceptAtOnce_</a></td></tr>
<tr class="separator:a1fd9bb6743ad7777813ea08b036b22d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab95836efcfcae6931dc5b946ffba8d75"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ab95836efcfcae6931dc5b946ffba8d75">maxNumMsgsInQueue_</a></td></tr>
<tr class="separator:ab95836efcfcae6931dc5b946ffba8d75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72a915da62e4834b5a511e85ddd825ea"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">acceptRateAdjustSpeed_</a></td></tr>
<tr class="separator:a72a915da62e4834b5a511e85ddd825ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fb06ffa1f0a28d1733ebb8cce5bf753"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">acceptRate_</a></td></tr>
<tr class="separator:a0fb06ffa1f0a28d1733ebb8cce5bf753"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa8953cadd940d0f1de1fdd64b58d202"><td class="memItemLeft" align="right" valign="top">std::chrono::time_point&lt; std::chrono::steady_clock &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#aaa8953cadd940d0f1de1fdd64b58d202">lastAccepTimestamp_</a></td></tr>
<tr class="separator:aaa8953cadd940d0f1de1fdd64b58d202"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59dbc9923e1cbc2952d51eff8526b900"><td class="memItemLeft" align="right" valign="top">std::size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a59dbc9923e1cbc2952d51eff8526b900">numDroppedConnections_</a></td></tr>
<tr class="separator:a59dbc9923e1cbc2952d51eff8526b900"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5288fb748a646e57f0e11f9af31ab16f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a></td></tr>
<tr class="separator:a5288fb748a646e57f0e11f9af31ab16f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab320137b9581d5dec588d30c9361063c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1BackoffTimeout.html">BackoffTimeout</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">backoffTimeout_</a></td></tr>
<tr class="separator:ab320137b9581d5dec588d30c9361063c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b9e7b78b31af268cdae329f88130caf"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structfolly_1_1AsyncServerSocket_1_1CallbackInfo.html">CallbackInfo</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a></td></tr>
<tr class="separator:a8b9e7b78b31af268cdae329f88130caf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c39ff08b287e27bb0197228fe0fe284"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a6c39ff08b287e27bb0197228fe0fe284">keepAliveEnabled_</a></td></tr>
<tr class="separator:a6c39ff08b287e27bb0197228fe0fe284"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac73b9cedbdba1d12be40478cecd91900"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#ac73b9cedbdba1d12be40478cecd91900">reusePortEnabled_</a> {false}</td></tr>
<tr class="separator:ac73b9cedbdba1d12be40478cecd91900"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12c992855f85d32186554a21700401e2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a12c992855f85d32186554a21700401e2">closeOnExec_</a></td></tr>
<tr class="separator:a12c992855f85d32186554a21700401e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e718d426534e0b4f0d68c4ed45de549"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a9e718d426534e0b4f0d68c4ed45de549">tfo_</a> {false}</td></tr>
<tr class="separator:a9e718d426534e0b4f0d68c4ed45de549"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e9822907a7c45314894404923de357c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a2e9822907a7c45314894404923de357c">noTransparentTls_</a> {false}</td></tr>
<tr class="separator:a2e9822907a7c45314894404923de357c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc9c3060d53c39c54b43f6ebe18ff7db"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#acc9c3060d53c39c54b43f6ebe18ff7db">tfoMaxQueueSize_</a> {0}</td></tr>
<tr class="separator:acc9c3060d53c39c54b43f6ebe18ff7db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a620c7911f1f89369b636b633f6ed14e3"><td class="memItemLeft" align="right" valign="top">std::weak_ptr&lt; <a class="el" href="classfolly_1_1ShutdownSocketSet.html">ShutdownSocketSet</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a620c7911f1f89369b636b633f6ed14e3">wShutdownSocketSet_</a></td></tr>
<tr class="separator:a620c7911f1f89369b636b633f6ed14e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48bed27d36529d46d889414c9f5fe463"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html">ConnectionEventCallback</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a> {<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>}</td></tr>
<tr class="separator:a48bed27d36529d46d889414c9f5fe463"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54ca161ae97ea01ed367d19a2add5b11"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncServerSocket.html#a54ca161ae97ea01ed367d19a2add5b11">tosReflect_</a> {false}</td></tr>
<tr class="separator:a54ca161ae97ea01ed367d19a2add5b11"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="structA.html">A</a> listening socket that asynchronously informs a callback whenever a new connection has been accepted.</p>
<p>Unlike most async interfaces that always invoke their callback in the same <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread, <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> is unusual in that it can distribute the callbacks across multiple <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> threads.</p>
<p>This supports a common use case for network servers to distribute incoming connections across a number of <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> threads. (Servers typically run with one <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread per CPU.)</p>
<p>Despite being able to invoke callbacks in multiple <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> threads, <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> still has one "primary" <a class="el" href="classfolly_1_1EventBase.html">EventBase</a>. Operations that modify the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> state may only be performed from the primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00065">65</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="a1a61df9e0ee98382ed7d7e678c9e3e52"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::unique_ptr&lt;<a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a>, <a class="el" href="classfolly_1_1DelayedDestruction_1_1Destructor.html">Destructor</a>&gt; <a class="el" href="classfolly_1_1AsyncServerSocket.html#a1a61df9e0ee98382ed7d7e678c9e3e52">folly::AsyncServerSocket::UniquePtr</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00067">67</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="a255d3a1e871a51764727504f290fbc9d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classfolly_1_1AsyncServerSocket.html#a255d3a1e871a51764727504f290fbc9d">folly::AsyncServerSocket::MessageType</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">strong</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a255d3a1e871a51764727504f290fbc9dabff78c1634882da30cebaf4a51c44117"></a>MSG_NEW_CONN&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a255d3a1e871a51764727504f290fbc9da5c89a276ac7877e1de49cdc1b4750ce4"></a>MSG_ERROR&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00742">742</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;{ MSG_NEW_CONN = 0, MSG_ERROR = 1 };</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ae77f32b67bc4d56d92aa7cdec7231cb1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::AsyncServerSocket::AsyncServerSocket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> &amp;&amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00226">newSocket()</a>.</p>

</div>
</div>
<a class="anchor" id="ad7ff4ac90e51ad15356fac3d1b50f20a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::AsyncServerSocket::AsyncServerSocket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *&#160;</td>
          <td class="paramname"><em>eventBase</em> = <code><a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Create a new <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> with the specified <a class="el" href="classfolly_1_1EventBase.html">EventBase</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">eventBase</td><td>The <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> to use for driving the asynchronous I/O. If this parameter is nullptr, <a class="el" href="classfolly_1_1AsyncServerSocket.html#a0c3df3cfec55d9966c64667ecc41536c">attachEventBase()</a> must be called before this socket can begin accepting connections. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00162">162</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00707">disableTransparentTls()</a>.</p>
<div class="fragment"><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>(eventBase),</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a>(<span class="keyword">false</span>),</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a1fd9bb6743ad7777813ea08b036b22d1">maxAcceptAtOnce_</a>(<a class="code" href="classfolly_1_1AsyncServerSocket.html#afbd22010be704480c2396c6e19aca023">kDefaultMaxAcceptAtOnce</a>),</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#ab95836efcfcae6931dc5b946ffba8d75">maxNumMsgsInQueue_</a>(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a6f47b5b536258612b3aba4403055a4d6">kDefaultMaxMessagesInQueue</a>),</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">acceptRateAdjustSpeed_</a>(0),</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">acceptRate_</a>(1),</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#aaa8953cadd940d0f1de1fdd64b58d202">lastAccepTimestamp_</a>(<a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">std::chrono::steady_clock::now</a>()),</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a59dbc9923e1cbc2952d51eff8526b900">numDroppedConnections_</a>(0),</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a>(0),</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">backoffTimeout_</a>(<span class="keyword">nullptr</span>),</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>(),</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a6c39ff08b287e27bb0197228fe0fe284">keepAliveEnabled_</a>(<span class="keyword">true</span>),</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a12c992855f85d32186554a21700401e2">closeOnExec_</a>(<span class="keyword">true</span>) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#aff7521f4bf9fef35432184e55c1b3fc6">disableTransparentTls</a>();</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a6f47b5b536258612b3aba4403055a4d6"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a6f47b5b536258612b3aba4403055a4d6">folly::AsyncServerSocket::kDefaultMaxMessagesInQueue</a></div><div class="ttdeci">static const uint32_t kDefaultMaxMessagesInQueue</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00209">AsyncServerSocket.h:209</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ab95836efcfcae6931dc5b946ffba8d75"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ab95836efcfcae6931dc5b946ffba8d75">folly::AsyncServerSocket::maxNumMsgsInQueue_</a></div><div class="ttdeci">uint32_t maxNumMsgsInQueue_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00874">AsyncServerSocket.h:874</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a0fb06ffa1f0a28d1733ebb8cce5bf753"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">folly::AsyncServerSocket::acceptRate_</a></div><div class="ttdeci">double acceptRate_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00876">AsyncServerSocket.h:876</a></div></div>
<div class="ttc" id="TimekeeperTest_8cpp_html_a562b4baa36dcf267f35a4ba4e0aef329"><div class="ttname"><a href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a></div><div class="ttdeci">std::chrono::steady_clock::time_point now()</div><div class="ttdef"><b>Definition:</b> <a href="TimekeeperTest_8cpp_source.html#l00031">TimekeeperTest.cpp:31</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a5288fb748a646e57f0e11f9af31ab16f"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">folly::AsyncServerSocket::callbackIndex_</a></div><div class="ttdeci">uint32_t callbackIndex_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00879">AsyncServerSocket.h:879</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_aaa8953cadd940d0f1de1fdd64b58d202"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#aaa8953cadd940d0f1de1fdd64b58d202">folly::AsyncServerSocket::lastAccepTimestamp_</a></div><div class="ttdeci">std::chrono::time_point&lt; std::chrono::steady_clock &gt; lastAccepTimestamp_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00877">AsyncServerSocket.h:877</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8b9e7b78b31af268cdae329f88130caf"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">folly::AsyncServerSocket::callbacks_</a></div><div class="ttdeci">std::vector&lt; CallbackInfo &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00881">AsyncServerSocket.h:881</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_afbd22010be704480c2396c6e19aca023"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#afbd22010be704480c2396c6e19aca023">folly::AsyncServerSocket::kDefaultMaxAcceptAtOnce</a></div><div class="ttdeci">static const uint32_t kDefaultMaxAcceptAtOnce</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00207">AsyncServerSocket.h:207</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a6c39ff08b287e27bb0197228fe0fe284"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a6c39ff08b287e27bb0197228fe0fe284">folly::AsyncServerSocket::keepAliveEnabled_</a></div><div class="ttdeci">bool keepAliveEnabled_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00882">AsyncServerSocket.h:882</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a59dbc9923e1cbc2952d51eff8526b900"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a59dbc9923e1cbc2952d51eff8526b900">folly::AsyncServerSocket::numDroppedConnections_</a></div><div class="ttdeci">std::size_t numDroppedConnections_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00878">AsyncServerSocket.h:878</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac336ecd3a05e2f5775e7c38843f3e7fa"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">folly::AsyncServerSocket::accepting_</a></div><div class="ttdeci">bool accepting_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00872">AsyncServerSocket.h:872</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a12c992855f85d32186554a21700401e2"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a12c992855f85d32186554a21700401e2">folly::AsyncServerSocket::closeOnExec_</a></div><div class="ttdeci">bool closeOnExec_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00884">AsyncServerSocket.h:884</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a1fd9bb6743ad7777813ea08b036b22d1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a1fd9bb6743ad7777813ea08b036b22d1">folly::AsyncServerSocket::maxAcceptAtOnce_</a></div><div class="ttdeci">uint32_t maxAcceptAtOnce_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00873">AsyncServerSocket.h:873</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ab320137b9581d5dec588d30c9361063c"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">folly::AsyncServerSocket::backoffTimeout_</a></div><div class="ttdeci">BackoffTimeout * backoffTimeout_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00880">AsyncServerSocket.h:880</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a72a915da62e4834b5a511e85ddd825ea"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">folly::AsyncServerSocket::acceptRateAdjustSpeed_</a></div><div class="ttdeci">double acceptRateAdjustSpeed_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00875">AsyncServerSocket.h:875</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_aff7521f4bf9fef35432184e55c1b3fc6"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#aff7521f4bf9fef35432184e55c1b3fc6">folly::AsyncServerSocket::disableTransparentTls</a></div><div class="ttdeci">void disableTransparentTls()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00707">AsyncServerSocket.h:707</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a438c9bc7e16c10a76aacc181e61c922e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::AsyncServerSocket::~AsyncServerSocket </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Protected destructor.</p>
<p>Invoke <a class="el" href="classfolly_1_1AsyncServerSocket.html#a81ffdd396f2f65b8360aa6bd718714ac">destroy()</a> instead to destroy the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a>. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00203">203</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00881">callbacks_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00729">getConnectionEventCallback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                                      {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  assert(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.empty());</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8b9e7b78b31af268cdae329f88130caf"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">folly::AsyncServerSocket::callbacks_</a></div><div class="ttdeci">std::vector&lt; CallbackInfo &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00881">AsyncServerSocket.h:881</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a054f650a28760b166f109194ea15cbf1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::addAcceptCallback </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a> *&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *&#160;</td>
          <td class="paramname"><em>eventBase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>maxAtOnce</em> = <code><a class="el" href="classfolly_1_1AsyncServerSocket.html#a0d25a4169140ac6b397c8a9d66895f9c">kDefaultCallbackAcceptAtOnce</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Add an <a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a>.</p>
<p>When a new socket is accepted, one of the AcceptCallbacks will be invoked with the new socket. The AcceptCallbacks are invoked in a round-robin fashion. This allows the accepted sockets to be distributed among a pool of threads, each running its own <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> object. This is a common model, since most asynchronous-style servers typically run one <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread per CPU.</p>
<p>The <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> object associated with each <a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a> must be running its loop. If the <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> loop is not running, sockets will still be scheduled for the callback, but the callback cannot actually get invoked until the loop runs.</p>
<p>This method must be invoked from the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a>'s primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread.</p>
<p>Note that <a class="el" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting()</a> must be called on the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> to cause it to actually start accepting sockets once callbacks have been installed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">callback</td><td>The callback to invoke. </td></tr>
    <tr><td class="paramname">eventBase</td><td>The <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> to use to invoke the callback. This parameter may be nullptr, in which case the callback will be invoked in the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a>'s primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a>. </td></tr>
    <tr><td class="paramname">maxAtOnce</td><td>The maximum number of connections to accept in this callback on a single iteration of the event base loop. This only takes effect when eventBase is non-nullptr. When using a nullptr eventBase for the callback, the <a class="el" href="classfolly_1_1AsyncServerSocket.html#a2297e5809bd9c6842af60ed9788907ee">setMaxAcceptAtOnce()</a> method controls how many connections the main event base will accept at once. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00586">586</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00872">accepting_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00194">folly::AsyncServerSocket::AcceptCallback::acceptStarted()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00881">callbacks_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00889">connectionEventCallback_</a>, <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00874">maxNumMsgsInQueue_</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00082">folly::AsyncServerSocket::RemoteAcceptor::start()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00704">startAccepting()</a>.</p>

<p>Referenced by <a class="el" href="ZeroCopy_8h_source.html#l00225">folly::ZeroCopyTestServer::addCallbackToServerSocket()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00368">getAddress()</a>, <a class="el" href="Acceptor_8cpp_source.html#l00060">wangle::Acceptor::init()</a>, and <a class="el" href="AsyncSocketTest2_8cpp_source.html#l01911">serverSocketSanityTest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                        {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>) {</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  }</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="comment">// If this is the first accept callback and we are supposed to be accepting,</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="comment">// start accepting once the callback is installed.</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="keywordtype">bool</span> runStartAccepting = <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a> &amp;&amp; <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.empty();</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.emplace_back(callback, eventBase);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  SCOPE_SUCCESS {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">// If this is the first accept callback and we are supposed to be accepting,</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">// start accepting.</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">if</span> (runStartAccepting) {</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting</a>();</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  };</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="keywordflow">if</span> (!eventBase) {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="comment">// Run in AsyncServerSocket&#39;s eventbase; notify that we are</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="comment">// starting to accept connections</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    callback-&gt;acceptStarted();</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="comment">// Start the remote acceptor.</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  <span class="comment">// It would be nice if we could avoid starting the remote acceptor if</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <span class="comment">// eventBase == eventBase_.  However, that would cause issues if</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <span class="comment">// detachEventBase() and attachEventBase() were ever used to change the</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="comment">// primary EventBase for the server socket.  Therefore we require the caller</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="comment">// to specify a nullptr EventBase if they want to ensure that the callback is</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <span class="comment">// always invoked in the primary EventBase, and to be able to invoke that</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">// callback more efficiently without having to use a notification queue.</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  RemoteAcceptor* acceptor = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    acceptor = <span class="keyword">new</span> RemoteAcceptor(callback, <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    acceptor-&gt;start(eventBase, maxAtOnce, <a class="code" href="classfolly_1_1AsyncServerSocket.html#ab95836efcfcae6931dc5b946ffba8d75">maxNumMsgsInQueue_</a>);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.pop_back();</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keyword">delete</span> acceptor;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.back().consumer = acceptor;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ab95836efcfcae6931dc5b946ffba8d75"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ab95836efcfcae6931dc5b946ffba8d75">folly::AsyncServerSocket::maxNumMsgsInQueue_</a></div><div class="ttdeci">uint32_t maxNumMsgsInQueue_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00874">AsyncServerSocket.h:874</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a48bed27d36529d46d889414c9f5fe463"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">folly::AsyncServerSocket::connectionEventCallback_</a></div><div class="ttdeci">ConnectionEventCallback * connectionEventCallback_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00889">AsyncServerSocket.h:889</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8b9e7b78b31af268cdae329f88130caf"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">folly::AsyncServerSocket::callbacks_</a></div><div class="ttdeci">std::vector&lt; CallbackInfo &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00881">AsyncServerSocket.h:881</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a125620843204dec2bc63d3d50bad5e39"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">folly::AsyncServerSocket::startAccepting</a></div><div class="ttdeci">virtual void startAccepting()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00704">AsyncServerSocket.cpp:704</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac336ecd3a05e2f5775e7c38843f3e7fa"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">folly::AsyncServerSocket::accepting_</a></div><div class="ttdeci">bool accepting_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00872">AsyncServerSocket.h:872</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0c3df3cfec55d9966c64667ecc41536c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::attachEventBase </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *&#160;</td>
          <td class="paramname"><em>eventBase</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Attach this <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> to its primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a>.</p>
<p>This may only be called if the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> is not already attached to a <a class="el" href="classfolly_1_1EventBase.html">EventBase</a>. The <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> must be attached to a <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> before it can begin accepting connections. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00274">274</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00226">newSocket()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00844">folly::AsyncServerSocket::ServerEventHandler::operator=()</a>.</p>
<div class="fragment"><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                                            {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  assert(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a> == <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  eventBase-&gt;dcheckIsInEventBaseThread();</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a> = eventBase;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.attachEventBase(eventBase);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a81f974cef89b33cdd381167f03199f1a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::backoffTimeoutExpired </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l01142">1142</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00872">accepting_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00881">callbacks_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00889">connectionEventCallback_</a>, <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, <a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#aa79896da4a0a22d4fd357c1a5f92f7db">folly::AsyncServerSocket::ConnectionEventCallback::onBackoffEnded()</a>, <a class="el" href="EventHandler_8h_source.html#l00046">folly::EventHandler::PERSIST</a>, <a class="el" href="EventHandler_8h_source.html#l00043">folly::EventHandler::READ</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>
<div class="fragment"><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                                              {</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  <span class="comment">// accepting_ should still be true.</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  <span class="comment">// If pauseAccepting() was called while in the backoff state it will cancel</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  <span class="comment">// the backoff timeout.</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  assert(<a class="code" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a>);</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="comment">// We can&#39;t be detached from the EventBase without being paused</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  assert(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a> != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  <span class="comment">// If all of the callbacks were removed, we shouldn&#39;t re-enable accepts</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.empty()) {</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#aa79896da4a0a22d4fd357c1a5f92f7db">onBackoffEnded</a>();</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    }</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  }</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <span class="comment">// Register the handler.</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.registerHandler(<a class="code" href="classfolly_1_1EventHandler.html#a03ecfc8fd68fa86b693c1e56148e862ca7b6303958f6418301a09e7ee402eae8f">EventHandler::READ</a> | <a class="code" href="classfolly_1_1EventHandler.html#a03ecfc8fd68fa86b693c1e56148e862ca60be439c6bcefd5e64997f8f4d05a572">EventHandler::PERSIST</a>)) {</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="comment">// We&#39;re hosed.  We could just re-schedule backoffTimeout_ to</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      <span class="comment">// re-try again after a little bit.  However, we don&#39;t want to</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <span class="comment">// loop retrying forever if we can&#39;t re-enable accepts.  Just</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      <span class="comment">// abort the entire program in this state; things are really bad</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      <span class="comment">// and restarting the entire server is probably the best remedy.</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      LOG(ERROR)</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;failed to re-enable AsyncServerSocket accepts after backoff; &quot;</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;crashing now&quot;</span>;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      abort();</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    }</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#aa79896da4a0a22d4fd357c1a5f92f7db">onBackoffEnded</a>();</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  }</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="classfolly_1_1EventHandler_html_a03ecfc8fd68fa86b693c1e56148e862ca60be439c6bcefd5e64997f8f4d05a572"><div class="ttname"><a href="classfolly_1_1EventHandler.html#a03ecfc8fd68fa86b693c1e56148e862ca60be439c6bcefd5e64997f8f4d05a572">folly::EventHandler::PERSIST</a></div><div class="ttdef"><b>Definition:</b> <a href="EventHandler_8h_source.html#l00046">EventHandler.h:46</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a48bed27d36529d46d889414c9f5fe463"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">folly::AsyncServerSocket::connectionEventCallback_</a></div><div class="ttdeci">ConnectionEventCallback * connectionEventCallback_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00889">AsyncServerSocket.h:889</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8b9e7b78b31af268cdae329f88130caf"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">folly::AsyncServerSocket::callbacks_</a></div><div class="ttdeci">std::vector&lt; CallbackInfo &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00881">AsyncServerSocket.h:881</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback_html_aa79896da4a0a22d4fd357c1a5f92f7db"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#aa79896da4a0a22d4fd357c1a5f92f7db">folly::AsyncServerSocket::ConnectionEventCallback::onBackoffEnded</a></div><div class="ttdeci">virtual void onBackoffEnded() noexcept=0</div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac336ecd3a05e2f5775e7c38843f3e7fa"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">folly::AsyncServerSocket::accepting_</a></div><div class="ttdeci">bool accepting_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00872">AsyncServerSocket.h:872</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="classfolly_1_1EventHandler_html_a03ecfc8fd68fa86b693c1e56148e862ca7b6303958f6418301a09e7ee402eae8f"><div class="ttname"><a href="classfolly_1_1EventHandler.html#a03ecfc8fd68fa86b693c1e56148e862ca7b6303958f6418301a09e7ee402eae8f">folly::EventHandler::READ</a></div><div class="ttdef"><b>Definition:</b> <a href="EventHandler_8h_source.html#l00043">EventHandler.h:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0a23e193758638022c15803d87bd622b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::bind </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Bind to the specified address.</p>
<p>This must be called from the primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread.</p>
<p>Throws TTransportException on error. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00372">372</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8cpp_source.html#l00331">bindSocket()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00738">createSocket()</a>, <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="SocketAddress_8h_source.html#l00407">folly::SocketAddress::getFamily()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00312">getSocket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                                         {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>) {</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="comment">// useExistingSocket() may have been called to initialize socket_ already.</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="comment">// However, in the normal case we need to create a new socket now.</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="comment">// Don&#39;t set socket_ yet, so that socket_ will remain uninitialized if an</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">// error occurs.</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <span class="keywordtype">int</span> fd;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() == 0) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    fd = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20fa204e321d7f899f5cea9d145adc07">createSocket</a>(address.getFamily());</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() == 1) {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">if</span> (address.getFamily() != <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>[0].addressFamily_) {</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keywordflow">throw</span> std::invalid_argument(</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;          <span class="stringliteral">&quot;Attempted to bind address to socket with &quot;</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;          <span class="stringliteral">&quot;different address family&quot;</span>);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    }</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    fd = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>[0].socket_;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;Attempted to bind to multiple fds&quot;</span>);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a74ff5451c48d43dc63d02f7f8ea617c1">bindSocket</a>(fd, address, !<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.empty());</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20fa204e321d7f899f5cea9d145adc07"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20fa204e321d7f899f5cea9d145adc07">folly::AsyncServerSocket::createSocket</a></div><div class="ttdeci">int createSocket(int family)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00738">AsyncServerSocket.cpp:738</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a74ff5451c48d43dc63d02f7f8ea617c1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a74ff5451c48d43dc63d02f7f8ea617c1">folly::AsyncServerSocket::bindSocket</a></div><div class="ttdeci">void bindSocket(int fd, const SocketAddress &amp;address, bool isExistingSocket)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00331">AsyncServerSocket.cpp:331</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aecc76e34e4040c5933a58cfd44fcf739"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::bind </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; IPAddress &gt; &amp;&#160;</td>
          <td class="paramname"><em>ipAddresses</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&#160;</td>
          <td class="paramname"><em>port</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Bind to the specified port for the specified addresses.</p>
<p>This must be called from the primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread.</p>
<p>Throws TTransportException on error. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00398">398</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8cpp_source.html#l00331">bindSocket()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00738">createSocket()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>
<div class="fragment"><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                   {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="keywordflow">if</span> (ipAddresses.empty()) {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;No ip addresses were provided&quot;</span>);</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.empty()) {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">throw</span> std::invalid_argument(</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="stringliteral">&quot;Cannot call bind on a AsyncServerSocket &quot;</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="stringliteral">&quot;that already has a socket.&quot;</span>);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  }</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> IPAddress&amp; ipAddress : ipAddresses) {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    SocketAddress address(ipAddress.toFullyQualified(), port);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordtype">int</span> fd = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20fa204e321d7f899f5cea9d145adc07">createSocket</a>(address.getFamily());</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a74ff5451c48d43dc63d02f7f8ea617c1">bindSocket</a>(fd, address, <span class="keyword">false</span>);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() == 0) {</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">throw</span> std::runtime_error(</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="stringliteral">&quot;did not bind any async server socket for port and addresses&quot;</span>);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20fa204e321d7f899f5cea9d145adc07"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20fa204e321d7f899f5cea9d145adc07">folly::AsyncServerSocket::createSocket</a></div><div class="ttdeci">int createSocket(int family)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00738">AsyncServerSocket.cpp:738</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a74ff5451c48d43dc63d02f7f8ea617c1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a74ff5451c48d43dc63d02f7f8ea617c1">folly::AsyncServerSocket::bindSocket</a></div><div class="ttdeci">void bindSocket(int fd, const SocketAddress &amp;address, bool isExistingSocket)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00331">AsyncServerSocket.cpp:331</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab4e53c91e2a1e6ca74e86919c0589f6d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::bind </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&#160;</td>
          <td class="paramname"><em>port</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Bind to the specified port.</p>
<p>This must be called from the primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread.</p>
<p>Throws TTransportException on error. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00422">422</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="NetOps_8cpp_source.html#l00076">folly::netops::bind()</a>, <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00073">folly::ShutdownSocketSet::close()</a>, <a class="el" href="FileUtil_8cpp_source.html#l00056">folly::closeNoInt()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="SocketAddress_8h_source.html#l00407">folly::SocketAddress::getFamily()</a>, <a class="el" href="SocketAddress_8cpp_source.html#l00199">folly::SocketAddress::getFamilyNameFrom()</a>, <a class="el" href="SocketAddress_8cpp_source.html#l00405">folly::SocketAddress::getPort()</a>, <a class="el" href="SocketAddress_8cpp_source.html#l00186">folly::SocketAddress::getPortFrom()</a>, <a class="el" href="Portability_8h_source.html#l00367">folly::kIsWindows</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00886">noTransparentTls_</a>, <a class="el" href="StringKeyedBenchmark_8cpp_source.html#l00048">s</a>, <a class="el" href="ScopeGuard_8h_source.html#l00274">SCOPE_EXIT</a>, <a class="el" href="SocketAddress_8cpp_source.html#l00253">folly::SocketAddress::setFromLocalAddress()</a>, <a class="el" href="NetOps_8cpp_source.html#l00384">folly::netops::setsockopt()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">setupSocket()</a>, <a class="el" href="ShutdownSocketSetTest_8cpp_source.html#l00034">folly::test::shutdownSocketSet</a>, <a class="el" href="NetOps_8cpp_source.html#l00412">folly::netops::socket()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, <a class="el" href="folly_2folly_2Exception_8h_source.html#l00076">folly::throwSystemError()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00888">wShutdownSocketSet_</a>.</p>
<div class="fragment"><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                                          {</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="keyword">struct </span>addrinfo hints, *res0;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keywordtype">char</span> sport[<span class="keyword">sizeof</span>(<span class="stringliteral">&quot;65536&quot;</span>)];</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  memset(&amp;hints, 0, <span class="keyword">sizeof</span>(hints));</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  hints.ai_family = AF_UNSPEC;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  hints.ai_socktype = SOCK_STREAM;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  hints.ai_flags = AI_PASSIVE | AI_NUMERICSERV;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  snprintf(sport, <span class="keyword">sizeof</span>(sport), <span class="stringliteral">&quot;%u&quot;</span>, port);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="comment">// On Windows the value we need to pass to bind to all available</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">// addresses is an empty string. Everywhere else, it&#39;s nullptr.</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  constexpr <span class="keyword">const</span> <span class="keywordtype">char</span>* kWildcardNode = <a class="code" href="namespacefolly.html#aa4893b3f0ea61009d5f6ed6950bf8f59">kIsWindows</a> ? <span class="stringliteral">&quot;&quot;</span> : <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">if</span> (getaddrinfo(kWildcardNode, sport, &amp;hints, &amp;res0)) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">throw</span> std::invalid_argument(</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="stringliteral">&quot;Attempted to bind address to socket with &quot;</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="stringliteral">&quot;bad getaddrinfo&quot;</span>);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <a class="code" href="ScopeGuard_8h.html#a175c354c3e38222bc00ce5df5e6d431d">SCOPE_EXIT</a> {</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    freeaddrinfo(res0);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  };</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keyword">auto</span> setupAddress = [&amp;](<span class="keyword">struct </span>addrinfo* res) {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="StringKeyedBenchmark_8cpp.html#aa7f1a46e86fabf3df0ec876cd34220c2">s</a> = <a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">fsp::socket</a>(res-&gt;ai_family, res-&gt;ai_socktype, res-&gt;ai_protocol);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">// IPv6/IPv4 may not be supported by the kernel</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="keywordflow">if</span> (s &lt; 0 &amp;&amp; errno == EAFNOSUPPORT) {</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    }</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    CHECK_GE(s, 0);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac6d4face307be53e9deef54e08d294a4">setupSocket</a>(s, res-&gt;ai_family);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">closeNoInt</a>(s);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">if</span> (res-&gt;ai_family == AF_INET6) {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keywordtype">int</span> v6only = 1;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      CHECK(</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;          0 ==</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;          <a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(s, IPPROTO_IPV6, IPV6_V6ONLY, &amp;v6only, <span class="keyword">sizeof</span>(v6only)));</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    }</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="comment">// Bind to the socket</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#a169c47f12a823de180fb9e9de51e951f">fsp::bind</a>(s, res-&gt;ai_addr, socklen_t(res-&gt;ai_addrlen)) != 0) {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <a class="code" href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a>(</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;          errno,</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;          <span class="stringliteral">&quot;failed to bind to async server socket for port &quot;</span>,</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;          <a class="code" href="classfolly_1_1SocketAddress.html#a22baf12a5c6ce9fa3f7b7e30aaba2112">SocketAddress::getPortFrom</a>(res-&gt;ai_addr),</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;          <span class="stringliteral">&quot; family &quot;</span>,</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;          <a class="code" href="classfolly_1_1SocketAddress.html#af976482472ee5638cacde1cc00936a6d">SocketAddress::getFamilyNameFrom</a>(res-&gt;ai_addr, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>));</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    }</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="preprocessor">#if __linux__</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a2e9822907a7c45314894404923de357c">noTransparentTls_</a>) {</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      <span class="comment">// Ignore return value, errors are ok</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(s, SOL_SOCKET, SO_NO_TRANSPARENT_TLS, <span class="keyword">nullptr</span>, 0);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    SocketAddress address;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    address.setFromLocalAddress(s);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.emplace_back(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>, s, <span class="keyword">this</span>, address.getFamily());</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  };</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> kNumTries = 25;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> tries = 1; <span class="keyword">true</span>; tries++) {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">// Prefer AF_INET6 addresses. RFC 3484 mandates that getaddrinfo</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">// should return IPv6 first and then IPv4 addresses, but glibc&#39;s</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">// getaddrinfo(nullptr) with AI_PASSIVE returns:</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// - 0.0.0.0 (IPv4-only)</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">// - :: (IPv6+IPv4) in this order</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="comment">// See: https://sourceware.org/bugzilla/show_bug.cgi?id=9981</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">struct</span> addrinfo* res = res0; res; res = res-&gt;ai_next) {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <span class="keywordflow">if</span> (res-&gt;ai_family == AF_INET6) {</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        setupAddress(res);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    }</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">// If port == 0, then we should try to bind to the same port on ipv4 and</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">// ipv6.  So if we did bind to ipv6, figure out that port and use it.</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() == 1 &amp;&amp; port == 0) {</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      SocketAddress address;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      address.setFromLocalAddress(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.back().socket_);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      snprintf(sport, <span class="keyword">sizeof</span>(sport), <span class="stringliteral">&quot;%u&quot;</span>, address.getPort());</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      freeaddrinfo(res0);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      CHECK_EQ(0, getaddrinfo(<span class="keyword">nullptr</span>, sport, &amp;hints, &amp;res0));</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    }</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">struct</span> addrinfo* res = res0; res; res = res-&gt;ai_next) {</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">if</span> (res-&gt;ai_family != AF_INET6) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;          setupAddress(res);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::system_error&amp;) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="comment">// If we can&#39;t bind to the same port on ipv4 as ipv6 when using</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="comment">// port=0 then we will retry again before giving up after</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="comment">// kNumTries attempts.  We do this by closing the sockets that</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      <span class="comment">// were opened, then restarting from scratch.</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordflow">if</span> (port == 0 &amp;&amp; !<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.empty() &amp;&amp; tries != kNumTries) {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a>.socket_ &lt;= 0) {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;              <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">shutdownSocketSet</a> = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a620c7911f1f89369b636b633f6ed14e3">wShutdownSocketSet_</a>.lock()) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <a class="code" href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">shutdownSocketSet</a>-&gt;<a class="code" href="classfolly_1_1ShutdownSocketSet.html#a4fdbae020a649b1e3e6819dd13a1913c">close</a>(<a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a>.socket_);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;          } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">closeNoInt</a>(<a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a>.socket_);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;          }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        sockets_.clear();</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        snprintf(sport, <span class="keyword">sizeof</span>(sport), <span class="stringliteral">&quot;%u&quot;</span>, port);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        freeaddrinfo(res0);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        CHECK_EQ(0, getaddrinfo(<span class="keyword">nullptr</span>, sport, &amp;hints, &amp;res0));</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    }</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keywordflow">if</span> (sockets_.size() == 0) {</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;did not bind any async server socket for port&quot;</span>);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1netops_html_a5046254be249f288deb01103b5db274d"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">folly::netops::setsockopt</a></div><div class="ttdeci">int setsockopt(NetworkSocket s, int level, int optname, const void *optval, socklen_t optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00384">NetOps.cpp:384</a></div></div>
<div class="ttc" id="namespacefolly_html_af5b0e02d1e436376f25df5c4927ad308"><div class="ttname"><a href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a></div><div class="ttdeci">int closeNoInt(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00056">FileUtil.cpp:56</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a4fdbae020a649b1e3e6819dd13a1913c"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a4fdbae020a649b1e3e6819dd13a1913c">folly::ShutdownSocketSet::close</a></div><div class="ttdeci">int close(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8cpp_source.html#l00073">ShutdownSocketSet.cpp:73</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a2e9822907a7c45314894404923de357c"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a2e9822907a7c45314894404923de357c">folly::AsyncServerSocket::noTransparentTls_</a></div><div class="ttdeci">bool noTransparentTls_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00886">AsyncServerSocket.h:886</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="ScopeGuard_8h_html_a175c354c3e38222bc00ce5df5e6d431d"><div class="ttname"><a href="ScopeGuard_8h.html#a175c354c3e38222bc00ce5df5e6d431d">SCOPE_EXIT</a></div><div class="ttdeci">#define SCOPE_EXIT</div><div class="ttdef"><b>Definition:</b> <a href="ScopeGuard_8h_source.html#l00274">ScopeGuard.h:274</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a620c7911f1f89369b636b633f6ed14e3"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a620c7911f1f89369b636b633f6ed14e3">folly::AsyncServerSocket::wShutdownSocketSet_</a></div><div class="ttdeci">std::weak_ptr&lt; ShutdownSocketSet &gt; wShutdownSocketSet_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00888">AsyncServerSocket.h:888</a></div></div>
<div class="ttc" id="classfolly_1_1SocketAddress_html_a22baf12a5c6ce9fa3f7b7e30aaba2112"><div class="ttname"><a href="classfolly_1_1SocketAddress.html#a22baf12a5c6ce9fa3f7b7e30aaba2112">folly::SocketAddress::getPortFrom</a></div><div class="ttdeci">static int getPortFrom(const struct sockaddr *address)</div><div class="ttdef"><b>Definition:</b> <a href="SocketAddress_8cpp_source.html#l00186">SocketAddress.cpp:186</a></div></div>
<div class="ttc" id="namespacefolly_1_1test_html_afd367401765c92ca52e1f5a35623614e"><div class="ttname"><a href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">folly::test::shutdownSocketSet</a></div><div class="ttdeci">ShutdownSocketSet shutdownSocketSet</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSetTest_8cpp_source.html#l00034">ShutdownSocketSetTest.cpp:34</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a5b95b96a5a185bb8cae1a4d28e0a6249"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">folly::netops::socket</a></div><div class="ttdeci">NetworkSocket socket(int af, int type, int protocol)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00412">NetOps.cpp:412</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a169c47f12a823de180fb9e9de51e951f"><div class="ttname"><a href="namespacefolly_1_1netops.html#a169c47f12a823de180fb9e9de51e951f">folly::netops::bind</a></div><div class="ttdeci">int bind(NetworkSocket s, const sockaddr *name, socklen_t namelen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00076">NetOps.cpp:76</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="classfolly_1_1SocketAddress_html_af976482472ee5638cacde1cc00936a6d"><div class="ttname"><a href="classfolly_1_1SocketAddress.html#af976482472ee5638cacde1cc00936a6d">folly::SocketAddress::getFamilyNameFrom</a></div><div class="ttdeci">static const char * getFamilyNameFrom(const struct sockaddr *address, const char *defaultResult=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="SocketAddress_8cpp_source.html#l00199">SocketAddress.cpp:199</a></div></div>
<div class="ttc" id="StringKeyedBenchmark_8cpp_html_aa7f1a46e86fabf3df0ec876cd34220c2"><div class="ttname"><a href="StringKeyedBenchmark_8cpp.html#aa7f1a46e86fabf3df0ec876cd34220c2">s</a></div><div class="ttdeci">static set&lt; string &gt; s</div><div class="ttdef"><b>Definition:</b> <a href="StringKeyedBenchmark_8cpp_source.html#l00048">StringKeyedBenchmark.cpp:48</a></div></div>
<div class="ttc" id="namespacefolly_html_aa4893b3f0ea61009d5f6ed6950bf8f59"><div class="ttname"><a href="namespacefolly.html#aa4893b3f0ea61009d5f6ed6950bf8f59">folly::kIsWindows</a></div><div class="ttdeci">constexpr auto kIsWindows</div><div class="ttdef"><b>Definition:</b> <a href="Portability_8h_source.html#l00367">Portability.h:367</a></div></div>
<div class="ttc" id="namespacefolly_html_a59da19f447b3f5da47b9e278016758c0"><div class="ttname"><a href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a></div><div class="ttdeci">void throwSystemError(Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00076">Exception.h:76</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac6d4face307be53e9deef54e08d294a4"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac6d4face307be53e9deef54e08d294a4">folly::AsyncServerSocket::setupSocket</a></div><div class="ttdeci">void setupSocket(int fd, int family)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00782">AsyncServerSocket.cpp:782</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a74ff5451c48d43dc63d02f7f8ea617c1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::bindSocket </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> &amp;&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>isExistingSocket</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00331">331</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="NetOps_8cpp_source.html#l00076">folly::netops::bind()</a>, <a class="el" href="FileUtil_8cpp_source.html#l00056">folly::closeNoInt()</a>, <a class="el" href="SocketAddress_8cpp_source.html#l00482">folly::SocketAddress::describe()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="SocketAddress_8cpp_source.html#l00362">folly::SocketAddress::getActualSize()</a>, <a class="el" href="SocketAddress_8h_source.html#l00393">folly::SocketAddress::getAddress()</a>, <a class="el" href="SocketAddress_8h_source.html#l00407">folly::SocketAddress::getFamily()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00886">noTransparentTls_</a>, <a class="el" href="NetOps_8cpp_source.html#l00384">folly::netops::setsockopt()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, and <a class="el" href="folly_2folly_2Exception_8h_source.html#l00076">folly::throwSystemError()</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00372">bind()</a>.</p>
<div class="fragment"><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                           {</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  sockaddr_storage addrStorage;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  address.getAddress(&amp;addrStorage);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  sockaddr* saddr = <span class="keyword">reinterpret_cast&lt;</span>sockaddr*<span class="keyword">&gt;</span>(&amp;addrStorage);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#a169c47f12a823de180fb9e9de51e951f">fsp::bind</a>(fd, saddr, address.getActualSize()) != 0) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">if</span> (!isExistingSocket) {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">closeNoInt</a>(fd);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <a class="code" href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a>(</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        errno, <span class="stringliteral">&quot;failed to bind to async server socket: &quot;</span> + address.describe());</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="preprocessor">#if __linux__</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a2e9822907a7c45314894404923de357c">noTransparentTls_</a>) {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// Ignore return value, errors are ok</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(fd, SOL_SOCKET, SO_NO_TRANSPARENT_TLS, <span class="keyword">nullptr</span>, 0);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  <span class="comment">// If we just created this socket, update the EventHandler and set socket_</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">if</span> (!isExistingSocket) {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.emplace_back(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>, fd, <span class="keyword">this</span>, address.getFamily());</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  }</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1netops_html_a5046254be249f288deb01103b5db274d"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">folly::netops::setsockopt</a></div><div class="ttdeci">int setsockopt(NetworkSocket s, int level, int optname, const void *optval, socklen_t optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00384">NetOps.cpp:384</a></div></div>
<div class="ttc" id="namespacefolly_html_af5b0e02d1e436376f25df5c4927ad308"><div class="ttname"><a href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a></div><div class="ttdeci">int closeNoInt(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00056">FileUtil.cpp:56</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a2e9822907a7c45314894404923de357c"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a2e9822907a7c45314894404923de357c">folly::AsyncServerSocket::noTransparentTls_</a></div><div class="ttdeci">bool noTransparentTls_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00886">AsyncServerSocket.h:886</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a169c47f12a823de180fb9e9de51e951f"><div class="ttname"><a href="namespacefolly_1_1netops.html#a169c47f12a823de180fb9e9de51e951f">folly::netops::bind</a></div><div class="ttdeci">int bind(NetworkSocket s, const sockaddr *name, socklen_t namelen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00076">NetOps.cpp:76</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="namespacefolly_html_a59da19f447b3f5da47b9e278016758c0"><div class="ttname"><a href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a></div><div class="ttdeci">void throwSystemError(Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00076">Exception.h:76</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a20fa204e321d7f899f5cea9d145adc07"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int folly::AsyncServerSocket::createSocket </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>family</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00738">738</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="FileUtil_8cpp_source.html#l00056">folly::closeNoInt()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">setupSocket()</a>, <a class="el" href="NetOps_8cpp_source.html#l00412">folly::netops::socket()</a>, and <a class="el" href="folly_2folly_2Exception_8h_source.html#l00076">folly::throwSystemError()</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00372">bind()</a>.</p>
<div class="fragment"><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                                              {</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  <span class="keywordtype">int</span> fd = <a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">fsp::socket</a>(family, SOCK_STREAM, 0);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="keywordflow">if</span> (fd == -1) {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <a class="code" href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a>(errno, <span class="stringliteral">&quot;error creating async server socket&quot;</span>);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="keywordflow">try</span> {</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac6d4face307be53e9deef54e08d294a4">setupSocket</a>(fd, family);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  } <span class="keywordflow">catch</span> (...) {</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">closeNoInt</a>(fd);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="keywordflow">return</span> fd;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;}</div><div class="ttc" id="namespacefolly_html_af5b0e02d1e436376f25df5c4927ad308"><div class="ttname"><a href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a></div><div class="ttdeci">int closeNoInt(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00056">FileUtil.cpp:56</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a5b95b96a5a185bb8cae1a4d28e0a6249"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">folly::netops::socket</a></div><div class="ttdeci">NetworkSocket socket(int af, int type, int protocol)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00412">NetOps.cpp:412</a></div></div>
<div class="ttc" id="namespacefolly_html_a59da19f447b3f5da47b9e278016758c0"><div class="ttname"><a href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a></div><div class="ttdeci">void throwSystemError(Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00076">Exception.h:76</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac6d4face307be53e9deef54e08d294a4"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac6d4face307be53e9deef54e08d294a4">folly::AsyncServerSocket::setupSocket</a></div><div class="ttdeci">void setupSocket(int fd, int family)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00782">AsyncServerSocket.cpp:782</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a81ffdd396f2f65b8360aa6bd718714ac"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::destroy </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Destroy the socket.</p>
<p><a class="el" href="classfolly_1_1AsyncServerSocket.html#a81ffdd396f2f65b8360aa6bd718714ac">AsyncServerSocket::destroy()</a> must be called to destroy the socket. The normal destructor is private, and should not be invoked directly. This prevents callers from deleting a <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> while it is invoking a callback.</p>
<p><a class="el" href="classfolly_1_1AsyncServerSocket.html#a81ffdd396f2f65b8360aa6bd718714ac">destroy()</a> must be invoked from the socket's primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread.</p>
<p>If there are AcceptCallbacks still installed when <a class="el" href="classfolly_1_1AsyncServerSocket.html#a81ffdd396f2f65b8360aa6bd718714ac">destroy()</a> is called, acceptStopped() will be called on these callbacks to notify them that accepting has stopped. Accept callbacks being driven by other <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> threads may continue to receive new accept callbacks for a brief period of time after <a class="el" href="classfolly_1_1AsyncServerSocket.html#a81ffdd396f2f65b8360aa6bd718714ac">destroy()</a> returns. They will not receive any more callback invocations once acceptStopped() is invoked. </p>

<p>Reimplemented from <a class="el" href="classfolly_1_1DelayedDestruction.html#a6dd27b219d5af8b2a93d6c324c65e95a">folly::DelayedDestruction</a>.</p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00264">264</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="FileUtil_8cpp_source.html#l00056">folly::closeNoInt()</a>, <a class="el" href="DelayedDestruction_8h_source.html#l00051">folly::DelayedDestruction::destroy()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00871">pendingCloseSockets_</a>, <a class="el" href="StringKeyedBenchmark_8cpp_source.html#l00048">s</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">stopAccepting()</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00226">newSocket()</a>, and <a class="el" href="ServerSocketFactory_8h_source.html#l00085">wangle::AsyncServerSocketFactory::ThreadSafeDestructor::operator()()</a>.</p>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                                {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8d18fd90cd3075db3051d46d4914c666">stopAccepting</a>();</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> <a class="code" href="StringKeyedBenchmark_8cpp.html#aa7f1a46e86fabf3df0ec876cd34220c2">s</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a96ea77dfc1b55dd71460cf318e048ba2">pendingCloseSockets_</a>) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">closeNoInt</a>(<a class="code" href="StringKeyedBenchmark_8cpp.html#aa7f1a46e86fabf3df0ec876cd34220c2">s</a>);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  }</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">// Then call DelayedDestruction::destroy() to take care of</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// whether or not we need immediate or delayed destruction</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="classfolly_1_1DelayedDestruction.html#a6dd27b219d5af8b2a93d6c324c65e95a">DelayedDestruction::destroy</a>();</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div><div class="ttc" id="namespacefolly_html_af5b0e02d1e436376f25df5c4927ad308"><div class="ttname"><a href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a></div><div class="ttdeci">int closeNoInt(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00056">FileUtil.cpp:56</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8d18fd90cd3075db3051d46d4914c666"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8d18fd90cd3075db3051d46d4914c666">folly::AsyncServerSocket::stopAccepting</a></div><div class="ttdeci">int stopAccepting(int shutdownFlags=-1)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00207">AsyncServerSocket.cpp:207</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a96ea77dfc1b55dd71460cf318e048ba2"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a96ea77dfc1b55dd71460cf318e048ba2">folly::AsyncServerSocket::pendingCloseSockets_</a></div><div class="ttdeci">std::vector&lt; int &gt; pendingCloseSockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00871">AsyncServerSocket.h:871</a></div></div>
<div class="ttc" id="StringKeyedBenchmark_8cpp_html_aa7f1a46e86fabf3df0ec876cd34220c2"><div class="ttname"><a href="StringKeyedBenchmark_8cpp.html#aa7f1a46e86fabf3df0ec876cd34220c2">s</a></div><div class="ttdeci">static set&lt; string &gt; s</div><div class="ttdef"><b>Definition:</b> <a href="StringKeyedBenchmark_8cpp_source.html#l00048">StringKeyedBenchmark.cpp:48</a></div></div>
<div class="ttc" id="classfolly_1_1DelayedDestruction_html_a6dd27b219d5af8b2a93d6c324c65e95a"><div class="ttname"><a href="classfolly_1_1DelayedDestruction.html#a6dd27b219d5af8b2a93d6c324c65e95a">folly::DelayedDestruction::destroy</a></div><div class="ttdeci">virtual void destroy()</div><div class="ttdef"><b>Definition:</b> <a href="DelayedDestruction_8h_source.html#l00051">DelayedDestruction.h:51</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aca9753a1f13d6a4a23d6a2649e620a84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::detachEventBase </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Detach the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> from its primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a>.</p>
<p><a class="el" href="classfolly_1_1AsyncServerSocket.html#aca9753a1f13d6a4a23d6a2649e620a84">detachEventBase()</a> may only be called if the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> is not currently accepting connections. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00284">284</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00872">accepting_</a>, <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00226">newSocket()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00844">folly::AsyncServerSocket::ServerEventHandler::operator=()</a>.</p>
<div class="fragment"><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                        {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  assert(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a> != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  assert(!<a class="code" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a>);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a> = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.detachEventBase();</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  }</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac336ecd3a05e2f5775e7c38843f3e7fa"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">folly::AsyncServerSocket::accepting_</a></div><div class="ttdeci">bool accepting_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00872">AsyncServerSocket.h:872</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aff7521f4bf9fef35432184e55c1b3fc6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::disableTransparentTls </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Do not attempt the transparent TLS handshake </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00707">707</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00886">noTransparentTls_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00162">AsyncServerSocket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                               {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a2e9822907a7c45314894404923de357c">noTransparentTls_</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a2e9822907a7c45314894404923de357c"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a2e9822907a7c45314894404923de357c">folly::AsyncServerSocket::noTransparentTls_</a></div><div class="ttdeci">bool noTransparentTls_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00886">AsyncServerSocket.h:886</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9388286b8e865c28801ecd3d7b8df5b0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::dispatchError </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>errnoValue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l01056">1056</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html#a094d946adcbfba63d0db0fbb43723851">folly::AsyncServerSocket::AcceptCallback::acceptError()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00795">folly::AsyncServerSocket::CallbackInfo::callback</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00879">callbackIndex_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00798">folly::AsyncServerSocket::CallbackInfo::consumer</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00747">folly::AsyncServerSocket::QueueMessage::err</a>, <a class="el" href="Subprocess_8cpp_source.html#l00225">errnoValue</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00796">folly::AsyncServerSocket::CallbackInfo::eventBase</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00776">folly::AsyncServerSocket::RemoteAcceptor::getQueue()</a>, <a class="el" href="deadlock_8py_source.html#l00447">deadlock::info()</a>, <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00749">folly::AsyncServerSocket::QueueMessage::msg</a>, <a class="el" href="classfolly_1_1AsyncServerSocket.html#a255d3a1e871a51764727504f290fbc9da5c89a276ac7877e1de49cdc1b4750ce4">MSG_ERROR</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00814">nextCallback()</a>, <a class="el" href="Conv_8cpp_source.html#l00212">string</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00745">folly::AsyncServerSocket::QueueMessage::type</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00186">uint32_t</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>.</p>
<div class="fragment"><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                                                                        {</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> startingIndex = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  CallbackInfo* <a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a> = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a387db3b642ca8f005458077e30c9c9bb">nextCallback</a>();</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="comment">// Create a message to send over the notification queue</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  QueueMessage msg;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  msg.type = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a255d3a1e871a51764727504f290fbc9da5c89a276ac7877e1de49cdc1b4750ce4">MessageType::MSG_ERROR</a>;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  msg.err = <a class="code" href="Subprocess_8cpp.html#ab78a8e14b1ed8af9a3ab22879ba64873">errnoValue</a>;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  msg.msg = <a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(msgstr);</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="comment">// Short circuit if the callback is in the primary EventBase thread</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">if</span> (info-&gt;eventBase == <span class="keyword">nullptr</span> || info-&gt;eventBase == this-&gt;eventBase_) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      std::runtime_error ex(</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;          <a class="code" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a>(msgstr) + folly::to&lt;std::string&gt;(<a class="code" href="Subprocess_8cpp.html#ab78a8e14b1ed8af9a3ab22879ba64873">errnoValue</a>));</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      info-&gt;callback-&gt;acceptError(ex);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">if</span> (info-&gt;consumer-&gt;getQueue()-&gt;tryPutMessageNoThrow(<a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(msg))) {</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    }</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="comment">// Fall through and try another callback</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a> == startingIndex) {</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <span class="comment">// The notification queues for all of the callbacks were full.</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <span class="comment">// We can&#39;t really do anything at this point.</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      LOG_EVERY_N(ERROR, 100)</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;failed to dispatch accept error: all accept&quot;</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; callback queues are full: error msg:  &quot;</span> &lt;&lt; msg.msg &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;          &lt;&lt; <a class="code" href="Subprocess_8cpp.html#ab78a8e14b1ed8af9a3ab22879ba64873">errnoValue</a>;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    }</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    info = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a387db3b642ca8f005458077e30c9c9bb">nextCallback</a>();</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  }</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a255d3a1e871a51764727504f290fbc9da5c89a276ac7877e1de49cdc1b4750ce4"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a255d3a1e871a51764727504f290fbc9da5c89a276ac7877e1de49cdc1b4750ce4">folly::AsyncServerSocket::MessageType::MSG_ERROR</a></div></div>
<div class="ttc" id="namespacedeadlock_html_a6cba8e3d51735d7ac2ac91a947f4984b"><div class="ttname"><a href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">deadlock.info</a></div><div class="ttdeci">def info()</div><div class="ttdef"><b>Definition:</b> <a href="deadlock_8py_source.html#l00447">deadlock.py:447</a></div></div>
<div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a5288fb748a646e57f0e11f9af31ab16f"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">folly::AsyncServerSocket::callbackIndex_</a></div><div class="ttdeci">uint32_t callbackIndex_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00879">AsyncServerSocket.h:879</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a387db3b642ca8f005458077e30c9c9bb"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a387db3b642ca8f005458077e30c9c9bb">folly::AsyncServerSocket::nextCallback</a></div><div class="ttdeci">CallbackInfo * nextCallback()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00814">AsyncServerSocket.h:814</a></div></div>
<div class="ttc" id="Conv_8cpp_html_ae1adbce218e7a9d09164012443191d24"><div class="ttname"><a href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">string</a></div><div class="ttdeci">const char * string</div><div class="ttdef"><b>Definition:</b> <a href="Conv_8cpp_source.html#l00212">Conv.cpp:212</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="Subprocess_8cpp_html_ab78a8e14b1ed8af9a3ab22879ba64873"><div class="ttname"><a href="Subprocess_8cpp.html#ab78a8e14b1ed8af9a3ab22879ba64873">errnoValue</a></div><div class="ttdeci">int errnoValue</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00225">Subprocess.cpp:225</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a099dfb224be0986e78872b8b704f07b8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::dispatchSocket </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> &amp;&amp;&#160;</td>
          <td class="paramname"><em>address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00995">995</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00876">acceptRate_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00875">acceptRateAdjustSpeed_</a>, <a class="el" href="GlobalThreadPoolList_8cpp_source.html#l00061">addr</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00748">folly::AsyncServerSocket::QueueMessage::address</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00795">folly::AsyncServerSocket::CallbackInfo::callback</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00879">callbackIndex_</a>, <a class="el" href="FileUtil_8cpp_source.html#l00056">folly::closeNoInt()</a>, <a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html#a8fc130e1179006e400b57d8f1c9e776e">folly::AsyncServerSocket::AcceptCallback::connectionAccepted()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00889">connectionEventCallback_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00798">folly::AsyncServerSocket::CallbackInfo::consumer</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00796">folly::AsyncServerSocket::CallbackInfo::eventBase</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00746">folly::AsyncServerSocket::QueueMessage::fd</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00776">folly::AsyncServerSocket::RemoteAcceptor::getQueue()</a>, <a class="el" href="deadlock_8py_source.html#l00447">deadlock::info()</a>, <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>, <a class="el" href="classfolly_1_1AsyncServerSocket.html#a255d3a1e871a51764727504f290fbc9dabff78c1634882da30cebaf4a51c44117">MSG_NEW_CONN</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00814">nextCallback()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00878">numDroppedConnections_</a>, <a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#acdacbb56ef489f9edc584d7c8ef845d3">folly::AsyncServerSocket::ConnectionEventCallback::onConnectionDropped()</a>, <a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a64c50a4308e4d73ef9726b923c5623d7">folly::AsyncServerSocket::ConnectionEventCallback::onConnectionEnqueuedForAcceptorCallback()</a>, <a class="el" href="NetOps_8cpp_source.html#l00412">folly::netops::socket()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00745">folly::AsyncServerSocket::QueueMessage::type</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00186">uint32_t</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>.</p>
<div class="fragment"><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                                                                          {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> startingIndex = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a>;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="comment">// Short circuit if the callback is in the primary EventBase thread</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  CallbackInfo* <a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a> = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a387db3b642ca8f005458077e30c9c9bb">nextCallback</a>();</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;  <span class="keywordflow">if</span> (info-&gt;eventBase == <span class="keyword">nullptr</span> || info-&gt;eventBase == this-&gt;eventBase_) {</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    info-&gt;callback-&gt;connectionAccepted(<a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a>, address);</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keyword">const</span> SocketAddress <a class="code" href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a>(address);</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="comment">// Create a message to send over the notification queue</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  QueueMessage msg;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  msg.type = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a255d3a1e871a51764727504f290fbc9dabff78c1634882da30cebaf4a51c44117">MessageType::MSG_NEW_CONN</a>;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  msg.address = <a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(address);</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  msg.fd = <a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a>;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="comment">// Loop until we find a free queue to write to</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">if</span> (info-&gt;consumer-&gt;getQueue()-&gt;tryPutMessageNoThrow(<a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(msg))) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a64c50a4308e4d73ef9726b923c5623d7">onConnectionEnqueuedForAcceptorCallback</a>(</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            <a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a>, <a class="code" href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a>);</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      }</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <span class="comment">// Success! return.</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    }</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="comment">// We couldn&#39;t add to queue.  Fall through to below</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    ++<a class="code" href="classfolly_1_1AsyncServerSocket.html#a59dbc9923e1cbc2952d51eff8526b900">numDroppedConnections_</a>;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">acceptRateAdjustSpeed_</a> &gt; 0) {</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <span class="comment">// aggressively decrease accept rate when in trouble</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> kAcceptRateDecreaseSpeed = 0.1;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">acceptRate_</a> *= 1 - kAcceptRateDecreaseSpeed;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    }</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a> == startingIndex) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <span class="comment">// The notification queue was full</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="comment">// We can&#39;t really do anything at this point other than close the socket.</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <span class="comment">//</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      <span class="comment">// This should only happen if a user&#39;s service is behaving extremely</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <span class="comment">// badly and none of the EventBase threads are looping fast enough to</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="comment">// process the incoming connections.  If the service is overloaded, it</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="comment">// should use pauseAccepting() to temporarily back off accepting new</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="comment">// connections, before they reach the point where their threads can&#39;t</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="comment">// even accept new messages.</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      LOG_EVERY_N(ERROR, 100) &lt;&lt; <span class="stringliteral">&quot;failed to dispatch newly accepted socket:&quot;</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                              &lt;&lt; <span class="stringliteral">&quot; all accept callback queues are full&quot;</span>;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">closeNoInt</a>(<a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a>);</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#acdacbb56ef489f9edc584d7c8ef845d3">onConnectionDropped</a>(<a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a>, <a class="code" href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a>);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    }</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    info = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a387db3b642ca8f005458077e30c9c9bb">nextCallback</a>();</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  }</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;}</div><div class="ttc" id="namespacedeadlock_html_a6cba8e3d51735d7ac2ac91a947f4984b"><div class="ttname"><a href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">deadlock.info</a></div><div class="ttdeci">def info()</div><div class="ttdef"><b>Definition:</b> <a href="deadlock_8py_source.html#l00447">deadlock.py:447</a></div></div>
<div class="ttc" id="namespacefolly_html_af5b0e02d1e436376f25df5c4927ad308"><div class="ttname"><a href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a></div><div class="ttdeci">int closeNoInt(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00056">FileUtil.cpp:56</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a0fb06ffa1f0a28d1733ebb8cce5bf753"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">folly::AsyncServerSocket::acceptRate_</a></div><div class="ttdeci">double acceptRate_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00876">AsyncServerSocket.h:876</a></div></div>
<div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a5288fb748a646e57f0e11f9af31ab16f"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">folly::AsyncServerSocket::callbackIndex_</a></div><div class="ttdeci">uint32_t callbackIndex_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00879">AsyncServerSocket.h:879</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a255d3a1e871a51764727504f290fbc9dabff78c1634882da30cebaf4a51c44117"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a255d3a1e871a51764727504f290fbc9dabff78c1634882da30cebaf4a51c44117">folly::AsyncServerSocket::MessageType::MSG_NEW_CONN</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a48bed27d36529d46d889414c9f5fe463"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">folly::AsyncServerSocket::connectionEventCallback_</a></div><div class="ttdeci">ConnectionEventCallback * connectionEventCallback_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00889">AsyncServerSocket.h:889</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a387db3b642ca8f005458077e30c9c9bb"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a387db3b642ca8f005458077e30c9c9bb">folly::AsyncServerSocket::nextCallback</a></div><div class="ttdeci">CallbackInfo * nextCallback()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00814">AsyncServerSocket.h:814</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a5b95b96a5a185bb8cae1a4d28e0a6249"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">folly::netops::socket</a></div><div class="ttdeci">NetworkSocket socket(int af, int type, int protocol)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00412">NetOps.cpp:412</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a59dbc9923e1cbc2952d51eff8526b900"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a59dbc9923e1cbc2952d51eff8526b900">folly::AsyncServerSocket::numDroppedConnections_</a></div><div class="ttdeci">std::size_t numDroppedConnections_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00878">AsyncServerSocket.h:878</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback_html_a64c50a4308e4d73ef9726b923c5623d7"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a64c50a4308e4d73ef9726b923c5623d7">folly::AsyncServerSocket::ConnectionEventCallback::onConnectionEnqueuedForAcceptorCallback</a></div><div class="ttdeci">virtual void onConnectionEnqueuedForAcceptorCallback(const int socket, const SocketAddress &amp;addr) noexcept=0</div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback_html_acdacbb56ef489f9edc584d7c8ef845d3"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#acdacbb56ef489f9edc584d7c8ef845d3">folly::AsyncServerSocket::ConnectionEventCallback::onConnectionDropped</a></div><div class="ttdeci">virtual void onConnectionDropped(const int socket, const SocketAddress &amp;addr) noexcept=0</div></div>
<div class="ttc" id="GlobalThreadPoolList_8cpp_html_ab94a49ce2d97d58d5e22352a39c2345c"><div class="ttname"><a href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a></div><div class="ttdeci">ThreadPoolListHook * addr</div><div class="ttdef"><b>Definition:</b> <a href="GlobalThreadPoolList_8cpp_source.html#l00061">GlobalThreadPoolList.cpp:61</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a72a915da62e4834b5a511e85ddd825ea"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">folly::AsyncServerSocket::acceptRateAdjustSpeed_</a></div><div class="ttdeci">double acceptRateAdjustSpeed_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00875">AsyncServerSocket.h:875</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae77d15bf0bf88ef84f4114fcfaf5635e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::enterBackoff </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l01093">1093</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00880">backoffTimeout_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00889">connectionEventCallback_</a>, <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, <a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#af4a0500544e3a7bd9bf4572201c13ad4">folly::AsyncServerSocket::ConnectionEventCallback::onBackoffError()</a>, <a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a91a5c5080f28da5e71a7951b1edacf2f">folly::AsyncServerSocket::ConnectionEventCallback::onBackoffStarted()</a>, <a class="el" href="AsyncTimeout_8cpp_source.html#l00080">folly::AsyncTimeout::scheduleTimeout()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00186">uint32_t</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>.</p>
<div class="fragment"><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                                     {</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  <span class="comment">// If this is the first time we have entered the backoff state,</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  <span class="comment">// allocate backoffTimeout_.</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">backoffTimeout_</a> == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">backoffTimeout_</a> = <span class="keyword">new</span> BackoffTimeout(<span class="keyword">this</span>);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::bad_alloc&amp;) {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      <span class="comment">// Man, we couldn&#39;t even allocate the timer to re-enable accepts.</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="comment">// We must be in pretty bad shape.  Don&#39;t pause accepting for now,</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      <span class="comment">// since we won&#39;t be able to re-enable ourselves later.</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;failed to allocate AsyncServerSocket backoff&quot;</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; timer; unable to temporarly pause accepting&quot;</span>;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;        <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#af4a0500544e3a7bd9bf4572201c13ad4">onBackoffError</a>();</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      }</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    }</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  }</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  <span class="comment">// For now, we simply pause accepting for 1 second.</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  <span class="comment">// We could add some smarter backoff calculation here in the future.  (e.g.,</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="comment">// start sleeping for longer if we keep hitting the backoff frequently.)</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  <span class="comment">// Typically the user needs to figure out why the server is overloaded and</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  <span class="comment">// fix it in some other way, though.  The backoff timer is just a simple</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  <span class="comment">// mechanism to try and give the connection processing code a little bit of</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  <span class="comment">// breathing room to catch up, and to avoid just spinning and failing to</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  <span class="comment">// accept over and over again.</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  <span class="keyword">const</span> <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> timeoutMS = 1000;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">backoffTimeout_</a>-&gt;<a class="code" href="classfolly_1_1AsyncTimeout.html#acb0b7716adfa30f6b0fd5261094d2228">scheduleTimeout</a>(timeoutMS)) {</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;failed to schedule AsyncServerSocket backoff timer;&quot;</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;unable to temporarly pause accepting&quot;</span>;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#af4a0500544e3a7bd9bf4572201c13ad4">onBackoffError</a>();</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    }</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  }</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;  <span class="comment">// The backoff timer is scheduled to re-enable accepts.</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <span class="comment">// Go ahead and disable accepts for now.  We leave accepting_ set to true,</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  <span class="comment">// since that tracks the desired state requested by the user.</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.unregisterHandler();</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  }</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a91a5c5080f28da5e71a7951b1edacf2f">onBackoffStarted</a>();</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  }</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback_html_af4a0500544e3a7bd9bf4572201c13ad4"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#af4a0500544e3a7bd9bf4572201c13ad4">folly::AsyncServerSocket::ConnectionEventCallback::onBackoffError</a></div><div class="ttdeci">virtual void onBackoffError() noexcept=0</div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback_html_a91a5c5080f28da5e71a7951b1edacf2f"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a91a5c5080f28da5e71a7951b1edacf2f">folly::AsyncServerSocket::ConnectionEventCallback::onBackoffStarted</a></div><div class="ttdeci">virtual void onBackoffStarted() noexcept=0</div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a48bed27d36529d46d889414c9f5fe463"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">folly::AsyncServerSocket::connectionEventCallback_</a></div><div class="ttdeci">ConnectionEventCallback * connectionEventCallback_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00889">AsyncServerSocket.h:889</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncTimeout_html_acb0b7716adfa30f6b0fd5261094d2228"><div class="ttname"><a href="classfolly_1_1AsyncTimeout.html#acb0b7716adfa30f6b0fd5261094d2228">folly::AsyncTimeout::scheduleTimeout</a></div><div class="ttdeci">bool scheduleTimeout(uint32_t milliseconds)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncTimeout_8cpp_source.html#l00080">AsyncTimeout.cpp:80</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ab320137b9581d5dec588d30c9361063c"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">folly::AsyncServerSocket::backoffTimeout_</a></div><div class="ttdeci">BackoffTimeout * backoffTimeout_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00880">AsyncServerSocket.h:880</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5587710f4d8a8988d571a85d084d56e5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::getAccepting </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get whether or not the socket is accepting new connections </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00714">714</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00872">accepting_</a>.</p>
<div class="fragment"><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                            {</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a>;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac336ecd3a05e2f5775e7c38843f3e7fa"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">folly::AsyncServerSocket::accepting_</a></div><div class="ttdeci">bool accepting_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00872">AsyncServerSocket.h:872</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aeb21f5f89a7fea0aa2e00b1ad4f6a74e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double folly::AsyncServerSocket::getAcceptRateAdjustSpeed </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the speed of adjusting connection accept rate. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00569">569</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00875">acceptRateAdjustSpeed_</a>.</p>
<div class="fragment"><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                          {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">acceptRateAdjustSpeed_</a>;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a72a915da62e4834b5a511e85ddd825ea"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">folly::AsyncServerSocket::acceptRateAdjustSpeed_</a></div><div class="ttdeci">double acceptRateAdjustSpeed_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00875">AsyncServerSocket.h:875</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af940f12891dda51c351295fe89652102"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::getAddress </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> *&#160;</td>
          <td class="paramname"><em>addressReturn</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the local address to which the socket is bound.</p>
<p>Throws TTransportException on error. </p>

<p>Implements <a class="el" href="classfolly_1_1AsyncSocketBase.html#a1b0894a8a880faa68dcd700193a447a4">folly::AsyncSocketBase</a>.</p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00567">567</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="SocketAddress_8cpp_source.html#l00253">folly::SocketAddress::setFromLocalAddress()</a>, <a class="el" href="FizzServerCommand_8cpp_source.html#l00075">socket_</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>

<p>Referenced by <a class="el" href="AsyncSocketTest2_8cpp_source.html#l01911">serverSocketSanityTest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                                                                     {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  CHECK(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() &gt;= 1);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  VLOG_IF(2, <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() &gt; 1)</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Warning: getAddress() called and multiple addresses available (&quot;</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      &lt;&lt; <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() &lt;&lt; <span class="stringliteral">&quot;). Returning only the first one.&quot;</span>;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  addressReturn-&gt;setFromLocalAddress(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>[0].<a class="code" href="FizzServerCommand_8cpp.html#aeba765bbee6b12e47abe46bf50a99604">socket_</a>);</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="FizzServerCommand_8cpp_html_aeba765bbee6b12e47abe46bf50a99604"><div class="ttname"><a href="FizzServerCommand_8cpp.html#aeba765bbee6b12e47abe46bf50a99604">socket_</a></div><div class="ttdeci">AsyncServerSocket::UniquePtr socket_</div><div class="ttdef"><b>Definition:</b> <a href="FizzServerCommand_8cpp_source.html#l00075">FizzServerCommand.cpp:75</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af6692ebc8e9e9f6ce7f766919389636e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> folly::AsyncServerSocket::getAddress </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the local address to which the socket is bound.</p>
<p>Throws TTransportException on error. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00368">368</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8cpp_source.html#l00586">addAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00576">getAddresses()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00554">listen()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00723">pauseAccepting()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00636">removeAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00704">startAccepting()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">stopAccepting()</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00186">uint32_t</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00312">getSocket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                                   {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    SocketAddress ret;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#af6692ebc8e9e9f6ce7f766919389636e">getAddress</a>(&amp;ret);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_af6692ebc8e9e9f6ce7f766919389636e"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#af6692ebc8e9e9f6ce7f766919389636e">folly::AsyncServerSocket::getAddress</a></div><div class="ttdeci">SocketAddress getAddress() const </div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00368">AsyncServerSocket.h:368</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a12139327a3a63318fc01b10db7bba215"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="classfolly_1_1SocketAddress.html">SocketAddress</a> &gt; folly::AsyncServerSocket::getAddresses </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get all the local addresses to which the socket is bound.</p>
<p>Throws TTransportException on error. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00576">576</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="NetOps_8cpp_source.html#l00412">folly::netops::socket()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00368">getAddress()</a>.</p>
<div class="fragment"><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                                                               {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  CHECK(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() &gt;= 1);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keyword">auto</span> tsaVec = std::vector&lt;SocketAddress&gt;(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size());</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <span class="keyword">auto</span> tsaIter = tsaVec.begin();</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    (tsaIter++)-&gt;setFromLocalAddress(<a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a>.socket_);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  };</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="keywordflow">return</span> tsaVec;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a5b95b96a5a185bb8cae1a4d28e0a6249"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">folly::netops::socket</a></div><div class="ttdeci">NetworkSocket socket(int af, int type, int protocol)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00412">NetOps.cpp:412</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a591aa1b36c82bd3a478bd393052f8d0a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::getCloseOnExec </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get whether or not FD_CLOEXEC is enabled on the server socket. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00692">692</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00884">closeOnExec_</a>.</p>
<div class="fragment"><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                              {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#a12c992855f85d32186554a21700401e2">closeOnExec_</a>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a12c992855f85d32186554a21700401e2"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a12c992855f85d32186554a21700401e2">folly::AsyncServerSocket::closeOnExec_</a></div><div class="ttdeci">bool closeOnExec_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00884">AsyncServerSocket.h:884</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acac69507b65526100185bf60de99e4b4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html">ConnectionEventCallback</a>* folly::AsyncServerSocket::getConnectionEventCallback </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the <a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html">ConnectionEventCallback</a> </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00729">729</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00889">connectionEventCallback_</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00203">~AsyncServerSocket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                                                              {</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a48bed27d36529d46d889414c9f5fe463"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">folly::AsyncServerSocket::connectionEventCallback_</a></div><div class="ttdeci">ConnectionEventCallback * connectionEventCallback_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00889">AsyncServerSocket.h:889</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="addd3c7a17313e81a16a4c9e40e5f6f03"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1EventBase.html">EventBase</a>* folly::AsyncServerSocket::getEventBase </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> used by this socket. </p>

<p>Implements <a class="el" href="classfolly_1_1AsyncSocketBase.html#a9262f7d81113a56d025572bd8a081fbe">folly::AsyncSocketBase</a>.</p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00273">273</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00327">useExistingSocket()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00295">useExistingSockets()</a>.</p>

<p>Referenced by <a class="el" href="ServerSocketFactory_8h_source.html#l00085">wangle::AsyncServerSocketFactory::ThreadSafeDestructor::operator()()</a>, and <a class="el" href="AsyncSocketTest2_8cpp_source.html#l01911">serverSocketSanityTest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                           {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2a71f09e5574e04908ea3c6ea2b50ebc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::getKeepAliveEnabled </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get whether or not SO_KEEPALIVE is enabled on the server socket. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00647">647</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00882">keepAliveEnabled_</a>.</p>
<div class="fragment"><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                   {</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#a6c39ff08b287e27bb0197228fe0fe284">keepAliveEnabled_</a>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a6c39ff08b287e27bb0197228fe0fe284"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a6c39ff08b287e27bb0197228fe0fe284">folly::AsyncServerSocket::keepAliveEnabled_</a></div><div class="ttdeci">bool keepAliveEnabled_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00882">AsyncServerSocket.h:882</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaae09d03c88c6a5bd58e2f0a1df0c434"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> folly::AsyncServerSocket::getMaxAcceptAtOnce </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the maximum number of connections that will be accepted each time around the event loop. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00525">525</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00873">maxAcceptAtOnce_</a>.</p>
<div class="fragment"><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                                      {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#a1fd9bb6743ad7777813ea08b036b22d1">maxAcceptAtOnce_</a>;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a1fd9bb6743ad7777813ea08b036b22d1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a1fd9bb6743ad7777813ea08b036b22d1">folly::AsyncServerSocket::maxAcceptAtOnce_</a></div><div class="ttdeci">uint32_t maxAcceptAtOnce_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00873">AsyncServerSocket.h:873</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a11d76410a98b6de4775991b0c98a104f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> folly::AsyncServerSocket::getMaxNumMessagesInQueue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the maximum number of unprocessed messages which a <a class="el" href="classfolly_1_1NotificationQueue.html">NotificationQueue</a> can hold. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00551">551</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00874">maxNumMsgsInQueue_</a>.</p>
<div class="fragment"><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                            {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#ab95836efcfcae6931dc5b946ffba8d75">maxNumMsgsInQueue_</a>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ab95836efcfcae6931dc5b946ffba8d75"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ab95836efcfcae6931dc5b946ffba8d75">folly::AsyncServerSocket::maxNumMsgsInQueue_</a></div><div class="ttdeci">uint32_t maxNumMsgsInQueue_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00874">AsyncServerSocket.h:874</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad630c1d8fa323f46b1eff8de0a6069c2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::size_t folly::AsyncServerSocket::getNumDroppedConnections </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the number of connections dropped by the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00592">592</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00878">numDroppedConnections_</a>.</p>
<div class="fragment"><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                                             {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#a59dbc9923e1cbc2952d51eff8526b900">numDroppedConnections_</a>;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a59dbc9923e1cbc2952d51eff8526b900"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a59dbc9923e1cbc2952d51eff8526b900">folly::AsyncServerSocket::numDroppedConnections_</a></div><div class="ttdeci">std::size_t numDroppedConnections_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00878">AsyncServerSocket.h:878</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a87d316a711b026a43fe0da34bc0cd7d7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a21214d6ef664ff09b89c1fd75fe0a042">int64_t</a> folly::AsyncServerSocket::getNumPendingMessagesInQueue </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the current number of unprocessed messages in <a class="el" href="classfolly_1_1NotificationQueue.html">NotificationQueue</a>.</p>
<p>This method must be invoked from the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a>'s primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread. Use <a class="el" href="classfolly_1_1EventBase.html#a064e4b74656102dbb6b9dccc7ffeb8cf">EventBase::runInEventBaseThread()</a> to schedule the operation in the correct <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> if your code is not in the server socket's primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a>. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00604">604</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00881">callbacks_</a>, <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00188">int64_t</a>.</p>
<div class="fragment"><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                               {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>) {</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    }</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="ConstexprMathBenchmark_8cpp.html#a21214d6ef664ff09b89c1fd75fe0a042">int64_t</a> numMsgs = 0;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; callback : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>) {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="keywordflow">if</span> (callback.consumer) {</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        numMsgs += callback.consumer-&gt;getQueue()-&gt;size();</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">return</span> numMsgs;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8b9e7b78b31af268cdae329f88130caf"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">folly::AsyncServerSocket::callbacks_</a></div><div class="ttdeci">std::vector&lt; CallbackInfo &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00881">AsyncServerSocket.h:881</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a21214d6ef664ff09b89c1fd75fe0a042"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a21214d6ef664ff09b89c1fd75fe0a042">int64_t</a></div><div class="ttdeci">int64_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00188">ConstexprMathBenchmark.cpp:188</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a478cb75197260c84b9832b80152421f5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::getReusePortEnabled_ </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get whether or not SO_REUSEPORT is enabled on the server socket. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00677">677</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00883">reusePortEnabled_</a>.</p>
<div class="fragment"><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                                    {</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac73b9cedbdba1d12be40478cecd91900">reusePortEnabled_</a>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac73b9cedbdba1d12be40478cecd91900"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac73b9cedbdba1d12be40478cecd91900">folly::AsyncServerSocket::reusePortEnabled_</a></div><div class="ttdeci">bool reusePortEnabled_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00883">AsyncServerSocket.h:883</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2e2721305cbdb1df9b8146fc0e11c08b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int folly::AsyncServerSocket::getSocket </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Backwards compatible getSocket, warns if &gt; 1 socket </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00312">312</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8cpp_source.html#l00372">bind()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00368">getAddress()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00360">setZeroCopy()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00182">uint16_t</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00360">setZeroCopy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                        {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() &gt; 1) {</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      VLOG(2) &lt;&lt; <span class="stringliteral">&quot;Warning: getSocket can return multiple fds, &quot;</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;but getSockets was not called, so only returning the first&quot;</span>;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() == 0) {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>[0].socket_;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a131c614961fbc96a568475bcc82ded1f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;int&gt; folly::AsyncServerSocket::getSockets </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the underlying file descriptor </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00301">301</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>

<p>Referenced by <a class="el" href="HTTPServer_8cpp_source.html#l00224">proxygen::HTTPServer::getListenSocket()</a>, and <a class="el" href="Acceptor_8cpp_source.html#l00060">wangle::Acceptor::init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                                    {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    std::vector&lt;int&gt; sockets;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      sockets.push_back(<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">return</span> sockets;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3004a10388ca6fe093919e86089f6837"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::getTosReflect </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00585">585</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00890">tosReflect_</a>.</p>
<div class="fragment"><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                       {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#a54ca161ae97ea01ed367d19a2add5b11">tosReflect_</a>;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a54ca161ae97ea01ed367d19a2add5b11"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a54ca161ae97ea01ed367d19a2add5b11">folly::AsyncServerSocket::tosReflect_</a></div><div class="ttdeci">bool tosReflect_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00890">AsyncServerSocket.h:890</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad8bc016a87884c14e4e7855688f2d360"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::handlerReady </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&#160;</td>
          <td class="paramname"><em>events</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">sa_family_t&#160;</td>
          <td class="paramname"><em>family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span><span class="mlabel">virtual</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">855</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="NetOps_8cpp_source.html#l00071">folly::netops::accept()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00872">accepting_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00876">acceptRate_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00875">acceptRateAdjustSpeed_</a>, <a class="el" href="lang_2Bits_8h_source.html#l00259">folly::Endian::big()</a>, <a class="el" href="experimental_2test_2BitsBenchmark_8cpp.html#a25bccaee4203f6f142efc1f61e9b66c5">buffer()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00881">callbacks_</a>, <a class="el" href="FileUtil_8cpp_source.html#l00056">folly::closeNoInt()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00889">connectionEventCallback_</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l01056">dispatchError()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00995">dispatchSocket()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l01093">enterBackoff()</a>, <a class="el" href="NetOps_8cpp_source.html#l00112">folly::netops::getsockopt()</a>, <a class="el" href="Portability_8h_source.html#l00361">folly::kIsLinux</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00877">lastAccepTimestamp_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00873">maxAcceptAtOnce_</a>, <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>, <a class="el" href="TimekeeperTest_8cpp_source.html#l00031">now()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00878">numDroppedConnections_</a>, <a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a4fdf3a53d22573728246262186f6e8d2">folly::AsyncServerSocket::ConnectionEventCallback::onConnectionAccepted()</a>, <a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a06593111ce6192ee0bf4a0991c4c250b">folly::AsyncServerSocket::ConnectionEventCallback::onConnectionAcceptError()</a>, <a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#acdacbb56ef489f9edc584d7c8ef845d3">folly::AsyncServerSocket::ConnectionEventCallback::onConnectionDropped()</a>, <a class="el" href="SocketAddress_8cpp_source.html#l00261">folly::SocketAddress::setFromSockaddr()</a>, <a class="el" href="NetOps_8cpp_source.html#l00384">folly::netops::setsockopt()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00047">TCP_SAVED_SYN</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00890">tosReflect_</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00186">uint32_t</a>.</p>
<div class="fragment"><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                                        {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  assert(!<a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.empty());</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  DestructorGuard dg(<span class="keyword">this</span>);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="comment">// Only accept up to maxAcceptAtOnce_ connections at a time,</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="comment">// to avoid starving other I/O handlers using this EventBase.</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> n = 0; n &lt; <a class="code" href="classfolly_1_1AsyncServerSocket.html#a1fd9bb6743ad7777813ea08b036b22d1">maxAcceptAtOnce_</a>; ++n) {</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    SocketAddress address;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    sockaddr_storage addrStorage;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    socklen_t addrLen = <span class="keyword">sizeof</span>(addrStorage);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    sockaddr* saddr = <span class="keyword">reinterpret_cast&lt;</span>sockaddr*<span class="keyword">&gt;</span>(&amp;addrStorage);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="comment">// In some cases, accept() doesn&#39;t seem to update these correctly.</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    saddr-&gt;sa_family = addressFamily;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">if</span> (addressFamily == AF_UNIX) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      addrLen = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr_un);</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    }</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="comment">// Accept a new client socket</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="preprocessor">#ifdef SOCK_NONBLOCK</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordtype">int</span> clientSocket = accept4(fd, saddr, &amp;addrLen, SOCK_NONBLOCK);</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    <span class="keywordtype">int</span> clientSocket = <a class="code" href="namespacefolly_1_1netops.html#a1fbffaeaeb4c134076228e7e3be0c783">accept</a>(fd, saddr, &amp;addrLen);</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    address.setFromSockaddr(saddr, addrLen);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">if</span> (clientSocket &gt;= 0 &amp;&amp; <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a4fdf3a53d22573728246262186f6e8d2">onConnectionAccepted</a>(clientSocket, address);</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    }</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="comment">// Connection accepted, get the SYN packet from the client if</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="comment">// TOS reflect is enabled</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacefolly.html#a55d6472e404be36e0ec94c91656f58f4">kIsLinux</a> &amp;&amp; clientSocket &gt;= 0 &amp;&amp; <a class="code" href="classfolly_1_1AsyncServerSocket.html#a54ca161ae97ea01ed367d19a2add5b11">tosReflect_</a>) {</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      std::array&lt;uint32_t, 64&gt; <a class="code" href="experimental_2test_2BitsBenchmark_8cpp.html#a25bccaee4203f6f142efc1f61e9b66c5">buffer</a>;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      socklen_t len = <span class="keyword">sizeof</span>(<a class="code" href="experimental_2test_2BitsBenchmark_8cpp.html#a25bccaee4203f6f142efc1f61e9b66c5">buffer</a>);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="keywordtype">int</span> ret =</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          <a class="code" href="namespacefolly_1_1netops.html#aa5fcb96753f19c95a1051c3840b50331">getsockopt</a>(clientSocket, IPPROTO_TCP, <a class="code" href="AsyncServerSocket_8cpp.html#a7bf9192a7919b9c7291508ebff0cfd86">TCP_SAVED_SYN</a>, &amp;buffer, &amp;len);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keywordflow">if</span> (ret == 0) {</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> tosWord = <a class="code" href="classfolly_1_1Endian.html#a9a1402b365179ce8b3de70e71487a8a2">folly::Endian::big</a>(buffer[0]);</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <span class="keywordflow">if</span> (addressFamily == AF_INET6) {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;          tosWord = (tosWord &amp; 0x0FC00000) &gt;&gt; 20;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;          ret = <a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;              clientSocket,</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;              IPPROTO_IPV6,</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;              IPV6_TCLASS,</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;              &amp;tosWord,</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;              <span class="keyword">sizeof</span>(tosWord));</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (addressFamily == AF_INET) {</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;          tosWord = (tosWord &amp; 0x00FC0000) &gt;&gt; 16;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;          ret = <a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;              clientSocket, IPPROTO_IP, IP_TOS, &amp;tosWord, <span class="keyword">sizeof</span>(tosWord));</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        <span class="keywordflow">if</span> (ret != 0) {</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;          LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;Unable to set TOS for accepted socket &quot;</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                     &lt;&lt; clientSocket;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;Unable to get SYN packet for accepted socket &quot;</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                   &lt;&lt; clientSocket;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      }</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    }</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    std::chrono::time_point&lt;std::chrono::steady_clock&gt; nowMs =</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <a class="code" href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">std::chrono::steady_clock::now</a>();</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keyword">auto</span> timeSinceLastAccept = std::max&lt;int64_t&gt;(</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        0,</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        nowMs.time_since_epoch().count() -</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            <a class="code" href="classfolly_1_1AsyncServerSocket.html#aaa8953cadd940d0f1de1fdd64b58d202">lastAccepTimestamp_</a>.time_since_epoch().count());</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#aaa8953cadd940d0f1de1fdd64b58d202">lastAccepTimestamp_</a> = nowMs;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">acceptRate_</a> &lt; 1) {</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">acceptRate_</a> *= 1 + <a class="code" href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">acceptRateAdjustSpeed_</a> * timeSinceLastAccept;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">acceptRate_</a> &gt;= 1) {</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <a class="code" href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">acceptRate_</a> = 1;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rand() &gt; <a class="code" href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">acceptRate_</a> * RAND_MAX) {</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        ++<a class="code" href="classfolly_1_1AsyncServerSocket.html#a59dbc9923e1cbc2952d51eff8526b900">numDroppedConnections_</a>;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <span class="keywordflow">if</span> (clientSocket &gt;= 0) {</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;          <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">closeNoInt</a>(clientSocket);</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#acdacbb56ef489f9edc584d7c8ef845d3">onConnectionDropped</a>(</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                clientSocket, address);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;          }</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        }</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      }</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    }</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="keywordflow">if</span> (clientSocket &lt; 0) {</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      <span class="keywordflow">if</span> (errno == EAGAIN) {</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="comment">// No more sockets to accept right now.</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="comment">// Check for this code first, since it&#39;s the most common.</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno == EMFILE || errno == ENFILE) {</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="comment">// We&#39;re out of file descriptors.  Perhaps we&#39;re accepting connections</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="comment">// too quickly. Pause accepting briefly to back off and give the server</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="comment">// a chance to recover.</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;accept failed: out of file descriptors; entering accept &quot;</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                      <span class="stringliteral">&quot;back-off state&quot;</span>;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        <a class="code" href="classfolly_1_1AsyncServerSocket.html#ae77d15bf0bf88ef84f4114fcfaf5635e">enterBackoff</a>();</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="comment">// Dispatch the error message</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9388286b8e865c28801ecd3d7b8df5b0">dispatchError</a>(<span class="stringliteral">&quot;accept() failed&quot;</span>, errno);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9388286b8e865c28801ecd3d7b8df5b0">dispatchError</a>(<span class="stringliteral">&quot;accept() failed&quot;</span>, errno);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      }</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a06593111ce6192ee0bf4a0991c4c250b">onConnectionAcceptError</a>(errno);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      }</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    }</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="preprocessor">#ifndef SOCK_NONBLOCK</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="comment">// Explicitly set the new connection to non-blocking mode</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">if</span> (fcntl(clientSocket, F_SETFL, O_NONBLOCK) != 0) {</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">closeNoInt</a>(clientSocket);</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9388286b8e865c28801ecd3d7b8df5b0">dispatchError</a>(</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;          <span class="stringliteral">&quot;failed to set accepted socket to non-blocking mode&quot;</span>, errno);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>) {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a>-&gt;<a class="code" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#acdacbb56ef489f9edc584d7c8ef845d3">onConnectionDropped</a>(clientSocket, address);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    }</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">// Inform the callback about the new connection</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a099dfb224be0986e78872b8b704f07b8">dispatchSocket</a>(clientSocket, <a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(address));</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">// If we aren&#39;t accepting any more, break out of the loop</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a> || <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.empty()) {</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    }</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;}</div><div class="ttc" id="experimental_2test_2BitsBenchmark_8cpp_html_a25bccaee4203f6f142efc1f61e9b66c5"><div class="ttname"><a href="experimental_2test_2BitsBenchmark_8cpp.html#a25bccaee4203f6f142efc1f61e9b66c5">buffer</a></div><div class="ttdeci">std::vector&lt; uint8_t &gt; buffer(kBufferSize+16)</div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a54ca161ae97ea01ed367d19a2add5b11"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a54ca161ae97ea01ed367d19a2add5b11">folly::AsyncServerSocket::tosReflect_</a></div><div class="ttdeci">bool tosReflect_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00890">AsyncServerSocket.h:890</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a5046254be249f288deb01103b5db274d"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">folly::netops::setsockopt</a></div><div class="ttdeci">int setsockopt(NetworkSocket s, int level, int optname, const void *optval, socklen_t optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00384">NetOps.cpp:384</a></div></div>
<div class="ttc" id="namespacefolly_html_af5b0e02d1e436376f25df5c4927ad308"><div class="ttname"><a href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a></div><div class="ttdeci">int closeNoInt(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00056">FileUtil.cpp:56</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ae77d15bf0bf88ef84f4114fcfaf5635e"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ae77d15bf0bf88ef84f4114fcfaf5635e">folly::AsyncServerSocket::enterBackoff</a></div><div class="ttdeci">void enterBackoff()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l01093">AsyncServerSocket.cpp:1093</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a0fb06ffa1f0a28d1733ebb8cce5bf753"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a0fb06ffa1f0a28d1733ebb8cce5bf753">folly::AsyncServerSocket::acceptRate_</a></div><div class="ttdeci">double acceptRate_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00876">AsyncServerSocket.h:876</a></div></div>
<div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="TimekeeperTest_8cpp_html_a562b4baa36dcf267f35a4ba4e0aef329"><div class="ttname"><a href="TimekeeperTest_8cpp.html#a562b4baa36dcf267f35a4ba4e0aef329">now</a></div><div class="ttdeci">std::chrono::steady_clock::time_point now()</div><div class="ttdef"><b>Definition:</b> <a href="TimekeeperTest_8cpp_source.html#l00031">TimekeeperTest.cpp:31</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9388286b8e865c28801ecd3d7b8df5b0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9388286b8e865c28801ecd3d7b8df5b0">folly::AsyncServerSocket::dispatchError</a></div><div class="ttdeci">void dispatchError(const char *msg, int errnoValue)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l01056">AsyncServerSocket.cpp:1056</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_aaa8953cadd940d0f1de1fdd64b58d202"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#aaa8953cadd940d0f1de1fdd64b58d202">folly::AsyncServerSocket::lastAccepTimestamp_</a></div><div class="ttdeci">std::chrono::time_point&lt; std::chrono::steady_clock &gt; lastAccepTimestamp_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00877">AsyncServerSocket.h:877</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a48bed27d36529d46d889414c9f5fe463"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">folly::AsyncServerSocket::connectionEventCallback_</a></div><div class="ttdeci">ConnectionEventCallback * connectionEventCallback_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00889">AsyncServerSocket.h:889</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8b9e7b78b31af268cdae329f88130caf"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">folly::AsyncServerSocket::callbacks_</a></div><div class="ttdeci">std::vector&lt; CallbackInfo &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00881">AsyncServerSocket.h:881</a></div></div>
<div class="ttc" id="classfolly_1_1Endian_html_a9a1402b365179ce8b3de70e71487a8a2"><div class="ttname"><a href="classfolly_1_1Endian.html#a9a1402b365179ce8b3de70e71487a8a2">folly::Endian::big</a></div><div class="ttdeci">static T big(T x)</div><div class="ttdef"><b>Definition:</b> <a href="lang_2Bits_8h_source.html#l00259">Bits.h:259</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_aa5fcb96753f19c95a1051c3840b50331"><div class="ttname"><a href="namespacefolly_1_1netops.html#aa5fcb96753f19c95a1051c3840b50331">folly::netops::getsockopt</a></div><div class="ttdeci">int getsockopt(NetworkSocket s, int level, int optname, void *optval, socklen_t *optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00112">NetOps.cpp:112</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a59dbc9923e1cbc2952d51eff8526b900"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a59dbc9923e1cbc2952d51eff8526b900">folly::AsyncServerSocket::numDroppedConnections_</a></div><div class="ttdeci">std::size_t numDroppedConnections_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00878">AsyncServerSocket.h:878</a></div></div>
<div class="ttc" id="AsyncServerSocket_8cpp_html_a7bf9192a7919b9c7291508ebff0cfd86"><div class="ttname"><a href="AsyncServerSocket_8cpp.html#a7bf9192a7919b9c7291508ebff0cfd86">TCP_SAVED_SYN</a></div><div class="ttdeci">#define TCP_SAVED_SYN</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00047">AsyncServerSocket.cpp:47</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a099dfb224be0986e78872b8b704f07b8"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a099dfb224be0986e78872b8b704f07b8">folly::AsyncServerSocket::dispatchSocket</a></div><div class="ttdeci">void dispatchSocket(int socket, SocketAddress &amp;&amp;address)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00995">AsyncServerSocket.cpp:995</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac336ecd3a05e2f5775e7c38843f3e7fa"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">folly::AsyncServerSocket::accepting_</a></div><div class="ttdeci">bool accepting_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00872">AsyncServerSocket.h:872</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a1fd9bb6743ad7777813ea08b036b22d1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a1fd9bb6743ad7777813ea08b036b22d1">folly::AsyncServerSocket::maxAcceptAtOnce_</a></div><div class="ttdeci">uint32_t maxAcceptAtOnce_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00873">AsyncServerSocket.h:873</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback_html_acdacbb56ef489f9edc584d7c8ef845d3"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#acdacbb56ef489f9edc584d7c8ef845d3">folly::AsyncServerSocket::ConnectionEventCallback::onConnectionDropped</a></div><div class="ttdeci">virtual void onConnectionDropped(const int socket, const SocketAddress &amp;addr) noexcept=0</div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback_html_a4fdf3a53d22573728246262186f6e8d2"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a4fdf3a53d22573728246262186f6e8d2">folly::AsyncServerSocket::ConnectionEventCallback::onConnectionAccepted</a></div><div class="ttdeci">virtual void onConnectionAccepted(const int socket, const SocketAddress &amp;addr) noexcept=0</div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback_html_a06593111ce6192ee0bf4a0991c4c250b"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html#a06593111ce6192ee0bf4a0991c4c250b">folly::AsyncServerSocket::ConnectionEventCallback::onConnectionAcceptError</a></div><div class="ttdeci">virtual void onConnectionAcceptError(const int err) noexcept=0</div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a72a915da62e4834b5a511e85ddd825ea"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">folly::AsyncServerSocket::acceptRateAdjustSpeed_</a></div><div class="ttdeci">double acceptRateAdjustSpeed_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00875">AsyncServerSocket.h:875</a></div></div>
<div class="ttc" id="namespacefolly_html_a55d6472e404be36e0ec94c91656f58f4"><div class="ttname"><a href="namespacefolly.html#a55d6472e404be36e0ec94c91656f58f4">folly::kIsLinux</a></div><div class="ttdeci">constexpr auto kIsLinux</div><div class="ttdef"><b>Definition:</b> <a href="Portability_8h_source.html#l00361">Portability.h:361</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a1fbffaeaeb4c134076228e7e3be0c783"><div class="ttname"><a href="namespacefolly_1_1netops.html#a1fbffaeaeb4c134076228e7e3be0c783">folly::netops::accept</a></div><div class="ttdeci">NetworkSocket accept(NetworkSocket s, sockaddr *addr, socklen_t *addrlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00071">NetOps.cpp:71</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3d72081ece353ce084d066547e1b5f4b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::listen </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>backlog</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Begin listening for connections.</p>
<p>This calls <a class="el" href="namespacefolly_1_1netops.html#ace702f1a8775087ffe26719278824191">listen()</a> with the specified backlog.</p>
<p>Once <a class="el" href="classfolly_1_1AsyncServerSocket.html#a3d72081ece353ce084d066547e1b5f4b">listen()</a> is invoked the socket will actually be open so that remote clients may establish connections. (Clients that attempt to connect before <a class="el" href="classfolly_1_1AsyncServerSocket.html#a3d72081ece353ce084d066547e1b5f4b">listen()</a> is called will receive a connection refused error.)</p>
<p>At least one callback must be set and <a class="el" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting()</a> must be called to actually begin notifying the accept callbacks of newly accepted connections. The backlog parameter controls how many connections the kernel will accept and buffer internally while the accept callbacks are paused (or if accepting is enabled but the callbacks cannot keep up).</p>
<p><a class="el" href="classfolly_1_1AsyncServerSocket.html#a0a23e193758638022c15803d87bd622b">bind()</a> must be called before calling <a class="el" href="classfolly_1_1AsyncServerSocket.html#a3d72081ece353ce084d066547e1b5f4b">listen()</a>. <a class="el" href="classfolly_1_1AsyncServerSocket.html#a3d72081ece353ce084d066547e1b5f4b">listen()</a> must be called from the primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread.</p>
<p>Throws TTransportException on error. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00554">554</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, <a class="el" href="NetOps_8cpp_source.html#l00137">folly::netops::listen()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, and <a class="el" href="folly_2folly_2Exception_8h_source.html#l00076">folly::throwSystemError()</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00368">getAddress()</a>.</p>
<div class="fragment"><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                                          {</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>) {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="comment">// Start listening</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#ace702f1a8775087ffe26719278824191">fsp::listen</a>(<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_, backlog) == -1) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <a class="code" href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a>(errno, <span class="stringliteral">&quot;failed to listen on async server socket&quot;</span>);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  }</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_ace702f1a8775087ffe26719278824191"><div class="ttname"><a href="namespacefolly_1_1netops.html#ace702f1a8775087ffe26719278824191">folly::netops::listen</a></div><div class="ttdeci">int listen(NetworkSocket s, int backlog)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00137">NetOps.cpp:137</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="namespacefolly_html_a59da19f447b3f5da47b9e278016758c0"><div class="ttname"><a href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a></div><div class="ttdeci">void throwSystemError(Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00076">Exception.h:76</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a77ef98039c764a1a6e35ceb95b7fc46d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static std::shared_ptr&lt;<a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a>&gt; folly::AsyncServerSocket::newSocket </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *&#160;</td>
          <td class="paramname"><em>evb</em> = <code><a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Helper function to create a shared_ptr&lt;AsyncServerSocket&gt;.</p>
<p>This passes in the correct destructor object, since <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a>'s destructor is protected and cannot be invoked directly. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00226">226</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="classfolly_1_1AsyncServerSocket.html#ae77f32b67bc4d56d92aa7cdec7231cb1">AsyncServerSocket()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00274">attachEventBase()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00264">destroy()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00284">detachEventBase()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00179">setShutdownSocketSet()</a>.</p>

<p>Referenced by <a class="el" href="TestSSLServer_8cpp_source.html#l00060">folly::TestSSLServer::init()</a>, <a class="el" href="ScopedBoundPort_8cpp_source.html#l00025">folly::ScopedBoundPort::ScopedBoundPort()</a>, <a class="el" href="AsyncSocketTest_8cpp_source.html#l00043">folly::TEST()</a>, and <a class="el" href="AsyncSocketTest2_8cpp_source.html#l01661">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">return</span> std::shared_ptr&lt;AsyncServerSocket&gt;(</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keyword">new</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#ae77f32b67bc4d56d92aa7cdec7231cb1">AsyncServerSocket</a>(evb), Destructor());</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ae77f32b67bc4d56d92aa7cdec7231cb1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ae77f32b67bc4d56d92aa7cdec7231cb1">folly::AsyncServerSocket::AsyncServerSocket</a></div><div class="ttdeci">AsyncServerSocket(AsyncServerSocket &amp;&amp;)=delete</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a387db3b642ca8f005458077e30c9c9bb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1AsyncServerSocket_1_1CallbackInfo.html">CallbackInfo</a>* folly::AsyncServerSocket::nextCallback </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00814">814</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00879">callbackIndex_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00881">callbacks_</a>, and <a class="el" href="deadlock_8py_source.html#l00447">deadlock::info()</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l01056">dispatchError()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00995">dispatchSocket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                               {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    CallbackInfo* <a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a> = &amp;<a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>[<a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a>];</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    ++<a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a>;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a> &gt;= <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.size()) {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a> = 0;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a>;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  }</div><div class="ttc" id="namespacedeadlock_html_a6cba8e3d51735d7ac2ac91a947f4984b"><div class="ttname"><a href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">deadlock.info</a></div><div class="ttdeci">def info()</div><div class="ttdef"><b>Definition:</b> <a href="deadlock_8py_source.html#l00447">deadlock.py:447</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a5288fb748a646e57f0e11f9af31ab16f"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">folly::AsyncServerSocket::callbackIndex_</a></div><div class="ttdeci">uint32_t callbackIndex_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00879">AsyncServerSocket.h:879</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8b9e7b78b31af268cdae329f88130caf"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">folly::AsyncServerSocket::callbacks_</a></div><div class="ttdeci">std::vector&lt; CallbackInfo &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00881">AsyncServerSocket.h:881</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af18b5c583d18cb824ecb83630c7e4fa1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::pauseAccepting </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Pause accepting connections.</p>
<p><a class="el" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting()</a> may be called to resume accepting.</p>
<p>This method may only be called from the primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread. If there are AcceptCallbacks being driven by other <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> threads they may continue to receive callbacks for a short period of time after <a class="el" href="classfolly_1_1AsyncServerSocket.html#af18b5c583d18cb824ecb83630c7e4fa1">pauseAccepting()</a> returns.</p>
<p>Unlike <a class="el" href="classfolly_1_1AsyncServerSocket.html#a72c7640a46aeb62b1d4ee1368bf3edf1">removeAcceptCallback()</a> or <a class="el" href="classfolly_1_1AsyncServerSocket.html#a81ffdd396f2f65b8360aa6bd718714ac">destroy()</a>, acceptStopped() will not be called on the <a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a> objects simply due to a temporary pause. If the server socket is later destroyed while paused, acceptStopped() will be called all of the installed AcceptCallbacks. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00723">723</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00872">accepting_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00880">backoffTimeout_</a>, <a class="el" href="AsyncTimeout_8cpp_source.html#l00084">folly::AsyncTimeout::cancelTimeout()</a>, <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00368">getAddress()</a>.</p>
<div class="fragment"><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                                       {</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>) {</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  }</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.unregisterHandler();</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  }</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="comment">// If we were in the accept backoff state, disable the backoff timeout</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">backoffTimeout_</a>) {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">backoffTimeout_</a>-&gt;<a class="code" href="classfolly_1_1AsyncTimeout.html#a2080a127e6087755e7d603883bebfd55">cancelTimeout</a>();</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncTimeout_html_a2080a127e6087755e7d603883bebfd55"><div class="ttname"><a href="classfolly_1_1AsyncTimeout.html#a2080a127e6087755e7d603883bebfd55">folly::AsyncTimeout::cancelTimeout</a></div><div class="ttdeci">void cancelTimeout()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncTimeout_8cpp_source.html#l00084">AsyncTimeout.cpp:84</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac336ecd3a05e2f5775e7c38843f3e7fa"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">folly::AsyncServerSocket::accepting_</a></div><div class="ttdeci">bool accepting_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00872">AsyncServerSocket.h:872</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ab320137b9581d5dec588d30c9361063c"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">folly::AsyncServerSocket::backoffTimeout_</a></div><div class="ttdeci">BackoffTimeout * backoffTimeout_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00880">AsyncServerSocket.h:880</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a72c7640a46aeb62b1d4ee1368bf3edf1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::removeAcceptCallback </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a> *&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfolly_1_1EventBase.html">EventBase</a> *&#160;</td>
          <td class="paramname"><em>eventBase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove an <a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a>.</p>
<p>This allows a single <a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a> to be removed from the round-robin pool.</p>
<p>This method must be invoked from the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a>'s primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread. Use <a class="el" href="classfolly_1_1EventBase.html#a064e4b74656102dbb6b9dccc7ffeb8cf">EventBase::runInEventBaseThread()</a> to schedule the operation in the correct <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> if your code is not in the server socket's primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a>.</p>
<p>Given that the accept callback is being driven by a different <a class="el" href="classfolly_1_1EventBase.html">EventBase</a>, the <a class="el" href="classfolly_1_1AsyncServerSocket_1_1AcceptCallback.html">AcceptCallback</a> may continue to be invoked for a short period of time after <a class="el" href="classfolly_1_1AsyncServerSocket.html#a72c7640a46aeb62b1d4ee1368bf3edf1">removeAcceptCallback()</a> returns in this thread. Once the other <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread receives the notification to stop, it will call acceptStopped() on the callback to inform it that it is fully stopped and will not receive any new sockets.</p>
<p>If the last accept callback is removed while the socket is accepting, the socket will implicitly pause accepting. If a callback is later added, it will resume accepting immediately, without requiring <a class="el" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting()</a> to be invoked.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">callback</td><td>The callback to uninstall. </td></tr>
    <tr><td class="paramname">eventBase</td><td>The <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> associated with this callback. This must be the same <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> that was used when the callback was installed with <a class="el" href="classfolly_1_1AsyncServerSocket.html#a054f650a28760b166f109194ea15cbf1">addAcceptCallback()</a>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00636">636</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00872">accepting_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00204">folly::AsyncServerSocket::AcceptCallback::acceptStopped()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00795">folly::AsyncServerSocket::CallbackInfo::callback</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00879">callbackIndex_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00881">callbacks_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00798">folly::AsyncServerSocket::CallbackInfo::consumer</a>, <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00796">folly::AsyncServerSocket::CallbackInfo::eventBase</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, <a class="el" href="deadlock_8py_source.html#l00447">deadlock::info()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00100">folly::AsyncServerSocket::RemoteAcceptor::stop()</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00186">uint32_t</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00368">getAddress()</a>, and <a class="el" href="AsyncSocketTest2_8cpp_source.html#l01911">serverSocketSanityTest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                          {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>) {</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  }</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="comment">// Find the matching AcceptCallback.</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <span class="comment">// We just do a simple linear search; we don&#39;t expect removeAcceptCallback()</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <span class="comment">// to be called frequently, and we expect there to only be a small number of</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="comment">// callbacks anyway.</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  std::vector&lt;CallbackInfo&gt;::iterator it = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.begin();</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> n = 0;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">if</span> (it == <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.end()) {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keywordflow">throw</span> std::runtime_error(</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;          <span class="stringliteral">&quot;AsyncServerSocket::removeAcceptCallback(): &quot;</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;          <span class="stringliteral">&quot;accept callback not found&quot;</span>);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">if</span> (it-&gt;callback == callback &amp;&amp;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        (it-&gt;eventBase == eventBase || eventBase == <span class="keyword">nullptr</span>)) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    ++it;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    ++n;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  <span class="comment">// Remove this callback from callbacks_.</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <span class="comment">// Do this before invoking the acceptStopped() callback, in case</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="comment">// acceptStopped() invokes one of our methods that examines callbacks_.</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="comment">// Save a copy of the CallbackInfo first.</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  CallbackInfo <a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a>(*it);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.erase(it);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <span class="keywordflow">if</span> (n &lt; <a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a>) {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">// We removed an element before callbackIndex_.  Move callbackIndex_ back</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="comment">// one step, since things after n have been shifted back by 1.</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    --<a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a>;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="comment">// We removed something at or after callbackIndex_.</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="comment">// If we removed the last element and callbackIndex_ was pointing at it,</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">// we need to reset callbackIndex_ to 0.</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a> &gt;= <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.size()) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">callbackIndex_</a> = 0;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  }</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a>.consumer) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="comment">// consumer could be nullptr is we run callbacks in primary event</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="comment">// base</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    DCHECK(<a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a>.eventBase);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a>.consumer-&gt;stop(<a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a>.eventBase, <a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a>.callback);</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="comment">// callback invoked in the primary event base, just call directly</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    DCHECK(<a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a>.callback);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    callback-&gt;acceptStopped();</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <span class="comment">// If we are supposed to be accepting but the last accept callback</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="comment">// was removed, unregister for events until a callback is added.</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a> &amp;&amp; <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.empty()) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.unregisterHandler();</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;}</div><div class="ttc" id="namespacedeadlock_html_a6cba8e3d51735d7ac2ac91a947f4984b"><div class="ttname"><a href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">deadlock.info</a></div><div class="ttdeci">def info()</div><div class="ttdef"><b>Definition:</b> <a href="deadlock_8py_source.html#l00447">deadlock.py:447</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a5288fb748a646e57f0e11f9af31ab16f"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a5288fb748a646e57f0e11f9af31ab16f">folly::AsyncServerSocket::callbackIndex_</a></div><div class="ttdeci">uint32_t callbackIndex_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00879">AsyncServerSocket.h:879</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8b9e7b78b31af268cdae329f88130caf"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">folly::AsyncServerSocket::callbacks_</a></div><div class="ttdeci">std::vector&lt; CallbackInfo &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00881">AsyncServerSocket.h:881</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac336ecd3a05e2f5775e7c38843f3e7fa"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">folly::AsyncServerSocket::accepting_</a></div><div class="ttdeci">bool accepting_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00872">AsyncServerSocket.h:872</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a36ae305e0e4e34fed2a92650a49b8f8b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setAcceptRateAdjustSpeed </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>speed</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set the speed of adjusting connection accept rate. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00576">576</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00875">acceptRateAdjustSpeed_</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00758">setTosReflect()</a>.</p>
<div class="fragment"><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                                              {</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">acceptRateAdjustSpeed_</a> = speed;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a72a915da62e4834b5a511e85ddd825ea"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a72a915da62e4834b5a511e85ddd825ea">folly::AsyncServerSocket::acceptRateAdjustSpeed_</a></div><div class="ttdeci">double acceptRateAdjustSpeed_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00875">AsyncServerSocket.h:875</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8f886df6b9be8f0339437586784c1d33"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setCloseOnExec </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>closeOnExec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set whether or not the socket should close during exec() (FD_CLOEXEC). By default, this is enabled </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00685">685</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00884">closeOnExec_</a>.</p>
<div class="fragment"><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                                        {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a12c992855f85d32186554a21700401e2">closeOnExec_</a> = closeOnExec;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a12c992855f85d32186554a21700401e2"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a12c992855f85d32186554a21700401e2">folly::AsyncServerSocket::closeOnExec_</a></div><div class="ttdeci">bool closeOnExec_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00884">AsyncServerSocket.h:884</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4e85f6e35d3570102ed3966ca2d38c33"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setConnectionEventCallback </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html">ConnectionEventCallback</a> *const&#160;</td>
          <td class="paramname"><em>connectionEventCallback</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set the <a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html">ConnectionEventCallback</a> </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00721">721</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00889">connectionEventCallback_</a>.</p>
<div class="fragment"><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                                                              {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">connectionEventCallback_</a> = connectionEventCallback;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a48bed27d36529d46d889414c9f5fe463"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a48bed27d36529d46d889414c9f5fe463">folly::AsyncServerSocket::connectionEventCallback_</a></div><div class="ttdeci">ConnectionEventCallback * connectionEventCallback_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00889">AsyncServerSocket.h:889</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a00b0a6ed3031d48c57866ae3686f1725"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setKeepAliveEnabled </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>enabled</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set whether or not SO_KEEPALIVE should be enabled on the server socket (and thus on all subsequently-accepted connections). By default, keepalive is enabled.</p>
<p>Note that TCP keepalive usually only kicks in after the connection has been idle for several hours. Applications should almost always have their own, shorter idle timeout. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00626">626</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="String_8cpp_source.html#l00463">folly::errnoStr()</a>, <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00882">keepAliveEnabled_</a>, <a class="el" href="NetOps_8cpp_source.html#l00384">folly::netops::setsockopt()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, and <a class="el" href="String_8cpp_source.html#l00273">val</a>.</p>
<div class="fragment"><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                         {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a6c39ff08b287e27bb0197228fe0fe284">keepAliveEnabled_</a> = enabled;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_ &lt; 0) {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="String_8cpp.html#a3c8bc0bb4f045bfe78d1196cb786792c">val</a> = (enabled) ? 1 : 0;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;              <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_, SOL_SOCKET, SO_KEEPALIVE, &amp;val, <span class="keyword">sizeof</span>(val)) !=</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;          0) {</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;failed to set SO_KEEPALIVE on async server socket: %s&quot;</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                   &lt;&lt; <a class="code" href="namespacefolly.html#ad904a601e206bb84a84f7f68302ac92f">errnoStr</a>(errno);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      }</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    }</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  }</div><div class="ttc" id="namespacefolly_1_1netops_html_a5046254be249f288deb01103b5db274d"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">folly::netops::setsockopt</a></div><div class="ttdeci">int setsockopt(NetworkSocket s, int level, int optname, const void *optval, socklen_t optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00384">NetOps.cpp:384</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="String_8cpp_html_a3c8bc0bb4f045bfe78d1196cb786792c"><div class="ttname"><a href="String_8cpp.html#a3c8bc0bb4f045bfe78d1196cb786792c">val</a></div><div class="ttdeci">double val</div><div class="ttdef"><b>Definition:</b> <a href="String_8cpp_source.html#l00273">String.cpp:273</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a6c39ff08b287e27bb0197228fe0fe284"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a6c39ff08b287e27bb0197228fe0fe284">folly::AsyncServerSocket::keepAliveEnabled_</a></div><div class="ttdeci">bool keepAliveEnabled_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00882">AsyncServerSocket.h:882</a></div></div>
<div class="ttc" id="namespacefolly_html_ad904a601e206bb84a84f7f68302ac92f"><div class="ttname"><a href="namespacefolly.html#ad904a601e206bb84a84f7f68302ac92f">folly::errnoStr</a></div><div class="ttdeci">fbstring errnoStr(int err)</div><div class="ttdef"><b>Definition:</b> <a href="String_8cpp_source.html#l00463">String.cpp:463</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2297e5809bd9c6842af60ed9788907ee"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setMaxAcceptAtOnce </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>numConns</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set the maximum number of connections that will be accepted each time around the event loop.</p>
<p>This provides a very coarse-grained way of controlling how fast the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> will accept connections. If you find that when your server is overloaded <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> accepts connections more quickly than your code can process them, you can try lowering this number so that fewer connections will be accepted each event loop iteration.</p>
<p>For more explicit control over the accept rate, you can also use <a class="el" href="classfolly_1_1AsyncServerSocket.html#af18b5c583d18cb824ecb83630c7e4fa1">pauseAccepting()</a> to temporarily pause accepting when your server is overloaded, and then use <a class="el" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting()</a> later to resume accepting. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00543">543</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00873">maxAcceptAtOnce_</a>.</p>
<div class="fragment"><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                             {</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a1fd9bb6743ad7777813ea08b036b22d1">maxAcceptAtOnce_</a> = numConns;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a1fd9bb6743ad7777813ea08b036b22d1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a1fd9bb6743ad7777813ea08b036b22d1">folly::AsyncServerSocket::maxAcceptAtOnce_</a></div><div class="ttdeci">uint32_t maxAcceptAtOnce_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00873">AsyncServerSocket.h:873</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab2e166e56df26f94c9125514faa5d988"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setMaxNumMessagesInQueue </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>num</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set the maximum number of unprocessed messages in <a class="el" href="classfolly_1_1NotificationQueue.html">NotificationQueue</a>. No new message will be sent to that <a class="el" href="classfolly_1_1NotificationQueue.html">NotificationQueue</a> if there are more than such number of unprocessed messages in that queue.</p>
<p>Only works if called before addAcceptCallback. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00562">562</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00874">maxNumMsgsInQueue_</a>.</p>
<div class="fragment"><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                                              {</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#ab95836efcfcae6931dc5b946ffba8d75">maxNumMsgsInQueue_</a> = num;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ab95836efcfcae6931dc5b946ffba8d75"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ab95836efcfcae6931dc5b946ffba8d75">folly::AsyncServerSocket::maxNumMsgsInQueue_</a></div><div class="ttdeci">uint32_t maxNumMsgsInQueue_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00874">AsyncServerSocket.h:874</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af27e128da9abf295f5f1d3fab279a010"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setReusePortEnabled </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>enabled</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set whether or not SO_REUSEPORT should be enabled on the server socket, allowing multiple binds to the same port </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00655">655</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00883">reusePortEnabled_</a>, <a class="el" href="NetOps_8cpp_source.html#l00384">folly::netops::setsockopt()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00039">SO_REUSEPORT</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, <a class="el" href="folly_2folly_2Exception_8h_source.html#l00076">folly::throwSystemError()</a>, and <a class="el" href="String_8cpp_source.html#l00273">val</a>.</p>
<div class="fragment"><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                                         {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac73b9cedbdba1d12be40478cecd91900">reusePortEnabled_</a> = enabled;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_ &lt; 0) {</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="String_8cpp.html#a3c8bc0bb4f045bfe78d1196cb786792c">val</a> = (enabled) ? 1 : 0;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;              <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_, SOL_SOCKET, <a class="code" href="AsyncServerSocket_8h.html#a36151618368affd148255e77785e365e">SO_REUSEPORT</a>, &amp;val, <span class="keyword">sizeof</span>(val)) !=</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;          0) {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;failed to set SO_REUSEPORT on async server socket &quot;</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                   &lt;&lt; errno;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <a class="code" href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a>(errno, <span class="stringliteral">&quot;failed to bind to async server socket&quot;</span>);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  }</div><div class="ttc" id="namespacefolly_1_1netops_html_a5046254be249f288deb01103b5db274d"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">folly::netops::setsockopt</a></div><div class="ttdeci">int setsockopt(NetworkSocket s, int level, int optname, const void *optval, socklen_t optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00384">NetOps.cpp:384</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="String_8cpp_html_a3c8bc0bb4f045bfe78d1196cb786792c"><div class="ttname"><a href="String_8cpp.html#a3c8bc0bb4f045bfe78d1196cb786792c">val</a></div><div class="ttdeci">double val</div><div class="ttdef"><b>Definition:</b> <a href="String_8cpp_source.html#l00273">String.cpp:273</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac73b9cedbdba1d12be40478cecd91900"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac73b9cedbdba1d12be40478cecd91900">folly::AsyncServerSocket::reusePortEnabled_</a></div><div class="ttdeci">bool reusePortEnabled_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00883">AsyncServerSocket.h:883</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="AsyncServerSocket_8h_html_a36151618368affd148255e77785e365e"><div class="ttname"><a href="AsyncServerSocket_8h.html#a36151618368affd148255e77785e365e">SO_REUSEPORT</a></div><div class="ttdeci">#define SO_REUSEPORT</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00039">AsyncServerSocket.h:39</a></div></div>
<div class="ttc" id="namespacefolly_html_a59da19f447b3f5da47b9e278016758c0"><div class="ttname"><a href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a></div><div class="ttdeci">void throwSystemError(Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00076">Exception.h:76</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a13fb84e85da1aef5f59fc66fbc8ccef5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setShutdownSocketSet </td>
          <td>(</td>
          <td class="paramtype">const std::weak_ptr&lt; <a class="el" href="classfolly_1_1ShutdownSocketSet.html">ShutdownSocketSet</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>wNewSS</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00179">179</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="Hazptr_8h_source.html#l00116">h</a>, <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00049">folly::ShutdownSocketSet::remove()</a>, <a class="el" href="ShutdownSocketSetTest_8cpp_source.html#l00034">folly::test::shutdownSocketSet</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00888">wShutdownSocketSet_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00226">newSocket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                                  {</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> newSS = wNewSS.lock();</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">shutdownSocketSet</a> = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a620c7911f1f89369b636b633f6ed14e3">wShutdownSocketSet_</a>.lock();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">shutdownSocketSet</a> == newSS) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">shutdownSocketSet</a>) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="Hazptr_8h.html#ab25155a2370ac096e61dc7e39e2816df">h</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <a class="code" href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">shutdownSocketSet</a>-&gt;<a class="code" href="classfolly_1_1ShutdownSocketSet.html#a00fc0d4b70c183e3678c97a727bd7c1e">remove</a>(<a class="code" href="Hazptr_8h.html#ab25155a2370ac096e61dc7e39e2816df">h</a>.socket_);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">if</span> (newSS) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="Hazptr_8h.html#ab25155a2370ac096e61dc7e39e2816df">h</a> : sockets_) {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      newSS-&gt;add(<a class="code" href="Hazptr_8h.html#ab25155a2370ac096e61dc7e39e2816df">h</a>.socket_);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a620c7911f1f89369b636b633f6ed14e3">wShutdownSocketSet_</a> = wNewSS;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;}</div><div class="ttc" id="Hazptr_8h_html_ab25155a2370ac096e61dc7e39e2816df"><div class="ttname"><a href="Hazptr_8h.html#ab25155a2370ac096e61dc7e39e2816df">h</a></div><div class="ttdeci">*than *hazptr_holder h</div><div class="ttdef"><b>Definition:</b> <a href="Hazptr_8h_source.html#l00116">Hazptr.h:116</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a00fc0d4b70c183e3678c97a727bd7c1e"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a00fc0d4b70c183e3678c97a727bd7c1e">folly::ShutdownSocketSet::remove</a></div><div class="ttdeci">void remove(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8cpp_source.html#l00049">ShutdownSocketSet.cpp:49</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a620c7911f1f89369b636b633f6ed14e3"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a620c7911f1f89369b636b633f6ed14e3">folly::AsyncServerSocket::wShutdownSocketSet_</a></div><div class="ttdeci">std::weak_ptr&lt; ShutdownSocketSet &gt; wShutdownSocketSet_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00888">AsyncServerSocket.h:888</a></div></div>
<div class="ttc" id="namespacefolly_1_1test_html_afd367401765c92ca52e1f5a35623614e"><div class="ttname"><a href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">folly::test::shutdownSocketSet</a></div><div class="ttdeci">ShutdownSocketSet shutdownSocketSet</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSetTest_8cpp_source.html#l00034">ShutdownSocketSetTest.cpp:34</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8c80f4f8fabdab23719d41444250aef2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setTFOEnabled </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>enabled</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>maxTFOQueueSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Tries to enable TFO if the machine supports it. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00699">699</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00885">tfo_</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00887">tfoMaxQueueSize_</a>.</p>
<div class="fragment"><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                                                             {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9e718d426534e0b4f0d68c4ed45de549">tfo_</a> = enabled;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#acc9c3060d53c39c54b43f6ebe18ff7db">tfoMaxQueueSize_</a> = maxTFOQueueSize;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9e718d426534e0b4f0d68c4ed45de549"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9e718d426534e0b4f0d68c4ed45de549">folly::AsyncServerSocket::tfo_</a></div><div class="ttdeci">bool tfo_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00885">AsyncServerSocket.h:885</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_acc9c3060d53c39c54b43f6ebe18ff7db"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#acc9c3060d53c39c54b43f6ebe18ff7db">folly::AsyncServerSocket::tfoMaxQueueSize_</a></div><div class="ttdeci">uint32_t tfoMaxQueueSize_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00887">AsyncServerSocket.h:887</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad66a91b5bf3a439cef33d349809a4f18"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setTosReflect </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>enable</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enable/Disable TOS reflection for the server socket</p>
<p>Enable/Disable TOS reflection for the server socket If enabled, the 'accepted' connections will reflect the TOS derived from the client's connect request </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00758">758</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, <a class="el" href="Portability_8h_source.html#l00361">folly::kIsLinux</a>, <a class="el" href="NetOps_8cpp_source.html#l00384">folly::netops::setsockopt()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00043">TCP_SAVE_SYN</a>, <a class="el" href="folly_2folly_2Exception_8h_source.html#l00076">folly::throwSystemError()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00890">tosReflect_</a>, and <a class="el" href="String_8cpp_source.html#l00273">val</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00576">setAcceptRateAdjustSpeed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                                                 {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacefolly.html#a55d6472e404be36e0ec94c91656f58f4">kIsLinux</a> || enable == <span class="keyword">false</span>) {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a54ca161ae97ea01ed367d19a2add5b11">tosReflect_</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  }</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_ &lt; 0) {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="String_8cpp.html#a3c8bc0bb4f045bfe78d1196cb786792c">val</a> = (enable) ? 1 : 0;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="keywordtype">int</span> ret = <a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_, IPPROTO_TCP, <a class="code" href="AsyncServerSocket_8cpp.html#aa39b1cc0e3b499122992e96e7608d0ec">TCP_SAVE_SYN</a>, &amp;val, <span class="keyword">sizeof</span>(val));</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordflow">if</span> (ret == 0) {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      VLOG(10) &lt;&lt; <span class="stringliteral">&quot;Enabled SYN save for socket &quot;</span> &lt;&lt; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      <a class="code" href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a>(errno, <span class="stringliteral">&quot;failed to enable TOS reflect&quot;</span>);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    }</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  }</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a54ca161ae97ea01ed367d19a2add5b11">tosReflect_</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a54ca161ae97ea01ed367d19a2add5b11"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a54ca161ae97ea01ed367d19a2add5b11">folly::AsyncServerSocket::tosReflect_</a></div><div class="ttdeci">bool tosReflect_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00890">AsyncServerSocket.h:890</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a5046254be249f288deb01103b5db274d"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">folly::netops::setsockopt</a></div><div class="ttdeci">int setsockopt(NetworkSocket s, int level, int optname, const void *optval, socklen_t optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00384">NetOps.cpp:384</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="String_8cpp_html_a3c8bc0bb4f045bfe78d1196cb786792c"><div class="ttname"><a href="String_8cpp.html#a3c8bc0bb4f045bfe78d1196cb786792c">val</a></div><div class="ttdeci">double val</div><div class="ttdef"><b>Definition:</b> <a href="String_8cpp_source.html#l00273">String.cpp:273</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="AsyncServerSocket_8cpp_html_aa39b1cc0e3b499122992e96e7608d0ec"><div class="ttname"><a href="AsyncServerSocket_8cpp.html#aa39b1cc0e3b499122992e96e7608d0ec">TCP_SAVE_SYN</a></div><div class="ttdeci">#define TCP_SAVE_SYN</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00043">AsyncServerSocket.cpp:43</a></div></div>
<div class="ttc" id="namespacefolly_html_a59da19f447b3f5da47b9e278016758c0"><div class="ttname"><a href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a></div><div class="ttdeci">void throwSystemError(Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00076">Exception.h:76</a></div></div>
<div class="ttc" id="namespacefolly_html_a55d6472e404be36e0ec94c91656f58f4"><div class="ttname"><a href="namespacefolly.html#a55d6472e404be36e0ec94c91656f58f4">folly::kIsLinux</a></div><div class="ttdeci">constexpr auto kIsLinux</div><div class="ttdef"><b>Definition:</b> <a href="Portability_8h_source.html#l00361">Portability.h:361</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac6d4face307be53e9deef54e08d294a4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::setupSocket </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>family</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">782</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00035">folly::ShutdownSocketSet::add()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00884">closeOnExec_</a>, <a class="el" href="SocketAddress_8cpp_source.html#l00482">folly::SocketAddress::describe()</a>, <a class="el" href="String_8cpp_source.html#l00463">folly::errnoStr()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00882">keepAliveEnabled_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00883">reusePortEnabled_</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00061">folly::setCloseOnExec()</a>, <a class="el" href="SocketAddress_8cpp_source.html#l00253">folly::SocketAddress::setFromLocalAddress()</a>, <a class="el" href="NetOps_8cpp_source.html#l00384">folly::netops::setsockopt()</a>, <a class="el" href="ShutdownSocketSetTest_8cpp_source.html#l00034">folly::test::shutdownSocketSet</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00039">SO_REUSEPORT</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00885">tfo_</a>, <a class="el" href="SocketFastOpen_8cpp_source.html#l00113">folly::detail::tfo_enable()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00887">tfoMaxQueueSize_</a>, <a class="el" href="folly_2folly_2Exception_8h_source.html#l00076">folly::throwSystemError()</a>, <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa059e9861e0400dfbe05c98a841f3f96b">folly::WARNING</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00888">wShutdownSocketSet_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00422">bind()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00738">createSocket()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00295">useExistingSockets()</a>.</p>
<div class="fragment"><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                                                      {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="comment">// Put the socket in non-blocking mode</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="keywordflow">if</span> (fcntl(fd, F_SETFL, O_NONBLOCK) != 0) {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <a class="code" href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a>(errno, <span class="stringliteral">&quot;failed to put socket in non-blocking mode&quot;</span>);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  }</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="comment">// Set reuseaddr to avoid 2MSL delay on server restart</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordtype">int</span> one = 1;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(fd, SOL_SOCKET, SO_REUSEADDR, &amp;one, <span class="keyword">sizeof</span>(one)) != 0) {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="comment">// This isn&#39;t a fatal error; just log an error message and continue</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;failed to set SO_REUSEADDR on async server socket &quot;</span> &lt;&lt; errno;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="comment">// Set reuseport to support multiple accept threads</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordtype">int</span> zero = 0;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#ac73b9cedbdba1d12be40478cecd91900">reusePortEnabled_</a> &amp;&amp;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;      <a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(fd, SOL_SOCKET, <a class="code" href="AsyncServerSocket_8h.html#a36151618368affd148255e77785e365e">SO_REUSEPORT</a>, &amp;one, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)) != 0) {</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;failed to set SO_REUSEPORT on async server socket &quot;</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;               &lt;&lt; <a class="code" href="namespacefolly.html#ad904a601e206bb84a84f7f68302ac92f">errnoStr</a>(errno);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="preprocessor">#ifdef WIN32</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <a class="code" href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a>(errno, <span class="stringliteral">&quot;failed to bind to the async server socket&quot;</span>);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    SocketAddress address;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    address.setFromLocalAddress(fd);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <a class="code" href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a>(</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        errno, <span class="stringliteral">&quot;failed to bind to async server socket: &quot;</span> + address.describe());</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  }</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <span class="comment">// Set keepalive as desired</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          fd,</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          SOL_SOCKET,</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          SO_KEEPALIVE,</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;          (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a6c39ff08b287e27bb0197228fe0fe284">keepAliveEnabled_</a>) ? &amp;one : &amp;zero,</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;          <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)) != 0) {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;failed to set SO_KEEPALIVE on async server socket: &quot;</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;               &lt;&lt; <a class="code" href="namespacefolly.html#ad904a601e206bb84a84f7f68302ac92f">errnoStr</a>(errno);</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="comment">// Setup FD_CLOEXEC flag</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a12c992855f85d32186554a21700401e2">closeOnExec_</a> &amp;&amp; (-1 == <a class="code" href="namespacefolly.html#ae0c8fa8438619b3cd0314c0a92e84e75">folly::setCloseOnExec</a>(fd, <a class="code" href="classfolly_1_1AsyncServerSocket.html#a12c992855f85d32186554a21700401e2">closeOnExec_</a>))) {</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;failed to set FD_CLOEXEC on async server socket: &quot;</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;               &lt;&lt; <a class="code" href="namespacefolly.html#ad904a601e206bb84a84f7f68302ac92f">errnoStr</a>(errno);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  }</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="comment">// Set TCP nodelay if available, MAC OS X Hack</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="comment">// See http://lists.danga.com/pipermail/memcached/2005-March/001240.html</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="preprocessor">#ifndef TCP_NOPUSH</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <span class="keywordflow">if</span> (family != AF_UNIX) {</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(fd, IPPROTO_TCP, TCP_NODELAY, &amp;one, <span class="keyword">sizeof</span>(one)) != 0) {</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      <span class="comment">// This isn&#39;t a fatal error; just log an error message and continue</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;failed to set TCP_NODELAY on async server socket: &quot;</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                 &lt;&lt; <a class="code" href="namespacefolly.html#ad904a601e206bb84a84f7f68302ac92f">errnoStr</a>(errno);</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    }</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  }</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  (void)family; <span class="comment">// to avoid unused parameter warning</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="preprocessor">#if FOLLY_ALLOW_TFO</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9e718d426534e0b4f0d68c4ed45de549">tfo_</a> &amp;&amp; <a class="code" href="namespacefolly_1_1detail.html#a0b27ba6c6848828696faa4b8db7c063f">detail::tfo_enable</a>(fd, <a class="code" href="classfolly_1_1AsyncServerSocket.html#acc9c3060d53c39c54b43f6ebe18ff7db">tfoMaxQueueSize_</a>) != 0) {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="comment">// This isn&#39;t a fatal error; just log an error message and continue</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    LOG(<a class="code" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa059e9861e0400dfbe05c98a841f3f96b">WARNING</a>) &lt;&lt; <span class="stringliteral">&quot;failed to set TCP_FASTOPEN on async server socket: &quot;</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                 &lt;&lt; <a class="code" href="namespacefolly.html#ad904a601e206bb84a84f7f68302ac92f">folly::errnoStr</a>(errno);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  }</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">shutdownSocketSet</a> = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a620c7911f1f89369b636b633f6ed14e3">wShutdownSocketSet_</a>.lock()) {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <a class="code" href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">shutdownSocketSet</a>-&gt;<a class="code" href="classfolly_1_1ShutdownSocketSet.html#a415b7df74172675e9331810c91048049">add</a>(fd);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1netops_html_a5046254be249f288deb01103b5db274d"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">folly::netops::setsockopt</a></div><div class="ttdeci">int setsockopt(NetworkSocket s, int level, int optname, const void *optval, socklen_t optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00384">NetOps.cpp:384</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac73b9cedbdba1d12be40478cecd91900"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac73b9cedbdba1d12be40478cecd91900">folly::AsyncServerSocket::reusePortEnabled_</a></div><div class="ttdeci">bool reusePortEnabled_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00883">AsyncServerSocket.h:883</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a620c7911f1f89369b636b633f6ed14e3"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a620c7911f1f89369b636b633f6ed14e3">folly::AsyncServerSocket::wShutdownSocketSet_</a></div><div class="ttdeci">std::weak_ptr&lt; ShutdownSocketSet &gt; wShutdownSocketSet_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00888">AsyncServerSocket.h:888</a></div></div>
<div class="ttc" id="namespacefolly_1_1test_html_afd367401765c92ca52e1f5a35623614e"><div class="ttname"><a href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">folly::test::shutdownSocketSet</a></div><div class="ttdeci">ShutdownSocketSet shutdownSocketSet</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSetTest_8cpp_source.html#l00034">ShutdownSocketSetTest.cpp:34</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a6c39ff08b287e27bb0197228fe0fe284"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a6c39ff08b287e27bb0197228fe0fe284">folly::AsyncServerSocket::keepAliveEnabled_</a></div><div class="ttdeci">bool keepAliveEnabled_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00882">AsyncServerSocket.h:882</a></div></div>
<div class="ttc" id="namespacefolly_html_ae0c8fa8438619b3cd0314c0a92e84e75"><div class="ttname"><a href="namespacefolly.html#ae0c8fa8438619b3cd0314c0a92e84e75">folly::setCloseOnExec</a></div><div class="ttdeci">int setCloseOnExec(int fd, int value)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00061">AsyncServerSocket.cpp:61</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_a0b27ba6c6848828696faa4b8db7c063f"><div class="ttname"><a href="namespacefolly_1_1detail.html#a0b27ba6c6848828696faa4b8db7c063f">folly::detail::tfo_enable</a></div><div class="ttdeci">int tfo_enable(int, size_t)</div><div class="ttdef"><b>Definition:</b> <a href="SocketFastOpen_8cpp_source.html#l00113">SocketFastOpen.cpp:113</a></div></div>
<div class="ttc" id="namespacefolly_html_ad904a601e206bb84a84f7f68302ac92f"><div class="ttname"><a href="namespacefolly.html#ad904a601e206bb84a84f7f68302ac92f">folly::errnoStr</a></div><div class="ttdeci">fbstring errnoStr(int err)</div><div class="ttdef"><b>Definition:</b> <a href="String_8cpp_source.html#l00463">String.cpp:463</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9e718d426534e0b4f0d68c4ed45de549"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9e718d426534e0b4f0d68c4ed45de549">folly::AsyncServerSocket::tfo_</a></div><div class="ttdeci">bool tfo_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00885">AsyncServerSocket.h:885</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_acc9c3060d53c39c54b43f6ebe18ff7db"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#acc9c3060d53c39c54b43f6ebe18ff7db">folly::AsyncServerSocket::tfoMaxQueueSize_</a></div><div class="ttdeci">uint32_t tfoMaxQueueSize_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00887">AsyncServerSocket.h:887</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a12c992855f85d32186554a21700401e2"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a12c992855f85d32186554a21700401e2">folly::AsyncServerSocket::closeOnExec_</a></div><div class="ttdeci">bool closeOnExec_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00884">AsyncServerSocket.h:884</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a415b7df74172675e9331810c91048049"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a415b7df74172675e9331810c91048049">folly::ShutdownSocketSet::add</a></div><div class="ttdeci">void add(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8cpp_source.html#l00035">ShutdownSocketSet.cpp:35</a></div></div>
<div class="ttc" id="namespacefolly_html_a925db14fdb0096fe395f6acc43118f4aa059e9861e0400dfbe05c98a841f3f96b"><div class="ttname"><a href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa059e9861e0400dfbe05c98a841f3f96b">folly::LogLevel::WARNING</a></div></div>
<div class="ttc" id="AsyncServerSocket_8h_html_a36151618368affd148255e77785e365e"><div class="ttname"><a href="AsyncServerSocket_8h.html#a36151618368affd148255e77785e365e">SO_REUSEPORT</a></div><div class="ttdeci">#define SO_REUSEPORT</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00039">AsyncServerSocket.h:39</a></div></div>
<div class="ttc" id="namespacefolly_html_a59da19f447b3f5da47b9e278016758c0"><div class="ttname"><a href="namespacefolly.html#a59da19f447b3f5da47b9e278016758c0">folly::throwSystemError</a></div><div class="ttdeci">void throwSystemError(Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00076">Exception.h:76</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaafab2dc98e0cb2190ece7857d40e15b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::setZeroCopy </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>enable</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00360">360</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00312">getSocket()</a>, <a class="el" href="NetOps_8cpp_source.html#l00384">folly::netops::setsockopt()</a>, <a class="el" href="NetOps_8h_source.html#l00051">SO_ZEROCOPY</a>, and <a class="el" href="String_8cpp_source.html#l00273">val</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00312">getSocket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                               {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacefolly.html#a236df91ae3d0d023dd67c6923d3cd47b">msgErrQueueSupported</a>) {</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordtype">int</span> fd = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a2e2721305cbdb1df9b8146fc0e11c08b">getSocket</a>();</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="String_8cpp.html#a3c8bc0bb4f045bfe78d1196cb786792c">val</a> = enable ? 1 : 0;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordtype">int</span> ret = <a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(fd, SOL_SOCKET, <a class="code" href="NetOps_8h.html#ad0006a8aad54351859c8a8774eae4e32">SO_ZEROCOPY</a>, &amp;val, <span class="keyword">sizeof</span>(val));</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">return</span> (0 == ret);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div><div class="ttc" id="NetOps_8h_html_ad0006a8aad54351859c8a8774eae4e32"><div class="ttname"><a href="NetOps_8h.html#ad0006a8aad54351859c8a8774eae4e32">SO_ZEROCOPY</a></div><div class="ttdeci">#define SO_ZEROCOPY</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8h_source.html#l00051">NetOps.h:51</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a5046254be249f288deb01103b5db274d"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">folly::netops::setsockopt</a></div><div class="ttdeci">int setsockopt(NetworkSocket s, int level, int optname, const void *optval, socklen_t optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00384">NetOps.cpp:384</a></div></div>
<div class="ttc" id="String_8cpp_html_a3c8bc0bb4f045bfe78d1196cb786792c"><div class="ttname"><a href="String_8cpp.html#a3c8bc0bb4f045bfe78d1196cb786792c">val</a></div><div class="ttdeci">double val</div><div class="ttdef"><b>Definition:</b> <a href="String_8cpp_source.html#l00273">String.cpp:273</a></div></div>
<div class="ttc" id="namespacefolly_html_a236df91ae3d0d023dd67c6923d3cd47b"><div class="ttname"><a href="namespacefolly.html#a236df91ae3d0d023dd67c6923d3cd47b">folly::msgErrQueueSupported</a></div><div class="ttdeci">static constexpr bool msgErrQueueSupported</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00050">AsyncServerSocket.cpp:50</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a2e2721305cbdb1df9b8146fc0e11c08b"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a2e2721305cbdb1df9b8146fc0e11c08b">folly::AsyncServerSocket::getSocket</a></div><div class="ttdeci">int getSocket() const </div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00312">AsyncServerSocket.h:312</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a125620843204dec2bc63d3d50bad5e39"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::startAccepting </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Begin accepting connctions on this socket.</p>
<p><a class="el" href="classfolly_1_1AsyncServerSocket.html#a0a23e193758638022c15803d87bd622b">bind()</a> and <a class="el" href="classfolly_1_1AsyncServerSocket.html#a3d72081ece353ce084d066547e1b5f4b">listen()</a> must be called before calling <a class="el" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting()</a>.</p>
<p>When a <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> is initially created, it will not begin accepting connections until at least one callback has been added and <a class="el" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting()</a> has been called. <a class="el" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting()</a> can also be used to resume accepting connections after a call to <a class="el" href="classfolly_1_1AsyncServerSocket.html#af18b5c583d18cb824ecb83630c7e4fa1">pauseAccepting()</a>.</p>
<p>If <a class="el" href="classfolly_1_1AsyncServerSocket.html#a125620843204dec2bc63d3d50bad5e39">startAccepting()</a> is called when there are no accept callbacks installed, the socket will not actually begin accepting until an accept callback is added.</p>
<p>This method may only be called from the primary <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> thread. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00704">704</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00872">accepting_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00881">callbacks_</a>, <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, <a class="el" href="EventHandler_8h_source.html#l00046">folly::EventHandler::PERSIST</a>, <a class="el" href="EventHandler_8h_source.html#l00043">folly::EventHandler::READ</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00586">addAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00368">getAddress()</a>, and <a class="el" href="AsyncSocketTest2_8cpp_source.html#l01911">serverSocketSanityTest()</a>.</p>
<div class="fragment"><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                                       {</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>) {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.empty()) {</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="comment">// We can&#39;t actually begin accepting if no callbacks are defined.</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">// Wait until a callback is added to start accepting.</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  }</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.registerHandler(<a class="code" href="classfolly_1_1EventHandler.html#a03ecfc8fd68fa86b693c1e56148e862ca7b6303958f6418301a09e7ee402eae8f">EventHandler::READ</a> | <a class="code" href="classfolly_1_1EventHandler.html#a03ecfc8fd68fa86b693c1e56148e862ca60be439c6bcefd5e64997f8f4d05a572">EventHandler::PERSIST</a>)) {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;failed to register for accept events&quot;</span>);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    }</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  }</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="classfolly_1_1EventHandler_html_a03ecfc8fd68fa86b693c1e56148e862ca60be439c6bcefd5e64997f8f4d05a572"><div class="ttname"><a href="classfolly_1_1EventHandler.html#a03ecfc8fd68fa86b693c1e56148e862ca60be439c6bcefd5e64997f8f4d05a572">folly::EventHandler::PERSIST</a></div><div class="ttdef"><b>Definition:</b> <a href="EventHandler_8h_source.html#l00046">EventHandler.h:46</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8b9e7b78b31af268cdae329f88130caf"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">folly::AsyncServerSocket::callbacks_</a></div><div class="ttdeci">std::vector&lt; CallbackInfo &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00881">AsyncServerSocket.h:881</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac336ecd3a05e2f5775e7c38843f3e7fa"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">folly::AsyncServerSocket::accepting_</a></div><div class="ttdeci">bool accepting_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00872">AsyncServerSocket.h:872</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="classfolly_1_1EventHandler_html_a03ecfc8fd68fa86b693c1e56148e862ca7b6303958f6418301a09e7ee402eae8f"><div class="ttname"><a href="classfolly_1_1EventHandler.html#a03ecfc8fd68fa86b693c1e56148e862ca7b6303958f6418301a09e7ee402eae8f">folly::EventHandler::READ</a></div><div class="ttdef"><b>Definition:</b> <a href="EventHandler_8h_source.html#l00043">EventHandler.h:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8d18fd90cd3075db3051d46d4914c666"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int folly::AsyncServerSocket::stopAccepting </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>shutdownFlags</em> = <code>-1</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Shutdown the listen socket and notify all callbacks that accept has stopped, but don't close the socket. This invokes shutdown(2) with the supplied argument. Passing -1 will close the socket now. Otherwise, the close will be delayed until this object is destroyed.</p>
<p>Only use this if you have reason to pass special flags to shutdown. Otherwise just destroy the socket.</p>
<p>This method has no effect when a <a class="el" href="classfolly_1_1ShutdownSocketSet.html">ShutdownSocketSet</a> option is used.</p>
<p>Returns the result of shutdown on sockets_[n-1] </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">207</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8h_source.html#l00872">accepting_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00880">backoffTimeout_</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00881">callbacks_</a>, <a class="el" href="ShutdownSocketSet_8cpp_source.html#l00073">folly::ShutdownSocketSet::close()</a>, <a class="el" href="FileUtil_8cpp_source.html#l00056">folly::closeNoInt()</a>, <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="StackTraceTest_8cpp_source.html#l00074">handler()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00871">pendingCloseSockets_</a>, <a class="el" href="FileUtil_8cpp_source.html#l00098">folly::shutdownNoInt()</a>, <a class="el" href="ShutdownSocketSetTest_8cpp_source.html#l00034">folly::test::shutdownSocketSet</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00888">wShutdownSocketSet_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00264">destroy()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00368">getAddress()</a>.</p>
<div class="fragment"><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                                                      {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordtype">int</span> result = 0;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> : <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    VLOG(10) &lt;&lt; <span class="stringliteral">&quot;AsyncServerSocket::stopAccepting &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="comment">// When destroy is called, unregister and close the socket immediately.</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">accepting_</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="comment">// Close the sockets in reverse order as they were opened to avoid</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  <span class="comment">// the condition where another process concurrently tries to open</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="comment">// the same port, succeed to bind the first socket but fails on the</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="comment">// second because it hasn&#39;t been closed yet.</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordflow">for</span> (; !sockets_.empty(); sockets_.pop_back()) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">auto</span>&amp; <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a> = sockets_.back();</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.unregisterHandler();</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">shutdownSocketSet</a> = <a class="code" href="classfolly_1_1AsyncServerSocket.html#a620c7911f1f89369b636b633f6ed14e3">wShutdownSocketSet_</a>.lock()) {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <a class="code" href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">shutdownSocketSet</a>-&gt;<a class="code" href="classfolly_1_1ShutdownSocketSet.html#a4fdbae020a649b1e3e6819dd13a1913c">close</a>(<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shutdownFlags &gt;= 0) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      result = <a class="code" href="namespacefolly.html#aef8909ab9cc380e8e59c8328aff2df3c">shutdownNoInt</a>(<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_, shutdownFlags);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <a class="code" href="classfolly_1_1AsyncServerSocket.html#a96ea77dfc1b55dd71460cf318e048ba2">pendingCloseSockets_</a>.push_back(<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <a class="code" href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">closeNoInt</a>(<a class="code" href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a>.socket_);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    }</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="comment">// Destroy the backoff timout.  This will cancel it if it is running.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <span class="keyword">delete</span> <a class="code" href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">backoffTimeout_</a>;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">backoffTimeout_</a> = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="comment">// Close all of the callback queues to notify them that they are being</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="comment">// destroyed.  No one should access the AsyncServerSocket any more once</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="comment">// destroy() is called.  However, clear out callbacks_ before invoking the</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">// accept callbacks just in case.  This will potentially help us detect the</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">// bug if one of the callbacks calls addAcceptCallback() or</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">// removeAcceptCallback().</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  std::vector&lt;CallbackInfo&gt; callbacksCopy;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">callbacks_</a>.swap(callbacksCopy);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;CallbackInfo&gt;::iterator it = callbacksCopy.begin();</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;       it != callbacksCopy.end();</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;       ++it) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">// consumer may not be set if we are running in primary event base</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">if</span> (it-&gt;consumer) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      DCHECK(it-&gt;eventBase);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      it-&gt;consumer-&gt;stop(it-&gt;eventBase, it-&gt;callback);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      DCHECK(it-&gt;callback);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      it-&gt;callback-&gt;acceptStopped();</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordflow">return</span> result;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div><div class="ttc" id="namespacefolly_html_aef8909ab9cc380e8e59c8328aff2df3c"><div class="ttname"><a href="namespacefolly.html#aef8909ab9cc380e8e59c8328aff2df3c">folly::shutdownNoInt</a></div><div class="ttdeci">int shutdownNoInt(NetworkSocket fd, int how)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00098">FileUtil.cpp:98</a></div></div>
<div class="ttc" id="namespacefolly_html_af5b0e02d1e436376f25df5c4927ad308"><div class="ttname"><a href="namespacefolly.html#af5b0e02d1e436376f25df5c4927ad308">folly::closeNoInt</a></div><div class="ttdeci">int closeNoInt(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00056">FileUtil.cpp:56</a></div></div>
<div class="ttc" id="classfolly_1_1ShutdownSocketSet_html_a4fdbae020a649b1e3e6819dd13a1913c"><div class="ttname"><a href="classfolly_1_1ShutdownSocketSet.html#a4fdbae020a649b1e3e6819dd13a1913c">folly::ShutdownSocketSet::close</a></div><div class="ttdeci">int close(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSet_8cpp_source.html#l00073">ShutdownSocketSet.cpp:73</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="StackTraceTest_8cpp_html_afd64937145d5f5efc6c5f6b485f8e441"><div class="ttname"><a href="StackTraceTest_8cpp.html#afd64937145d5f5efc6c5f6b485f8e441">handler</a></div><div class="ttdeci">void handler(int, siginfo_t *, void *)</div><div class="ttdef"><b>Definition:</b> <a href="StackTraceTest_8cpp_source.html#l00074">StackTraceTest.cpp:74</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a620c7911f1f89369b636b633f6ed14e3"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a620c7911f1f89369b636b633f6ed14e3">folly::AsyncServerSocket::wShutdownSocketSet_</a></div><div class="ttdeci">std::weak_ptr&lt; ShutdownSocketSet &gt; wShutdownSocketSet_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00888">AsyncServerSocket.h:888</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a8b9e7b78b31af268cdae329f88130caf"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a8b9e7b78b31af268cdae329f88130caf">folly::AsyncServerSocket::callbacks_</a></div><div class="ttdeci">std::vector&lt; CallbackInfo &gt; callbacks_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00881">AsyncServerSocket.h:881</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a96ea77dfc1b55dd71460cf318e048ba2"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a96ea77dfc1b55dd71460cf318e048ba2">folly::AsyncServerSocket::pendingCloseSockets_</a></div><div class="ttdeci">std::vector&lt; int &gt; pendingCloseSockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00871">AsyncServerSocket.h:871</a></div></div>
<div class="ttc" id="namespacefolly_1_1test_html_afd367401765c92ca52e1f5a35623614e"><div class="ttname"><a href="namespacefolly_1_1test.html#afd367401765c92ca52e1f5a35623614e">folly::test::shutdownSocketSet</a></div><div class="ttdeci">ShutdownSocketSet shutdownSocketSet</div><div class="ttdef"><b>Definition:</b> <a href="ShutdownSocketSetTest_8cpp_source.html#l00034">ShutdownSocketSetTest.cpp:34</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac336ecd3a05e2f5775e7c38843f3e7fa"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac336ecd3a05e2f5775e7c38843f3e7fa">folly::AsyncServerSocket::accepting_</a></div><div class="ttdeci">bool accepting_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00872">AsyncServerSocket.h:872</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ab320137b9581d5dec588d30c9361063c"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ab320137b9581d5dec588d30c9361063c">folly::AsyncServerSocket::backoffTimeout_</a></div><div class="ttdeci">BackoffTimeout * backoffTimeout_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00880">AsyncServerSocket.h:880</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aeb79d74e35d1addb16e96194f791d6b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::useExistingSocket </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> from an existing socket file descriptor.</p>
<p><a class="el" href="classfolly_1_1AsyncServerSocket.html#aeb79d74e35d1addb16e96194f791d6b4">useExistingSocket()</a> will cause the <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> to take ownership of the specified file descriptor, and use it to listen for new connections. The <a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a> will close the file descriptor when it is destroyed.</p>
<p><a class="el" href="classfolly_1_1AsyncServerSocket.html#aeb79d74e35d1addb16e96194f791d6b4">useExistingSocket()</a> must be called before <a class="el" href="classfolly_1_1AsyncServerSocket.html#a0a23e193758638022c15803d87bd622b">bind()</a> or <a class="el" href="classfolly_1_1AsyncServerSocket.html#a3d72081ece353ce084d066547e1b5f4b">listen()</a>.</p>
<p>The supplied file descriptor will automatically be put into non-blocking mode. The caller may have already directly called <a class="el" href="classfolly_1_1AsyncServerSocket.html#a0a23e193758638022c15803d87bd622b">bind()</a> and possibly listen on the file descriptor. If so the caller should skip calling the corresponding <a class="el" href="classfolly_1_1AsyncServerSocket.html#a0a23e193758638022c15803d87bd622b">AsyncServerSocket::bind()</a> and <a class="el" href="classfolly_1_1AsyncServerSocket.html#a3d72081ece353ce084d066547e1b5f4b">listen()</a> methods.</p>
<p>On error a TTransportException will be thrown and the caller will retain ownership of the file descriptor. </p>

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00327">327</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="AsyncServerSocket_8cpp_source.html#l00295">useExistingSockets()</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00273">getEventBase()</a>.</p>
<div class="fragment"><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                                {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <a class="code" href="classfolly_1_1AsyncServerSocket.html#ab84474eb8bc3f03e98927e06feb7e55a">useExistingSockets</a>({fd});</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ab84474eb8bc3f03e98927e06feb7e55a"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ab84474eb8bc3f03e98927e06feb7e55a">folly::AsyncServerSocket::useExistingSockets</a></div><div class="ttdeci">void useExistingSockets(const std::vector&lt; int &gt; &amp;fds)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00295">AsyncServerSocket.cpp:295</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab84474eb8bc3f03e98927e06feb7e55a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncServerSocket::useExistingSockets </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; int &gt; &amp;&#160;</td>
          <td class="paramname"><em>fds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8cpp_source.html#l00295">295</a> of file <a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a>.</p>

<p>References <a class="el" href="EventBase_8h_source.html#l00520">folly::EventBase::dcheckIsInEventBaseThread()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00869">eventBase_</a>, <a class="el" href="SocketAddress_8h_source.html#l00407">folly::SocketAddress::getFamily()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00886">noTransparentTls_</a>, <a class="el" href="SocketAddress_8cpp_source.html#l00253">folly::SocketAddress::setFromLocalAddress()</a>, <a class="el" href="NetOps_8cpp_source.html#l00384">folly::netops::setsockopt()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">setupSocket()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00870">sockets_</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00273">getEventBase()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00327">useExistingSocket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                                                    {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">dcheckIsInEventBaseThread</a>();</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.size() &gt; 0) {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordflow">throw</span> std::invalid_argument(</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="stringliteral">&quot;cannot call useExistingSocket() on a &quot;</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="stringliteral">&quot;AsyncServerSocket that already has a socket&quot;</span>);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> fd : fds) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">// Set addressFamily_ from this socket.</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="comment">// Note that the socket may not have been bound yet, but</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="comment">// setFromLocalAddress() will still work and get the correct address family.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">// We will update addressFamily_ again anyway if bind() is called later.</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    SocketAddress address;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    address.setFromLocalAddress(fd);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">#if __linux__</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncServerSocket.html#a2e9822907a7c45314894404923de357c">noTransparentTls_</a>) {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="comment">// Ignore return value, errors are ok</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <a class="code" href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">setsockopt</a>(fd, SOL_SOCKET, SO_NO_TRANSPARENT_TLS, <span class="keyword">nullptr</span>, 0);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#ac6d4face307be53e9deef54e08d294a4">setupSocket</a>(fd, address.getFamily());</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.emplace_back(<a class="code" href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">eventBase_</a>, fd, <span class="keyword">this</span>, address.getFamily());</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">sockets_</a>.back().changeHandlerFD(fd);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1netops_html_a5046254be249f288deb01103b5db274d"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5046254be249f288deb01103b5db274d">folly::netops::setsockopt</a></div><div class="ttdeci">int setsockopt(NetworkSocket s, int level, int optname, const void *optval, socklen_t optlen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00384">NetOps.cpp:384</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a2e9822907a7c45314894404923de357c"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a2e9822907a7c45314894404923de357c">folly::AsyncServerSocket::noTransparentTls_</a></div><div class="ttdeci">bool noTransparentTls_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00886">AsyncServerSocket.h:886</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a20f34533f96bf8a250e29d6bcc0f38e1"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a20f34533f96bf8a250e29d6bcc0f38e1">folly::AsyncServerSocket::sockets_</a></div><div class="ttdeci">std::vector&lt; ServerEventHandler &gt; sockets_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00870">AsyncServerSocket.h:870</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a42a80d7c0f6207dcaef1d84b7584d67d"><div class="ttname"><a href="classfolly_1_1EventBase.html#a42a80d7c0f6207dcaef1d84b7584d67d">folly::EventBase::dcheckIsInEventBaseThread</a></div><div class="ttdeci">void dcheckIsInEventBaseThread() const </div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00520">EventBase.h:520</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_a9c785d226c23e0664137bae64b03eac0"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#a9c785d226c23e0664137bae64b03eac0">folly::AsyncServerSocket::eventBase_</a></div><div class="ttdeci">EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8h_source.html#l00869">AsyncServerSocket.h:869</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncServerSocket_html_ac6d4face307be53e9deef54e08d294a4"><div class="ttname"><a href="classfolly_1_1AsyncServerSocket.html#ac6d4face307be53e9deef54e08d294a4">folly::AsyncServerSocket::setupSocket</a></div><div class="ttdeci">void setupSocket(int fd, int family)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncServerSocket_8cpp_source.html#l00782">AsyncServerSocket.cpp:782</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="ac336ecd3a05e2f5775e7c38843f3e7fa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::accepting_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00872">872</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00586">addAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l01142">backoffTimeoutExpired()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00284">detachEventBase()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00714">getAccepting()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00723">pauseAccepting()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00636">removeAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00704">startAccepting()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">stopAccepting()</a>.</p>

</div>
</div>
<a class="anchor" id="a0fb06ffa1f0a28d1733ebb8cce5bf753"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double folly::AsyncServerSocket::acceptRate_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00876">876</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00995">dispatchSocket()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>.</p>

</div>
</div>
<a class="anchor" id="a72a915da62e4834b5a511e85ddd825ea"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double folly::AsyncServerSocket::acceptRateAdjustSpeed_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00875">875</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00995">dispatchSocket()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00569">getAcceptRateAdjustSpeed()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00576">setAcceptRateAdjustSpeed()</a>.</p>

</div>
</div>
<a class="anchor" id="ab320137b9581d5dec588d30c9361063c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1BackoffTimeout.html">BackoffTimeout</a>* folly::AsyncServerSocket::backoffTimeout_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00880">880</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l01093">enterBackoff()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00723">pauseAccepting()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">stopAccepting()</a>.</p>

</div>
</div>
<a class="anchor" id="a5288fb748a646e57f0e11f9af31ab16f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> folly::AsyncServerSocket::callbackIndex_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00879">879</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l01056">dispatchError()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00995">dispatchSocket()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00814">nextCallback()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00636">removeAcceptCallback()</a>.</p>

</div>
</div>
<a class="anchor" id="a8b9e7b78b31af268cdae329f88130caf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structfolly_1_1AsyncServerSocket_1_1CallbackInfo.html">CallbackInfo</a>&gt; folly::AsyncServerSocket::callbacks_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00881">881</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00586">addAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l01142">backoffTimeoutExpired()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00604">getNumPendingMessagesInQueue()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00814">nextCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00636">removeAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00704">startAccepting()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">stopAccepting()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00203">~AsyncServerSocket()</a>.</p>

</div>
</div>
<a class="anchor" id="a12c992855f85d32186554a21700401e2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::closeOnExec_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00884">884</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00692">getCloseOnExec()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00685">setCloseOnExec()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">setupSocket()</a>.</p>

</div>
</div>
<a class="anchor" id="a48bed27d36529d46d889414c9f5fe463"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1AsyncServerSocket_1_1ConnectionEventCallback.html">ConnectionEventCallback</a>* folly::AsyncServerSocket::connectionEventCallback_ {<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00889">889</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00586">addAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l01142">backoffTimeoutExpired()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00995">dispatchSocket()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l01093">enterBackoff()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00729">getConnectionEventCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00721">setConnectionEventCallback()</a>.</p>

</div>
</div>
<a class="anchor" id="a9c785d226c23e0664137bae64b03eac0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1EventBase.html">EventBase</a>* folly::AsyncServerSocket::eventBase_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00869">869</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00586">addAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00274">attachEventBase()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l01142">backoffTimeoutExpired()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00372">bind()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00331">bindSocket()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00284">detachEventBase()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00273">getEventBase()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00604">getNumPendingMessagesInQueue()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00554">listen()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00844">folly::AsyncServerSocket::ServerEventHandler::operator=()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00723">pauseAccepting()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00636">removeAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00704">startAccepting()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">stopAccepting()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00295">useExistingSockets()</a>.</p>

</div>
</div>
<a class="anchor" id="a0d25a4169140ac6b397c8a9d66895f9c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> folly::AsyncServerSocket::kDefaultCallbackAcceptAtOnce = 5</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00208">208</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

</div>
</div>
<a class="anchor" id="afbd22010be704480c2396c6e19aca023"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> folly::AsyncServerSocket::kDefaultMaxAcceptAtOnce = 30</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00207">207</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6f47b5b536258612b3aba4403055a4d6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> folly::AsyncServerSocket::kDefaultMaxMessagesInQueue = 1024</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00209">209</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6c39ff08b287e27bb0197228fe0fe284"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::keepAliveEnabled_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00882">882</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00647">getKeepAliveEnabled()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00626">setKeepAliveEnabled()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">setupSocket()</a>.</p>

</div>
</div>
<a class="anchor" id="aaa8953cadd940d0f1de1fdd64b58d202"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::time_point&lt;std::chrono::steady_clock&gt; folly::AsyncServerSocket::lastAccepTimestamp_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00877">877</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>.</p>

</div>
</div>
<a class="anchor" id="a1fd9bb6743ad7777813ea08b036b22d1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> folly::AsyncServerSocket::maxAcceptAtOnce_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00873">873</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00525">getMaxAcceptAtOnce()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00543">setMaxAcceptAtOnce()</a>.</p>

</div>
</div>
<a class="anchor" id="ab95836efcfcae6931dc5b946ffba8d75"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> folly::AsyncServerSocket::maxNumMsgsInQueue_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00874">874</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00586">addAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00551">getMaxNumMessagesInQueue()</a>, and <a class="el" href="AsyncServerSocket_8h_source.html#l00562">setMaxNumMessagesInQueue()</a>.</p>

</div>
</div>
<a class="anchor" id="a2e9822907a7c45314894404923de357c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::noTransparentTls_ {false}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00886">886</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00422">bind()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00331">bindSocket()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00707">disableTransparentTls()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00295">useExistingSockets()</a>.</p>

</div>
</div>
<a class="anchor" id="a59dbc9923e1cbc2952d51eff8526b900"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::size_t folly::AsyncServerSocket::numDroppedConnections_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00878">878</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00995">dispatchSocket()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00592">getNumDroppedConnections()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>.</p>

</div>
</div>
<a class="anchor" id="a96ea77dfc1b55dd71460cf318e048ba2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;int&gt; folly::AsyncServerSocket::pendingCloseSockets_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00871">871</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00264">destroy()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">stopAccepting()</a>.</p>

</div>
</div>
<a class="anchor" id="ac73b9cedbdba1d12be40478cecd91900"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::reusePortEnabled_ {false}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00883">883</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00677">getReusePortEnabled_()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00655">setReusePortEnabled()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">setupSocket()</a>.</p>

</div>
</div>
<a class="anchor" id="a20f34533f96bf8a250e29d6bcc0f38e1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structfolly_1_1AsyncServerSocket_1_1ServerEventHandler.html">ServerEventHandler</a>&gt; folly::AsyncServerSocket::sockets_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00870">870</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00274">attachEventBase()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l01142">backoffTimeoutExpired()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00372">bind()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00331">bindSocket()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00284">detachEventBase()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l01093">enterBackoff()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00567">getAddress()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00576">getAddresses()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00312">getSocket()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00301">getSockets()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00554">listen()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00723">pauseAccepting()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00636">removeAcceptCallback()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00626">setKeepAliveEnabled()</a>, <a class="el" href="AsyncServerSocket_8h_source.html#l00655">setReusePortEnabled()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00179">setShutdownSocketSet()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00758">setTosReflect()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00704">startAccepting()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">stopAccepting()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00295">useExistingSockets()</a>.</p>

</div>
</div>
<a class="anchor" id="a9e718d426534e0b4f0d68c4ed45de549"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::tfo_ {false}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00885">885</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00699">setTFOEnabled()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">setupSocket()</a>.</p>

</div>
</div>
<a class="anchor" id="acc9c3060d53c39c54b43f6ebe18ff7db"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> folly::AsyncServerSocket::tfoMaxQueueSize_ {0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00887">887</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00699">setTFOEnabled()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">setupSocket()</a>.</p>

</div>
</div>
<a class="anchor" id="a54ca161ae97ea01ed367d19a2add5b11"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncServerSocket::tosReflect_ {false}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00890">890</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8h_source.html#l00585">getTosReflect()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00855">handlerReady()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00758">setTosReflect()</a>.</p>

</div>
</div>
<a class="anchor" id="a620c7911f1f89369b636b633f6ed14e3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::weak_ptr&lt;<a class="el" href="classfolly_1_1ShutdownSocketSet.html">ShutdownSocketSet</a>&gt; folly::AsyncServerSocket::wShutdownSocketSet_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncServerSocket_8h_source.html#l00888">888</a> of file <a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncServerSocket_8cpp_source.html#l00422">bind()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00179">setShutdownSocketSet()</a>, <a class="el" href="AsyncServerSocket_8cpp_source.html#l00782">setupSocket()</a>, and <a class="el" href="AsyncServerSocket_8cpp_source.html#l00207">stopAccepting()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/folly/folly/io/async/<a class="el" href="AsyncServerSocket_8h_source.html">AsyncServerSocket.h</a></li>
<li>proxygen/folly/folly/io/async/<a class="el" href="AsyncServerSocket_8cpp_source.html">AsyncServerSocket.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefolly.html">folly</a></li><li class="navelem"><a class="el" href="classfolly_1_1AsyncServerSocket.html">AsyncServerSocket</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
