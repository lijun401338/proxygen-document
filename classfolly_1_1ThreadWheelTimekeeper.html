<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: folly::ThreadWheelTimekeeper Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfolly_1_1ThreadWheelTimekeeper.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classfolly_1_1ThreadWheelTimekeeper-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::ThreadWheelTimekeeper Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="ThreadWheelTimekeeper_8h_source.html">ThreadWheelTimekeeper.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for folly::ThreadWheelTimekeeper:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classfolly_1_1ThreadWheelTimekeeper.png" usemap="#folly::ThreadWheelTimekeeper_map" alt=""/>
  <map id="folly::ThreadWheelTimekeeper_map" name="folly::ThreadWheelTimekeeper_map">
<area href="classfolly_1_1Timekeeper.html" alt="folly::Timekeeper" shape="rect" coords="0,0,182,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:acf9973df1177187dad5c66299325110e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ThreadWheelTimekeeper.html#acf9973df1177187dad5c66299325110e">ThreadWheelTimekeeper</a> ()</td></tr>
<tr class="memdesc:acf9973df1177187dad5c66299325110e"><td class="mdescLeft">&#160;</td><td class="mdescRight">But it doesn't <em>have</em> to be a singleton.  <a href="#acf9973df1177187dad5c66299325110e">More...</a><br /></td></tr>
<tr class="separator:acf9973df1177187dad5c66299325110e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a270d81bdb8c82f4cf47782e61ebbb3bb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ThreadWheelTimekeeper.html#a270d81bdb8c82f4cf47782e61ebbb3bb">~ThreadWheelTimekeeper</a> () override</td></tr>
<tr class="separator:a270d81bdb8c82f4cf47782e61ebbb3bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d81beac83d9350f595bcd63de722845"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1Future.html">Future</a>&lt; <a class="el" href="structfolly_1_1Unit.html">Unit</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ThreadWheelTimekeeper.html#a5d81beac83d9350f595bcd63de722845">after</a> (<a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a>) override</td></tr>
<tr class="separator:a5d81beac83d9350f595bcd63de722845"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfolly_1_1Timekeeper"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfolly_1_1Timekeeper')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfolly_1_1Timekeeper.html">folly::Timekeeper</a></td></tr>
<tr class="memitem:ae8c7464c45028ef28d60c87e9e0ee939 inherit pub_methods_classfolly_1_1Timekeeper"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Timekeeper.html#ae8c7464c45028ef28d60c87e9e0ee939">~Timekeeper</a> ()=default</td></tr>
<tr class="separator:ae8c7464c45028ef28d60c87e9e0ee939 inherit pub_methods_classfolly_1_1Timekeeper"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad267a3988a2df703b34b44b370738bc4 inherit pub_methods_classfolly_1_1Timekeeper"><td class="memTemplParams" colspan="2">template&lt;class Clock &gt; </td></tr>
<tr class="memitem:ad267a3988a2df703b34b44b370738bc4 inherit pub_methods_classfolly_1_1Timekeeper"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1Future.html">Future</a>&lt; <a class="el" href="structfolly_1_1Unit.html">Unit</a> &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1Timekeeper.html#ad267a3988a2df703b34b44b370738bc4">at</a> (std::chrono::time_point&lt; Clock &gt; <a class="el" href="namespacefolly.html#a7ab90ae4183e3dc37f224c4f494824f9">when</a>)</td></tr>
<tr class="separator:ad267a3988a2df703b34b44b370738bc4 inherit pub_methods_classfolly_1_1Timekeeper"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:add92c961144342a42f9f3b1b7a34d0c5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1EventBase.html">folly::EventBase</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">eventBase_</a></td></tr>
<tr class="separator:add92c961144342a42f9f3b1b7a34d0c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a934066ce5089e7032c08262a5465c80c"><td class="memItemLeft" align="right" valign="top">std::thread&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ThreadWheelTimekeeper.html#a934066ce5089e7032c08262a5465c80c">thread_</a></td></tr>
<tr class="separator:a934066ce5089e7032c08262a5465c80c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bccd7f994f4734735b108044876d9b6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1HHWheelTimer.html#ac5c81b3296322bb2afffde0af8a0a797">HHWheelTimer::UniquePtr</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ThreadWheelTimekeeper.html#a1bccd7f994f4734735b108044876d9b6">wheelTimer_</a></td></tr>
<tr class="separator:a1bccd7f994f4734735b108044876d9b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The default <a class="el" href="classfolly_1_1Timekeeper.html">Timekeeper</a> implementation which uses a <a class="el" href="classfolly_1_1HHWheelTimer.html">HHWheelTimer</a> on an <a class="el" href="classfolly_1_1EventBase.html">EventBase</a> in a dedicated thread. Users needn't deal with this directly, it is used by default by <a class="el" href="classfolly_1_1Future.html">Future</a> methods that work with timeouts. </p>

<p>Definition at line <a class="el" href="ThreadWheelTimekeeper_8h_source.html#l00029">29</a> of file <a class="el" href="ThreadWheelTimekeeper_8h_source.html">ThreadWheelTimekeeper.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="acf9973df1177187dad5c66299325110e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">folly::ThreadWheelTimekeeper::ThreadWheelTimekeeper </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>But it doesn't <em>have</em> to be a singleton. </p>

<p>Definition at line <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html#l00104">104</a> of file <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html">ThreadWheelTimekeeper.cpp</a>.</p>

<p>References <a class="el" href="ThreadWheelTimekeeper_8h_source.html#l00042">eventBase_</a>, <a class="el" href="EventBase_8cpp_source.html#l00455">folly::EventBase::loopForever()</a>, <a class="el" href="HHWheelTimer_8h_source.html#l00061">folly::HHWheelTimer::newTimer()</a>, <a class="el" href="EventBase_8h_source.html#l00794">folly::EventBase::runInEventBaseThread()</a>, <a class="el" href="EventBase_8cpp_source.html#l00740">folly::EventBase::setName()</a>, <a class="el" href="EventBase_8cpp_source.html#l00249">folly::EventBase::waitUntilRunning()</a>, and <a class="el" href="ThreadWheelTimekeeper_8h_source.html#l00044">wheelTimer_</a>.</p>
<div class="fragment"><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    : <a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#a934066ce5089e7032c08262a5465c80c">thread_</a>([<span class="keyword">this</span>] { <a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">eventBase_</a>.<a class="code" href="classfolly_1_1EventBase.html#a7696dec40156ed3c4c8caa1e80d188e7">loopForever</a>(); }),</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#a1bccd7f994f4734735b108044876d9b6">wheelTimer_</a>(</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;          <a class="code" href="classfolly_1_1HHWheelTimer.html#aea6d48674701c93320954cb3c8edd134">HHWheelTimer::newTimer</a>(&amp;<a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">eventBase_</a>, std::chrono::milliseconds(1))) {</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">eventBase_</a>.<a class="code" href="classfolly_1_1EventBase.html#af9ea38dd928c52d56e72eaefe310e13a">waitUntilRunning</a>();</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">eventBase_</a>.<a class="code" href="classfolly_1_1EventBase.html#a064e4b74656102dbb6b9dccc7ffeb8cf">runInEventBaseThread</a>([<span class="keyword">this</span>] {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// 15 characters max</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">eventBase_</a>.<a class="code" href="classfolly_1_1EventBase.html#a2ea0304a1c1891ce4022a92ce1984d48">setName</a>(<span class="stringliteral">&quot;FutureTimekeepr&quot;</span>);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  });</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div><div class="ttc" id="classfolly_1_1ThreadWheelTimekeeper_html_a934066ce5089e7032c08262a5465c80c"><div class="ttname"><a href="classfolly_1_1ThreadWheelTimekeeper.html#a934066ce5089e7032c08262a5465c80c">folly::ThreadWheelTimekeeper::thread_</a></div><div class="ttdeci">std::thread thread_</div><div class="ttdef"><b>Definition:</b> <a href="ThreadWheelTimekeeper_8h_source.html#l00043">ThreadWheelTimekeeper.h:43</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a7696dec40156ed3c4c8caa1e80d188e7"><div class="ttname"><a href="classfolly_1_1EventBase.html#a7696dec40156ed3c4c8caa1e80d188e7">folly::EventBase::loopForever</a></div><div class="ttdeci">void loopForever()</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8cpp_source.html#l00455">EventBase.cpp:455</a></div></div>
<div class="ttc" id="classfolly_1_1HHWheelTimer_html_aea6d48674701c93320954cb3c8edd134"><div class="ttname"><a href="classfolly_1_1HHWheelTimer.html#aea6d48674701c93320954cb3c8edd134">folly::HHWheelTimer::newTimer</a></div><div class="ttdeci">static UniquePtr newTimer(Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="HHWheelTimer_8h_source.html#l00061">HHWheelTimer.h:61</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a064e4b74656102dbb6b9dccc7ffeb8cf"><div class="ttname"><a href="classfolly_1_1EventBase.html#a064e4b74656102dbb6b9dccc7ffeb8cf">folly::EventBase::runInEventBaseThread</a></div><div class="ttdeci">bool runInEventBaseThread(void(*fn)(T *), T *arg)</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00794">EventBase.h:794</a></div></div>
<div class="ttc" id="classfolly_1_1ThreadWheelTimekeeper_html_add92c961144342a42f9f3b1b7a34d0c5"><div class="ttname"><a href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">folly::ThreadWheelTimekeeper::eventBase_</a></div><div class="ttdeci">folly::EventBase eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="ThreadWheelTimekeeper_8h_source.html#l00042">ThreadWheelTimekeeper.h:42</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a2ea0304a1c1891ce4022a92ce1984d48"><div class="ttname"><a href="classfolly_1_1EventBase.html#a2ea0304a1c1891ce4022a92ce1984d48">folly::EventBase::setName</a></div><div class="ttdeci">void setName(const std::string &amp;name)</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8cpp_source.html#l00740">EventBase.cpp:740</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_af9ea38dd928c52d56e72eaefe310e13a"><div class="ttname"><a href="classfolly_1_1EventBase.html#af9ea38dd928c52d56e72eaefe310e13a">folly::EventBase::waitUntilRunning</a></div><div class="ttdeci">void waitUntilRunning()</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8cpp_source.html#l00249">EventBase.cpp:249</a></div></div>
<div class="ttc" id="classfolly_1_1ThreadWheelTimekeeper_html_a1bccd7f994f4734735b108044876d9b6"><div class="ttname"><a href="classfolly_1_1ThreadWheelTimekeeper.html#a1bccd7f994f4734735b108044876d9b6">folly::ThreadWheelTimekeeper::wheelTimer_</a></div><div class="ttdeci">HHWheelTimer::UniquePtr wheelTimer_</div><div class="ttdef"><b>Definition:</b> <a href="ThreadWheelTimekeeper_8h_source.html#l00044">ThreadWheelTimekeeper.h:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a270d81bdb8c82f4cf47782e61ebbb3bb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::ThreadWheelTimekeeper::~ThreadWheelTimekeeper </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html#l00115">115</a> of file <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html">ThreadWheelTimekeeper.cpp</a>.</p>

<p>References <a class="el" href="ThreadWheelTimekeeper_8h_source.html#l00042">eventBase_</a>, <a class="el" href="EventBase_8h_source.html#l00799">folly::EventBase::runInEventBaseThreadAndWait()</a>, <a class="el" href="EventBase_8cpp_source.html#l00493">folly::EventBase::terminateLoopSoon()</a>, <a class="el" href="ThreadWheelTimekeeper_8h_source.html#l00043">thread_</a>, and <a class="el" href="ThreadWheelTimekeeper_8h_source.html#l00044">wheelTimer_</a>.</p>
<div class="fragment"><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                              {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">eventBase_</a>.<a class="code" href="classfolly_1_1EventBase.html#adb94096ef5323ef3a5ec03f8c62880aa">runInEventBaseThreadAndWait</a>([<span class="keyword">this</span>] {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#a1bccd7f994f4734735b108044876d9b6">wheelTimer_</a>-&gt;cancelAll();</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">eventBase_</a>.<a class="code" href="classfolly_1_1EventBase.html#ac274e03942f8358c5a3106eebc56c120">terminateLoopSoon</a>();</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  });</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  <a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#a934066ce5089e7032c08262a5465c80c">thread_</a>.join();</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div><div class="ttc" id="classfolly_1_1ThreadWheelTimekeeper_html_a934066ce5089e7032c08262a5465c80c"><div class="ttname"><a href="classfolly_1_1ThreadWheelTimekeeper.html#a934066ce5089e7032c08262a5465c80c">folly::ThreadWheelTimekeeper::thread_</a></div><div class="ttdeci">std::thread thread_</div><div class="ttdef"><b>Definition:</b> <a href="ThreadWheelTimekeeper_8h_source.html#l00043">ThreadWheelTimekeeper.h:43</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_adb94096ef5323ef3a5ec03f8c62880aa"><div class="ttname"><a href="classfolly_1_1EventBase.html#adb94096ef5323ef3a5ec03f8c62880aa">folly::EventBase::runInEventBaseThreadAndWait</a></div><div class="ttdeci">bool runInEventBaseThreadAndWait(void(*fn)(T *), T *arg)</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00799">EventBase.h:799</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_ac274e03942f8358c5a3106eebc56c120"><div class="ttname"><a href="classfolly_1_1EventBase.html#ac274e03942f8358c5a3106eebc56c120">folly::EventBase::terminateLoopSoon</a></div><div class="ttdeci">void terminateLoopSoon()</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8cpp_source.html#l00493">EventBase.cpp:493</a></div></div>
<div class="ttc" id="classfolly_1_1ThreadWheelTimekeeper_html_add92c961144342a42f9f3b1b7a34d0c5"><div class="ttname"><a href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">folly::ThreadWheelTimekeeper::eventBase_</a></div><div class="ttdeci">folly::EventBase eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="ThreadWheelTimekeeper_8h_source.html#l00042">ThreadWheelTimekeeper.h:42</a></div></div>
<div class="ttc" id="classfolly_1_1ThreadWheelTimekeeper_html_a1bccd7f994f4734735b108044876d9b6"><div class="ttname"><a href="classfolly_1_1ThreadWheelTimekeeper.html#a1bccd7f994f4734735b108044876d9b6">folly::ThreadWheelTimekeeper::wheelTimer_</a></div><div class="ttdeci">HHWheelTimer::UniquePtr wheelTimer_</div><div class="ttdef"><b>Definition:</b> <a href="ThreadWheelTimekeeper_8h_source.html#l00044">ThreadWheelTimekeeper.h:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a5d81beac83d9350f595bcd63de722845"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1Future.html">Future</a>&lt; <a class="el" href="structfolly_1_1Unit.html">Unit</a> &gt; folly::ThreadWheelTimekeeper::after </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a>&#160;</td>
          <td class="paramname"><em>dur</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Implement the <a class="el" href="classfolly_1_1Timekeeper.html">Timekeeper</a> interface This future <em>does</em> complete on the timer thread. You should almost certainly follow it with a <a class="el" href="namespacefolly.html#ad8577f68fd0aaeeb5a563c9cb8fe0d49">via()</a> call or the accuracy of other timers will suffer. </p>

<p>Implements <a class="el" href="classfolly_1_1Timekeeper.html#a1c702bd70e6c1b22ee1db289682af047">folly::Timekeeper</a>.</p>

<p>Definition at line <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html#l00123">123</a> of file <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html">ThreadWheelTimekeeper.cpp</a>.</p>

<p>References <a class="el" href="ThreadWheelTimekeeper_8h_source.html#l00042">eventBase_</a>, <a class="el" href="PushmiBenchmarks_8cpp_source.html#l00515">f</a>, and <a class="el" href="EventBase_8h_source.html#l00794">folly::EventBase::runInEventBaseThread()</a>.</p>

<p>Referenced by <a class="el" href="TimekeeperTest_8cpp_source.html#l00408">TEST_F()</a>.</p>
<div class="fragment"><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                                      {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keyword">auto</span> cob = WTCallback::create(&amp;<a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">eventBase_</a>);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keyword">auto</span> <a class="code" href="PushmiBenchmarks_8cpp.html#ad94c2c2f9fd35a12cc099962b7540071">f</a> = cob-&gt;getFuture();</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">// Even shared_ptr of cob is captured in lambda this is still somewhat *racy*</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// because it will be released once timeout is scheduled. So technically there</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <span class="comment">// is no gurantee that EventBase thread can safely call timeout callback.</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="comment">// However due to fact that we are having circular reference here:</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// WTCallback-&gt;Promise-&gt;Core-&gt;WTCallbak, so three of them won&#39;t go away until</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="comment">// we break the circular reference. The break happens either in</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="comment">// WTCallback::timeoutExpired or WTCallback::interruptHandler. Former means</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="comment">// timeout callback is being safely executed. Latter captures shared_ptr of</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">// WTCallback again in another lambda for canceling timeout. The moment</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  <span class="comment">// canceling timeout is executed in EventBase thread, the actual timeout</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="comment">// callback has either been executed, or will never be executed. So we are</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <span class="comment">// fine here.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">eventBase_</a>.<a class="code" href="classfolly_1_1EventBase.html#a064e4b74656102dbb6b9dccc7ffeb8cf">runInEventBaseThread</a>(</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;          [<span class="keyword">this</span>, cob, dur] { wheelTimer_-&gt;scheduleTimeout(cob.get(), dur); })) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// Release promise to break the circular reference. Because if</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// scheduleTimeout fails, there is nothing to *promise*. Internally</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="comment">// Core would automatically set an exception result when Promise is</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="comment">// destructed before fulfilling.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// This is either called from EventBase thread, or here.</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// They are somewhat racy but given the rare chance this could fail,</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="comment">// I don&#39;t see it is introducing any problem yet.</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keyword">auto</span> promise = cob-&gt;stealPromise();</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">if</span> (!promise.isFulfilled()) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      promise.setException(FutureNoTimekeeper{});</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="PushmiBenchmarks_8cpp.html#ad94c2c2f9fd35a12cc099962b7540071">f</a>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;}</div><div class="ttc" id="PushmiBenchmarks_8cpp_html_ad94c2c2f9fd35a12cc099962b7540071"><div class="ttname"><a href="PushmiBenchmarks_8cpp.html#ad94c2c2f9fd35a12cc099962b7540071">f</a></div><div class="ttdeci">auto f</div><div class="ttdef"><b>Definition:</b> <a href="PushmiBenchmarks_8cpp_source.html#l00515">PushmiBenchmarks.cpp:515</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a064e4b74656102dbb6b9dccc7ffeb8cf"><div class="ttname"><a href="classfolly_1_1EventBase.html#a064e4b74656102dbb6b9dccc7ffeb8cf">folly::EventBase::runInEventBaseThread</a></div><div class="ttdeci">bool runInEventBaseThread(void(*fn)(T *), T *arg)</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00794">EventBase.h:794</a></div></div>
<div class="ttc" id="classfolly_1_1ThreadWheelTimekeeper_html_add92c961144342a42f9f3b1b7a34d0c5"><div class="ttname"><a href="classfolly_1_1ThreadWheelTimekeeper.html#add92c961144342a42f9f3b1b7a34d0c5">folly::ThreadWheelTimekeeper::eventBase_</a></div><div class="ttdeci">folly::EventBase eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="ThreadWheelTimekeeper_8h_source.html#l00042">ThreadWheelTimekeeper.h:42</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="add92c961144342a42f9f3b1b7a34d0c5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1EventBase.html">folly::EventBase</a> folly::ThreadWheelTimekeeper::eventBase_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ThreadWheelTimekeeper_8h_source.html#l00042">42</a> of file <a class="el" href="ThreadWheelTimekeeper_8h_source.html">ThreadWheelTimekeeper.h</a>.</p>

<p>Referenced by <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html#l00123">after()</a>, <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html#l00104">ThreadWheelTimekeeper()</a>, and <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html#l00115">~ThreadWheelTimekeeper()</a>.</p>

</div>
</div>
<a class="anchor" id="a934066ce5089e7032c08262a5465c80c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::thread folly::ThreadWheelTimekeeper::thread_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ThreadWheelTimekeeper_8h_source.html#l00043">43</a> of file <a class="el" href="ThreadWheelTimekeeper_8h_source.html">ThreadWheelTimekeeper.h</a>.</p>

<p>Referenced by <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html#l00115">~ThreadWheelTimekeeper()</a>.</p>

</div>
</div>
<a class="anchor" id="a1bccd7f994f4734735b108044876d9b6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1HHWheelTimer.html#ac5c81b3296322bb2afffde0af8a0a797">HHWheelTimer::UniquePtr</a> folly::ThreadWheelTimekeeper::wheelTimer_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ThreadWheelTimekeeper_8h_source.html#l00044">44</a> of file <a class="el" href="ThreadWheelTimekeeper_8h_source.html">ThreadWheelTimekeeper.h</a>.</p>

<p>Referenced by <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html#l00104">ThreadWheelTimekeeper()</a>, and <a class="el" href="ThreadWheelTimekeeper_8cpp_source.html#l00115">~ThreadWheelTimekeeper()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/folly/folly/futures/<a class="el" href="ThreadWheelTimekeeper_8h_source.html">ThreadWheelTimekeeper.h</a></li>
<li>proxygen/folly/folly/futures/<a class="el" href="ThreadWheelTimekeeper_8cpp_source.html">ThreadWheelTimekeeper.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefolly.html">folly</a></li><li class="navelem"><a class="el" href="classfolly_1_1ThreadWheelTimekeeper.html">ThreadWheelTimekeeper</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
