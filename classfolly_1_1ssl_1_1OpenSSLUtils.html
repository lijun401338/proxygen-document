<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: folly::ssl::OpenSSLUtils Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfolly_1_1ssl_1_1OpenSSLUtils.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="classfolly_1_1ssl_1_1OpenSSLUtils-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::ssl::OpenSSLUtils Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="OpenSSLUtils_8h_source.html">OpenSSLUtils.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a62ed95725cf0f1089e06bf2408e8078b"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#a62ed95725cf0f1089e06bf2408e8078b">getTLSMasterKey</a> (const SSL_SESSION *session, <a class="el" href="namespacefolly.html#a9efde8a92a713a155d17ccb9452ecd5e">MutableByteRange</a> keyOut)</td></tr>
<tr class="separator:a62ed95725cf0f1089e06bf2408e8078b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bfa3697f9a685a40ea2f9027b7c2174"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#a1bfa3697f9a685a40ea2f9027b7c2174">getTLSClientRandom</a> (const SSL *ssl, <a class="el" href="namespacefolly.html#a9efde8a92a713a155d17ccb9452ecd5e">MutableByteRange</a> randomOut)</td></tr>
<tr class="separator:a1bfa3697f9a685a40ea2f9027b7c2174"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad45cd3afe8363b2c9d64736cfa961cd6"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#ad45cd3afe8363b2c9d64736cfa961cd6">validatePeerCertNames</a> (X509 *cert, const sockaddr *<a class="el" href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a>, socklen_t addrLen)</td></tr>
<tr class="separator:ad45cd3afe8363b2c9d64736cfa961cd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3b335c81c6e34edee5fd53fe40fda4d"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#ab3b335c81c6e34edee5fd53fe40fda4d">getPeerAddressFromX509StoreCtx</a> (X509_STORE_CTX *ctx, sockaddr_storage *addrStorage, socklen_t *addrLen)</td></tr>
<tr class="separator:ab3b335c81c6e34edee5fd53fe40fda4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41d65ad1862f5f2ee853feb704723ad5"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#a41d65ad1862f5f2ee853feb704723ad5">getCipherName</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a> cipherCode)</td></tr>
<tr class="separator:a41d65ad1862f5f2ee853feb704723ad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b84002d2b4d36ad86aa8af78d14f1eb"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#a5b84002d2b4d36ad86aa8af78d14f1eb">setSSLInitialCtx</a> (SSL *ssl, SSL_CTX *ctx)</td></tr>
<tr class="separator:a5b84002d2b4d36ad86aa8af78d14f1eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cd776052d621048a567695cd0f23505"><td class="memItemLeft" align="right" valign="top">static SSL_CTX *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#a3cd776052d621048a567695cd0f23505">getSSLInitialCtx</a> (SSL *ssl)</td></tr>
<tr class="separator:a3cd776052d621048a567695cd0f23505"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c09e16d566a66fc494f704a556226cb"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#a6c09e16d566a66fc494f704a556226cb">getCommonName</a> (X509 *x509)</td></tr>
<tr class="separator:a6c09e16d566a66fc494f704a556226cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc5bb4b894d126f7563665071a2ee0c4"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="namespacefolly_1_1ssl.html#a2a1d3d93992678b5a4ab02e831b4101a">BioMethodUniquePtr</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#afc5bb4b894d126f7563665071a2ee0c4">newSocketBioMethod</a> ()</td></tr>
<tr class="separator:afc5bb4b894d126f7563665071a2ee0c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2575ebf4597ac4c8a0c716589ce13beb"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#a2575ebf4597ac4c8a0c716589ce13beb">setCustomBioReadMethod</a> (BIO_METHOD *bioMeth, int(*meth)(BIO *, char *, int))</td></tr>
<tr class="separator:a2575ebf4597ac4c8a0c716589ce13beb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55c843b31793128dde118a25ac1620c4"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#a55c843b31793128dde118a25ac1620c4">setCustomBioWriteMethod</a> (BIO_METHOD *bioMeth, int(*meth)(BIO *, const char *, int))</td></tr>
<tr class="separator:a55c843b31793128dde118a25ac1620c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3178e65ba0197c65b7adb42c6f39a32d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#a3178e65ba0197c65b7adb42c6f39a32d">getBioShouldRetryWrite</a> (int ret)</td></tr>
<tr class="separator:a3178e65ba0197c65b7adb42c6f39a32d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb9515eddb7b8588e260ed10e96e0c1d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#adb9515eddb7b8588e260ed10e96e0c1d">setBioAppData</a> (BIO *<a class="el" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>, void *<a class="el" href="Hazptr_8h.html#a7e740ea149128af625c59cc9461ae0d3">ptr</a>)</td></tr>
<tr class="separator:adb9515eddb7b8588e260ed10e96e0c1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4687b8c55c5543b44dadc629dceb5b7"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#aa4687b8c55c5543b44dadc629dceb5b7">getBioAppData</a> (BIO *<a class="el" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>)</td></tr>
<tr class="separator:aa4687b8c55c5543b44dadc629dceb5b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb98e16c6ef87cbf9a6c19d9d6e1ab73"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#adb98e16c6ef87cbf9a6c19d9d6e1ab73">getBioFd</a> (BIO *<a class="el" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>, int *fd)</td></tr>
<tr class="separator:adb98e16c6ef87cbf9a6c19d9d6e1ab73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a147ad97e24b089dab2e6529497375a0e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html#a147ad97e24b089dab2e6529497375a0e">setBioFd</a> (BIO *<a class="el" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>, int fd, int <a class="el" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a>)</td></tr>
<tr class="separator:a147ad97e24b089dab2e6529497375a0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="OpenSSLUtils_8h_source.html#l00026">26</a> of file <a class="el" href="OpenSSLUtils_8h_source.html">OpenSSLUtils.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="aa4687b8c55c5543b44dadc629dceb5b7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void * folly::ssl::OpenSSLUtils::getBioAppData </td>
          <td>(</td>
          <td class="paramtype">BIO *&#160;</td>
          <td class="paramname"><em>b</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00284">284</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>Referenced by <a class="el" href="AsyncSSLSocket_8cpp_source.html#l01751">folly::AsyncSSLSocket::bioRead()</a>, and <a class="el" href="AsyncSSLSocket_8cpp_source.html#l01701">folly::AsyncSSLSocket::bioWrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                        {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">#ifdef OPENSSL_IS_BORINGSSL</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordflow">return</span> BIO_get_callback_arg(<a class="code" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="keywordflow">return</span> BIO_get_app_data(<a class="code" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div><div class="ttc" id="OptionalTest_8cpp_html_a9c67fe724294816aca4adddf8255fece"><div class="ttname"><a href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a></div><div class="ttdeci">char b</div><div class="ttdef"><b>Definition:</b> <a href="OptionalTest_8cpp_source.html#l00053">OptionalTest.cpp:53</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adb98e16c6ef87cbf9a6c19d9d6e1ab73"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int folly::ssl::OpenSSLUtils::getBioFd </td>
          <td>(</td>
          <td class="paramtype">BIO *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>fd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00292">292</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>Referenced by <a class="el" href="AsyncSSLSocket_8cpp_source.html#l01751">folly::AsyncSSLSocket::bioRead()</a>, and <a class="el" href="AsyncSSLSocket_8cpp_source.html#l01701">folly::AsyncSSLSocket::bioWrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                          {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordtype">int</span> ret = portability::sockets::socket_to_fd((SOCKET)BIO_get_fd(<a class="code" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>, fd));</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordflow">if</span> (fd != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    *fd = ret;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordflow">return</span> BIO_get_fd(<a class="code" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>, fd);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;}</div><div class="ttc" id="OptionalTest_8cpp_html_a9c67fe724294816aca4adddf8255fece"><div class="ttname"><a href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a></div><div class="ttdeci">char b</div><div class="ttdef"><b>Definition:</b> <a href="OptionalTest_8cpp_source.html#l00053">OptionalTest.cpp:53</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3178e65ba0197c65b7adb42c6f39a32d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int folly::ssl::OpenSSLUtils::getBioShouldRetryWrite </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ret</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00266">266</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>Referenced by <a class="el" href="AsyncSSLSocket_8cpp_source.html#l01751">folly::AsyncSSLSocket::bioRead()</a>, and <a class="el" href="AsyncSSLSocket_8cpp_source.html#l01701">folly::AsyncSSLSocket::bioWrite()</a>.</p>
<div class="fragment"><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                                              {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="preprocessor">#ifdef OPENSSL_IS_BORINGSSL</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  ret = boringssl_bio_fd_should_retry(r);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  ret = BIO_sock_should_retry(r);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a41d65ad1862f5f2ee853feb704723ad5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp; folly::ssl::OpenSSLUtils::getCipherName </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a5a8b2dc9e45a9ee81a94ef304fb62505">uint16_t</a>&#160;</td>
          <td class="paramname"><em>cipherCode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get a stringified cipher name (e.g., ECDHE-ECDSA-CHACHA20-POLY1305) given the 2-byte code (e.g., 0xcca9) for the cipher. The name conversion only works for the ciphers built into the linked OpenSSL library</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cipherCode</td><td><a class="el" href="structA.html">A</a> 16-bit IANA cipher code (machine endianness) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Cipher name, or empty if the code is not found </dd></dl>

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00188">188</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>References <a class="el" href="Access_8h_source.html#l00055">folly::empty()</a>, <a class="el" href="OpenSSLUtils_8cpp_source.html#l00152">folly::ssl::getOpenSSLCipherNames()</a>, and <a class="el" href="Conv_8cpp_source.html#l00212">string</a>.</p>

<p>Referenced by <a class="el" href="AsyncSSLSocket_8cpp_source.html#l01919">folly::AsyncSSLSocket::getSSLClientCiphers()</a>.</p>
<div class="fragment"><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                                                {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// Having this in a hash map saves the binary search inside OpenSSL</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="keyword">static</span> std::unordered_map&lt;uint16_t, std::string&gt; cipherCodeToName(</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <a class="code" href="namespacefolly_1_1ssl.html#a36945595eddf7d95fb0f336ac5e4bad8">getOpenSSLCipherNames</a>());</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span>&amp; iter = cipherCodeToName.find(cipherCode);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keywordflow">if</span> (iter != cipherCodeToName.end()) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">return</span> iter-&gt;second;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keyword">static</span> <a class="code" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> <a class="code" href="namespacefolly.html#a689e45e870f8267348e24cea50d6877f">empty</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacefolly.html#a689e45e870f8267348e24cea50d6877f">empty</a>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div><div class="ttc" id="namespacefolly_html_a689e45e870f8267348e24cea50d6877f"><div class="ttname"><a href="namespacefolly.html#a689e45e870f8267348e24cea50d6877f">folly::empty</a></div><div class="ttdeci">constexpr auto empty(C const &amp;c) -&gt; decltype(c.empty())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00055">Access.h:55</a></div></div>
<div class="ttc" id="Conv_8cpp_html_ae1adbce218e7a9d09164012443191d24"><div class="ttname"><a href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">string</a></div><div class="ttdeci">const char * string</div><div class="ttdef"><b>Definition:</b> <a href="Conv_8cpp_source.html#l00212">Conv.cpp:212</a></div></div>
<div class="ttc" id="namespacefolly_1_1ssl_html_a36945595eddf7d95fb0f336ac5e4bad8"><div class="ttname"><a href="namespacefolly_1_1ssl.html#a36945595eddf7d95fb0f336ac5e4bad8">folly::ssl::getOpenSSLCipherNames</a></div><div class="ttdeci">static std::unordered_map&lt; uint16_t, std::string &gt; getOpenSSLCipherNames()</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSLUtils_8cpp_source.html#l00152">OpenSSLUtils.cpp:152</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6c09e16d566a66fc494f704a556226cb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> folly::ssl::OpenSSLUtils::getCommonName </td>
          <td>(</td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>x509</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the common name out of a cert. Return empty if x509 is null. </p>

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00317">317</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>References <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">i</a>, and <a class="el" href="Conv_8cpp_source.html#l00212">string</a>.</p>
<div class="fragment"><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                                                {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">if</span> (x509 == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  X509_NAME* subject = X509_get_subject_name(x509);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> cn;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  cn.resize(ub_common_name);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  X509_NAME_get_text_by_NID(</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      subject, NID_commonName, const_cast&lt;char*&gt;(cn.data()), ub_common_name);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">return</span> cn;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div><div class="ttc" id="Conv_8cpp_html_ae1adbce218e7a9d09164012443191d24"><div class="ttname"><a href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">string</a></div><div class="ttdeci">const char * string</div><div class="ttdef"><b>Definition:</b> <a href="Conv_8cpp_source.html#l00212">Conv.cpp:212</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab3b335c81c6e34edee5fd53fe40fda4d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::ssl::OpenSSLUtils::getPeerAddressFromX509StoreCtx </td>
          <td>(</td>
          <td class="paramtype">X509_STORE_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">sockaddr_storage *&#160;</td>
          <td class="paramname"><em>addrStorage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">socklen_t *&#160;</td>
          <td class="paramname"><em>addrLen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the peer socket address from an X509_STORE_CTX*. Unlike the accept, getsockname, getpeername, etc family of operations, addrLen's initial value is ignored and reset.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>Context from which to retrieve peer sockaddr </td></tr>
    <tr><td class="paramname">addrStorage</td><td>out param for address </td></tr>
    <tr><td class="paramname">addrLen</td><td>out param for length of address </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true on success, false on failure </dd></dl>

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00075">75</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>References <a class="el" href="NetOps_8cpp_source.html#l00104">folly::netops::getpeername()</a>.</p>
<div class="fragment"><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                        {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="comment">// Grab the ssl idx and then the ssl object so that we can get the peer</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="comment">// name to compare against the ips in the subjectAltName</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keyword">auto</span> sslIdx = SSL_get_ex_data_X509_STORE_CTX_idx();</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keyword">auto</span> ssl = <span class="keyword">reinterpret_cast&lt;</span>SSL*<span class="keyword">&gt;</span>(X509_STORE_CTX_get_ex_data(ctx, sslIdx));</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordtype">int</span> fd = SSL_get_fd(ssl);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="keywordflow">if</span> (fd &lt; 0) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;Inexplicably couldn&#39;t get fd from SSL&quot;</span>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  *addrLen = <span class="keyword">sizeof</span>(*addrStorage);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacefolly_1_1netops.html#a8c107066c6eb918efb58e07d91993f44">getpeername</a>(fd, reinterpret_cast&lt;sockaddr*&gt;(addrStorage), addrLen) != 0) {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    PLOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;Unable to get peer name&quot;</span>;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  CHECK(*addrLen &lt;= <span class="keyword">sizeof</span>(*addrStorage));</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1netops_html_a8c107066c6eb918efb58e07d91993f44"><div class="ttname"><a href="namespacefolly_1_1netops.html#a8c107066c6eb918efb58e07d91993f44">folly::netops::getpeername</a></div><div class="ttdeci">int getpeername(NetworkSocket s, sockaddr *name, socklen_t *namelen)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00104">NetOps.cpp:104</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3cd776052d621048a567695cd0f23505"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SSL_CTX * folly::ssl::OpenSSLUtils::getSSLInitialCtx </td>
          <td>(</td>
          <td class="paramtype">SSL *&#160;</td>
          <td class="paramname"><em>ssl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00215">215</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>Referenced by <a class="el" href="AsyncSSLSocket_8cpp_source.html#l00461">folly::AsyncSSLSocket::sslAccept()</a>.</p>
<div class="fragment"><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                                                {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  (void)ssl;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">#if !FOLLY_OPENSSL_IS_110 &amp;&amp; !defined(OPENSSL_NO_TLSEXT)</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="keywordflow">if</span> (ssl) {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keywordflow">return</span> ssl-&gt;initial_ctx;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1bfa3697f9a685a40ea2f9027b7c2174"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::ssl::OpenSSLUtils::getTLSClientRandom </td>
          <td>(</td>
          <td class="paramtype">const SSL *&#160;</td>
          <td class="paramname"><em>ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefolly.html#a9efde8a92a713a155d17ccb9452ecd5e">MutableByteRange</a>&#160;</td>
          <td class="paramname"><em>randomOut</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00058">58</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>References <a class="el" href="Range_8h_source.html#l00452">folly::Range&lt; Iter &gt;::begin()</a>, <a class="el" href="Utility_8h_source.html#l00072">folly::copy()</a>, and <a class="el" href="Range_8h_source.html#l00431">folly::Range&lt; Iter &gt;::size()</a>.</p>
<div class="fragment"><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                                {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#if FOLLY_OPENSSL_IS_101 || FOLLY_OPENSSL_IS_102</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">if</span> ((SSL_version(ssl) &gt;&gt; 8) == TLS1_VERSION_MAJOR &amp;&amp; ssl-&gt;s3 &amp;&amp;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      randomOut.size() == SSL3_RANDOM_SIZE) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keyword">auto</span> clientRandom = ssl-&gt;s3-&gt;client_random;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="namespacefolly.html#ac4b2f1383a59507925358ddd5b1badb1">std::copy</a>(clientRandom, clientRandom + SSL3_RANDOM_SIZE, randomOut.begin());</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  }</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  (void)ssl;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  (void)randomOut;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;}</div><div class="ttc" id="namespacefolly_html_ac4b2f1383a59507925358ddd5b1badb1"><div class="ttname"><a href="namespacefolly.html#ac4b2f1383a59507925358ddd5b1badb1">folly::copy</a></div><div class="ttdeci">constexpr std::decay&lt; T &gt;::type copy(T &amp;&amp;value) noexcept(noexcept(typename std::decay&lt; T &gt;::type(std::forward&lt; T &gt;(value))))</div><div class="ttdef"><b>Definition:</b> <a href="Utility_8h_source.html#l00072">Utility.h:72</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a62ed95725cf0f1089e06bf2408e8078b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::ssl::OpenSSLUtils::getTLSMasterKey </td>
          <td>(</td>
          <td class="paramtype">const SSL_SESSION *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacefolly.html#a9efde8a92a713a155d17ccb9452ecd5e">MutableByteRange</a>&#160;</td>
          <td class="paramname"><em>keyOut</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00040">40</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>References <a class="el" href="Range_8h_source.html#l00452">folly::Range&lt; Iter &gt;::begin()</a>, <a class="el" href="Utility_8h_source.html#l00072">folly::copy()</a>, and <a class="el" href="Range_8h_source.html#l00431">folly::Range&lt; Iter &gt;::size()</a>.</p>
<div class="fragment"><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                             {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#if FOLLY_OPENSSL_IS_101 || FOLLY_OPENSSL_IS_102</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">if</span> (session &amp;&amp;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      session-&gt;master_key_length == static_cast&lt;int&gt;(keyOut.size())) {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keyword">auto</span> masterKey = session-&gt;master_key;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="namespacefolly.html#ac4b2f1383a59507925358ddd5b1badb1">std::copy</a>(</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        masterKey, masterKey + session-&gt;master_key_length, keyOut.begin());</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  (void)session;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  (void)keyOut;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;}</div><div class="ttc" id="namespacefolly_html_ac4b2f1383a59507925358ddd5b1badb1"><div class="ttname"><a href="namespacefolly.html#ac4b2f1383a59507925358ddd5b1badb1">folly::copy</a></div><div class="ttdeci">constexpr std::decay&lt; T &gt;::type copy(T &amp;&amp;value) noexcept(noexcept(typename std::decay&lt; T &gt;::type(std::forward&lt; T &gt;(value))))</div><div class="ttdef"><b>Definition:</b> <a href="Utility_8h_source.html#l00072">Utility.h:72</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afc5bb4b894d126f7563665071a2ee0c4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefolly_1_1ssl.html#a2a1d3d93992678b5a4ab02e831b4101a">BioMethodUniquePtr</a> folly::ssl::OpenSSLUtils::newSocketBioMethod </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Wrappers for BIO operations that may be different across different versions/flavors of OpenSSL (including forks like BoringSSL) </p>

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00225">225</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>References <a class="el" href="OpenSSL_8cpp_source.html#l00121">folly::portability::ssl::BIO_meth_new()</a>, <a class="el" href="OpenSSL_8cpp_source.html#l00161">folly::portability::ssl::BIO_meth_set_create()</a>, <a class="el" href="OpenSSL_8cpp_source.html#l00156">folly::portability::ssl::BIO_meth_set_ctrl()</a>, <a class="el" href="OpenSSL_8cpp_source.html#l00166">folly::portability::ssl::BIO_meth_set_destroy()</a>, <a class="el" href="OpenSSL_8cpp_source.html#l00151">folly::portability::ssl::BIO_meth_set_gets()</a>, <a class="el" href="OpenSSL_8cpp_source.html#l00146">folly::portability::ssl::BIO_meth_set_puts()</a>, <a class="el" href="OpenSSL_8cpp_source.html#l00136">folly::portability::ssl::BIO_meth_set_read()</a>, and <a class="el" href="OpenSSL_8cpp_source.html#l00141">folly::portability::ssl::BIO_meth_set_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                                    {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  BIO_METHOD* newmeth = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">#if FOLLY_OPENSSL_IS_110</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordflow">if</span> (!(newmeth = <a class="code" href="namespacefolly_1_1portability_1_1ssl.html#a377666171b3761699ea5daf431dd2cd5">BIO_meth_new</a>(BIO_TYPE_SOCKET, <span class="stringliteral">&quot;socket_bio_method&quot;</span>))) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keyword">auto</span> meth = <span class="keyword">const_cast&lt;</span>BIO_METHOD*<span class="keyword">&gt;</span>(BIO_s_socket());</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <a class="code" href="namespacefolly_1_1portability_1_1ssl.html#aa0209ed210086b1af38af29541448ed2">BIO_meth_set_create</a>(newmeth, BIO_meth_get_create(meth));</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <a class="code" href="namespacefolly_1_1portability_1_1ssl.html#ab876e2770f136146696644873bf9d2bd">BIO_meth_set_destroy</a>(newmeth, BIO_meth_get_destroy(meth));</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  <a class="code" href="namespacefolly_1_1portability_1_1ssl.html#a2d67aff29b49581e209435d099c79ed1">BIO_meth_set_ctrl</a>(newmeth, BIO_meth_get_ctrl(meth));</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  BIO_meth_set_callback_ctrl(newmeth, BIO_meth_get_callback_ctrl(meth));</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <a class="code" href="namespacefolly_1_1portability_1_1ssl.html#a196535e8f10fad4ecaf996faff107c4c">BIO_meth_set_read</a>(newmeth, BIO_meth_get_read(meth));</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  <a class="code" href="namespacefolly_1_1portability_1_1ssl.html#a3cedb7eb020f73dcf16342c6e13ce482">BIO_meth_set_write</a>(newmeth, BIO_meth_get_write(meth));</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <a class="code" href="namespacefolly_1_1portability_1_1ssl.html#a54c404154b6f41f6342323f2d85f4134">BIO_meth_set_gets</a>(newmeth, BIO_meth_get_gets(meth));</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <a class="code" href="namespacefolly_1_1portability_1_1ssl.html#a132ce8e160b9d1dd48ba4a0ed92ad9fd">BIO_meth_set_puts</a>(newmeth, BIO_meth_get_puts(meth));</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">if</span> (!(newmeth = (BIO_METHOD*)OPENSSL_malloc(<span class="keyword">sizeof</span>(BIO_METHOD)))) {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  }</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  memcpy(newmeth, BIO_s_socket(), <span class="keyword">sizeof</span>(BIO_METHOD));</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefolly_1_1ssl.html#a2a1d3d93992678b5a4ab02e831b4101a">BioMethodUniquePtr</a>(newmeth);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_ab876e2770f136146696644873bf9d2bd"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#ab876e2770f136146696644873bf9d2bd">folly::portability::ssl::BIO_meth_set_destroy</a></div><div class="ttdeci">int BIO_meth_set_destroy(BIO_METHOD *biom, int(*destroy)(BIO *))</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00166">OpenSSL.cpp:166</a></div></div>
<div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_aa0209ed210086b1af38af29541448ed2"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#aa0209ed210086b1af38af29541448ed2">folly::portability::ssl::BIO_meth_set_create</a></div><div class="ttdeci">int BIO_meth_set_create(BIO_METHOD *biom, int(*create)(BIO *))</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00161">OpenSSL.cpp:161</a></div></div>
<div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_a3cedb7eb020f73dcf16342c6e13ce482"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#a3cedb7eb020f73dcf16342c6e13ce482">folly::portability::ssl::BIO_meth_set_write</a></div><div class="ttdeci">int BIO_meth_set_write(BIO_METHOD *biom, int(*write)(BIO *, const char *, int))</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00141">OpenSSL.cpp:141</a></div></div>
<div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_a54c404154b6f41f6342323f2d85f4134"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#a54c404154b6f41f6342323f2d85f4134">folly::portability::ssl::BIO_meth_set_gets</a></div><div class="ttdeci">int BIO_meth_set_gets(BIO_METHOD *biom, int(*bgets)(BIO *, char *, int))</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00151">OpenSSL.cpp:151</a></div></div>
<div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_a2d67aff29b49581e209435d099c79ed1"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#a2d67aff29b49581e209435d099c79ed1">folly::portability::ssl::BIO_meth_set_ctrl</a></div><div class="ttdeci">int BIO_meth_set_ctrl(BIO_METHOD *biom, long(*ctrl)(BIO *, int, long, void *))</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00156">OpenSSL.cpp:156</a></div></div>
<div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_a377666171b3761699ea5daf431dd2cd5"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#a377666171b3761699ea5daf431dd2cd5">folly::portability::ssl::BIO_meth_new</a></div><div class="ttdeci">BIO_METHOD * BIO_meth_new(int type, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00121">OpenSSL.cpp:121</a></div></div>
<div class="ttc" id="namespacefolly_1_1ssl_html_a2a1d3d93992678b5a4ab02e831b4101a"><div class="ttname"><a href="namespacefolly_1_1ssl.html#a2a1d3d93992678b5a4ab02e831b4101a">folly::ssl::BioMethodUniquePtr</a></div><div class="ttdeci">std::unique_ptr&lt; BIO_METHOD, BioMethodDeleter &gt; BioMethodUniquePtr</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSLPtrTypes_8h_source.html#l00089">OpenSSLPtrTypes.h:89</a></div></div>
<div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_a132ce8e160b9d1dd48ba4a0ed92ad9fd"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#a132ce8e160b9d1dd48ba4a0ed92ad9fd">folly::portability::ssl::BIO_meth_set_puts</a></div><div class="ttdeci">int BIO_meth_set_puts(BIO_METHOD *biom, int(*bputs)(BIO *, const char *))</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00146">OpenSSL.cpp:146</a></div></div>
<div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_a196535e8f10fad4ecaf996faff107c4c"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#a196535e8f10fad4ecaf996faff107c4c">folly::portability::ssl::BIO_meth_set_read</a></div><div class="ttdeci">int BIO_meth_set_read(BIO_METHOD *biom, int(*read)(BIO *, char *, int))</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00136">OpenSSL.cpp:136</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adb9515eddb7b8588e260ed10e96e0c1d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::ssl::OpenSSLUtils::setBioAppData </td>
          <td>(</td>
          <td class="paramtype">BIO *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00276">276</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>Referenced by <a class="el" href="AsyncSSLSocket_8cpp_source.html#l00740">folly::AsyncSSLSocket::setupSSLBio()</a>.</p>
<div class="fragment"><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                                  {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="preprocessor">#ifdef OPENSSL_IS_BORINGSSL</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  BIO_set_callback_arg(<a class="code" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>, static_cast&lt;char*&gt;(<a class="code" href="StaticSingletonManager_8cpp.html#a53a30bc00154d79fa155f60e2dfabf5f">ptr</a>));</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  BIO_set_app_data(<a class="code" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>, <a class="code" href="StaticSingletonManager_8cpp.html#a53a30bc00154d79fa155f60e2dfabf5f">ptr</a>);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div><div class="ttc" id="StaticSingletonManager_8cpp_html_a53a30bc00154d79fa155f60e2dfabf5f"><div class="ttname"><a href="StaticSingletonManager_8cpp.html#a53a30bc00154d79fa155f60e2dfabf5f">ptr</a></div><div class="ttdeci">void * ptr</div><div class="ttdef"><b>Definition:</b> <a href="StaticSingletonManager_8cpp_source.html#l00038">StaticSingletonManager.cpp:38</a></div></div>
<div class="ttc" id="OptionalTest_8cpp_html_a9c67fe724294816aca4adddf8255fece"><div class="ttname"><a href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a></div><div class="ttdeci">char b</div><div class="ttdef"><b>Definition:</b> <a href="OptionalTest_8cpp_source.html#l00053">OptionalTest.cpp:53</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a147ad97e24b089dab2e6529497375a0e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::ssl::OpenSSLUtils::setBioFd </td>
          <td>(</td>
          <td class="paramtype">BIO *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00304">304</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>References <a class="el" href="NetOps_8cpp_source.html#l00412">folly::netops::socket()</a>.</p>

<p>Referenced by <a class="el" href="AsyncSSLSocket_8cpp_source.html#l00740">folly::AsyncSSLSocket::setupSSLBio()</a>.</p>
<div class="fragment"><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                                                     {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  SOCKET <a class="code" href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">socket</a> = portability::sockets::fd_to_socket(fd);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">// Internally OpenSSL uses this as an int for reasons completely</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">// beyond any form of sanity, so we do the cast ourselves to avoid</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="comment">// the warnings that would be generated.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="keywordtype">int</span> sock = int(socket);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordtype">int</span> sock = fd;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  BIO_set_fd(<a class="code" href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a>, sock, <a class="code" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a>);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div><div class="ttc" id="http__parser_8h_html_ab6b306ef981f5e21bb41ea2c2dbe8cd9"><div class="ttname"><a href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a></div><div class="ttdeci">flags</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8h_source.html#l00127">http_parser.h:127</a></div></div>
<div class="ttc" id="OptionalTest_8cpp_html_a9c67fe724294816aca4adddf8255fece"><div class="ttname"><a href="OptionalTest_8cpp.html#a9c67fe724294816aca4adddf8255fece">b</a></div><div class="ttdeci">char b</div><div class="ttdef"><b>Definition:</b> <a href="OptionalTest_8cpp_source.html#l00053">OptionalTest.cpp:53</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a5b95b96a5a185bb8cae1a4d28e0a6249"><div class="ttname"><a href="namespacefolly_1_1netops.html#a5b95b96a5a185bb8cae1a4d28e0a6249">folly::netops::socket</a></div><div class="ttdeci">NetworkSocket socket(int af, int type, int protocol)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00412">NetOps.cpp:412</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2575ebf4597ac4c8a0c716589ce13beb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::ssl::OpenSSLUtils::setCustomBioReadMethod </td>
          <td>(</td>
          <td class="paramtype">BIO_METHOD *&#160;</td>
          <td class="paramname"><em>bioMeth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(BIO *, char *, int)&#160;</td>
          <td class="paramname"><em>meth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00250">250</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>References <a class="el" href="OpenSSL_8cpp_source.html#l00136">folly::portability::ssl::BIO_meth_set_read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                   {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  ret = (<a class="code" href="namespacefolly_1_1portability_1_1ssl.html#a196535e8f10fad4ecaf996faff107c4c">BIO_meth_set_read</a>(bioMeth, meth) == 1);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_a196535e8f10fad4ecaf996faff107c4c"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#a196535e8f10fad4ecaf996faff107c4c">folly::portability::ssl::BIO_meth_set_read</a></div><div class="ttdeci">int BIO_meth_set_read(BIO_METHOD *biom, int(*read)(BIO *, char *, int))</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00136">OpenSSL.cpp:136</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a55c843b31793128dde118a25ac1620c4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::ssl::OpenSSLUtils::setCustomBioWriteMethod </td>
          <td>(</td>
          <td class="paramtype">BIO_METHOD *&#160;</td>
          <td class="paramname"><em>bioMeth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(BIO *, const char *, int)&#160;</td>
          <td class="paramname"><em>meth</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00258">258</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>References <a class="el" href="OpenSSL_8cpp_source.html#l00141">folly::portability::ssl::BIO_meth_set_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                         {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  ret = (<a class="code" href="namespacefolly_1_1portability_1_1ssl.html#a3cedb7eb020f73dcf16342c6e13ce482">BIO_meth_set_write</a>(bioMeth, meth) == 1);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_a3cedb7eb020f73dcf16342c6e13ce482"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#a3cedb7eb020f73dcf16342c6e13ce482">folly::portability::ssl::BIO_meth_set_write</a></div><div class="ttdeci">int BIO_meth_set_write(BIO_METHOD *biom, int(*write)(BIO *, const char *, int))</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00141">OpenSSL.cpp:141</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5b84002d2b4d36ad86aa8af78d14f1eb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::ssl::OpenSSLUtils::setSSLInitialCtx </td>
          <td>(</td>
          <td class="paramtype">SSL *&#160;</td>
          <td class="paramname"><em>ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set the 'initial_ctx' SSL_CTX* inside an SSL. The initial_ctx is used to point to the SSL_CTX on which servername callback and session callbacks, as well as session caching stats are set. If we want to enforce SSL_CTX thread-based ownership (e.g., thread-local SSL_CTX) in the application, we need to also set/reset the initial_ctx when we call SSL_set_SSL_CTX.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ssl</td><td>SSL pointer </td></tr>
    <tr><td class="paramname">ctx</td><td>SSL_CTX pointer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Cipher name, or empty if the code is not found </dd></dl>

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00202">202</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>Referenced by <a class="el" href="AsyncSSLSocket_8cpp_source.html#l00461">folly::AsyncSSLSocket::sslAccept()</a>.</p>
<div class="fragment"><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                                          {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  (void)ssl;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  (void)ctx;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="preprocessor">#if !FOLLY_OPENSSL_IS_110 &amp;&amp; !defined(OPENSSL_NO_TLSEXT)</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  <span class="keywordflow">if</span> (ssl) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">if</span> (ctx) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      SSL_CTX_up_ref(ctx);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    ssl-&gt;initial_ctx = ctx;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad45cd3afe8363b2c9d64736cfa961cd6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::ssl::OpenSSLUtils::validatePeerCertNames </td>
          <td>(</td>
          <td class="paramtype">X509 *&#160;</td>
          <td class="paramname"><em>cert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const sockaddr *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">socklen_t&#160;</td>
          <td class="paramname"><em>addrLen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Validate that the peer certificate's common name or subject alt names match what we expect. Currently this only checks for IPs within subject alt names but it could easily be expanded to check common name and hostnames as well.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cert</td><td>X509* peer certificate </td></tr>
    <tr><td class="paramname">addr</td><td>sockaddr object containing sockaddr to verify </td></tr>
    <tr><td class="paramname">addrLen</td><td>length of sockaddr as returned by getpeername or accept </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true iff a subject altname IP matches addr </dd></dl>

<p>Definition at line <a class="el" href="OpenSSLUtils_8cpp_source.html#l00098">98</a> of file <a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a>.</p>

<p>References <a class="el" href="GlobalThreadPoolList_8cpp_source.html#l00061">addr</a>, <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc">folly::FATAL</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">i</a>, <a class="el" href="http__parser_8c_source.html#l00437">name</a>, <a class="el" href="ScopeGuard_8h_source.html#l00274">SCOPE_EXIT</a>, <a class="el" href="OpenSSL_8cpp_source.html#l00305">folly::portability::ssl::STACK_OF()</a>, and <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa059e9861e0400dfbe05c98a841f3f96b">folly::WARNING</a>.</p>
<div class="fragment"><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                 {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  <span class="comment">// Try to extract the names within the SAN extension from the certificate</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keyword">auto</span> altNames = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespacefolly_1_1portability_1_1ssl.html#ada7cd671324a6635fcc31e65ab30e7b5">STACK_OF</a>(GENERAL_NAME)*<span class="keyword">&gt;</span>(</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      X509_get_ext_d2i(cert, NID_subject_alt_name, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>));</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <a class="code" href="ScopeGuard_8h.html#a175c354c3e38222bc00ce5df5e6d431d">SCOPE_EXIT</a> {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (altNames != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      sk_GENERAL_NAME_pop_free(altNames, GENERAL_NAME_free);</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  };</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">if</span> (altNames == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    LOG(WARNING) &lt;&lt; <span class="stringliteral">&quot;No subjectAltName provided and we only support ip auth&quot;</span>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="keyword">const</span> sockaddr_in* addr4 = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  <span class="keyword">const</span> sockaddr_in6* addr6 = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a> != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a>-&gt;sa_family == AF_INET) {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      addr4 = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>sockaddr_in*<span class="keyword">&gt;</span>(<a class="code" href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a>);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a>-&gt;sa_family == AF_INET6) {</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      addr6 = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>sockaddr_in6*<span class="keyword">&gt;</span>(<a class="code" href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a>);</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      LOG(FATAL) &lt;&lt; <span class="stringliteral">&quot;Unsupported sockaddr family: &quot;</span> &lt;&lt; <a class="code" href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a>-&gt;sa_family;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; sk_GENERAL_NAME_num(altNames); <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keyword">auto</span> <a class="code" href="http__parser_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = sk_GENERAL_NAME_value(altNames, <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">if</span> ((addr4 != <span class="keyword">nullptr</span> || addr6 != <span class="keyword">nullptr</span>) &amp;&amp; <a class="code" href="http__parser_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>-&gt;type == GEN_IPADD) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="comment">// Extra const-ness for paranoia</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span> rawIpStr = <a class="code" href="http__parser_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>-&gt;d.iPAddress-&gt;data;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="keywordtype">size_t</span> <span class="keyword">const</span> rawIpLen = size_t(<a class="code" href="http__parser_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>-&gt;d.iPAddress-&gt;length);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="keywordflow">if</span> (rawIpLen == 4 &amp;&amp; addr4 != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">if</span> (::memcmp(rawIpStr, &amp;addr4-&gt;sin_addr, rawIpLen) == 0) {</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rawIpLen == 16 &amp;&amp; addr6 != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span> (::memcmp(rawIpStr, &amp;addr6-&gt;sin6_addr, rawIpLen) == 0) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rawIpLen != 4 &amp;&amp; rawIpLen != 16) {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        LOG(WARNING) &lt;&lt; <span class="stringliteral">&quot;Unexpected IP length: &quot;</span> &lt;&lt; rawIpLen;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  LOG(WARNING) &lt;&lt; <span class="stringliteral">&quot;Unable to match client cert against alt name ip&quot;</span>;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;}</div><div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_html_a7e98b8a17c0aad30ba64d47b74e2a6c1"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">gtest_output_test_golden_lin.txt:83</a></div></div>
<div class="ttc" id="namespacefolly_1_1portability_1_1ssl_html_ada7cd671324a6635fcc31e65ab30e7b5"><div class="ttname"><a href="namespacefolly_1_1portability_1_1ssl.html#ada7cd671324a6635fcc31e65ab30e7b5">folly::portability::ssl::STACK_OF</a></div><div class="ttdeci">STACK_OF(X509_OBJECT)*X509_STORE_get0_objects(X509_STORE *store)</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSL_8cpp_source.html#l00305">OpenSSL.cpp:305</a></div></div>
<div class="ttc" id="ScopeGuard_8h_html_a175c354c3e38222bc00ce5df5e6d431d"><div class="ttname"><a href="ScopeGuard_8h.html#a175c354c3e38222bc00ce5df5e6d431d">SCOPE_EXIT</a></div><div class="ttdeci">#define SCOPE_EXIT</div><div class="ttdef"><b>Definition:</b> <a href="ScopeGuard_8h_source.html#l00274">ScopeGuard.h:274</a></div></div>
<div class="ttc" id="http__parser_8c_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="http__parser_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8c_source.html#l00437">http_parser.c:437</a></div></div>
<div class="ttc" id="GlobalThreadPoolList_8cpp_html_ab94a49ce2d97d58d5e22352a39c2345c"><div class="ttname"><a href="GlobalThreadPoolList_8cpp.html#ab94a49ce2d97d58d5e22352a39c2345c">addr</a></div><div class="ttdeci">ThreadPoolListHook * addr</div><div class="ttdef"><b>Definition:</b> <a href="GlobalThreadPoolList_8cpp_source.html#l00061">GlobalThreadPoolList.cpp:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/folly/folly/io/async/ssl/<a class="el" href="OpenSSLUtils_8h_source.html">OpenSSLUtils.h</a></li>
<li>proxygen/folly/folly/io/async/ssl/<a class="el" href="OpenSSLUtils_8cpp_source.html">OpenSSLUtils.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefolly.html">folly</a></li><li class="navelem"><a class="el" href="namespacefolly_1_1ssl.html">ssl</a></li><li class="navelem"><a class="el" href="classfolly_1_1ssl_1_1OpenSSLUtils.html">OpenSSLUtils</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
