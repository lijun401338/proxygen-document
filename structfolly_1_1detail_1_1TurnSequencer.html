<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: folly::detail::TurnSequencer&lt; Atom &gt; Struct Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('structfolly_1_1detail_1_1TurnSequencer.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="structfolly_1_1detail_1_1TurnSequencer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::detail::TurnSequencer&lt; Atom &gt; Struct Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a53c791927a41201bb8c06b77c86c0fd0"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0">TryWaitResult</a> { <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0ad0749aaba8b833466dfcbb0428e4f89c">TryWaitResult::SUCCESS</a>, 
<a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0acd9d1c615f2c97eccf84b5c06708099d">TryWaitResult::PAST</a>, 
<a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0ac5b306a30b21dec5abcb84067152687a">TryWaitResult::TIMEDOUT</a>
 }</td></tr>
<tr class="separator:a53c791927a41201bb8c06b77c86c0fd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a7aeff74dcc6b2ad542970162bf5b35fb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a7aeff74dcc6b2ad542970162bf5b35fb">TurnSequencer</a> (const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> firstTurn=0) noexcept</td></tr>
<tr class="separator:a7aeff74dcc6b2ad542970162bf5b35fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae036862dbb34fb755f8f612b15984473"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#ae036862dbb34fb755f8f612b15984473">isTurn</a> (const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> turn) const noexcept</td></tr>
<tr class="memdesc:ae036862dbb34fb755f8f612b15984473"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true iff a call to waitForTurn(turn, ...) won't block.  <a href="#ae036862dbb34fb755f8f612b15984473">More...</a><br /></td></tr>
<tr class="separator:ae036862dbb34fb755f8f612b15984473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0457f0e3deff194a95cc8b4e3fa31795"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a0457f0e3deff194a95cc8b4e3fa31795">waitForTurn</a> (const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> turn, <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a>&lt; <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> &gt; &amp;spinCutoff, const bool updateSpinCutoff) noexcept</td></tr>
<tr class="separator:a0457f0e3deff194a95cc8b4e3fa31795"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3e37ebddfd2af2d070aea806fad4316"><td class="memTemplParams" colspan="2">template&lt;class Clock  = std::chrono::steady_clock, class Duration  = typename Clock::duration&gt; </td></tr>
<tr class="memitem:af3e37ebddfd2af2d070aea806fad4316"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0">TryWaitResult</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#af3e37ebddfd2af2d070aea806fad4316">tryWaitForTurn</a> (const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> turn, <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a>&lt; <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> &gt; &amp;spinCutoff, const bool updateSpinCutoff, const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; *absTime=<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>) noexcept</td></tr>
<tr class="separator:af3e37ebddfd2af2d070aea806fad4316"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa993be29c3e7de8679346fd794b7b04f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#aa993be29c3e7de8679346fd794b7b04f">completeTurn</a> (const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> turn) noexcept</td></tr>
<tr class="memdesc:aa993be29c3e7de8679346fd794b7b04f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unblocks a thread running waitForTurn(turn + 1)  <a href="#aa993be29c3e7de8679346fd794b7b04f">More...</a><br /></td></tr>
<tr class="separator:aa993be29c3e7de8679346fd794b7b04f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e24dabb0d7b3982b31bdd109467c724"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a0e24dabb0d7b3982b31bdd109467c724">uncompletedTurnLSB</a> () const noexcept</td></tr>
<tr class="separator:a0e24dabb0d7b3982b31bdd109467c724"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a7743c44704cff997681125ae181326ff"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">: uint32_t { <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">kTurnShift</a> = 6, 
<a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2">kWaitersMask</a> = (1 &lt;&lt; kTurnShift) - 1, 
<a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaf1178fc5ef85aff87dfba3a2d6419fd4">kMinSpins</a> = 20, 
<a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa218131ebcd41f692731691298c3d419">kMaxSpins</a> = 2000
 }</td></tr>
<tr class="separator:a7743c44704cff997681125ae181326ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ab9e32cde45a45280f93e507b4a9e386e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#ab9e32cde45a45280f93e507b4a9e386e">futexChannel</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> turn) const noexcept</td></tr>
<tr class="separator:ab9e32cde45a45280f93e507b4a9e386e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af41ac825482fc19e89f68957d6267814"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#af41ac825482fc19e89f68957d6267814">decodeCurrentSturn</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="el" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>) const noexcept</td></tr>
<tr class="separator:af41ac825482fc19e89f68957d6267814"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7a045da83d7b17ceb46685ac46d41c5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#ae7a045da83d7b17ceb46685ac46d41c5">decodeMaxWaitersDelta</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="el" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>) const noexcept</td></tr>
<tr class="separator:ae7a045da83d7b17ceb46685ac46d41c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad67d0353dc7ada6bc020039cf8fdb0f7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#ad67d0353dc7ada6bc020039cf8fdb0f7">encode</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> currentSturn, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> maxWaiterD) const noexcept</td></tr>
<tr class="separator:ad67d0353dc7ada6bc020039cf8fdb0f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a94a147b039de5b57d5a12d9747d3a55d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefolly_1_1detail.html#a119b8d460f481815f833da41cdc33141">Futex</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a></td></tr>
<tr class="separator:a94a147b039de5b57d5a12d9747d3a55d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;template&lt; typename &gt; class Atom&gt;<br />
struct folly::detail::TurnSequencer&lt; Atom &gt;</h3>

<p><a class="el" href="structA.html">A</a> <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">TurnSequencer</a> allows threads to order their execution according to a monotonically increasing (with wraparound) "turn" value. The two operations provided are to wait for turn T, and to move to the next turn. Every thread that is waiting for T must have arrived before that turn is marked completed (for <a class="el" href="classfolly_1_1MPMCQueue.html">MPMCQueue</a> only one thread waits for any particular turn, so this is trivially true).</p>
<p><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">TurnSequencer</a>'s state_ holds 26 bits of the current turn (shifted left by 6), along with a 6 bit saturating value that records the maximum waiter minus the current turn. Wraparound of the turn space is expected and handled. This allows us to atomically adjust the number of outstanding waiters when we perform a FUTEX_WAKE operation. Compare this strategy to sem_t's separate num_waiters field, which isn't decremented until after the waiting thread gets scheduled, during which time more enqueues might have occurred and made pointless FUTEX_WAKE calls.</p>
<p><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">TurnSequencer</a> uses futex() directly. It is optimized for the case that the highest awaited turn is 32 or less higher than the current turn. We use the FUTEX_WAIT_BITSET variant, which lets us embed 32 separate wakeup channels in a single futex. See <a href="http://locklessinc.com/articles/futex_cheat_sheet">http://locklessinc.com/articles/futex_cheat_sheet</a> for a description.</p>
<p>We only need to keep exact track of the delta between the current turn and the maximum waiter for the 32 turns that follow the current one, because waiters at turn t+32 will be awoken at turn t. At that point they can then adjust the delta using the higher base. Since we need to encode waiter deltas of 0 to 32 inclusive, we use 6 bits. We actually store waiter deltas up to 63, since that might reduce the number of CAS operations a tiny bit.</p>
<p>To avoid some futex() calls entirely, <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">TurnSequencer</a> uses an adaptive spin cutoff before waiting. The overheads (and convergence rate) of separately tracking the spin cutoff for each <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">TurnSequencer</a> would be prohibitive, so the actual storage is passed in as a parameter and updated atomically. This also lets the caller use different adaptive cutoffs for different operations (read versus write, for example). To avoid contention, the spin cutoff is only updated when requested by the caller. </p>

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00072">72</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="a7743c44704cff997681125ae181326ff"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum : <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966"></a>kTurnShift&#160;</td><td class="fielddoc">
<p>kTurnShift counts the bits that are stolen to record the delta between the current turn and the maximum waiter. It needs to be big enough to record wait deltas of 0 to 32 inclusive. Waiters more than 32 in the future will be woken up 32*n turns early (since their BITSET will hit) and will adjust the waiter count again. We go a bit beyond and let the waiter count go up to 63, which is free and might save us a few CAS </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2"></a>kWaitersMask&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a7743c44704cff997681125ae181326ffaf1178fc5ef85aff87dfba3a2d6419fd4"></a>kMinSpins&#160;</td><td class="fielddoc">
<p>The minimum spin count that we will adaptively select. </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a7743c44704cff997681125ae181326ffaa218131ebcd41f692731691298c3d419"></a>kMaxSpins&#160;</td><td class="fielddoc">
<p>The maximum spin count that we will adaptively select, and the spin count that will be used when probing to get a new data point for the adaptation </p>
</td></tr>
</table>

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00222">222</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;       : <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">kTurnShift</a> = 6,</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2">kWaitersMask</a> = (1 &lt;&lt; <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">kTurnShift</a>) - 1,</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaf1178fc5ef85aff87dfba3a2d6419fd4">kMinSpins</a> = 20,</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa218131ebcd41f692731691298c3d419">kMaxSpins</a> = 2000,</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  };</div><div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2">folly::detail::TurnSequencer::kWaitersMask</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00231">TurnSequencer.h:231</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffaf1178fc5ef85aff87dfba3a2d6419fd4"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaf1178fc5ef85aff87dfba3a2d6419fd4">folly::detail::TurnSequencer::kMinSpins</a></div><div class="ttdoc">The minimum spin count that we will adaptively select. </div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00234">TurnSequencer.h:234</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">folly::detail::TurnSequencer::kTurnShift</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00230">TurnSequencer.h:230</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffaa218131ebcd41f692731691298c3d419"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa218131ebcd41f692731691298c3d419">folly::detail::TurnSequencer::kMaxSpins</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00239">TurnSequencer.h:239</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a53c791927a41201bb8c06b77c86c0fd0"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0">folly::detail::TurnSequencer::TryWaitResult</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">strong</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a53c791927a41201bb8c06b77c86c0fd0ad0749aaba8b833466dfcbb0428e4f89c"></a>SUCCESS&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a53c791927a41201bb8c06b77c86c0fd0acd9d1c615f2c97eccf84b5c06708099d"></a>PAST&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a53c791927a41201bb8c06b77c86c0fd0ac5b306a30b21dec5abcb84067152687a"></a>TIMEDOUT&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00082">82</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;{ <a class="code" href="ScopeGuardTest_8cpp.html#a54c3d982e7be3c196e8a0907b69ac57ead0749aaba8b833466dfcbb0428e4f89c">SUCCESS</a>, PAST, <a class="code" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a">TIMEDOUT</a> };</div><div class="ttc" id="ScopeGuardTest_8cpp_html_a54c3d982e7be3c196e8a0907b69ac57ead0749aaba8b833466dfcbb0428e4f89c"><div class="ttname"><a href="ScopeGuardTest_8cpp.html#a54c3d982e7be3c196e8a0907b69ac57ead0749aaba8b833466dfcbb0428e4f89c">ErrorBehavior::SUCCESS</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a"><div class="ttname"><a href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a">folly::detail::FutexResult::TIMEDOUT</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a7aeff74dcc6b2ad542970162bf5b35fb"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::<a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">TurnSequencer</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>firstTurn</em> = <code>0</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00073">73</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      : <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a>(<a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#ad67d0353dc7ada6bc020039cf8fdb0f7">encode</a>(firstTurn &lt;&lt; <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">kTurnShift</a>, 0)) {}</div><div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_ad67d0353dc7ada6bc020039cf8fdb0f7"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#ad67d0353dc7ada6bc020039cf8fdb0f7">folly::detail::TurnSequencer::encode</a></div><div class="ttdeci">uint32_t encode(uint32_t currentSturn, uint32_t maxWaiterD) const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00260">TurnSequencer.h:260</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a94a147b039de5b57d5a12d9747d3a55d"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">folly::detail::TurnSequencer::state_</a></div><div class="ttdeci">Futex&lt; Atom &gt; state_</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00244">TurnSequencer.h:244</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">folly::detail::TurnSequencer::kTurnShift</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00230">TurnSequencer.h:230</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="aa993be29c3e7de8679346fd794b7b04f"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::completeTurn </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>turn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unblocks a thread running waitForTurn(turn + 1) </p>

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00195">195</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>

<p>Referenced by <a class="el" href="MPMCQueue_8h_source.html#l01494">folly::detail::SingleElementQueue&lt; T, Atom &gt;::dequeueImpl()</a>, and <a class="el" href="MPMCQueue_8h_source.html#l01467">folly::detail::SingleElementQueue&lt; T, Atom &gt;::enqueueImpl()</a>.</p>
<div class="fragment"><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                                  {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a> = <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a>.load(std::memory_order_acquire);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      DCHECK(state == <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#ad67d0353dc7ada6bc020039cf8fdb0f7">encode</a>(turn &lt;&lt; <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">kTurnShift</a>, <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#ae7a045da83d7b17ceb46685ac46d41c5">decodeMaxWaitersDelta</a>(state)));</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> max_waiter_delta = <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#ae7a045da83d7b17ceb46685ac46d41c5">decodeMaxWaitersDelta</a>(state);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> new_state = <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#ad67d0353dc7ada6bc020039cf8fdb0f7">encode</a>(</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;          (turn + 1) &lt;&lt; <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">kTurnShift</a>,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;          max_waiter_delta == 0 ? 0 : max_waiter_delta - 1);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a>.compare_exchange_strong(state, new_state)) {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">if</span> (max_waiter_delta != 0) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;          <a class="code" href="namespacefolly_1_1detail.html#aeba3f67ff8fb877e9e460b417afdf82f">detail::futexWake</a>(</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;              &amp;<a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a>, <a class="code" href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">std::numeric_limits&lt;int&gt;::max</a>(), <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#ab9e32cde45a45280f93e507b4a9e386e">futexChannel</a>(turn + 1));</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="comment">// failing compare_exchange_strong updates first arg to the value</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="comment">// that caused the failure, so no need to reread state_</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  }</div><div class="ttc" id="LogLevel_8cpp_html_a15c8b90f03cae068a6979f32590642e2"><div class="ttname"><a href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">max</a></div><div class="ttdeci">LogLevel max</div><div class="ttdef"><b>Definition:</b> <a href="LogLevel_8cpp_source.html#l00031">LogLevel.cpp:31</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_ad67d0353dc7ada6bc020039cf8fdb0f7"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#ad67d0353dc7ada6bc020039cf8fdb0f7">folly::detail::TurnSequencer::encode</a></div><div class="ttdeci">uint32_t encode(uint32_t currentSturn, uint32_t maxWaiterD) const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00260">TurnSequencer.h:260</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a94a147b039de5b57d5a12d9747d3a55d"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">folly::detail::TurnSequencer::state_</a></div><div class="ttdeci">Futex&lt; Atom &gt; state_</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00244">TurnSequencer.h:244</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_ab9e32cde45a45280f93e507b4a9e386e"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#ab9e32cde45a45280f93e507b4a9e386e">folly::detail::TurnSequencer::futexChannel</a></div><div class="ttdeci">uint32_t futexChannel(uint32_t turn) const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00248">TurnSequencer.h:248</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">folly::detail::TurnSequencer::kTurnShift</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00230">TurnSequencer.h:230</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_ae7a045da83d7b17ceb46685ac46d41c5"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#ae7a045da83d7b17ceb46685ac46d41c5">folly::detail::TurnSequencer::decodeMaxWaitersDelta</a></div><div class="ttdeci">uint32_t decodeMaxWaitersDelta(uint32_t state) const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00256">TurnSequencer.h:256</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="http__parser_8c_html_adc6e5733fc3c22f0a7b2914188c49c90"><div class="ttname"><a href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a></div><div class="ttdeci">state</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8c_source.html#l00272">http_parser.c:272</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_aeba3f67ff8fb877e9e460b417afdf82f"><div class="ttname"><a href="namespacefolly_1_1detail.html#aeba3f67ff8fb877e9e460b417afdf82f">folly::detail::futexWake</a></div><div class="ttdeci">int futexWake(const Futex *futex, int count, uint32_t wakeMask)</div><div class="ttdef"><b>Definition:</b> <a href="Futex-inl_8h_source.html#l00107">Futex-inl.h:107</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af41ac825482fc19e89f68957d6267814"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::decodeCurrentSturn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00252">252</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>

<p>Referenced by <a class="el" href="TurnSequencer_8h_source.html#l00077">folly::detail::TurnSequencer&lt; std::atomic &gt;::isTurn()</a>, and <a class="el" href="TurnSequencer_8h_source.html#l00109">folly::detail::TurnSequencer&lt; std::atomic &gt;::tryWaitForTurn()</a>.</p>
<div class="fragment"><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                                             {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a> &amp; ~<a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2">kWaitersMask</a>;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  }</div><div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2">folly::detail::TurnSequencer::kWaitersMask</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00231">TurnSequencer.h:231</a></div></div>
<div class="ttc" id="http__parser_8c_html_adc6e5733fc3c22f0a7b2914188c49c90"><div class="ttname"><a href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a></div><div class="ttdeci">state</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8c_source.html#l00272">http_parser.c:272</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae7a045da83d7b17ceb46685ac46d41c5"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::decodeMaxWaitersDelta </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00256">256</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>

<p>Referenced by <a class="el" href="TurnSequencer_8h_source.html#l00195">folly::detail::TurnSequencer&lt; std::atomic &gt;::completeTurn()</a>, and <a class="el" href="TurnSequencer_8h_source.html#l00109">folly::detail::TurnSequencer&lt; std::atomic &gt;::tryWaitForTurn()</a>.</p>
<div class="fragment"><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                                                {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a> &amp; <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2">kWaitersMask</a>;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  }</div><div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2">folly::detail::TurnSequencer::kWaitersMask</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00231">TurnSequencer.h:231</a></div></div>
<div class="ttc" id="http__parser_8c_html_adc6e5733fc3c22f0a7b2914188c49c90"><div class="ttname"><a href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a></div><div class="ttdeci">state</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8c_source.html#l00272">http_parser.c:272</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad67d0353dc7ada6bc020039cf8fdb0f7"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::encode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>currentSturn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>maxWaiterD</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00260">260</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>

<p>Referenced by <a class="el" href="TurnSequencer_8h_source.html#l00195">folly::detail::TurnSequencer&lt; std::atomic &gt;::completeTurn()</a>, and <a class="el" href="TurnSequencer_8h_source.html#l00109">folly::detail::TurnSequencer&lt; std::atomic &gt;::tryWaitForTurn()</a>.</p>
<div class="fragment"><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                                                             {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">return</span> currentSturn | <a class="code" href="LogLevel_8cpp.html#a7361901234703a521a82885405734c53">std::min</a>(<a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>{<a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2">kWaitersMask</a>}, maxWaiterD);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  }</div><div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffa69d974737b823fb6bf11a379fad9c6d2">folly::detail::TurnSequencer::kWaitersMask</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00231">TurnSequencer.h:231</a></div></div>
<div class="ttc" id="LogLevel_8cpp_html_a7361901234703a521a82885405734c53"><div class="ttname"><a href="LogLevel_8cpp.html#a7361901234703a521a82885405734c53">min</a></div><div class="ttdeci">LogLevel min</div><div class="ttdef"><b>Definition:</b> <a href="LogLevel_8cpp_source.html#l00030">LogLevel.cpp:30</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab9e32cde45a45280f93e507b4a9e386e"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::futexChannel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>turn</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the bitmask to pass futexWait or futexWake when communicating about the specified turn </p>

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00248">248</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>

<p>Referenced by <a class="el" href="TurnSequencer_8h_source.html#l00195">folly::detail::TurnSequencer&lt; std::atomic &gt;::completeTurn()</a>, and <a class="el" href="TurnSequencer_8h_source.html#l00109">folly::detail::TurnSequencer&lt; std::atomic &gt;::tryWaitForTurn()</a>.</p>
<div class="fragment"><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                                      {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">return</span> 1u &lt;&lt; (turn &amp; 31);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae036862dbb34fb755f8f612b15984473"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::isTurn </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>turn</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns true iff a call to waitForTurn(turn, ...) won't block. </p>

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00077">77</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                                                  {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keyword">auto</span> <a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a> = <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a>.load(std::memory_order_acquire);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#af41ac825482fc19e89f68957d6267814">decodeCurrentSturn</a>(<a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>) == (turn &lt;&lt; <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">kTurnShift</a>);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  }</div><div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_af41ac825482fc19e89f68957d6267814"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#af41ac825482fc19e89f68957d6267814">folly::detail::TurnSequencer::decodeCurrentSturn</a></div><div class="ttdeci">uint32_t decodeCurrentSturn(uint32_t state) const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00252">TurnSequencer.h:252</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a94a147b039de5b57d5a12d9747d3a55d"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">folly::detail::TurnSequencer::state_</a></div><div class="ttdeci">Futex&lt; Atom &gt; state_</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00244">TurnSequencer.h:244</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">folly::detail::TurnSequencer::kTurnShift</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00230">TurnSequencer.h:230</a></div></div>
<div class="ttc" id="http__parser_8c_html_adc6e5733fc3c22f0a7b2914188c49c90"><div class="ttname"><a href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a></div><div class="ttdeci">state</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8c_source.html#l00272">http_parser.c:272</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af3e37ebddfd2af2d070aea806fad4316"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<div class="memtemplate">
template&lt;class Clock  = std::chrono::steady_clock, class Duration  = typename Clock::duration&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0">TryWaitResult</a> <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::tryWaitForTurn </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>turn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a>&lt; <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>spinCutoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>updateSpinCutoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::chrono::time_point&lt; Clock, <a class="el" href="namespacefolly.html#ad1989ff61ba788d22aa07cb22f8c5c49">Duration</a> &gt; *&#160;</td>
          <td class="paramname"><em>absTime</em> = <code><a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Blocks the current thread until turn has arrived. If updateSpinCutoff is true then this will spin for up to kMaxSpins tries before blocking and will adjust spinCutoff based on the results, otherwise it will spin for at most spinCutoff spins. Returns SUCCESS if the wait succeeded, PAST if the turn is in the past or TIMEDOUT if the absTime time value is not nullptr and is reached before the turn arrives </p>

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00109">109</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>

<p>Referenced by <a class="el" href="TurnSequencer_8h_source.html#l00086">folly::detail::TurnSequencer&lt; std::atomic &gt;::waitForTurn()</a>.</p>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                            {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> prevThresh = spinCutoff.load(std::memory_order_relaxed);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keyword">const</span> <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> effectiveSpinCutoff =</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        updateSpinCutoff || prevThresh == 0 ? <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa218131ebcd41f692731691298c3d419">kMaxSpins</a> : prevThresh;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> tries;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keyword">const</span> <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> sturn = turn &lt;&lt; <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">kTurnShift</a>;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">for</span> (tries = 0;; ++tries) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a> = <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a>.load(std::memory_order_acquire);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> current_sturn = <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#af41ac825482fc19e89f68957d6267814">decodeCurrentSturn</a>(state);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keywordflow">if</span> (current_sturn == sturn) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="comment">// wrap-safe version of (current_sturn &gt;= sturn)</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      <span class="keywordflow">if</span> (sturn - current_sturn &gt;= <a class="code" href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">std::numeric_limits&lt;uint32_t&gt;::max</a>() / 2) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="comment">// turn is in the past</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0acd9d1c615f2c97eccf84b5c06708099d">TryWaitResult::PAST</a>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="comment">// the first effectSpinCutoff tries are spins, after that we will</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="comment">// record ourself as a waiter and block with futexWait</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      <span class="keywordflow">if</span> (tries &lt; effectiveSpinCutoff) {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <a class="code" href="namespacefolly.html#aaf13bc11e412f3e0899525ee0eef1443">asm_volatile_pause</a>();</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> current_max_waiter_delta = <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#ae7a045da83d7b17ceb46685ac46d41c5">decodeMaxWaitersDelta</a>(state);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> our_waiter_delta = (sturn - current_sturn) &gt;&gt; kTurnShift;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> new_state;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="keywordflow">if</span> (our_waiter_delta &lt;= current_max_waiter_delta) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// state already records us as waiters, probably because this</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment">// isn&#39;t our first time around this loop</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        new_state = <a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        new_state = <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#ad67d0353dc7ada6bc020039cf8fdb0f7">encode</a>(current_sturn, our_waiter_delta);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">if</span> (state != new_state &amp;&amp;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            !<a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a>.compare_exchange_strong(state, new_state)) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;          <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordflow">if</span> (absTime) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keyword">auto</span> futexResult = <a class="code" href="namespacefolly_1_1detail.html#a019c6366943c531ff2c486b93e13fb2a">detail::futexWaitUntil</a>(</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            &amp;<a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a>, new_state, *absTime, <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#ab9e32cde45a45280f93e507b4a9e386e">futexChannel</a>(turn));</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">if</span> (futexResult == <a class="code" href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a">FutexResult::TIMEDOUT</a>) {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0ac5b306a30b21dec5abcb84067152687a">TryWaitResult::TIMEDOUT</a>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <a class="code" href="namespacefolly_1_1detail.html#ac38f887dc2a632a181b751b11ebae575">detail::futexWait</a>(&amp;<a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a>, new_state, <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#ab9e32cde45a45280f93e507b4a9e386e">futexChannel</a>(turn));</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span> (updateSpinCutoff || prevThresh == 0) {</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <span class="comment">// if we hit kMaxSpins then spinning was pointless, so the right</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="comment">// spinCutoff is kMinSpins</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> target;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">if</span> (tries &gt;= <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa218131ebcd41f692731691298c3d419">kMaxSpins</a>) {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        target = <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaf1178fc5ef85aff87dfba3a2d6419fd4">kMinSpins</a>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="comment">// to account for variations, we allow ourself to spin 2*N when</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment">// we think that N is actually required in order to succeed</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        target = std::min&lt;uint32_t&gt;(</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa218131ebcd41f692731691298c3d419">kMaxSpins</a>, std::max&lt;uint32_t&gt;(<a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaf1178fc5ef85aff87dfba3a2d6419fd4">kMinSpins</a>, tries * 2));</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">if</span> (prevThresh == 0) {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">// bootstrap</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        spinCutoff.store(target);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment">// try once, keep moving if CAS fails.  Exponential moving average</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="comment">// with alpha of 7/8</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="comment">// Be careful that the quantity we add to prevThresh is signed.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        spinCutoff.compare_exchange_weak(</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            prevThresh, prevThresh + <span class="keywordtype">int</span>(target - prevThresh) / 8);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    }</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0ad0749aaba8b833466dfcbb0428e4f89c">TryWaitResult::SUCCESS</a>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  }</div><div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_af41ac825482fc19e89f68957d6267814"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#af41ac825482fc19e89f68957d6267814">folly::detail::TurnSequencer::decodeCurrentSturn</a></div><div class="ttdeci">uint32_t decodeCurrentSturn(uint32_t state) const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00252">TurnSequencer.h:252</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a53c791927a41201bb8c06b77c86c0fd0ac5b306a30b21dec5abcb84067152687a"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0ac5b306a30b21dec5abcb84067152687a">folly::detail::TurnSequencer::TryWaitResult::TIMEDOUT</a></div></div>
<div class="ttc" id="LogLevel_8cpp_html_a15c8b90f03cae068a6979f32590642e2"><div class="ttname"><a href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">max</a></div><div class="ttdeci">LogLevel max</div><div class="ttdef"><b>Definition:</b> <a href="LogLevel_8cpp_source.html#l00031">LogLevel.cpp:31</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_ad67d0353dc7ada6bc020039cf8fdb0f7"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#ad67d0353dc7ada6bc020039cf8fdb0f7">folly::detail::TurnSequencer::encode</a></div><div class="ttdeci">uint32_t encode(uint32_t currentSturn, uint32_t maxWaiterD) const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00260">TurnSequencer.h:260</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a94a147b039de5b57d5a12d9747d3a55d"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">folly::detail::TurnSequencer::state_</a></div><div class="ttdeci">Futex&lt; Atom &gt; state_</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00244">TurnSequencer.h:244</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffaf1178fc5ef85aff87dfba3a2d6419fd4"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaf1178fc5ef85aff87dfba3a2d6419fd4">folly::detail::TurnSequencer::kMinSpins</a></div><div class="ttdoc">The minimum spin count that we will adaptively select. </div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00234">TurnSequencer.h:234</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_ac38f887dc2a632a181b751b11ebae575"><div class="ttname"><a href="namespacefolly_1_1detail.html#ac38f887dc2a632a181b751b11ebae575">folly::detail::futexWait</a></div><div class="ttdeci">FutexResult futexWait(const Futex *futex, uint32_t expected, uint32_t waitMask)</div><div class="ttdef"><b>Definition:</b> <a href="Futex-inl_8h_source.html#l00100">Futex-inl.h:100</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_a019c6366943c531ff2c486b93e13fb2a"><div class="ttname"><a href="namespacefolly_1_1detail.html#a019c6366943c531ff2c486b93e13fb2a">folly::detail::futexWaitUntil</a></div><div class="ttdeci">FutexResult futexWaitUntil(const Futex *futex, uint32_t expected, std::chrono::time_point&lt; Clock, Duration &gt; const &amp;deadline, uint32_t waitMask)</div><div class="ttdef"><b>Definition:</b> <a href="Futex-inl_8h_source.html#l00112">Futex-inl.h:112</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_ab9e32cde45a45280f93e507b4a9e386e"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#ab9e32cde45a45280f93e507b4a9e386e">folly::detail::TurnSequencer::futexChannel</a></div><div class="ttdeci">uint32_t futexChannel(uint32_t turn) const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00248">TurnSequencer.h:248</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">folly::detail::TurnSequencer::kTurnShift</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00230">TurnSequencer.h:230</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_ae7a045da83d7b17ceb46685ac46d41c5"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#ae7a045da83d7b17ceb46685ac46d41c5">folly::detail::TurnSequencer::decodeMaxWaitersDelta</a></div><div class="ttdeci">uint32_t decodeMaxWaitersDelta(uint32_t state) const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00256">TurnSequencer.h:256</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a53c791927a41201bb8c06b77c86c0fd0acd9d1c615f2c97eccf84b5c06708099d"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0acd9d1c615f2c97eccf84b5c06708099d">folly::detail::TurnSequencer::TryWaitResult::PAST</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a53c791927a41201bb8c06b77c86c0fd0ad0749aaba8b833466dfcbb0428e4f89c"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0ad0749aaba8b833466dfcbb0428e4f89c">folly::detail::TurnSequencer::TryWaitResult::SUCCESS</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffaa218131ebcd41f692731691298c3d419"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa218131ebcd41f692731691298c3d419">folly::detail::TurnSequencer::kMaxSpins</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00239">TurnSequencer.h:239</a></div></div>
<div class="ttc" id="http__parser_8c_html_adc6e5733fc3c22f0a7b2914188c49c90"><div class="ttname"><a href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a></div><div class="ttdeci">state</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8c_source.html#l00272">http_parser.c:272</a></div></div>
<div class="ttc" id="namespacefolly_1_1detail_html_af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a"><div class="ttname"><a href="namespacefolly_1_1detail.html#af130844a971c4ed26a0658a3e79f273cac5b306a30b21dec5abcb84067152687a">folly::detail::FutexResult::TIMEDOUT</a></div></div>
<div class="ttc" id="namespacefolly_html_aaf13bc11e412f3e0899525ee0eef1443"><div class="ttname"><a href="namespacefolly.html#aaf13bc11e412f3e0899525ee0eef1443">folly::asm_volatile_pause</a></div><div class="ttdeci">void asm_volatile_pause()</div><div class="ttdef"><b>Definition:</b> <a href="Asm_8h_source.html#l00037">Asm.h:37</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0e24dabb0d7b3982b31bdd109467c724"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::uncompletedTurnLSB </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the least-most significant byte of the current uncompleted turn. The full 32 bit turn cannot be recovered. </p>

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00217">217</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                                              {</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>(<a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">state_</a>.load(std::memory_order_acquire) &gt;&gt; <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">kTurnShift</a>);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div><div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a94a147b039de5b57d5a12d9747d3a55d"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a94a147b039de5b57d5a12d9747d3a55d">folly::detail::TurnSequencer::state_</a></div><div class="ttdeci">Futex&lt; Atom &gt; state_</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00244">TurnSequencer.h:244</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00178">ConstexprMathBenchmark.cpp:178</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a7743c44704cff997681125ae181326ffaa88f3dcde7c4a4f6284c6573a0763966">folly::detail::TurnSequencer::kTurnShift</a></div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00230">TurnSequencer.h:230</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0457f0e3deff194a95cc8b4e3fa31795"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::waitForTurn </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>turn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a>&lt; <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>spinCutoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>updateSpinCutoff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>See tryWaitForTurn Requires that <code>turn</code> is not a turn in the past. </p>

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00086">86</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>

<p>Referenced by <a class="el" href="MPMCQueue_8h_source.html#l01494">folly::detail::SingleElementQueue&lt; T, Atom &gt;::dequeueImpl()</a>, and <a class="el" href="MPMCQueue_8h_source.html#l01467">folly::detail::SingleElementQueue&lt; T, Atom &gt;::enqueueImpl()</a>.</p>
<div class="fragment"><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                                            {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> ret = <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#af3e37ebddfd2af2d070aea806fad4316">tryWaitForTurn</a>(turn, spinCutoff, updateSpinCutoff);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    DCHECK(ret == <a class="code" href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0ad0749aaba8b833466dfcbb0428e4f89c">TryWaitResult::SUCCESS</a>);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  }</div><div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_af3e37ebddfd2af2d070aea806fad4316"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#af3e37ebddfd2af2d070aea806fad4316">folly::detail::TurnSequencer::tryWaitForTurn</a></div><div class="ttdeci">TryWaitResult tryWaitForTurn(const uint32_t turn, Atom&lt; uint32_t &gt; &amp;spinCutoff, const bool updateSpinCutoff, const std::chrono::time_point&lt; Clock, Duration &gt; *absTime=nullptr) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="TurnSequencer_8h_source.html#l00109">TurnSequencer.h:109</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1TurnSequencer_html_a53c791927a41201bb8c06b77c86c0fd0ad0749aaba8b833466dfcbb0428e4f89c"><div class="ttname"><a href="structfolly_1_1detail_1_1TurnSequencer.html#a53c791927a41201bb8c06b77c86c0fd0ad0749aaba8b833466dfcbb0428e4f89c">folly::detail::TurnSequencer::TryWaitResult::SUCCESS</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a94a147b039de5b57d5a12d9747d3a55d"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefolly_1_1detail.html#a119b8d460f481815f833da41cdc33141">Futex</a>&lt;<a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a>&gt; <a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">folly::detail::TurnSequencer</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::state_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This holds both the current turn, and the highest waiting turn, stored as (current_turn &lt;&lt; 6) | min(63, max(waited_turn - current_turn)) </p>

<p>Definition at line <a class="el" href="TurnSequencer_8h_source.html#l00244">244</a> of file <a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a>.</p>

<p>Referenced by <a class="el" href="TurnSequencer_8h_source.html#l00195">folly::detail::TurnSequencer&lt; std::atomic &gt;::completeTurn()</a>, <a class="el" href="TurnSequencer_8h_source.html#l00077">folly::detail::TurnSequencer&lt; std::atomic &gt;::isTurn()</a>, <a class="el" href="TurnSequencer_8h_source.html#l00109">folly::detail::TurnSequencer&lt; std::atomic &gt;::tryWaitForTurn()</a>, and <a class="el" href="TurnSequencer_8h_source.html#l00217">folly::detail::TurnSequencer&lt; std::atomic &gt;::uncompletedTurnLSB()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>proxygen/folly/folly/detail/<a class="el" href="TurnSequencer_8h_source.html">TurnSequencer.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefolly.html">folly</a></li><li class="navelem"><a class="el" href="namespacefolly_1_1detail.html">detail</a></li><li class="navelem"><a class="el" href="structfolly_1_1detail_1_1TurnSequencer.html">TurnSequencer</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
