<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: folly::AsyncFileWriter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfolly_1_1AsyncFileWriter.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classfolly_1_1AsyncFileWriter-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::AsyncFileWriter Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for folly::AsyncFileWriter:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classfolly_1_1AsyncFileWriter.png" usemap="#folly::AsyncFileWriter_map" alt=""/>
  <map id="folly::AsyncFileWriter_map" name="folly::AsyncFileWriter_map">
<area href="classfolly_1_1LogWriter.html" alt="folly::LogWriter" shape="rect" coords="0,0,133,24"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AsyncFileWriter_1_1Data.html">Data</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac86b2726c0bdd88e1ce419307ee91391"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#ac86b2726c0bdd88e1ce419307ee91391">AsyncFileWriter</a> (<a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">folly::StringPiece</a> path)</td></tr>
<tr class="separator:ac86b2726c0bdd88e1ce419307ee91391"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a515873f12d17eee4e5e3e91475da8472"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a515873f12d17eee4e5e3e91475da8472">AsyncFileWriter</a> (<a class="el" href="classfolly_1_1File.html">folly::File</a> &amp;&amp;file)</td></tr>
<tr class="separator:a515873f12d17eee4e5e3e91475da8472"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d038c41645c526c885bba01b3c20c80"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a0d038c41645c526c885bba01b3c20c80">~AsyncFileWriter</a> ()</td></tr>
<tr class="separator:a0d038c41645c526c885bba01b3c20c80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee2364cd86c259cb2bc09a31c08d6662"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#aee2364cd86c259cb2bc09a31c08d6662">writeMessage</a> (<a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">folly::StringPiece</a> <a class="el" href="experimental_2test_2BitsBenchmark_8cpp.html#a25bccaee4203f6f142efc1f61e9b66c5">buffer</a>, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="el" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a>=0) override</td></tr>
<tr class="separator:aee2364cd86c259cb2bc09a31c08d6662"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f973c8a81176b4238bc9b39ab122968"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a6f973c8a81176b4238bc9b39ab122968">writeMessage</a> (<a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;&amp;<a class="el" href="experimental_2test_2BitsBenchmark_8cpp.html#a25bccaee4203f6f142efc1f61e9b66c5">buffer</a>, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> <a class="el" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a>=0) override</td></tr>
<tr class="separator:a6f973c8a81176b4238bc9b39ab122968"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f288fb8a40d328593b1397a0880629d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a9f288fb8a40d328593b1397a0880629d">flush</a> () override</td></tr>
<tr class="separator:a9f288fb8a40d328593b1397a0880629d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c8763b4f5d7c76215dfeb523a9bcb42"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a7c8763b4f5d7c76215dfeb523a9bcb42">ttyOutput</a> () const override</td></tr>
<tr class="separator:a7c8763b4f5d7c76215dfeb523a9bcb42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c2f057974bcaabd41fc428207bcdd56"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a2c2f057974bcaabd41fc428207bcdd56">setMaxBufferSize</a> (size_t <a class="el" href="namespacefolly.html#a0606ba855bcb96a1673880aa3b404993">size</a>)</td></tr>
<tr class="separator:a2c2f057974bcaabd41fc428207bcdd56"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a3de357554b8f1b5ca405e02eac5277"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a8a3de357554b8f1b5ca405e02eac5277">getMaxBufferSize</a> () const </td></tr>
<tr class="separator:a8a3de357554b8f1b5ca405e02eac5277"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab826dbcbdf1a3637893224b425a5f75a"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classfolly_1_1File.html">folly::File</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#ab826dbcbdf1a3637893224b425a5f75a">getFile</a> () const </td></tr>
<tr class="separator:ab826dbcbdf1a3637893224b425a5f75a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfolly_1_1LogWriter"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfolly_1_1LogWriter')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfolly_1_1LogWriter.html">folly::LogWriter</a></td></tr>
<tr class="memitem:a2f3a8c662a4200bd57dd9aedff552e9f inherit pub_methods_classfolly_1_1LogWriter"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1LogWriter.html#a2f3a8c662a4200bd57dd9aedff552e9f">~LogWriter</a> ()</td></tr>
<tr class="separator:a2f3a8c662a4200bd57dd9aedff552e9f inherit pub_methods_classfolly_1_1LogWriter"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a019328efde1f033b275502542e2f0480"><td class="memItemLeft" align="right" valign="top">static constexpr size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a019328efde1f033b275502542e2f0480">kDefaultMaxBufferSize</a> = 1024 * 1024</td></tr>
<tr class="separator:a019328efde1f033b275502542e2f0480"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:aa41985aff4be73b33277e0892f34a0bc"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bc">Flags</a> : uint32_t { <br />
&#160;&#160;<a class="el" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58">FLAG_IO_THREAD_STARTED</a> = 0x01, 
<a class="el" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1">FLAG_DESTROYING</a> = 0x02, 
<a class="el" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47">FLAG_STOP</a> = 0x04, 
<a class="el" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940">FLAG_IO_THREAD_STOPPED</a> = 0x08, 
<br />
&#160;&#160;<a class="el" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db">FLAG_IO_THREAD_JOINED</a> = 0x10
<br />
 }</td></tr>
<tr class="separator:aa41985aff4be73b33277e0892f34a0bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:aeee2cd453ce08fc1d58439c288570ab3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#aeee2cd453ce08fc1d58439c288570ab3">ioThread</a> ()</td></tr>
<tr class="separator:aeee2cd453ce08fc1d58439c288570ab3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2ea64ea5a59f488c1cb067f224052b9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#aa2ea64ea5a59f488c1cb067f224052b9">performIO</a> (std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; *ioQueue, size_t numDiscarded)</td></tr>
<tr class="separator:aa2ea64ea5a59f488c1cb067f224052b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc49180d73170c8835f81829c3531575"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#afc49180d73170c8835f81829c3531575">onIoError</a> (const std::exception &amp;ex)</td></tr>
<tr class="separator:afc49180d73170c8835f81829c3531575"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a158f91c8e24819ff14e3d71c38446b04"><td class="memItemLeft" align="right" valign="top"><a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a158f91c8e24819ff14e3d71c38446b04">getNumDiscardedMsg</a> (size_t numDiscarded)</td></tr>
<tr class="separator:a158f91c8e24819ff14e3d71c38446b04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1eed7dd6770bb233e029167942e6e399"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a1eed7dd6770bb233e029167942e6e399">preFork</a> ()</td></tr>
<tr class="separator:a1eed7dd6770bb233e029167942e6e399"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaace3940927db89acf7441865c8483fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#aaace3940927db89acf7441865c8483fc">postForkParent</a> ()</td></tr>
<tr class="separator:aaace3940927db89acf7441865c8483fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe8926d45f8aa5f4d7b19571cb05a8a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#afe8926d45f8aa5f4d7b19571cb05a8a4">postForkChild</a> ()</td></tr>
<tr class="separator:afe8926d45f8aa5f4d7b19571cb05a8a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3596437525ed832ac671088ea4ea213f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a3596437525ed832ac671088ea4ea213f">stopIoThread</a> (<a class="el" href="structfolly_1_1Synchronized.html">folly::Synchronized</a>&lt; <a class="el" href="structfolly_1_1AsyncFileWriter_1_1Data.html">Data</a>, <a class="el" href="OpenSSLThreading_8cpp.html#a1be3f7fa26e4521098de5f1ec0f865f3">std::mutex</a> &gt;::<a class="el" href="classfolly_1_1LockedPtr.html">LockedPtr</a> &amp;<a class="el" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> extraFlags)</td></tr>
<tr class="separator:a3596437525ed832ac671088ea4ea213f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a862ff2812a7a8c3ab9892c2d5203069e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a862ff2812a7a8c3ab9892c2d5203069e">restartThread</a> ()</td></tr>
<tr class="separator:a862ff2812a7a8c3ab9892c2d5203069e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a12ab19630b2e8ba9625df2e15577d14d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1File.html">folly::File</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">file_</a></td></tr>
<tr class="separator:a12ab19630b2e8ba9625df2e15577d14d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a041aab511907b886d37cd4bacc8627e9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfolly_1_1Synchronized.html">folly::Synchronized</a>&lt; <a class="el" href="structfolly_1_1AsyncFileWriter_1_1Data.html">Data</a>, <a class="el" href="OpenSSLThreading_8cpp.html#a1be3f7fa26e4521098de5f1ec0f865f3">std::mutex</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">data_</a></td></tr>
<tr class="separator:a041aab511907b886d37cd4bacc8627e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa8a94c5331d3e44bb7a52ede6061d80"><td class="memItemLeft" align="right" valign="top">std::condition_variable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#afa8a94c5331d3e44bb7a52ede6061d80">messageReady_</a></td></tr>
<tr class="separator:afa8a94c5331d3e44bb7a52ede6061d80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9410e89c4d583308f5ed831d7bb64720"><td class="memItemLeft" align="right" valign="top">std::condition_variable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a9410e89c4d583308f5ed831d7bb64720">ioCV_</a></td></tr>
<tr class="separator:a9410e89c4d583308f5ed831d7bb64720"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a0d2b34769bed5daee731fbbda2a2cf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structfolly_1_1Synchronized.html">folly::Synchronized</a>&lt; <a class="el" href="structfolly_1_1AsyncFileWriter_1_1Data.html">Data</a>, <a class="el" href="OpenSSLThreading_8cpp.html#a1be3f7fa26e4521098de5f1ec0f865f3">std::mutex</a> &gt;::<a class="el" href="classfolly_1_1LockedPtr.html">LockedPtr</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AsyncFileWriter.html#a1a0d2b34769bed5daee731fbbda2a2cf">lockedData_</a></td></tr>
<tr class="separator:a1a0d2b34769bed5daee731fbbda2a2cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_types_classfolly_1_1LogWriter"><td colspan="2" onclick="javascript:toggleInherit('pub_types_classfolly_1_1LogWriter')"><img src="closed.png" alt="-"/>&#160;Public Types inherited from <a class="el" href="classfolly_1_1LogWriter.html">folly::LogWriter</a></td></tr>
<tr class="memitem:aada8a13563d6a8908170724a1e2a73fe inherit pub_types_classfolly_1_1LogWriter"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1LogWriter.html#aada8a13563d6a8908170724a1e2a73fe">Flags</a> : uint32_t { <a class="el" href="classfolly_1_1LogWriter.html#aada8a13563d6a8908170724a1e2a73fea35c8fc37efa51e1b9130abf3b9f704d7">NO_FLAGS</a> = 0x00, 
<a class="el" href="classfolly_1_1LogWriter.html#aada8a13563d6a8908170724a1e2a73feada443dbaaec322e2591d8c8066a9983c">NEVER_DISCARD</a> = 0x01
 }</td></tr>
<tr class="separator:aada8a13563d6a8908170724a1e2a73fe inherit pub_types_classfolly_1_1LogWriter"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="structA.html">A</a> <a class="el" href="classfolly_1_1LogWriter.html">LogWriter</a> implementation that asynchronously writes to a file descriptor.</p>
<p>This class performs the log I/O in a separarate thread.</p>
<p>The advantage of this class over <a class="el" href="classfolly_1_1ImmediateFileWriter.html">ImmediateFileWriter</a> is that logging I/O can never slow down or block your normal program operation. If log messages are generated faster than they can be written, messages will be dropped (and an indication of how many messages were dropped will be written to the log file when we are able to catch up a bit.)</p>
<p>However, one downside is that if your program crashes, not all log messages may have been written, so you may lose messages generated immediately before the crash. </p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8h_source.html#l00044">44</a> of file <a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a>.</p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="aa41985aff4be73b33277e0892f34a0bc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bc">folly::AsyncFileWriter::Flags</a> : <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58"></a>FLAG_IO_THREAD_STARTED&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1"></a>FLAG_DESTROYING&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47"></a>FLAG_STOP&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940"></a>FLAG_IO_THREAD_STOPPED&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db"></a>FLAG_IO_THREAD_JOINED&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="AsyncFileWriter_8h_source.html#l00103">103</a> of file <a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;             : <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// FLAG_IO_THREAD_STARTED indicates that the constructor has started the</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// I/O thread.</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58">FLAG_IO_THREAD_STARTED</a> = 0x01,</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// FLAG_DESTROYING indicates that the destructor is running and destroying</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="comment">// the I/O thread.</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1">FLAG_DESTROYING</a> = 0x02,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// FLAG_STOP indicates that the I/O thread has been asked to stop.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// This is set either by the destructor or by preFork()</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47">FLAG_STOP</a> = 0x04,</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// FLAG_IO_THREAD_STOPPED indicates that the I/O thread is about to return</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// and can now be joined.  ioCV_ will be signalled when this flag is set.</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940">FLAG_IO_THREAD_STOPPED</a> = 0x08,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// FLAG_IO_THREAD_JOINED indicates that the I/O thread has been joined.</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db">FLAG_IO_THREAD_JOINED</a> = 0x10,</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  };</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db">folly::AsyncFileWriter::FLAG_IO_THREAD_JOINED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00117">AsyncFileWriter.h:117</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47">folly::AsyncFileWriter::FLAG_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00112">AsyncFileWriter.h:112</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58">folly::AsyncFileWriter::FLAG_IO_THREAD_STARTED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00106">AsyncFileWriter.h:106</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940">folly::AsyncFileWriter::FLAG_IO_THREAD_STOPPED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00115">AsyncFileWriter.h:115</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1">folly::AsyncFileWriter::FLAG_DESTROYING</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00109">AsyncFileWriter.h:109</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ac86b2726c0bdd88e1ce419307ee91391"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::AsyncFileWriter::AsyncFileWriter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">folly::StringPiece</a>&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Construct an <a class="el" href="classfolly_1_1AsyncFileWriter.html">AsyncFileWriter</a> that appends to the file at the specified path. </p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00031">31</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="Range_8h_source.html#l00591">folly::Range&lt; Iter &gt;::str()</a>.</p>
<div class="fragment"><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    : <a class="code" href="classfolly_1_1AsyncFileWriter.html#ac86b2726c0bdd88e1ce419307ee91391">AsyncFileWriter</a>{<a class="code" href="classfolly_1_1File.html">File</a>{path.<a class="code" href="classfolly_1_1Range.html#a804a40c74d797664d8ee131ae4a4f09b">str</a>(), O_WRONLY | O_APPEND | O_CREAT}} {}</div><div class="ttc" id="classfolly_1_1Range_html_a804a40c74d797664d8ee131ae4a4f09b"><div class="ttname"><a href="classfolly_1_1Range.html#a804a40c74d797664d8ee131ae4a4f09b">folly::Range::str</a></div><div class="ttdeci">std::string str() const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00591">Range.h:591</a></div></div>
<div class="ttc" id="classfolly_1_1File_html"><div class="ttname"><a href="classfolly_1_1File.html">folly::File</a></div><div class="ttdef"><b>Definition:</b> <a href="File_8h_source.html#l00037">File.h:37</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_ac86b2726c0bdd88e1ce419307ee91391"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#ac86b2726c0bdd88e1ce419307ee91391">folly::AsyncFileWriter::AsyncFileWriter</a></div><div class="ttdeci">AsyncFileWriter(folly::StringPiece path)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00031">AsyncFileWriter.cpp:31</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a515873f12d17eee4e5e3e91475da8472"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::AsyncFileWriter::AsyncFileWriter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1File.html">folly::File</a> &amp;&amp;&#160;</td>
          <td class="paramname"><em>file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Construct an <a class="el" href="classfolly_1_1AsyncFileWriter.html">AsyncFileWriter</a> that writes to the specified <a class="el" href="classfolly_1_1File.html">File</a> object. </p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00033">33</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="Access_8h_source.html#l00071">folly::data()</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00158">data_</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00106">FLAG_IO_THREAD_STARTED</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00134">ioThread()</a>, <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00264">postForkChild()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00259">postForkParent()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00237">preFork()</a>, and <a class="el" href="AtFork_8cpp_source.html#l00108">folly::detail::AtFork::registerHandler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;                                                 : <a class="code" href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">file_</a>{<a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(file)} {</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="structfolly_1_1detail_1_1AtFork.html#a77265c9bc07b48d89c97208b439aaf4c">folly::detail::AtFork::registerHandler</a>(</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      <span class="keyword">this</span>,</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      [<span class="keyword">this</span>] { <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncFileWriter.html#a1eed7dd6770bb233e029167942e6e399">preFork</a>(); },</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      [<span class="keyword">this</span>] { <a class="code" href="classfolly_1_1AsyncFileWriter.html#aaace3940927db89acf7441865c8483fc">postForkParent</a>(); },</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      [<span class="keyword">this</span>] { <a class="code" href="classfolly_1_1AsyncFileWriter.html#afe8926d45f8aa5f4d7b19571cb05a8a4">postForkChild</a>(); });</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">// Start the I/O thread after registering the atfork handler.</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="comment">// preFork() may be invoked in another thread as soon as registerHandler()</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="comment">// returns.  It will check FLAG_IO_THREAD_STARTED to see if the I/O thread is</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="comment">// running yet.</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keyword">auto</span> <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a> = <a class="code" href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">data_</a>.lock();</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;flags |= <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58">FLAG_IO_THREAD_STARTED</a>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;ioThread = std::thread([<span class="keyword">this</span>] { <a class="code" href="classfolly_1_1AsyncFileWriter.html#aeee2cd453ce08fc1d58439c288570ab3">ioThread</a>(); });</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  }</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a12ab19630b2e8ba9625df2e15577d14d"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">folly::AsyncFileWriter::file_</a></div><div class="ttdeci">folly::File file_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00156">AsyncFileWriter.h:156</a></div></div>
<div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58">folly::AsyncFileWriter::FLAG_IO_THREAD_STARTED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00106">AsyncFileWriter.h:106</a></div></div>
<div class="ttc" id="namespacefolly_html_a23ca01703d6715fb172f4188faa73dc9"><div class="ttname"><a href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">folly::data</a></div><div class="ttdeci">constexpr auto data(C &amp;c) -&gt; decltype(c.data())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00071">Access.h:71</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a1eed7dd6770bb233e029167942e6e399"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a1eed7dd6770bb233e029167942e6e399">folly::AsyncFileWriter::preFork</a></div><div class="ttdeci">bool preFork()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00237">AsyncFileWriter.cpp:237</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a041aab511907b886d37cd4bacc8627e9"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">folly::AsyncFileWriter::data_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00158">AsyncFileWriter.h:158</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_afe8926d45f8aa5f4d7b19571cb05a8a4"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#afe8926d45f8aa5f4d7b19571cb05a8a4">folly::AsyncFileWriter::postForkChild</a></div><div class="ttdeci">void postForkChild()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00264">AsyncFileWriter.cpp:264</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aaace3940927db89acf7441865c8483fc"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aaace3940927db89acf7441865c8483fc">folly::AsyncFileWriter::postForkParent</a></div><div class="ttdeci">void postForkParent()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00259">AsyncFileWriter.cpp:259</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aeee2cd453ce08fc1d58439c288570ab3"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aeee2cd453ce08fc1d58439c288570ab3">folly::AsyncFileWriter::ioThread</a></div><div class="ttdeci">void ioThread()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00134">AsyncFileWriter.cpp:134</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1AtFork_html_a77265c9bc07b48d89c97208b439aaf4c"><div class="ttname"><a href="structfolly_1_1detail_1_1AtFork.html#a77265c9bc07b48d89c97208b439aaf4c">folly::detail::AtFork::registerHandler</a></div><div class="ttdeci">static void registerHandler(void *object, folly::Function&lt; bool()&gt; prepare, folly::Function&lt; void()&gt; parent, folly::Function&lt; void()&gt; child)</div><div class="ttdef"><b>Definition:</b> <a href="AtFork_8cpp_source.html#l00108">AtFork.cpp:108</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0d038c41645c526c885bba01b3c20c80"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">folly::AsyncFileWriter::~AsyncFileWriter </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00051">51</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="Access_8h_source.html#l00071">folly::data()</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00158">data_</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00109">FLAG_DESTROYING</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00218">onIoError()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00184">performIO()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00274">stopIoThread()</a>, and <a class="el" href="AtFork_8cpp_source.html#l00118">folly::detail::AtFork::unregisterHandler()</a>.</p>
<div class="fragment"><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                  {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  std::vector&lt;std::string&gt;* ioQueue;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordtype">size_t</span> numDiscarded;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  {</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// Stop the I/O thread</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keyword">auto</span> <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a> = <a class="code" href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">data_</a>.lock();</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <a class="code" href="classfolly_1_1AsyncFileWriter.html#a3596437525ed832ac671088ea4ea213f">stopIoThread</a>(<a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>, <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1">FLAG_DESTROYING</a>);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// stopIoThread() causes the I/O thread to stop as soon as possible,</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// without waiting for all pending messages to be written.  Extract any</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// remaining messages to write them below.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    ioQueue = <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;getCurrentQueue();</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    numDiscarded = <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;numDiscarded;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">// Unregister the atfork handler after stopping the I/O thread.</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="comment">// preFork(), postForkParent(), and postForkChild() calls can run</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <span class="comment">// concurrently with the destructor until unregisterHandler() returns.</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <a class="code" href="structfolly_1_1detail_1_1AtFork.html#ab2aaeea8f502335b1af8821b98f9538a">folly::detail::AtFork::unregisterHandler</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="comment">// If there are still any pending messages, flush them now.</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="keywordflow">if</span> (!ioQueue-&gt;empty()) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa2ea64ea5a59f488c1cb067f224052b9">performIO</a>(ioQueue, numDiscarded);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; ex) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <a class="code" href="classfolly_1_1AsyncFileWriter.html#afc49180d73170c8835f81829c3531575">onIoError</a>(ex);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;}</div><div class="ttc" id="namespacefolly_html_a23ca01703d6715fb172f4188faa73dc9"><div class="ttname"><a href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">folly::data</a></div><div class="ttdeci">constexpr auto data(C &amp;c) -&gt; decltype(c.data())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00071">Access.h:71</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a041aab511907b886d37cd4bacc8627e9"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">folly::AsyncFileWriter::data_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00158">AsyncFileWriter.h:158</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_afc49180d73170c8835f81829c3531575"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#afc49180d73170c8835f81829c3531575">folly::AsyncFileWriter::onIoError</a></div><div class="ttdeci">void onIoError(const std::exception &amp;ex)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00218">AsyncFileWriter.cpp:218</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa2ea64ea5a59f488c1cb067f224052b9"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa2ea64ea5a59f488c1cb067f224052b9">folly::AsyncFileWriter::performIO</a></div><div class="ttdeci">void performIO(std::vector&lt; std::string &gt; *ioQueue, size_t numDiscarded)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00184">AsyncFileWriter.cpp:184</a></div></div>
<div class="ttc" id="structfolly_1_1detail_1_1AtFork_html_ab2aaeea8f502335b1af8821b98f9538a"><div class="ttname"><a href="structfolly_1_1detail_1_1AtFork.html#ab2aaeea8f502335b1af8821b98f9538a">folly::detail::AtFork::unregisterHandler</a></div><div class="ttdeci">static void unregisterHandler(void *object)</div><div class="ttdef"><b>Definition:</b> <a href="AtFork_8cpp_source.html#l00118">AtFork.cpp:118</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1">folly::AsyncFileWriter::FLAG_DESTROYING</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00109">AsyncFileWriter.h:109</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a3596437525ed832ac671088ea4ea213f"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a3596437525ed832ac671088ea4ea213f">folly::AsyncFileWriter::stopIoThread</a></div><div class="ttdeci">void stopIoThread(folly::Synchronized&lt; Data, std::mutex &gt;::LockedPtr &amp;data, uint32_t extraFlags)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00274">AsyncFileWriter.cpp:274</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a9f288fb8a40d328593b1397a0880629d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Block until the I/O thread has finished writing all messages that were already enqueued when <a class="el" href="classfolly_1_1AsyncFileWriter.html#a9f288fb8a40d328593b1397a0880629d">flush()</a> was called. </p>

<p>Implements <a class="el" href="classfolly_1_1LogWriter.html#a416ab4b848bb4872ce838a3d79cc2c59">folly::LogWriter</a>.</p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00103">103</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="Access_8h_source.html#l00071">folly::data()</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00158">data_</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00168">ioCV_</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00163">messageReady_</a>, and <a class="el" href="ParallelBenchmark_8cpp_source.html#l00083">start</a>.</p>
<div class="fragment"><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                            {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keyword">auto</span> <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a> = <a class="code" href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">data_</a>.lock();</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keyword">auto</span> <a class="code" href="ParallelBenchmark_8cpp.html#a7f02a749754f40365411f74cf75d08fa">start</a> = <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;ioThreadCounter;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="comment">// Wait until ioThreadCounter increments by at least two.</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <span class="comment">// Waiting for a single increment is not sufficient, as this happens after</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">// the I/O thread has swapped the queues, which is before it has actually</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="comment">// done the I/O.</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordflow">while</span> (<a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;ioThreadCounter &lt; <a class="code" href="ParallelBenchmark_8cpp.html#a7f02a749754f40365411f74cf75d08fa">start</a> + 2) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="comment">// Enqueue an empty string and wake the I/O thread.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="comment">// The empty string ensures that the I/O thread will break out of its wait</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="comment">// loop and increment the ioThreadCounter, even if there is no other work</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="comment">// to do.</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;getCurrentQueue()-&gt;emplace_back();</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="classfolly_1_1AsyncFileWriter.html#afa8a94c5331d3e44bb7a52ede6061d80">messageReady_</a>.notify_one();</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="comment">// Wait for notification from the I/O thread that it has done work.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="classfolly_1_1AsyncFileWriter.html#a9410e89c4d583308f5ed831d7bb64720">ioCV_</a>.wait(<a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>.getUniqueLock());</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_afa8a94c5331d3e44bb7a52ede6061d80"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#afa8a94c5331d3e44bb7a52ede6061d80">folly::AsyncFileWriter::messageReady_</a></div><div class="ttdeci">std::condition_variable messageReady_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00163">AsyncFileWriter.h:163</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a9410e89c4d583308f5ed831d7bb64720"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a9410e89c4d583308f5ed831d7bb64720">folly::AsyncFileWriter::ioCV_</a></div><div class="ttdeci">std::condition_variable ioCV_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00168">AsyncFileWriter.h:168</a></div></div>
<div class="ttc" id="namespacefolly_html_a23ca01703d6715fb172f4188faa73dc9"><div class="ttname"><a href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">folly::data</a></div><div class="ttdeci">constexpr auto data(C &amp;c) -&gt; decltype(c.data())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00071">Access.h:71</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a041aab511907b886d37cd4bacc8627e9"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">folly::AsyncFileWriter::data_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00158">AsyncFileWriter.h:158</a></div></div>
<div class="ttc" id="ParallelBenchmark_8cpp_html_a7f02a749754f40365411f74cf75d08fa"><div class="ttname"><a href="ParallelBenchmark_8cpp.html#a7f02a749754f40365411f74cf75d08fa">start</a></div><div class="ttdeci">auto start</div><div class="ttdef"><b>Definition:</b> <a href="ParallelBenchmark_8cpp_source.html#l00083">ParallelBenchmark.cpp:83</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab826dbcbdf1a3637893224b425a5f75a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classfolly_1_1File.html">folly::File</a>&amp; folly::AsyncFileWriter::getFile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get the output file. </p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8h_source.html#l00098">98</a> of file <a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a>.</p>

<p>References <a class="el" href="AsyncFileWriter_8h_source.html#l00156">file_</a>.</p>
<div class="fragment"><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                                   {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">file_</a>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  }</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a12ab19630b2e8ba9625df2e15577d14d"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">folly::AsyncFileWriter::file_</a></div><div class="ttdeci">folly::File file_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00156">AsyncFileWriter.h:156</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8a3de357554b8f1b5ca405e02eac5277"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t folly::AsyncFileWriter::getMaxBufferSize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get the maximum buffer size for this <a class="el" href="classfolly_1_1AsyncFileWriter.html">AsyncFileWriter</a>, in bytes. </p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00129">129</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="Access_8h_source.html#l00071">folly::data()</a>, and <a class="el" href="AsyncFileWriter_8h_source.html#l00158">data_</a>.</p>
<div class="fragment"><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                                               {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keyword">auto</span> <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a> = <a class="code" href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">data_</a>.lock();</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;maxBufferBytes;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;}</div><div class="ttc" id="namespacefolly_html_a23ca01703d6715fb172f4188faa73dc9"><div class="ttname"><a href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">folly::data</a></div><div class="ttdeci">constexpr auto data(C &amp;c) -&gt; decltype(c.data())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00071">Access.h:71</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a041aab511907b886d37cd4bacc8627e9"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">folly::AsyncFileWriter::data_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00158">AsyncFileWriter.h:158</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a158f91c8e24819ff14e3d71c38446b04"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> folly::AsyncFileWriter::getNumDiscardedMsg </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>numDiscarded</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00228">228</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8h_source.html#l00137">folly::AsyncFileWriter::Data::getCurrentQueue()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00184">performIO()</a>.</p>
<div class="fragment"><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                                                                 {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="comment">// We may want to make this customizable in the future (e.g., to allow it to</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <span class="comment">// conform to the LogFormatter style being used).</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="comment">// For now just return a simple fixed message.</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  <span class="keywordflow">return</span> folly::to&lt;std::string&gt;(</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      numDiscarded,</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="stringliteral">&quot; log messages discarded: logging faster than we can write\n&quot;</span>);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aeee2cd453ce08fc1d58439c288570ab3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::ioThread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00134">134</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="Access_8h_source.html#l00071">folly::data()</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00158">data_</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00115">FLAG_IO_THREAD_STOPPED</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00112">FLAG_STOP</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00168">ioCV_</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00163">messageReady_</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00218">onIoError()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00184">performIO()</a>, and <a class="el" href="ThreadName_8cpp_source.html#l00109">folly::setThreadName()</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8cpp_source.html#l00033">AsyncFileWriter()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00292">restartThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                               {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <a class="code" href="namespacefolly.html#a2e933f76070b83ef7519c9c2ac8a1117">folly::setThreadName</a>(<span class="stringliteral">&quot;log_writer&quot;</span>);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="comment">// With the lock held, grab a pointer to the current queue, then increment</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// the ioThreadCounter index so that other threads will write into the</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// other queue as we process this one.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    std::vector&lt;std::string&gt;* ioQueue;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordtype">size_t</span> numDiscarded;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <span class="keyword">auto</span> <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a> = <a class="code" href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">data_</a>.lock();</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      ioQueue = <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;getCurrentQueue();</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <span class="keywordflow">while</span> (ioQueue-&gt;empty() &amp;&amp; !(<a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;flags &amp; <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47">FLAG_STOP</a>)) {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">// Wait for a message or one of the above flags to be set.</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <a class="code" href="classfolly_1_1AsyncFileWriter.html#afa8a94c5331d3e44bb7a52ede6061d80">messageReady_</a>.wait(<a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>.getUniqueLock());</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      }</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;flags &amp; <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47">FLAG_STOP</a>) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">// We have been asked to stop.  We exit immediately in this case</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment">// without writing out any pending messages.  If we are stopping due</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="comment">// to a fork() the I/O thread will be restarted after the fork (as</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        <span class="comment">// long as we are not also being destroyed).  If we are stopping due</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment">// to the destructor, any remaining messages will be written out</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="comment">// inside the destructor.</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;flags |= <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940">FLAG_IO_THREAD_STOPPED</a>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>.unlock();</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="classfolly_1_1AsyncFileWriter.html#a9410e89c4d583308f5ed831d7bb64720">ioCV_</a>.notify_all();</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      ++<a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;ioThreadCounter;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      numDiscarded = <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;numDiscarded;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;numDiscarded = 0;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;currentBufferSize = 0;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <a class="code" href="classfolly_1_1AsyncFileWriter.html#a9410e89c4d583308f5ed831d7bb64720">ioCV_</a>.notify_all();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="comment">// Write the log messages now that we have released the lock</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa2ea64ea5a59f488c1cb067f224052b9">performIO</a>(ioQueue, numDiscarded);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; ex) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <a class="code" href="classfolly_1_1AsyncFileWriter.html#afc49180d73170c8835f81829c3531575">onIoError</a>(ex);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">// clear() empties the vector, but the allocated capacity remains so we can</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// just reuse it without having to re-allocate in most cases.</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    ioQueue-&gt;clear();</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_afa8a94c5331d3e44bb7a52ede6061d80"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#afa8a94c5331d3e44bb7a52ede6061d80">folly::AsyncFileWriter::messageReady_</a></div><div class="ttdeci">std::condition_variable messageReady_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00163">AsyncFileWriter.h:163</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47">folly::AsyncFileWriter::FLAG_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00112">AsyncFileWriter.h:112</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a9410e89c4d583308f5ed831d7bb64720"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a9410e89c4d583308f5ed831d7bb64720">folly::AsyncFileWriter::ioCV_</a></div><div class="ttdeci">std::condition_variable ioCV_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00168">AsyncFileWriter.h:168</a></div></div>
<div class="ttc" id="namespacefolly_html_a23ca01703d6715fb172f4188faa73dc9"><div class="ttname"><a href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">folly::data</a></div><div class="ttdeci">constexpr auto data(C &amp;c) -&gt; decltype(c.data())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00071">Access.h:71</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a041aab511907b886d37cd4bacc8627e9"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">folly::AsyncFileWriter::data_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00158">AsyncFileWriter.h:158</a></div></div>
<div class="ttc" id="namespacefolly_html_a2e933f76070b83ef7519c9c2ac8a1117"><div class="ttname"><a href="namespacefolly.html#a2e933f76070b83ef7519c9c2ac8a1117">folly::setThreadName</a></div><div class="ttdeci">bool setThreadName(std::thread::id tid, StringPiece name)</div><div class="ttdef"><b>Definition:</b> <a href="ThreadName_8cpp_source.html#l00109">ThreadName.cpp:109</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_afc49180d73170c8835f81829c3531575"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#afc49180d73170c8835f81829c3531575">folly::AsyncFileWriter::onIoError</a></div><div class="ttdeci">void onIoError(const std::exception &amp;ex)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00218">AsyncFileWriter.cpp:218</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa2ea64ea5a59f488c1cb067f224052b9"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa2ea64ea5a59f488c1cb067f224052b9">folly::AsyncFileWriter::performIO</a></div><div class="ttdeci">void performIO(std::vector&lt; std::string &gt; *ioQueue, size_t numDiscarded)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00184">AsyncFileWriter.cpp:184</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940">folly::AsyncFileWriter::FLAG_IO_THREAD_STOPPED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00115">AsyncFileWriter.h:115</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afc49180d73170c8835f81829c3531575"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::onIoError </td>
          <td>(</td>
          <td class="paramtype">const std::exception &amp;&#160;</td>
          <td class="paramname"><em>ex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00218">218</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="ExceptionString_8h_source.html#l00033">folly::exceptionStr()</a>, <a class="el" href="File_8h_source.html#l00085">folly::File::fd()</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00156">file_</a>, and <a class="el" href="LoggerDB_8h_source.html#l00201">folly::LoggerDB::internalWarning()</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8h_source.html#l00137">folly::AsyncFileWriter::Data::getCurrentQueue()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00134">ioThread()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00051">~AsyncFileWriter()</a>.</p>
<div class="fragment"><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                                      {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <a class="code" href="classfolly_1_1LoggerDB.html#aae945e11fe96e763f6eded47257bb540">LoggerDB::internalWarning</a>(</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      __FILE__,</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      __LINE__,</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="stringliteral">&quot;error writing to log file &quot;</span>,</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <a class="code" href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">file_</a>.<a class="code" href="classfolly_1_1File.html#ad5a7fede63287b920672e5c08899c686">fd</a>(),</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="stringliteral">&quot; in AsyncFileWriter: &quot;</span>,</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <a class="code" href="namespacefolly.html#acb103e15fafef3561273c07f9f9d705d">folly::exceptionStr</a>(ex));</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a12ab19630b2e8ba9625df2e15577d14d"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">folly::AsyncFileWriter::file_</a></div><div class="ttdeci">folly::File file_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00156">AsyncFileWriter.h:156</a></div></div>
<div class="ttc" id="namespacefolly_html_acb103e15fafef3561273c07f9f9d705d"><div class="ttname"><a href="namespacefolly.html#acb103e15fafef3561273c07f9f9d705d">folly::exceptionStr</a></div><div class="ttdeci">fbstring exceptionStr(const std::exception &amp;e)</div><div class="ttdef"><b>Definition:</b> <a href="ExceptionString_8h_source.html#l00033">ExceptionString.h:33</a></div></div>
<div class="ttc" id="classfolly_1_1File_html_ad5a7fede63287b920672e5c08899c686"><div class="ttname"><a href="classfolly_1_1File.html#ad5a7fede63287b920672e5c08899c686">folly::File::fd</a></div><div class="ttdeci">int fd() const </div><div class="ttdef"><b>Definition:</b> <a href="File_8h_source.html#l00085">File.h:85</a></div></div>
<div class="ttc" id="classfolly_1_1LoggerDB_html_aae945e11fe96e763f6eded47257bb540"><div class="ttname"><a href="classfolly_1_1LoggerDB.html#aae945e11fe96e763f6eded47257bb540">folly::LoggerDB::internalWarning</a></div><div class="ttdeci">static void internalWarning(folly::StringPiece file, int lineNumber, Args &amp;&amp;...args) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="LoggerDB_8h_source.html#l00201">LoggerDB.h:201</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa2ea64ea5a59f488c1cb067f224052b9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::performIO </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; *&#160;</td>
          <td class="paramname"><em>ioQueue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>numDiscarded</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00184">184</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="folly_2folly_2Exception_8h_source.html#l00101">folly::checkUnixError()</a>, <a class="el" href="File_8h_source.html#l00085">folly::File::fd()</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00156">file_</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00228">getNumDiscardedMsg()</a>, <a class="el" href="Access_8h_source.html#l00045">folly::size()</a>, <a class="el" href="FileUtil_8cpp_source.html#l00134">folly::writeFull()</a>, and <a class="el" href="FileUtil_8cpp_source.html#l00150">folly::writevFull()</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8h_source.html#l00137">folly::AsyncFileWriter::Data::getCurrentQueue()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00134">ioThread()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00051">~AsyncFileWriter()</a>.</p>
<div class="fragment"><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                         {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">// kNumIovecs controls the maximum number of strings we write at once in a</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">// single writev() call.</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  constexpr <span class="keywordtype">int</span> kNumIovecs = 64;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  std::array&lt;iovec, kNumIovecs&gt; iovecs;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordtype">size_t</span> idx = 0;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordflow">while</span> (idx &lt; ioQueue-&gt;<a class="code" href="namespacefolly.html#a0606ba855bcb96a1673880aa3b404993">size</a>()) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordtype">int</span> numIovecs = 0;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">while</span> (numIovecs &lt; kNumIovecs &amp;&amp; idx &lt; ioQueue-&gt;<a class="code" href="namespacefolly.html#a0606ba855bcb96a1673880aa3b404993">size</a>()) {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; str = (*ioQueue)[idx];</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      iovecs[numIovecs].iov_base = <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(str.data());</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      iovecs[numIovecs].iov_len = str.size();</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      ++numIovecs;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      ++idx;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keyword">auto</span> ret = <a class="code" href="namespacefolly.html#a7fc2ec243aee6076a4fbf218580ad360">folly::writevFull</a>(<a class="code" href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">file_</a>.<a class="code" href="classfolly_1_1File.html#ad5a7fede63287b920672e5c08899c686">fd</a>(), iovecs.data(), numIovecs);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">folly::checkUnixError</a>(ret, <span class="stringliteral">&quot;writeFull() failed&quot;</span>);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keywordflow">if</span> (numDiscarded &gt; 0) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keyword">auto</span> msg = <a class="code" href="classfolly_1_1AsyncFileWriter.html#a158f91c8e24819ff14e3d71c38446b04">getNumDiscardedMsg</a>(numDiscarded);</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">if</span> (!msg.empty()) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keyword">auto</span> ret = <a class="code" href="namespacefolly.html#afea6cb3e4179e6c21748549dd8d5e9da">folly::writeFull</a>(<a class="code" href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">file_</a>.<a class="code" href="classfolly_1_1File.html#ad5a7fede63287b920672e5c08899c686">fd</a>(), msg.data(), msg.size());</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="comment">// We currently ignore errors from writeFull() here.</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="comment">// There&#39;s not much we can really do.</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      (void)ret;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a12ab19630b2e8ba9625df2e15577d14d"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">folly::AsyncFileWriter::file_</a></div><div class="ttdeci">folly::File file_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00156">AsyncFileWriter.h:156</a></div></div>
<div class="ttc" id="namespacefolly_html_a7fc2ec243aee6076a4fbf218580ad360"><div class="ttname"><a href="namespacefolly.html#a7fc2ec243aee6076a4fbf218580ad360">folly::writevFull</a></div><div class="ttdeci">ssize_t writevFull(int fd, iovec *iov, int count)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00150">FileUtil.cpp:150</a></div></div>
<div class="ttc" id="namespacefolly_html_a0606ba855bcb96a1673880aa3b404993"><div class="ttname"><a href="namespacefolly.html#a0606ba855bcb96a1673880aa3b404993">folly::size</a></div><div class="ttdeci">constexpr auto size(C const &amp;c) -&gt; decltype(c.size())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00045">Access.h:45</a></div></div>
<div class="ttc" id="classfolly_1_1File_html_ad5a7fede63287b920672e5c08899c686"><div class="ttname"><a href="classfolly_1_1File.html#ad5a7fede63287b920672e5c08899c686">folly::File::fd</a></div><div class="ttdeci">int fd() const </div><div class="ttdef"><b>Definition:</b> <a href="File_8h_source.html#l00085">File.h:85</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a158f91c8e24819ff14e3d71c38446b04"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a158f91c8e24819ff14e3d71c38446b04">folly::AsyncFileWriter::getNumDiscardedMsg</a></div><div class="ttdeci">std::string getNumDiscardedMsg(size_t numDiscarded)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00228">AsyncFileWriter.cpp:228</a></div></div>
<div class="ttc" id="namespacefolly_html_afea6cb3e4179e6c21748549dd8d5e9da"><div class="ttname"><a href="namespacefolly.html#afea6cb3e4179e6c21748549dd8d5e9da">folly::writeFull</a></div><div class="ttdeci">ssize_t writeFull(int fd, const void *buf, size_t count)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00134">FileUtil.cpp:134</a></div></div>
<div class="ttc" id="namespacefolly_html_af6244d72aa4bdeb215d938ff5f56a6e5"><div class="ttname"><a href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">folly::checkUnixError</a></div><div class="ttdeci">void checkUnixError(ssize_t ret, Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00101">Exception.h:101</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afe8926d45f8aa5f4d7b19571cb05a8a4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::postForkChild </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00264">264</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="AsyncFileWriter_8h_source.html#l00176">lockedData_</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00292">restartThread()</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8cpp_source.html#l00033">AsyncFileWriter()</a>, and <a class="el" href="AsyncFileWriter_8h_source.html#l00137">folly::AsyncFileWriter::Data::getCurrentQueue()</a>.</p>
<div class="fragment"><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                                    {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="comment">// Clear any messages in the queue.  We only want them to be written once,</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="comment">// and we let the parent process handle writing them.</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="classfolly_1_1AsyncFileWriter.html#a1a0d2b34769bed5daee731fbbda2a2cf">lockedData_</a>-&gt;queues[0].clear();</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <a class="code" href="classfolly_1_1AsyncFileWriter.html#a1a0d2b34769bed5daee731fbbda2a2cf">lockedData_</a>-&gt;queues[1].clear();</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// Restart the I/O thread</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="classfolly_1_1AsyncFileWriter.html#a862ff2812a7a8c3ab9892c2d5203069e">restartThread</a>();</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a1a0d2b34769bed5daee731fbbda2a2cf"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a1a0d2b34769bed5daee731fbbda2a2cf">folly::AsyncFileWriter::lockedData_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt;::LockedPtr lockedData_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00176">AsyncFileWriter.h:176</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a862ff2812a7a8c3ab9892c2d5203069e"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a862ff2812a7a8c3ab9892c2d5203069e">folly::AsyncFileWriter::restartThread</a></div><div class="ttdeci">void restartThread()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00292">AsyncFileWriter.cpp:292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaace3940927db89acf7441865c8483fc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::postForkParent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00259">259</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="AsyncFileWriter_8cpp_source.html#l00292">restartThread()</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8cpp_source.html#l00033">AsyncFileWriter()</a>, and <a class="el" href="AsyncFileWriter_8h_source.html#l00137">folly::AsyncFileWriter::Data::getCurrentQueue()</a>.</p>
<div class="fragment"><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                                     {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="comment">// Restart the I/O thread</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <a class="code" href="classfolly_1_1AsyncFileWriter.html#a862ff2812a7a8c3ab9892c2d5203069e">restartThread</a>();</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a862ff2812a7a8c3ab9892c2d5203069e"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a862ff2812a7a8c3ab9892c2d5203069e">folly::AsyncFileWriter::restartThread</a></div><div class="ttdeci">void restartThread()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00292">AsyncFileWriter.cpp:292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1eed7dd6770bb233e029167942e6e399"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncFileWriter::preFork </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00237">237</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="AsyncFileWriter_8h_source.html#l00158">data_</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00106">FLAG_IO_THREAD_STARTED</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00176">lockedData_</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00274">stopIoThread()</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8cpp_source.html#l00033">AsyncFileWriter()</a>, and <a class="el" href="AsyncFileWriter_8h_source.html#l00137">folly::AsyncFileWriter::Data::getCurrentQueue()</a>.</p>
<div class="fragment"><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                              {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="comment">// Stop the I/O thread.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="comment">// It would perhaps be better to not stop the I/O thread in the parent</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="comment">// process.  However, this leaves us in a slightly tricky situation in the</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="comment">// child process where data_-&gt;ioThread has been initialized and does not</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="comment">// really point to a valid thread.  While we could store it in a union and</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  <span class="comment">// replace it without ever calling its destructor, in practice this still has</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">// some tricky corner cases to deal with.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="comment">// Grab the data lock to ensure no other thread is holding it</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="comment">// while we fork.</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <a class="code" href="classfolly_1_1AsyncFileWriter.html#a1a0d2b34769bed5daee731fbbda2a2cf">lockedData_</a> = <a class="code" href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">data_</a>.lock();</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <span class="comment">// If the I/O thread has been started, stop it now</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1AsyncFileWriter.html#a1a0d2b34769bed5daee731fbbda2a2cf">lockedData_</a>-&gt;flags &amp; <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58">FLAG_IO_THREAD_STARTED</a>) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="classfolly_1_1AsyncFileWriter.html#a3596437525ed832ac671088ea4ea213f">stopIoThread</a>(<a class="code" href="classfolly_1_1AsyncFileWriter.html#a1a0d2b34769bed5daee731fbbda2a2cf">lockedData_</a>, 0);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a1a0d2b34769bed5daee731fbbda2a2cf"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a1a0d2b34769bed5daee731fbbda2a2cf">folly::AsyncFileWriter::lockedData_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt;::LockedPtr lockedData_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00176">AsyncFileWriter.h:176</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58">folly::AsyncFileWriter::FLAG_IO_THREAD_STARTED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00106">AsyncFileWriter.h:106</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a041aab511907b886d37cd4bacc8627e9"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">folly::AsyncFileWriter::data_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00158">AsyncFileWriter.h:158</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a3596437525ed832ac671088ea4ea213f"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a3596437525ed832ac671088ea4ea213f">folly::AsyncFileWriter::stopIoThread</a></div><div class="ttdeci">void stopIoThread(folly::Synchronized&lt; Data, std::mutex &gt;::LockedPtr &amp;data, uint32_t extraFlags)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00274">AsyncFileWriter.cpp:274</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a862ff2812a7a8c3ab9892c2d5203069e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::restartThread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00292">292</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="Access_8h_source.html#l00071">folly::data()</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00109">FLAG_DESTROYING</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00117">FLAG_IO_THREAD_JOINED</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00106">FLAG_IO_THREAD_STARTED</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00115">FLAG_IO_THREAD_STOPPED</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00112">FLAG_STOP</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00134">ioThread()</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00176">lockedData_</a>, and <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8h_source.html#l00137">folly::AsyncFileWriter::Data::getCurrentQueue()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00264">postForkChild()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00259">postForkParent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                    {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">// Move lockedData_ into a local member variable so it will be released</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">// when we return.</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <a class="code" href="structfolly_1_1Synchronized.html#a0c066566bebd6270cbaac80e6363684d">folly::Synchronized&lt;Data, std::mutex&gt;::LockedPtr</a> <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a> =</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      <a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(<a class="code" href="classfolly_1_1AsyncFileWriter.html#a1a0d2b34769bed5daee731fbbda2a2cf">lockedData_</a>);</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordflow">if</span> (!(data-&gt;flags &amp; <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58">FLAG_IO_THREAD_STARTED</a>)) {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="comment">// Do not start the I/O thread if the constructor has not finished yet</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="keywordflow">if</span> (data-&gt;flags &amp; <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1">FLAG_DESTROYING</a>) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">// Do not restart the I/O thread if we were being destroyed.</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// If there are more pending messages that need to be flushed the</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">// destructor&#39;s stopIoThread() call will handle flushing the messages in</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">// this case.</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  data-&gt;flags &amp;= ~(<a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47">FLAG_STOP</a> | <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db">FLAG_IO_THREAD_JOINED</a> | <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940">FLAG_IO_THREAD_STOPPED</a>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  data-&gt;ioThread = std::thread([<span class="keyword">this</span>] { <a class="code" href="classfolly_1_1AsyncFileWriter.html#aeee2cd453ce08fc1d58439c288570ab3">ioThread</a>(); });</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a1a0d2b34769bed5daee731fbbda2a2cf"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a1a0d2b34769bed5daee731fbbda2a2cf">folly::AsyncFileWriter::lockedData_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt;::LockedPtr lockedData_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00176">AsyncFileWriter.h:176</a></div></div>
<div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db">folly::AsyncFileWriter::FLAG_IO_THREAD_JOINED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00117">AsyncFileWriter.h:117</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47">folly::AsyncFileWriter::FLAG_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00112">AsyncFileWriter.h:112</a></div></div>
<div class="ttc" id="structfolly_1_1Synchronized_html_a0c066566bebd6270cbaac80e6363684d"><div class="ttname"><a href="structfolly_1_1Synchronized.html#a0c066566bebd6270cbaac80e6363684d">folly::Synchronized::LockedPtr</a></div><div class="ttdeci">typename Base::LockedPtr LockedPtr</div><div class="ttdef"><b>Definition:</b> <a href="Synchronized_8h_source.html#l00453">Synchronized.h:453</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bcadaa9253c9bf54f98562b468531b3ae58">folly::AsyncFileWriter::FLAG_IO_THREAD_STARTED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00106">AsyncFileWriter.h:106</a></div></div>
<div class="ttc" id="namespacefolly_html_a23ca01703d6715fb172f4188faa73dc9"><div class="ttname"><a href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">folly::data</a></div><div class="ttdeci">constexpr auto data(C &amp;c) -&gt; decltype(c.data())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00071">Access.h:71</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940">folly::AsyncFileWriter::FLAG_IO_THREAD_STOPPED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00115">AsyncFileWriter.h:115</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca55ae2f2d3b4b243b9282aec01be4d7a1">folly::AsyncFileWriter::FLAG_DESTROYING</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00109">AsyncFileWriter.h:109</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aeee2cd453ce08fc1d58439c288570ab3"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aeee2cd453ce08fc1d58439c288570ab3">folly::AsyncFileWriter::ioThread</a></div><div class="ttdeci">void ioThread()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00134">AsyncFileWriter.cpp:134</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2c2f057974bcaabd41fc428207bcdd56"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::setMaxBufferSize </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set the maximum buffer size for this <a class="el" href="classfolly_1_1AsyncFileWriter.html">AsyncFileWriter</a>, in bytes.</p>
<p>This controls the upper bound on how much unwritten data will be buffered in memory. If messages are being logged faster than they can be written to output file, new messages will be discarded if they would cause the amount of buffered data to exceed this limit. </p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00124">124</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="Access_8h_source.html#l00071">folly::data()</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00158">data_</a>, and <a class="el" href="Access_8h_source.html#l00045">folly::size()</a>.</p>
<div class="fragment"><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                                  {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keyword">auto</span> <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a> = <a class="code" href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">data_</a>.lock();</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;maxBufferBytes = <a class="code" href="namespacefolly.html#a0606ba855bcb96a1673880aa3b404993">size</a>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div><div class="ttc" id="namespacefolly_html_a0606ba855bcb96a1673880aa3b404993"><div class="ttname"><a href="namespacefolly.html#a0606ba855bcb96a1673880aa3b404993">folly::size</a></div><div class="ttdeci">constexpr auto size(C const &amp;c) -&gt; decltype(c.size())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00045">Access.h:45</a></div></div>
<div class="ttc" id="namespacefolly_html_a23ca01703d6715fb172f4188faa73dc9"><div class="ttname"><a href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">folly::data</a></div><div class="ttdeci">constexpr auto data(C &amp;c) -&gt; decltype(c.data())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00071">Access.h:71</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a041aab511907b886d37cd4bacc8627e9"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">folly::AsyncFileWriter::data_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00158">AsyncFileWriter.h:158</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3596437525ed832ac671088ea4ea213f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::stopIoThread </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfolly_1_1Synchronized.html">folly::Synchronized</a>&lt; <a class="el" href="structfolly_1_1AsyncFileWriter_1_1Data.html">Data</a>, <a class="el" href="OpenSSLThreading_8cpp.html#a1be3f7fa26e4521098de5f1ec0f865f3">std::mutex</a> &gt;::<a class="el" href="classfolly_1_1LockedPtr.html">LockedPtr</a> &amp;&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>extraFlags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00274">274</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="AsyncFileWriter_8h_source.html#l00117">FLAG_IO_THREAD_JOINED</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00115">FLAG_IO_THREAD_STOPPED</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00112">FLAG_STOP</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00168">ioCV_</a>, and <a class="el" href="AsyncFileWriter_8h_source.html#l00163">messageReady_</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8h_source.html#l00137">folly::AsyncFileWriter::Data::getCurrentQueue()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00237">preFork()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00051">~AsyncFileWriter()</a>.</p>
<div class="fragment"><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                         {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  data-&gt;flags |= (<a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47">FLAG_STOP</a> | extraFlags);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="classfolly_1_1AsyncFileWriter.html#afa8a94c5331d3e44bb7a52ede6061d80">messageReady_</a>.notify_one();</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <a class="code" href="classfolly_1_1AsyncFileWriter.html#a9410e89c4d583308f5ed831d7bb64720">ioCV_</a>.wait(data.getUniqueLock(), [&amp;] {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordflow">return</span> bool(data-&gt;flags &amp; <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940">FLAG_IO_THREAD_STOPPED</a>);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  });</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">// Check FLAG_IO_THREAD_JOINED before calling join().</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">// preFork() and the destructor may both run concurrently in separate</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// threads, and only one should try to join the thread.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordflow">if</span> ((data-&gt;flags &amp; <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db">FLAG_IO_THREAD_JOINED</a>) == 0) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    data-&gt;ioThread.join();</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    data-&gt;flags |= <a class="code" href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db">FLAG_IO_THREAD_JOINED</a>;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_afa8a94c5331d3e44bb7a52ede6061d80"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#afa8a94c5331d3e44bb7a52ede6061d80">folly::AsyncFileWriter::messageReady_</a></div><div class="ttdeci">std::condition_variable messageReady_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00163">AsyncFileWriter.h:163</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca9651769a4d63d5747b0d27a6e1cb90db">folly::AsyncFileWriter::FLAG_IO_THREAD_JOINED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00117">AsyncFileWriter.h:117</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca07c7924ffd99e8205b22e20d6ea57b47">folly::AsyncFileWriter::FLAG_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00112">AsyncFileWriter.h:112</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a9410e89c4d583308f5ed831d7bb64720"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a9410e89c4d583308f5ed831d7bb64720">folly::AsyncFileWriter::ioCV_</a></div><div class="ttdeci">std::condition_variable ioCV_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00168">AsyncFileWriter.h:168</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aa41985aff4be73b33277e0892f34a0bca26dab48257b2bebdf22bed3d0fe3a940">folly::AsyncFileWriter::FLAG_IO_THREAD_STOPPED</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00115">AsyncFileWriter.h:115</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7c8763b4f5d7c76215dfeb523a9bcb42"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::AsyncFileWriter::ttyOutput </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns true if the output steam is a tty. </p>

<p>Implements <a class="el" href="classfolly_1_1LogWriter.html#a52341921ee608844ac622e5153d092a2">folly::LogWriter</a>.</p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00081">81</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="File_8h_source.html#l00085">folly::File::fd()</a>, and <a class="el" href="AsyncFileWriter_8h_source.html#l00156">file_</a>.</p>
<div class="fragment"><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                                      {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">return</span> isatty(<a class="code" href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">file_</a>.<a class="code" href="classfolly_1_1File.html#ad5a7fede63287b920672e5c08899c686">fd</a>());</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a12ab19630b2e8ba9625df2e15577d14d"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a12ab19630b2e8ba9625df2e15577d14d">folly::AsyncFileWriter::file_</a></div><div class="ttdeci">folly::File file_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00156">AsyncFileWriter.h:156</a></div></div>
<div class="ttc" id="classfolly_1_1File_html_ad5a7fede63287b920672e5c08899c686"><div class="ttname"><a href="classfolly_1_1File.html#ad5a7fede63287b920672e5c08899c686">folly::File::fd</a></div><div class="ttdeci">int fd() const </div><div class="ttdef"><b>Definition:</b> <a href="File_8h_source.html#l00085">File.h:85</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aee2364cd86c259cb2bc09a31c08d6662"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::writeMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">folly::StringPiece</a>&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>flags</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Write a serialized log message.</p>
<p>The flags parameter is a bitwise-ORed set of Flag values defined above. </p>

<p>Implements <a class="el" href="classfolly_1_1LogWriter.html#a250aabb140c3356062d0921c1572b073">folly::LogWriter</a>.</p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00085">85</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="Range_8h_source.html#l00591">folly::Range&lt; Iter &gt;::str()</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriterTest_8cpp_source.html#l00551">writeThread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                                                                     {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1AsyncFileWriter.html#aee2364cd86c259cb2bc09a31c08d6662">writeMessage</a>(buffer.<a class="code" href="classfolly_1_1Range.html#a804a40c74d797664d8ee131ae4a4f09b">str</a>(), <a class="code" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a>);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncFileWriter_html_aee2364cd86c259cb2bc09a31c08d6662"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#aee2364cd86c259cb2bc09a31c08d6662">folly::AsyncFileWriter::writeMessage</a></div><div class="ttdeci">void writeMessage(folly::StringPiece buffer, uint32_t flags=0) override</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8cpp_source.html#l00085">AsyncFileWriter.cpp:85</a></div></div>
<div class="ttc" id="http__parser_8h_html_ab6b306ef981f5e21bb41ea2c2dbe8cd9"><div class="ttname"><a href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a></div><div class="ttdeci">flags</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8h_source.html#l00127">http_parser.h:127</a></div></div>
<div class="ttc" id="classfolly_1_1Range_html_a804a40c74d797664d8ee131ae4a4f09b"><div class="ttname"><a href="classfolly_1_1Range.html#a804a40c74d797664d8ee131ae4a4f09b">folly::Range::str</a></div><div class="ttdeci">std::string str() const </div><div class="ttdef"><b>Definition:</b> <a href="Range_8h_source.html#l00591">Range.h:591</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6f973c8a81176b4238bc9b39ab122968"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::AsyncFileWriter::writeMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;&amp;&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>flags</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Write a serialized message.</p>
<p>This version of <a class="el" href="classfolly_1_1AsyncFileWriter.html#aee2364cd86c259cb2bc09a31c08d6662">writeMessage()</a> accepts a std::string&amp;&amp;. The default implementation calls the StringPiece version of <a class="el" href="classfolly_1_1AsyncFileWriter.html#aee2364cd86c259cb2bc09a31c08d6662">writeMessage()</a>, but subclasses may override this implementation if desired. </p>

<p>Reimplemented from <a class="el" href="classfolly_1_1LogWriter.html#a7c4d2732c713d0c55922cdebc0c29a78">folly::LogWriter</a>.</p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8cpp_source.html#l00089">89</a> of file <a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a>.</p>

<p>References <a class="el" href="experimental_2test_2BitsBenchmark_8cpp.html#a25bccaee4203f6f142efc1f61e9b66c5">buffer()</a>, <a class="el" href="Access_8h_source.html#l00071">folly::data()</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00158">data_</a>, <a class="el" href="AsyncFileWriter_8h_source.html#l00163">messageReady_</a>, <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>, and <a class="el" href="LogWriter_8h_source.html#l00042">folly::LogWriter::NEVER_DISCARD</a>.</p>
<div class="fragment"><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                                                                     {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="keyword">auto</span> <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a> = <a class="code" href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">data_</a>.lock();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keywordflow">if</span> ((<a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;currentBufferSize &gt;= <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;maxBufferBytes) &amp;&amp;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      !(<a class="code" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a> &amp; <a class="code" href="classfolly_1_1LogWriter.html#aada8a13563d6a8908170724a1e2a73feada443dbaaec322e2591d8c8066a9983c">NEVER_DISCARD</a>)) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    ++<a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;numDiscarded;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;currentBufferSize += <a class="code" href="experimental_2test_2BitsBenchmark_8cpp.html#a25bccaee4203f6f142efc1f61e9b66c5">buffer</a>.size();</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keyword">auto</span>* queue = <a class="code" href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">data</a>-&gt;getCurrentQueue();</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  queue-&gt;emplace_back(<a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(<a class="code" href="experimental_2test_2BitsBenchmark_8cpp.html#a25bccaee4203f6f142efc1f61e9b66c5">buffer</a>));</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <a class="code" href="classfolly_1_1AsyncFileWriter.html#afa8a94c5331d3e44bb7a52ede6061d80">messageReady_</a>.notify_one();</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div><div class="ttc" id="experimental_2test_2BitsBenchmark_8cpp_html_a25bccaee4203f6f142efc1f61e9b66c5"><div class="ttname"><a href="experimental_2test_2BitsBenchmark_8cpp.html#a25bccaee4203f6f142efc1f61e9b66c5">buffer</a></div><div class="ttdeci">std::vector&lt; uint8_t &gt; buffer(kBufferSize+16)</div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_afa8a94c5331d3e44bb7a52ede6061d80"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#afa8a94c5331d3e44bb7a52ede6061d80">folly::AsyncFileWriter::messageReady_</a></div><div class="ttdeci">std::condition_variable messageReady_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00163">AsyncFileWriter.h:163</a></div></div>
<div class="ttc" id="http__parser_8h_html_ab6b306ef981f5e21bb41ea2c2dbe8cd9"><div class="ttname"><a href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a></div><div class="ttdeci">flags</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8h_source.html#l00127">http_parser.h:127</a></div></div>
<div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="namespacefolly_html_a23ca01703d6715fb172f4188faa73dc9"><div class="ttname"><a href="namespacefolly.html#a23ca01703d6715fb172f4188faa73dc9">folly::data</a></div><div class="ttdeci">constexpr auto data(C &amp;c) -&gt; decltype(c.data())</div><div class="ttdef"><b>Definition:</b> <a href="Access_8h_source.html#l00071">Access.h:71</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncFileWriter_html_a041aab511907b886d37cd4bacc8627e9"><div class="ttname"><a href="classfolly_1_1AsyncFileWriter.html#a041aab511907b886d37cd4bacc8627e9">folly::AsyncFileWriter::data_</a></div><div class="ttdeci">folly::Synchronized&lt; Data, std::mutex &gt; data_</div><div class="ttdef"><b>Definition:</b> <a href="AsyncFileWriter_8h_source.html#l00158">AsyncFileWriter.h:158</a></div></div>
<div class="ttc" id="classfolly_1_1LogWriter_html_aada8a13563d6a8908170724a1e2a73feada443dbaaec322e2591d8c8066a9983c"><div class="ttname"><a href="classfolly_1_1LogWriter.html#aada8a13563d6a8908170724a1e2a73feada443dbaaec322e2591d8c8066a9983c">folly::LogWriter::NEVER_DISCARD</a></div><div class="ttdef"><b>Definition:</b> <a href="LogWriter_8h_source.html#l00042">LogWriter.h:42</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a041aab511907b886d37cd4bacc8627e9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1Synchronized.html">folly::Synchronized</a>&lt;<a class="el" href="structfolly_1_1AsyncFileWriter_1_1Data.html">Data</a>, <a class="el" href="OpenSSLThreading_8cpp.html#a1be3f7fa26e4521098de5f1ec0f865f3">std::mutex</a>&gt; folly::AsyncFileWriter::data_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8h_source.html#l00158">158</a> of file <a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8cpp_source.html#l00033">AsyncFileWriter()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00103">flush()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00129">getMaxBufferSize()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00134">ioThread()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00237">preFork()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00124">setMaxBufferSize()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00089">writeMessage()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00051">~AsyncFileWriter()</a>.</p>

</div>
</div>
<a class="anchor" id="a12ab19630b2e8ba9625df2e15577d14d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1File.html">folly::File</a> folly::AsyncFileWriter::file_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="AsyncFileWriter_8h_source.html#l00156">156</a> of file <a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8h_source.html#l00098">getFile()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00218">onIoError()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00184">performIO()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00081">ttyOutput()</a>.</p>

</div>
</div>
<a class="anchor" id="a9410e89c4d583308f5ed831d7bb64720"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::condition_variable folly::AsyncFileWriter::ioCV_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>ioCV_ is signaled by the I/O thread each time it increments the ioThreadCounter (once each time around its loop). </p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8h_source.html#l00168">168</a> of file <a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8cpp_source.html#l00103">flush()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00134">ioThread()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00274">stopIoThread()</a>.</p>

</div>
</div>
<a class="anchor" id="a019328efde1f033b275502542e2f0480"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr size_t folly::AsyncFileWriter::kDefaultMaxBufferSize = 1024 * 1024</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The default maximum buffer size.</p>
<p>The comments for <a class="el" href="classfolly_1_1AsyncFileWriter.html#a2c2f057974bcaabd41fc428207bcdd56">setMaxBufferSize()</a> explain how this parameter is used. </p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8h_source.html#l00051">51</a> of file <a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a>.</p>

<p>Referenced by <a class="el" href="FileHandlerFactoryTest_8cpp_source.html#l00062">TEST()</a>.</p>

</div>
</div>
<a class="anchor" id="a1a0d2b34769bed5daee731fbbda2a2cf"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1Synchronized.html">folly::Synchronized</a>&lt;<a class="el" href="structfolly_1_1AsyncFileWriter_1_1Data.html">Data</a>, <a class="el" href="OpenSSLThreading_8cpp.html#a1be3f7fa26e4521098de5f1ec0f865f3">std::mutex</a>&gt;::<a class="el" href="classfolly_1_1LockedPtr.html">LockedPtr</a> folly::AsyncFileWriter::lockedData_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>lockedData_ exists only to help pass the lock between <a class="el" href="classfolly_1_1AsyncFileWriter.html#a1eed7dd6770bb233e029167942e6e399">preFork()</a> and <a class="el" href="classfolly_1_1AsyncFileWriter.html#aaace3940927db89acf7441865c8483fc">postForkParent()</a>/postForkChild(). We potentially could add some new low-level methods to <a class="el" href="structfolly_1_1Synchronized.html">Synchronized</a> to allow manually locking and unlocking to avoid having to store this object as a member variable. </p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8h_source.html#l00176">176</a> of file <a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8cpp_source.html#l00264">postForkChild()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00237">preFork()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00292">restartThread()</a>.</p>

</div>
</div>
<a class="anchor" id="afa8a94c5331d3e44bb7a52ede6061d80"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::condition_variable folly::AsyncFileWriter::messageReady_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>messageReady_ is signaled by writer threads whenever they add a new message to the current queue. </p>

<p>Definition at line <a class="el" href="AsyncFileWriter_8h_source.html#l00163">163</a> of file <a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a>.</p>

<p>Referenced by <a class="el" href="AsyncFileWriter_8cpp_source.html#l00103">flush()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00134">ioThread()</a>, <a class="el" href="AsyncFileWriter_8cpp_source.html#l00274">stopIoThread()</a>, and <a class="el" href="AsyncFileWriter_8cpp_source.html#l00089">writeMessage()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/folly/folly/logging/<a class="el" href="AsyncFileWriter_8h_source.html">AsyncFileWriter.h</a></li>
<li>proxygen/folly/folly/logging/<a class="el" href="AsyncFileWriter_8cpp_source.html">AsyncFileWriter.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefolly.html">folly</a></li><li class="navelem"><a class="el" href="classfolly_1_1AsyncFileWriter.html">AsyncFileWriter</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
