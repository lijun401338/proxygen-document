<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: folly::AccessSpreader&lt; Atom &gt; Struct Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('structfolly_1_1AccessSpreader.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="structfolly_1_1AccessSpreader-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::AccessSpreader&lt; Atom &gt; Struct Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1AccessSpreader_1_1CpuCache.html">CpuCache</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Caches the current CPU and refreshes the cache every so often.  <a href="classfolly_1_1AccessSpreader_1_1CpuCache.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a26b4d4c8669f2fe759fae9e0a6aab25c"><td class="memTemplParams" colspan="2">template&lt;&gt; </td></tr>
<tr class="memitem:a26b4d4c8669f2fe759fae9e0a6aab25c"><td class="memTemplItemLeft" align="right" valign="top">size_t&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#a26b4d4c8669f2fe759fae9e0a6aab25c">current</a> (size_t numStripes)</td></tr>
<tr class="separator:a26b4d4c8669f2fe759fae9e0a6aab25c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ac608371fb7dd0dfb999e55e50cd52deb"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#ac608371fb7dd0dfb999e55e50cd52deb">current</a> (size_t numStripes)</td></tr>
<tr class="separator:ac608371fb7dd0dfb999e55e50cd52deb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47f2c07084bf7ebea489e6ee9e0e5ad9"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#a47f2c07084bf7ebea489e6ee9e0e5ad9">cachedCurrent</a> (size_t numStripes)</td></tr>
<tr class="memdesc:a47f2c07084bf7ebea489e6ee9e0e5ad9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fallback implementation when thread-local storage isn't available.  <a href="#a47f2c07084bf7ebea489e6ee9e0e5ad9">More...</a><br /></td></tr>
<tr class="separator:a47f2c07084bf7ebea489e6ee9e0e5ad9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:aad2dc7c86171a0e298315785cf020924"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">kMaxCpus</a> = 128
 }</td></tr>
<tr class="separator:aad2dc7c86171a0e298315785cf020924"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48d5848e8940d2e3bd3d43a1cbb4cd51"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#a48d5848e8940d2e3bd3d43a1cbb4cd51">CompactStripe</a></td></tr>
<tr class="separator:a48d5848e8940d2e3bd3d43a1cbb4cd51"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a7ccc926044ed198a8a6242adb4e045ef"><td class="memTemplParams" colspan="2">template&lt;&gt; </td></tr>
<tr class="memitem:a7ccc926044ed198a8a6242adb4e045ef"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#a7ccc926044ed198a8a6242adb4e045ef">pickGetcpuFunc</a> ()</td></tr>
<tr class="separator:a7ccc926044ed198a8a6242adb4e045ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0c38a319c73c12b10822d73d4eb027b"><td class="memTemplParams" colspan="2">template&lt;&gt; </td></tr>
<tr class="memitem:ad0c38a319c73c12b10822d73d4eb027b"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#ad0c38a319c73c12b10822d73d4eb027b">pickGetcpuFunc</a> ()</td></tr>
<tr class="separator:ad0c38a319c73c12b10822d73d4eb027b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a062731a1dac676dbe02ce6540b7ff8cd"><td class="memTemplParams" colspan="2">template&lt;&gt; </td></tr>
<tr class="memitem:a062731a1dac676dbe02ce6540b7ff8cd"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#a062731a1dac676dbe02ce6540b7ff8cd">pickGetcpuFunc</a> ()</td></tr>
<tr class="separator:a062731a1dac676dbe02ce6540b7ff8cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a062731a1dac676dbe02ce6540b7ff8cd"><td class="memTemplParams" colspan="2">template&lt;&gt; </td></tr>
<tr class="memitem:a062731a1dac676dbe02ce6540b7ff8cd"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#a062731a1dac676dbe02ce6540b7ff8cd">pickGetcpuFunc</a> ()</td></tr>
<tr class="separator:a062731a1dac676dbe02ce6540b7ff8cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:adabae05fd0ad9cf8b16fb61f51e7f907"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#adabae05fd0ad9cf8b16fb61f51e7f907">pickGetcpuFunc</a> ()</td></tr>
<tr class="memdesc:adabae05fd0ad9cf8b16fb61f51e7f907"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the best getcpu implementation for Atom.  <a href="#adabae05fd0ad9cf8b16fb61f51e7f907">More...</a><br /></td></tr>
<tr class="separator:adabae05fd0ad9cf8b16fb61f51e7f907"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19e9cf78a97e7389cdc14f5c46f4fa9f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#a19e9cf78a97e7389cdc14f5c46f4fa9f">degenerateGetcpu</a> (unsigned *cpu, unsigned *node, void *)</td></tr>
<tr class="memdesc:a19e9cf78a97e7389cdc14f5c46f4fa9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Always claims to be on CPU zero, node zero.  <a href="#a19e9cf78a97e7389cdc14f5c46f4fa9f">More...</a><br /></td></tr>
<tr class="separator:a19e9cf78a97e7389cdc14f5c46f4fa9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4e3018c2b01df70c2ce9d8a1d9fd06f"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#ae4e3018c2b01df70c2ce9d8a1d9fd06f">initialize</a> ()</td></tr>
<tr class="separator:ae4e3018c2b01df70c2ce9d8a1d9fd06f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a7341f4d3dcc9bda4faf270febda00eb7"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#a7341f4d3dcc9bda4faf270febda00eb7">getcpuFunc</a></td></tr>
<tr class="separator:a7341f4d3dcc9bda4faf270febda00eb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a734f4b864918e36ee26964e697935b62"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="structfolly_1_1AccessSpreader.html#a48d5848e8940d2e3bd3d43a1cbb4cd51">CompactStripe</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#a734f4b864918e36ee26964e697935b62">widthAndCpuToStripe</a> [<a class="el" href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">kMaxCpus</a>+1][<a class="el" href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">kMaxCpus</a>] = {}</td></tr>
<tr class="separator:a734f4b864918e36ee26964e697935b62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05faeaccd92913525e638b815d5220b6"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1AccessSpreader.html#a05faeaccd92913525e638b815d5220b6">initialized</a> = <a class="el" href="structfolly_1_1AccessSpreader.html">AccessSpreader</a>&lt;<a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a>&gt;::<a class="el" href="structfolly_1_1AccessSpreader.html#ae4e3018c2b01df70c2ce9d8a1d9fd06f">initialize</a>()</td></tr>
<tr class="separator:a05faeaccd92913525e638b815d5220b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;template&lt; typename &gt; class Atom = std::atomic&gt;<br />
struct folly::AccessSpreader&lt; Atom &gt;</h3>

<p><a class="el" href="structfolly_1_1AccessSpreader.html">AccessSpreader</a> arranges access to a striped data structure in such a way that concurrently executing threads are likely to be accessing different stripes. It does NOT guarantee uncontended access. Your underlying algorithm must be thread-safe without spreading, this is merely an optimization. AccessSpreader::current(n) is typically much faster than a cache miss (12 nanos on my dev box, tested fast in both 2.6 and 3.2 kernels).</p>
<p>If available (and not using the deterministic testing implementation) <a class="el" href="structfolly_1_1AccessSpreader.html">AccessSpreader</a> uses the getcpu system call via VDSO and the precise locality information retrieved from sysfs by <a class="el" href="structfolly_1_1CacheLocality.html">CacheLocality</a>. This provides optimal anti-sharing at a fraction of the cost of a cache miss.</p>
<p>When there are not as many stripes as processors, we try to optimally place the cache sharing boundaries. This means that if you have 2 stripes and run on a dual-socket system, your 2 stripes will each get all of the cores from a single socket. If you have 16 stripes on a 16 core system plus hyperthreading (32 cpus), each core will get its own stripe and there will be no cache sharing at all.</p>
<p><a class="el" href="structfolly_1_1AccessSpreader.html">AccessSpreader</a> has a fallback mechanism for when __vdso_getcpu can't be loaded, or for use during deterministic testing. Using sched_getcpu or the getcpu syscall would negate the performance advantages of access spreading, so we use a thread-local value and a shared atomic counter to spread access out. On systems lacking both a fast getcpu() and TLS, we hash the thread id to spread accesses.</p>
<p><a class="el" href="structfolly_1_1AccessSpreader.html">AccessSpreader</a> is templated on the template type that is used to implement atomics, as a way to instantiate the underlying heuristics differently for production use and deterministic unit testing. See DeterministicScheduler for more. If you aren't using DeterministicScheduler, you can just use the default template parameter all of the time. </p>

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00228">228</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="a48d5848e8940d2e3bd3d43a1cbb4cd51"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom = std::atomic&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::<a class="el" href="structfolly_1_1AccessSpreader.html#a48d5848e8940d2e3bd3d43a1cbb4cd51">CompactStripe</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00265">265</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="aad2dc7c86171a0e298315785cf020924"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom = std::atomic&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>If there are more cpus than this nothing will crash, but there might be unnecessary sharing </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6"></a>kMaxCpus&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00263">263</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;{ <a class="code" href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">kMaxCpus</a> = 128 };</div><div class="ttc" id="structfolly_1_1AccessSpreader_html_aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">folly::AccessSpreader::kMaxCpus</a></div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00263">CacheLocality.h:263</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a47f2c07084bf7ebea489e6ee9e0e5ad9"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom = std::atomic&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::cachedCurrent </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>numStripes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fallback implementation when thread-local storage isn't available. </p>

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00255">255</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>

<p>Referenced by <a class="el" href="CacheLocalityBenchmark_8cpp_source.html#l00075">BENCHMARK()</a>, and <a class="el" href="CacheLocalityBenchmark_8cpp_source.html#l00063">folly::AccessSpreader&lt; Atom &gt;::current()</a>.</p>
<div class="fragment"><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                                 {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structfolly_1_1AccessSpreader.html#ac608371fb7dd0dfb999e55e50cd52deb">current</a>(numStripes);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  }</div><div class="ttc" id="structfolly_1_1AccessSpreader_html_ac608371fb7dd0dfb999e55e50cd52deb"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#ac608371fb7dd0dfb999e55e50cd52deb">folly::AccessSpreader::current</a></div><div class="ttdeci">static size_t current(size_t numStripes)</div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00231">CacheLocality.h:231</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a26b4d4c8669f2fe759fae9e0a6aab25c"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; CachedCurrentTag &gt;::current </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>numStripes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CacheLocalityBenchmark_8cpp_source.html#l00063">63</a> of file <a class="el" href="CacheLocalityBenchmark_8cpp_source.html">CacheLocalityBenchmark.cpp</a>.</p>

<p>References <a class="el" href="CacheLocality_8h_source.html#l00255">folly::AccessSpreader&lt; Atom &gt;::cachedCurrent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                                                                  {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="structfolly_1_1AccessSpreader.html#a47f2c07084bf7ebea489e6ee9e0e5ad9">AccessSpreader&lt;std::atomic&gt;::cachedCurrent</a>(numStripes);</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div><div class="ttc" id="structfolly_1_1AccessSpreader_html_a47f2c07084bf7ebea489e6ee9e0e5ad9"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#a47f2c07084bf7ebea489e6ee9e0e5ad9">folly::AccessSpreader::cachedCurrent</a></div><div class="ttdeci">static size_t cachedCurrent(size_t numStripes)</div><div class="ttdoc">Fallback implementation when thread-local storage isn&amp;#39;t available. </div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00255">CacheLocality.h:255</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac608371fb7dd0dfb999e55e50cd52deb"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom = std::atomic&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::current </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>numStripes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns the stripe associated with the current CPU. The returned value will be &lt; numStripes. </p>

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00231">231</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>

<p>References <a class="el" href="SynchronizedTest_8cpp_source.html#l00743">current</a>, and <a class="el" href="LogLevel_8cpp_source.html#l00030">min</a>.</p>

<p>Referenced by <a class="el" href="DigestBuilder-defs_8h_source.html#l00074">folly::detail::DigestBuilder&lt; DigestT &gt;::append()</a>, <a class="el" href="CacheLocalityBenchmark_8cpp_source.html#l00068">BENCHMARK()</a>, <a class="el" href="CacheLocalityBenchmark_8cpp_source.html#l00182">contentionAtWidth()</a>, <a class="el" href="CoreCachedSharedPtr_8h_source.html#l00057">folly::CoreCachedSharedPtr&lt; T, kNumSlots &gt;::get()</a>, <a class="el" href="CoreCachedSharedPtr_8h_source.html#l00079">folly::CoreCachedWeakPtr&lt; T, kNumSlots &gt;::get()</a>, <a class="el" href="CoreCachedSharedPtr_8h_source.html#l00132">folly::AtomicCoreCachedSharedPtr&lt; T, kNumSlots &gt;::get()</a>, and <a class="el" href="CacheLocalityTest_8cpp_source.html#l00384">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                           {</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// widthAndCpuToStripe[0] will actually work okay (all zeros), but</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// something&#39;s wrong with the caller</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    assert(numStripes &gt; 0);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordtype">unsigned</span> cpu;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="structfolly_1_1AccessSpreader.html#a7341f4d3dcc9bda4faf270febda00eb7">getcpuFunc</a>(&amp;cpu, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structfolly_1_1AccessSpreader.html#a734f4b864918e36ee26964e697935b62">widthAndCpuToStripe</a>[<a class="code" href="LogLevel_8cpp.html#a7361901234703a521a82885405734c53">std::min</a>(<span class="keywordtype">size_t</span>(<a class="code" href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">kMaxCpus</a>), numStripes)]</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                              [cpu % <a class="code" href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">kMaxCpus</a>];</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  }</div><div class="ttc" id="structfolly_1_1AccessSpreader_html_aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">folly::AccessSpreader::kMaxCpus</a></div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00263">CacheLocality.h:263</a></div></div>
<div class="ttc" id="structfolly_1_1AccessSpreader_html_a734f4b864918e36ee26964e697935b62"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#a734f4b864918e36ee26964e697935b62">folly::AccessSpreader::widthAndCpuToStripe</a></div><div class="ttdeci">static CompactStripe widthAndCpuToStripe[kMaxCpus+1][kMaxCpus]</div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00286">CacheLocality.h:286</a></div></div>
<div class="ttc" id="LogLevel_8cpp_html_a7361901234703a521a82885405734c53"><div class="ttname"><a href="LogLevel_8cpp.html#a7361901234703a521a82885405734c53">min</a></div><div class="ttdeci">LogLevel min</div><div class="ttdef"><b>Definition:</b> <a href="LogLevel_8cpp_source.html#l00030">LogLevel.cpp:30</a></div></div>
<div class="ttc" id="structfolly_1_1AccessSpreader_html_a7341f4d3dcc9bda4faf270febda00eb7"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#a7341f4d3dcc9bda4faf270febda00eb7">folly::AccessSpreader::getcpuFunc</a></div><div class="ttdeci">static Getcpu::Func getcpuFunc</div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00269">CacheLocality.h:269</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a19e9cf78a97e7389cdc14f5c46f4fa9f"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom = std::atomic&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::degenerateGetcpu </td>
          <td>(</td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>cpu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Always claims to be on CPU zero, node zero. </p>

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00321">321</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                                                    {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (cpu != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      *cpu = 0;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    }</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">if</span> (node != <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      *node = 0;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae4e3018c2b01df70c2ce9d8a1d9fd06f"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom = std::atomic&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::initialize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00344">344</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>

<p>References <a class="el" href="ConcurrentHashMapTest_8cpp_source.html#l00301">Atom</a>, and <a class="el" href="LogLevel_8cpp_source.html#l00031">max</a>.</p>
<div class="fragment"><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                           {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="structfolly_1_1AccessSpreader.html#a7341f4d3dcc9bda4faf270febda00eb7">getcpuFunc</a> = <a class="code" href="structfolly_1_1AccessSpreader.html#adabae05fd0ad9cf8b16fb61f51e7f907">pickGetcpuFunc</a>();</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keyword">auto</span>&amp; cacheLocality = CacheLocality::system&lt;Atom&gt;();</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keyword">auto</span> n = cacheLocality.numCpus;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> width = 0; width &lt;= <a class="code" href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">kMaxCpus</a>; ++width) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <span class="keyword">auto</span> numStripes = <a class="code" href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">std::max</a>(<span class="keywordtype">size_t</span>{1}, width);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> cpu = 0; cpu &lt; <a class="code" href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">kMaxCpus</a> &amp;&amp; cpu &lt; n; ++cpu) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="keyword">auto</span> index = cacheLocality.localityIndexByCpu[cpu];</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        assert(index &lt; n);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="comment">// as index goes from 0..n, post-transform value goes from</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="comment">// 0..numStripes</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <a class="code" href="structfolly_1_1AccessSpreader.html#a734f4b864918e36ee26964e697935b62">widthAndCpuToStripe</a>[width][cpu] =</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <a class="code" href="structfolly_1_1AccessSpreader.html#a48d5848e8940d2e3bd3d43a1cbb4cd51">CompactStripe</a>((index * numStripes) / n);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        assert(<a class="code" href="structfolly_1_1AccessSpreader.html#a734f4b864918e36ee26964e697935b62">widthAndCpuToStripe</a>[width][cpu] &lt; numStripes);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> cpu = n; cpu &lt; <a class="code" href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">kMaxCpus</a>; ++cpu) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <a class="code" href="structfolly_1_1AccessSpreader.html#a734f4b864918e36ee26964e697935b62">widthAndCpuToStripe</a>[width][cpu] = <a class="code" href="structfolly_1_1AccessSpreader.html#a734f4b864918e36ee26964e697935b62">widthAndCpuToStripe</a>[width][cpu - n];</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    }</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div><div class="ttc" id="structfolly_1_1AccessSpreader_html_aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#aad2dc7c86171a0e298315785cf020924a8179b79cb9bcaa83cb1ecf61a8c7a5a6">folly::AccessSpreader::kMaxCpus</a></div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00263">CacheLocality.h:263</a></div></div>
<div class="ttc" id="structfolly_1_1AccessSpreader_html_a734f4b864918e36ee26964e697935b62"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#a734f4b864918e36ee26964e697935b62">folly::AccessSpreader::widthAndCpuToStripe</a></div><div class="ttdeci">static CompactStripe widthAndCpuToStripe[kMaxCpus+1][kMaxCpus]</div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00286">CacheLocality.h:286</a></div></div>
<div class="ttc" id="LogLevel_8cpp_html_a15c8b90f03cae068a6979f32590642e2"><div class="ttname"><a href="LogLevel_8cpp.html#a15c8b90f03cae068a6979f32590642e2">max</a></div><div class="ttdeci">LogLevel max</div><div class="ttdef"><b>Definition:</b> <a href="LogLevel_8cpp_source.html#l00031">LogLevel.cpp:31</a></div></div>
<div class="ttc" id="structfolly_1_1AccessSpreader_html_a7341f4d3dcc9bda4faf270febda00eb7"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#a7341f4d3dcc9bda4faf270febda00eb7">folly::AccessSpreader::getcpuFunc</a></div><div class="ttdeci">static Getcpu::Func getcpuFunc</div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00269">CacheLocality.h:269</a></div></div>
<div class="ttc" id="structfolly_1_1AccessSpreader_html_a48d5848e8940d2e3bd3d43a1cbb4cd51"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#a48d5848e8940d2e3bd3d43a1cbb4cd51">folly::AccessSpreader::CompactStripe</a></div><div class="ttdeci">uint8_t CompactStripe</div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00265">CacheLocality.h:265</a></div></div>
<div class="ttc" id="structfolly_1_1AccessSpreader_html_adabae05fd0ad9cf8b16fb61f51e7f907"><div class="ttname"><a href="structfolly_1_1AccessSpreader.html#adabae05fd0ad9cf8b16fb61f51e7f907">folly::AccessSpreader::pickGetcpuFunc</a></div><div class="ttdeci">static Getcpu::Func pickGetcpuFunc()</div><div class="ttdoc">Returns the best getcpu implementation for Atom. </div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00315">CacheLocality.h:315</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7ccc926044ed198a8a6242adb4e045ef"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a> <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; ThreadLocalTag &gt;::pickGetcpuFunc </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CacheLocalityBenchmark_8cpp_source.html#l00050">50</a> of file <a class="el" href="CacheLocalityBenchmark_8cpp_source.html">CacheLocalityBenchmark.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ad0c38a319c73c12b10822d73d4eb027b"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a> <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; PthreadSelfTag &gt;::pickGetcpuFunc </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CacheLocalityBenchmark_8cpp_source.html#l00054">54</a> of file <a class="el" href="CacheLocalityBenchmark_8cpp_source.html">CacheLocalityBenchmark.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adabae05fd0ad9cf8b16fb61f51e7f907"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom = std::atomic&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a> <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::pickGetcpuFunc </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the best getcpu implementation for Atom. </p>

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00315">315</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>

<p>References <a class="el" href="CacheLocality_8h_source.html#l00175">folly::FallbackGetcpu&lt; ThreadId &gt;::getcpu()</a>, and <a class="el" href="CacheLocality_8cpp_source.html#l00208">folly::Getcpu::resolveVdsoFunc()</a>.</p>

<p>Referenced by <a class="el" href="DeterministicSchedule_8h_source.html#l00528">folly::test::DeterministicMutex::unlock()</a>.</p>
<div class="fragment"><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                     {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keyword">auto</span> best = <a class="code" href="structfolly_1_1Getcpu.html#a1c5457978b7b3c23f59e3896764cf009">Getcpu::resolveVdsoFunc</a>();</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">return</span> best ? best : &amp;<a class="code" href="structfolly_1_1FallbackGetcpu.html#abf07bf930e664834a33cdaee557c3842">FallbackGetcpuType::getcpu</a>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  }</div><div class="ttc" id="structfolly_1_1FallbackGetcpu_html_abf07bf930e664834a33cdaee557c3842"><div class="ttname"><a href="structfolly_1_1FallbackGetcpu.html#abf07bf930e664834a33cdaee557c3842">folly::FallbackGetcpu::getcpu</a></div><div class="ttdeci">static int getcpu(unsigned *cpu, unsigned *node, void *)</div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8h_source.html#l00175">CacheLocality.h:175</a></div></div>
<div class="ttc" id="structfolly_1_1Getcpu_html_a1c5457978b7b3c23f59e3896764cf009"><div class="ttname"><a href="structfolly_1_1Getcpu.html#a1c5457978b7b3c23f59e3896764cf009">folly::Getcpu::resolveVdsoFunc</a></div><div class="ttdeci">static Func resolveVdsoFunc()</div><div class="ttdef"><b>Definition:</b> <a href="CacheLocality_8cpp_source.html#l00208">CacheLocality.cpp:208</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a062731a1dac676dbe02ce6540b7ff8cd"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a> <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="namespacefolly_1_1test.html#a36cab8b2e79142d5f56c4ff0d2fc7a23">test::DeterministicAtomic</a> &gt;::pickGetcpuFunc </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="DeterministicSchedule_8cpp_source.html#l00429">429</a> of file <a class="el" href="DeterministicSchedule_8cpp_source.html">DeterministicSchedule.cpp</a>.</p>

<p>References <a class="el" href="DeterministicSchedule_8cpp_source.html#l00161">folly::test::DeterministicSchedule::getcpu()</a>.</p>
<div class="fragment"><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                                                                   {</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <span class="keywordflow">return</span> &amp;<a class="code" href="classfolly_1_1test_1_1DeterministicSchedule.html#a3551dcd34a26400ceab3428b1c5f18a3">test::DeterministicSchedule::getcpu</a>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;}</div><div class="ttc" id="classfolly_1_1test_1_1DeterministicSchedule_html_a3551dcd34a26400ceab3428b1c5f18a3"><div class="ttname"><a href="classfolly_1_1test_1_1DeterministicSchedule.html#a3551dcd34a26400ceab3428b1c5f18a3">folly::test::DeterministicSchedule::getcpu</a></div><div class="ttdeci">static int getcpu(unsigned *cpu, unsigned *node, void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="DeterministicSchedule_8cpp_source.html#l00161">DeterministicSchedule.cpp:161</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a062731a1dac676dbe02ce6540b7ff8cd"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a> <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="namespacefolly_1_1test.html#a36cab8b2e79142d5f56c4ff0d2fc7a23">test::DeterministicAtomic</a> &gt;::pickGetcpuFunc </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a7341f4d3dcc9bda4faf270febda00eb7"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom = std::atomic&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1Getcpu.html#a1f7e90f5a529fbee3b68d96e8385d318">Getcpu::Func</a> <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::getcpuFunc</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=</div><div class="line">    <a class="code" href="structfolly_1_1AccessSpreader.html#a19e9cf78a97e7389cdc14f5c46f4fa9f">AccessSpreader&lt;Atom&gt;::degenerateGetcpu</a></div></div><!-- fragment --><p>Points to the getcpu-like function we are using to obtain the current cpu. It should not be assumed that the returned cpu value is in range. We use a static for this so that we can prearrange a valid value in the pre-constructed state and avoid the need for a conditional on every subsequent invocation (not normally a big win, but 20% on some inner loops here). </p>

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00269">269</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>

<p>Referenced by <a class="el" href="CacheLocality_8h_source.html#l00291">folly::AccessSpreader&lt; Atom &gt;::CpuCache::cpu()</a>.</p>

</div>
</div>
<a class="anchor" id="a05faeaccd92913525e638b815d5220b6"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom = std::atomic&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::initialized = <a class="el" href="structfolly_1_1AccessSpreader.html">AccessSpreader</a>&lt;<a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a>&gt;::<a class="el" href="structfolly_1_1AccessSpreader.html#ae4e3018c2b01df70c2ce9d8a1d9fd06f">initialize</a>()</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00312">312</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>

</div>
</div>
<a class="anchor" id="a734f4b864918e36ee26964e697935b62"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;template&lt; typename &gt; class Atom = std::atomic&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structfolly_1_1AccessSpreader.html">AccessSpreader</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::<a class="el" href="structfolly_1_1AccessSpreader.html#a48d5848e8940d2e3bd3d43a1cbb4cd51">CompactStripe</a> <a class="el" href="structfolly_1_1AccessSpreader.html">folly::AccessSpreader</a>&lt; <a class="el" href="ConcurrentHashMapTest_8cpp.html#a98ac53dd3c18b4046e7c5cb0bcb64b75">Atom</a> &gt;::widthAndCpuToStripe = {}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>For each level of splitting up to kMaxCpus, maps the cpu (mod kMaxCpus) to the stripe. Rather than performing any inequalities or modulo on the actual number of cpus, we just fill in the entire array. </p>

<p>Definition at line <a class="el" href="CacheLocality_8h_source.html#l00286">286</a> of file <a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>proxygen/folly/folly/concurrency/<a class="el" href="CacheLocality_8h_source.html">CacheLocality.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefolly.html">folly</a></li><li class="navelem"><a class="el" href="structfolly_1_1AccessSpreader.html">AccessSpreader</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
