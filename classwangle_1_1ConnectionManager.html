<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: wangle::ConnectionManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classwangle_1_1ConnectionManager.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classwangle_1_1ConnectionManager-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">wangle::ConnectionManager Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for wangle::ConnectionManager:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classwangle_1_1ConnectionManager.png" usemap="#wangle::ConnectionManager_map" alt=""/>
  <map id="wangle::ConnectionManager_map" name="wangle::ConnectionManager_map">
<area href="classfolly_1_1DelayedDestruction.html" alt="folly::DelayedDestruction" shape="rect" coords="0,112,230,136"/>
<area href="classwangle_1_1ManagedConnection_1_1Callback.html" alt="wangle::ManagedConnection::Callback" shape="rect" coords="240,112,470,136"/>
<area href="classfolly_1_1DelayedDestructionBase.html" alt="folly::DelayedDestructionBase" shape="rect" coords="0,56,230,80"/>
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager_1_1Callback.html">Callback</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager_1_1DrainHelper.html">DrainHelper</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a6a562d1f774a7678d9a73bbe70c7cdef"><td class="memItemLeft" align="right" valign="top">typedef std::unique_ptr&lt; <a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a>, <a class="el" href="classfolly_1_1DelayedDestruction_1_1Destructor.html">Destructor</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a6a562d1f774a7678d9a73bbe70c7cdef">UniquePtr</a></td></tr>
<tr class="separator:a6a562d1f774a7678d9a73bbe70c7cdef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a681123264b3430519d7e691b90bd3e74"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="namespacefolly.html#a92871ba6503747f5c7767deaf44cbf66">folly::CountedIntrusiveList</a>&lt; <a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a>,&amp;<a class="el" href="classwangle_1_1ManagedConnection.html#a54fe30e311f8b05c1c07d4363c05214f">ManagedConnection::listHook_</a> &gt;::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a681123264b3430519d7e691b90bd3e74">ConnectionIterator</a></td></tr>
<tr class="separator:a681123264b3430519d7e691b90bd3e74"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8ce47720a1d0ba11f8aeae2d05dd0514"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a8ce47720a1d0ba11f8aeae2d05dd0514">ConnectionManager</a> (<a class="el" href="classfolly_1_1EventBase.html">folly::EventBase</a> *eventBase, std::chrono::milliseconds timeout, <a class="el" href="classwangle_1_1ConnectionManager_1_1Callback.html">Callback</a> *callback=<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>)</td></tr>
<tr class="separator:a8ce47720a1d0ba11f8aeae2d05dd0514"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a986d85c429c832b55f75d548ae63af42"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a986d85c429c832b55f75d548ae63af42">addConnection</a> (<a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a> *connection, bool timeout=false)</td></tr>
<tr class="separator:a986d85c429c832b55f75d548ae63af42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28fef5a57c7c328fdad539f567e00bf9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a28fef5a57c7c328fdad539f567e00bf9">scheduleTimeout</a> (<a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a> *const connection, std::chrono::milliseconds timeout)</td></tr>
<tr class="separator:a28fef5a57c7c328fdad539f567e00bf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab97b8e977d389c40240cddf8eccf3988"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#ab97b8e977d389c40240cddf8eccf3988">scheduleTimeout</a> (<a class="el" href="classfolly_1_1HHWheelTimer_1_1Callback.html">folly::HHWheelTimer::Callback</a> *callback, std::chrono::milliseconds timeout)</td></tr>
<tr class="separator:ab97b8e977d389c40240cddf8eccf3988"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a272f0d1f15108aec51f212fed824d74c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a272f0d1f15108aec51f212fed824d74c">removeConnection</a> (<a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a> *connection)</td></tr>
<tr class="separator:a272f0d1f15108aec51f212fed824d74c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d9d919513552b57d6430935f2b54aad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a3d9d919513552b57d6430935f2b54aad">initiateGracefulShutdown</a> (std::chrono::milliseconds idleGrace)</td></tr>
<tr class="separator:a3d9d919513552b57d6430935f2b54aad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b31962579f2cc080e4c05d8530cfe0c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a7b31962579f2cc080e4c05d8530cfe0c">drainConnections</a> (double pct, std::chrono::milliseconds idleGrace)</td></tr>
<tr class="separator:a7b31962579f2cc080e4c05d8530cfe0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a489de84ff1c406b9532b6d47b0aa4c51"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a489de84ff1c406b9532b6d47b0aa4c51">dropAllConnections</a> ()</td></tr>
<tr class="separator:a489de84ff1c406b9532b6d47b0aa4c51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50a79340e094e2ddcf180f766add5364"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a50a79340e094e2ddcf180f766add5364">dropConnections</a> (double pct)</td></tr>
<tr class="separator:a50a79340e094e2ddcf180f766add5364"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3922e888aac50a29504a1753a7ac127b"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a3922e888aac50a29504a1753a7ac127b">getNumConnections</a> () const </td></tr>
<tr class="separator:a3922e888aac50a29504a1753a7ac127b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2799d2a5bbfdbfce60fa9d51c5e316e"><td class="memTemplParams" colspan="2">template&lt;typename F &gt; </td></tr>
<tr class="memitem:ae2799d2a5bbfdbfce60fa9d51c5e316e"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#ae2799d2a5bbfdbfce60fa9d51c5e316e">iterateConns</a> (F func)</td></tr>
<tr class="separator:ae2799d2a5bbfdbfce60fa9d51c5e316e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac96f20a8cd142b4df99dced93e9796ab"><td class="memItemLeft" align="right" valign="top">std::chrono::milliseconds&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#ac96f20a8cd142b4df99dced93e9796ab">getDefaultTimeout</a> () const </td></tr>
<tr class="separator:ac96f20a8cd142b4df99dced93e9796ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16abdef698128af9e1b75537b6b7e0f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a16abdef698128af9e1b75537b6b7e0f7">setLoweredIdleTimeout</a> (std::chrono::milliseconds timeout)</td></tr>
<tr class="separator:a16abdef698128af9e1b75537b6b7e0f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc0e52edc0e12cb8be5df04ccd199d84"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#afc0e52edc0e12cb8be5df04ccd199d84">dropIdleConnections</a> (size_t num)</td></tr>
<tr class="separator:afc0e52edc0e12cb8be5df04ccd199d84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c6d2dcb319d9de84535ed8f30a5aa8a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a9c6d2dcb319d9de84535ed8f30a5aa8a">onActivated</a> (<a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a> &amp;conn) override</td></tr>
<tr class="separator:a9c6d2dcb319d9de84535ed8f30a5aa8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1f9d364c8f329725cba312afd2000c9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#ab1f9d364c8f329725cba312afd2000c9">onDeactivated</a> (<a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a> &amp;conn) override</td></tr>
<tr class="separator:ab1f9d364c8f329725cba312afd2000c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfolly_1_1DelayedDestruction"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfolly_1_1DelayedDestruction')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfolly_1_1DelayedDestruction.html">folly::DelayedDestruction</a></td></tr>
<tr class="memitem:a6dd27b219d5af8b2a93d6c324c65e95a inherit pub_methods_classfolly_1_1DelayedDestruction"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestruction.html#a6dd27b219d5af8b2a93d6c324c65e95a">destroy</a> ()</td></tr>
<tr class="separator:a6dd27b219d5af8b2a93d6c324c65e95a inherit pub_methods_classfolly_1_1DelayedDestruction"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b64caadd65cdae43185e05eb4beb3fa inherit pub_methods_classfolly_1_1DelayedDestruction"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestruction.html#a2b64caadd65cdae43185e05eb4beb3fa">getDestroyPending</a> () const </td></tr>
<tr class="separator:a2b64caadd65cdae43185e05eb4beb3fa inherit pub_methods_classfolly_1_1DelayedDestruction"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classfolly_1_1DelayedDestructionBase"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classfolly_1_1DelayedDestructionBase')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classfolly_1_1DelayedDestructionBase.html">folly::DelayedDestructionBase</a></td></tr>
<tr class="memitem:a50c17a3675426754e89707ded8566f9f inherit pub_methods_classfolly_1_1DelayedDestructionBase"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestructionBase.html#a50c17a3675426754e89707ded8566f9f">~DelayedDestructionBase</a> ()=default</td></tr>
<tr class="separator:a50c17a3675426754e89707ded8566f9f inherit pub_methods_classfolly_1_1DelayedDestructionBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a8fa72870400b6da9079cf7b66f40187e"><td class="memTemplParams" colspan="2">template&lt;typename... Args&gt; </td></tr>
<tr class="memitem:a8fa72870400b6da9079cf7b66f40187e"><td class="memTemplItemLeft" align="right" valign="top">static <a class="el" href="classwangle_1_1ConnectionManager.html#a6a562d1f774a7678d9a73bbe70c7cdef">UniquePtr</a>&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a8fa72870400b6da9079cf7b66f40187e">makeUnique</a> (Args &amp;&amp;...args)</td></tr>
<tr class="separator:a8fa72870400b6da9079cf7b66f40187e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:af80bfb251153dbac30f78ae2fad6c3d5"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5">ShutdownState</a> : uint8_t { <br />
&#160;&#160;<a class="el" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5ab50339a10e1de285ac99d4c3990b8693">ShutdownState::NONE</a> = 0, 
<a class="el" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5a9de9a24e7ac2a5dee66a628c5d69c146">ShutdownState::NOTIFY_PENDING_SHUTDOWN</a> = 1, 
<a class="el" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5ac046b11bae70a3cd1edf3ce8af784b53">ShutdownState::NOTIFY_PENDING_SHUTDOWN_COMPLETE</a> = 2, 
<a class="el" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5a836a3db587ed17b12161e90d06b6450d">ShutdownState::CLOSE_WHEN_IDLE</a> = 3, 
<br />
&#160;&#160;<a class="el" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5a1b49e15882f26e1c712d294718131681">ShutdownState::CLOSE_WHEN_IDLE_COMPLETE</a> = 4
<br />
 }</td></tr>
<tr class="separator:af80bfb251153dbac30f78ae2fad6c3d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a3c28c39029d51386c91422bc5e0a2ecb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a3c28c39029d51386c91422bc5e0a2ecb">~ConnectionManager</a> () override=default</td></tr>
<tr class="separator:a3c28c39029d51386c91422bc5e0a2ecb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5584f9d1ea99baae7dcf5019c595e8fd"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a5584f9d1ea99baae7dcf5019c595e8fd">ConnectionManager</a> (const <a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a> &amp;)=delete</td></tr>
<tr class="separator:a5584f9d1ea99baae7dcf5019c595e8fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbd2ae54b5b3a67bc5df7a73097471ca"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#afbd2ae54b5b3a67bc5df7a73097471ca">operator=</a> (<a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a> &amp;)=delete</td></tr>
<tr class="separator:afbd2ae54b5b3a67bc5df7a73097471ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ba2253a566a49634d812867c2e59d5b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a4ba2253a566a49634d812867c2e59d5b">drainAllConnections</a> ()</td></tr>
<tr class="separator:a4ba2253a566a49634d812867c2e59d5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29c6020d456fc0a91daaa9c99d6531b5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a29c6020d456fc0a91daaa9c99d6531b5">stopDrainingForShutdown</a> ()</td></tr>
<tr class="separator:a29c6020d456fc0a91daaa9c99d6531b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ca38c705696fd91cdc8440298417763"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a4ca38c705696fd91cdc8440298417763">idleGracefulTimeoutExpired</a> ()</td></tr>
<tr class="separator:a4ca38c705696fd91cdc8440298417763"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classwangle_1_1ManagedConnection_1_1Callback"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classwangle_1_1ManagedConnection_1_1Callback')"><img src="closed.png" alt="-"/>&#160;Private Member Functions inherited from <a class="el" href="classwangle_1_1ManagedConnection_1_1Callback.html">wangle::ManagedConnection::Callback</a></td></tr>
<tr class="memitem:a61572f41014deb9878b9d37bbd1c18fd inherit pub_methods_classwangle_1_1ManagedConnection_1_1Callback"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ManagedConnection_1_1Callback.html#a61572f41014deb9878b9d37bbd1c18fd">~Callback</a> ()=default</td></tr>
<tr class="separator:a61572f41014deb9878b9d37bbd1c18fd inherit pub_methods_classwangle_1_1ManagedConnection_1_1Callback"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:afad97fed27dd88b97a2043d26f55e6e3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacefolly.html#a92871ba6503747f5c7767deaf44cbf66">folly::CountedIntrusiveList</a>&lt; <a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a>,&amp;<a class="el" href="classwangle_1_1ManagedConnection.html#a54fe30e311f8b05c1c07d4363c05214f">ManagedConnection::listHook_</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a></td></tr>
<tr class="separator:afad97fed27dd88b97a2043d26f55e6e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b3089a18654b27e4e71da75f18fc1ba"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classwangle_1_1ConnectionManager_1_1Callback.html">Callback</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">callback_</a></td></tr>
<tr class="separator:a7b3089a18654b27e4e71da75f18fc1ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e62e294c76c47219def3ee815025363"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1EventBase.html">folly::EventBase</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a8e62e294c76c47219def3ee815025363">eventBase_</a></td></tr>
<tr class="separator:a8e62e294c76c47219def3ee815025363"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25552f7d0b1cbbb6ae092dd007624a59"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classwangle_1_1ConnectionManager.html#a681123264b3430519d7e691b90bd3e74">ConnectionIterator</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">drainIterator_</a></td></tr>
<tr class="separator:a25552f7d0b1cbbb6ae092dd007624a59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a966316e3af90f2bbe3586c8c86441a86"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classwangle_1_1ConnectionManager.html#a681123264b3430519d7e691b90bd3e74">ConnectionIterator</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">idleIterator_</a></td></tr>
<tr class="separator:a966316e3af90f2bbe3586c8c86441a86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c4b8ddd3bf266b1579f8a798594b6a3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classwangle_1_1ConnectionManager_1_1DrainHelper.html">DrainHelper</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">drainHelper_</a></td></tr>
<tr class="separator:a4c4b8ddd3bf266b1579f8a798594b6a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaeb98bde257f7bf1c4dc2a1f4205b9ca"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#aaeb98bde257f7bf1c4dc2a1f4205b9ca">notifyPendingShutdown_</a> {true}</td></tr>
<tr class="separator:aaeb98bde257f7bf1c4dc2a1f4205b9ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39515cf7efe2c8039615838e3e014b39"><td class="memItemLeft" align="right" valign="top">std::chrono::milliseconds&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a39515cf7efe2c8039615838e3e014b39">timeout_</a></td></tr>
<tr class="separator:a39515cf7efe2c8039615838e3e014b39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ebd2ff3cbdd3b30b30a3d0e85dc403f"><td class="memItemLeft" align="right" valign="top">std::chrono::milliseconds&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1ConnectionManager.html#a2ebd2ff3cbdd3b30b30a3d0e85dc403f">idleConnEarlyDropThreshold_</a></td></tr>
<tr class="separator:a2ebd2ff3cbdd3b30b30a3d0e85dc403f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pro_methods_classfolly_1_1DelayedDestruction"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_classfolly_1_1DelayedDestruction')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="classfolly_1_1DelayedDestruction.html">folly::DelayedDestruction</a></td></tr>
<tr class="memitem:adc9a58eaf38e0e9afea76101942ae7df inherit pro_methods_classfolly_1_1DelayedDestruction"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestruction.html#adc9a58eaf38e0e9afea76101942ae7df">~DelayedDestruction</a> () override=default</td></tr>
<tr class="separator:adc9a58eaf38e0e9afea76101942ae7df inherit pro_methods_classfolly_1_1DelayedDestruction"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42db04c8a694b8584822371afb67012c inherit pro_methods_classfolly_1_1DelayedDestruction"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestruction.html#a42db04c8a694b8584822371afb67012c">DelayedDestruction</a> ()</td></tr>
<tr class="separator:a42db04c8a694b8584822371afb67012c inherit pro_methods_classfolly_1_1DelayedDestruction"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_methods_classfolly_1_1DelayedDestructionBase"><td colspan="2" onclick="javascript:toggleInherit('pro_methods_classfolly_1_1DelayedDestructionBase')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="classfolly_1_1DelayedDestructionBase.html">folly::DelayedDestructionBase</a></td></tr>
<tr class="memitem:ad0257a1b700f005ee75d45ecf67abf76 inherit pro_methods_classfolly_1_1DelayedDestructionBase"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestructionBase.html#ad0257a1b700f005ee75d45ecf67abf76">DelayedDestructionBase</a> ()</td></tr>
<tr class="separator:ad0257a1b700f005ee75d45ecf67abf76 inherit pro_methods_classfolly_1_1DelayedDestructionBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31591f967cbdb0b071bff2880de37cb0 inherit pro_methods_classfolly_1_1DelayedDestructionBase"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1DelayedDestructionBase.html#a31591f967cbdb0b071bff2880de37cb0">getDestructorGuardCount</a> () const </td></tr>
<tr class="separator:a31591f967cbdb0b071bff2880de37cb0 inherit pro_methods_classfolly_1_1DelayedDestructionBase"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="structA.html">A</a> <a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a> keeps track of ManagedConnections. </p>

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00034">34</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="a681123264b3430519d7e691b90bd3e74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="namespacefolly.html#a92871ba6503747f5c7767deaf44cbf66">folly::CountedIntrusiveList</a>&lt; <a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a>, &amp;<a class="el" href="classwangle_1_1ManagedConnection.html#a54fe30e311f8b05c1c07d4363c05214f">ManagedConnection::listHook_</a>&gt;::iterator <a class="el" href="classwangle_1_1ConnectionManager.html#a681123264b3430519d7e691b90bd3e74">wangle::ConnectionManager::ConnectionIterator</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00066">66</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6a562d1f774a7678d9a73bbe70c7cdef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::unique_ptr&lt;<a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a>, <a class="el" href="classfolly_1_1DelayedDestruction_1_1Destructor.html">Destructor</a>&gt; <a class="el" href="classwangle_1_1ConnectionManager.html#a6a562d1f774a7678d9a73bbe70c7cdef">wangle::ConnectionManager::UniquePtr</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00063">63</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Enumeration Documentation</h2>
<a class="anchor" id="af80bfb251153dbac30f78ae2fad6c3d5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5">wangle::ConnectionManager::ShutdownState</a> : <a class="el" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">strong</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="af80bfb251153dbac30f78ae2fad6c3d5ab50339a10e1de285ac99d4c3990b8693"></a>NONE&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="af80bfb251153dbac30f78ae2fad6c3d5a9de9a24e7ac2a5dee66a628c5d69c146"></a>NOTIFY_PENDING_SHUTDOWN&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="af80bfb251153dbac30f78ae2fad6c3d5ac046b11bae70a3cd1edf3ce8af784b53"></a>NOTIFY_PENDING_SHUTDOWN_COMPLETE&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="af80bfb251153dbac30f78ae2fad6c3d5a836a3db587ed17b12161e90d06b6450d"></a>CLOSE_WHEN_IDLE&#160;</td><td class="fielddoc">
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="af80bfb251153dbac30f78ae2fad6c3d5a1b49e15882f26e1c712d294718131681"></a>CLOSE_WHEN_IDLE_COMPLETE&#160;</td><td class="fielddoc">
</td></tr>
</table>

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00174">174</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                            : <a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;     <a class="code" href="namespacefolly.html#a268239ef872bd1f7025dca14313f5fc7ab50339a10e1de285ac99d4c3990b8693">NONE</a> = 0,</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;     <span class="comment">// All ManagedConnections receive notifyPendingShutdown</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;     NOTIFY_PENDING_SHUTDOWN = 1,</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;     <span class="comment">// All ManagedConnections have received notifyPendingShutdown</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;     NOTIFY_PENDING_SHUTDOWN_COMPLETE = 2,</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;     <span class="comment">// All ManagedConnections receive closeWhenIdle</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;     CLOSE_WHEN_IDLE = 3,</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;     <span class="comment">// All ManagedConnections have received closeWhenIdle</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;     CLOSE_WHEN_IDLE_COMPLETE = 4,</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;   };</div><div class="ttc" id="namespacefolly_html_a268239ef872bd1f7025dca14313f5fc7ab50339a10e1de285ac99d4c3990b8693"><div class="ttname"><a href="namespacefolly.html#a268239ef872bd1f7025dca14313f5fc7ab50339a10e1de285ac99d4c3990b8693">folly::WriteFlags::NONE</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00178">ConstexprMathBenchmark.cpp:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a8ce47720a1d0ba11f8aeae2d05dd0514"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">wangle::ConnectionManager::ConnectionManager </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1EventBase.html">folly::EventBase</a> *&#160;</td>
          <td class="paramname"><em>eventBase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::chrono::milliseconds&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classwangle_1_1ConnectionManager_1_1Callback.html">Callback</a> *&#160;</td>
          <td class="paramname"><em>callback</em> = <code><a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructor not to be used by itself. </p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00071">makeUnique()</a>.</p>

</div>
</div>
<a class="anchor" id="a3c28c39029d51386c91422bc5e0a2ecb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">wangle::ConnectionManager::~ConnectionManager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">private</span><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a5584f9d1ea99baae7dcf5019c595e8fd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">wangle::ConnectionManager::ConnectionManager </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a> &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a986d85c429c832b55f75d548ae63af42"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::addConnection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a> *&#160;</td>
          <td class="paramname"><em>connection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>timeout</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a connection to the set of connections managed by this <a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">connection</td><td>The connection to add. </td></tr>
    <tr><td class="paramname">timeout</td><td>Whether to immediately register this connection for an idle timeout callback. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00040">40</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>

<p>References <a class="el" href="FizzClientCommand_8cpp_source.html#l00225">callback_</a>, <a class="el" href="ManagedConnection_8h_source.html#l00091">wangle::ManagedConnection::fireCloseWhenIdle()</a>, <a class="el" href="ManagedConnection_8h_source.html#l00078">wangle::ManagedConnection::fireNotifyPendingShutdown()</a>, <a class="el" href="ManagedConnection_8h_source.html#l00133">wangle::ManagedConnection::getConnectionManager()</a>, <a class="el" href="ManagedConnection_8h_source.html#l00157">wangle::ManagedConnection::listHook_</a>, <a class="el" href="ConnectionManager_8cpp_source.html#l00105">removeConnection()</a>, and <a class="el" href="ManagedConnection_8h_source.html#l00151">wangle::ManagedConnection::setConnectionManager()</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00071">makeUnique()</a>.</p>
<div class="fragment"><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                  {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  CHECK_NOTNULL(connection);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a8ce47720a1d0ba11f8aeae2d05dd0514">ConnectionManager</a>* oldMgr = connection-&gt;getConnectionManager();</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordflow">if</span> (oldMgr != <span class="keyword">this</span>) {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (oldMgr) {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      <span class="comment">// &#39;connection&#39; was being previously managed in a different thread.</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      <span class="comment">// We must remove it from that manager before adding it to this one.</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      oldMgr-&gt;removeConnection(connection);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// put the connection into busy part first.  This should not matter at all</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// because the last callback for an idle connection must be onDeactivated(),</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// so the connection must be moved to idle part then.</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.push_front(*connection);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    connection-&gt;setConnectionManager(<span class="keyword">this</span>);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">callback_</a>) {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <a class="code" href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">callback_</a>-&gt;<a class="code" href="classwangle_1_1ConnectionManager_1_1Callback.html#af5271d8ed9ecd42e8b9fefb231d47552">onConnectionAdded</a>(connection);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    }</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  }</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keywordflow">if</span> (timeout) {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a28fef5a57c7c328fdad539f567e00bf9">scheduleTimeout</a>(connection, <a class="code" href="classwangle_1_1ConnectionManager.html#a39515cf7efe2c8039615838e3e014b39">timeout_</a>);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  }</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">drainHelper_</a>.<a class="code" href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a266a566a8490f231840080d738217959">getShutdownState</a>() &gt;=</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <a class="code" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5a9de9a24e7ac2a5dee66a628c5d69c146">ShutdownState::NOTIFY_PENDING_SHUTDOWN</a> &amp;&amp;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      <a class="code" href="classwangle_1_1ConnectionManager.html#aaeb98bde257f7bf1c4dc2a1f4205b9ca">notifyPendingShutdown_</a>) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    connection-&gt;fireNotifyPendingShutdown();</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">drainHelper_</a>.<a class="code" href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a266a566a8490f231840080d738217959">getShutdownState</a>() &gt;= <a class="code" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5a836a3db587ed17b12161e90d06b6450d">ShutdownState::CLOSE_WHEN_IDLE</a>) {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">// closeWhenIdle can delete the connection (it was just created, so it&#39;s</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// probably idle).  Delay the closeWhenIdle call until the end of the loop</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// where it will be safer to terminate the conn.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// Hold a DestructorGuard to the end of the loop for this</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keyword">auto</span> cmDg = <span class="keyword">new</span> DestructorGuard(<span class="keyword">this</span>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keyword">auto</span> connDg = <span class="keyword">new</span> DestructorGuard(connection);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a8e62e294c76c47219def3ee815025363">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#a657bdf25f8e72ac620547bf3d064caed">runInLoop</a>([connection, <span class="keyword">this</span>, cmDg, connDg] {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">if</span> (connection-&gt;listHook_.is_linked()) {</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;          <span class="keyword">auto</span> it = <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.iterator_to(*connection);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;          DCHECK(it != <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.end());</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;          connection-&gt;fireCloseWhenIdle(!<a class="code" href="classwangle_1_1ConnectionManager.html#aaeb98bde257f7bf1c4dc2a1f4205b9ca">notifyPendingShutdown_</a>);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        }</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keyword">delete</span> connDg;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keyword">delete</span> cmDg;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      });</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;}</div><div class="ttc" id="classwangle_1_1ConnectionManager_html_a8e62e294c76c47219def3ee815025363"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a8e62e294c76c47219def3ee815025363">wangle::ConnectionManager::eventBase_</a></div><div class="ttdeci">folly::EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00275">ConnectionManager.h:275</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a8ce47720a1d0ba11f8aeae2d05dd0514"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a8ce47720a1d0ba11f8aeae2d05dd0514">wangle::ConnectionManager::ConnectionManager</a></div><div class="ttdeci">ConnectionManager(folly::EventBase *eventBase, std::chrono::milliseconds timeout, Callback *callback=nullptr)</div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_1_1DrainHelper_html_a266a566a8490f231840080d738217959"><div class="ttname"><a href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a266a566a8490f231840080d738217959">wangle::ConnectionManager::DrainHelper::getShutdownState</a></div><div class="ttdeci">ShutdownState getShutdownState()</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00194">ConnectionManager.h:194</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a657bdf25f8e72ac620547bf3d064caed"><div class="ttname"><a href="classfolly_1_1EventBase.html#a657bdf25f8e72ac620547bf3d064caed">folly::EventBase::runInLoop</a></div><div class="ttdeci">void runInLoop(LoopCallback *callback, bool thisIteration=false)</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8cpp_source.html#l00520">EventBase.cpp:520</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a7b3089a18654b27e4e71da75f18fc1ba"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">wangle::ConnectionManager::callback_</a></div><div class="ttdeci">Callback * callback_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00272">ConnectionManager.h:272</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a28fef5a57c7c328fdad539f567e00bf9"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a28fef5a57c7c328fdad539f567e00bf9">wangle::ConnectionManager::scheduleTimeout</a></div><div class="ttdeci">void scheduleTimeout(ManagedConnection *const connection, std::chrono::milliseconds timeout)</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8cpp_source.html#l00091">ConnectionManager.cpp:91</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_af80bfb251153dbac30f78ae2fad6c3d5a9de9a24e7ac2a5dee66a628c5d69c146"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5a9de9a24e7ac2a5dee66a628c5d69c146">wangle::ConnectionManager::ShutdownState::NOTIFY_PENDING_SHUTDOWN</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_af80bfb251153dbac30f78ae2fad6c3d5a836a3db587ed17b12161e90d06b6450d"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5a836a3db587ed17b12161e90d06b6450d">wangle::ConnectionManager::ShutdownState::CLOSE_WHEN_IDLE</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a39515cf7efe2c8039615838e3e014b39"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a39515cf7efe2c8039615838e3e014b39">wangle::ConnectionManager::timeout_</a></div><div class="ttdeci">std::chrono::milliseconds timeout_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00287">ConnectionManager.h:287</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_aaeb98bde257f7bf1c4dc2a1f4205b9ca"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#aaeb98bde257f7bf1c4dc2a1f4205b9ca">wangle::ConnectionManager::notifyPendingShutdown_</a></div><div class="ttdeci">bool notifyPendingShutdown_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00281">ConnectionManager.h:281</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_afad97fed27dd88b97a2043d26f55e6e3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">wangle::ConnectionManager::conns_</a></div><div class="ttdeci">folly::CountedIntrusiveList&lt; ManagedConnection,&amp;ManagedConnection::listHook_ &gt; conns_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00269">ConnectionManager.h:269</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_1_1Callback_html_af5271d8ed9ecd42e8b9fefb231d47552"><div class="ttname"><a href="classwangle_1_1ConnectionManager_1_1Callback.html#af5271d8ed9ecd42e8b9fefb231d47552">wangle::ConnectionManager::Callback::onConnectionAdded</a></div><div class="ttdeci">virtual void onConnectionAdded(const ManagedConnection *conn)=0</div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a4c4b8ddd3bf266b1579f8a798594b6a3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">wangle::ConnectionManager::drainHelper_</a></div><div class="ttdeci">DrainHelper drainHelper_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00280">ConnectionManager.h:280</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4ba2253a566a49634d812867c2e59d5b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::drainAllConnections </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Destroy all connections managed by this <a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a> that are currently idle, as determined by a call to each <a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a>'s isBusy() method. </p>

</div>
</div>
<a class="anchor" id="a7b31962579f2cc080e4c05d8530cfe0c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::drainConnections </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pct</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::chrono::milliseconds&#160;</td>
          <td class="paramname"><em>idleGrace</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gracefully shutdown certain percentage of persistent client connections and leave the rest intact. </p>

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00141">141</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>

<p>References <a class="el" href="namespacewangle.html#a0a21718cd725845364471663b9b45823ab50339a10e1de285ac99d4c3990b8693">wangle::NONE</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00071">makeUnique()</a>, <a class="el" href="ConnectionManager_8h_source.html#l00209">wangle::ConnectionManager::DrainHelper::runLoopCallback()</a>, and <a class="el" href="ConnectionManager_8h_source.html#l00214">wangle::ConnectionManager::DrainHelper::timeoutExpired()</a>.</p>
<div class="fragment"><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                                                                          {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">drainHelper_</a>.<a class="code" href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a266a566a8490f231840080d738217959">getShutdownState</a>() != <a class="code" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5ab50339a10e1de285ac99d4c3990b8693">ShutdownState::NONE</a>) {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    VLOG(3) &lt;&lt; <span class="stringliteral">&quot;Ignoring partial drain with full drain in progress&quot;</span>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">drainHelper_</a>.<a class="code" href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#aba08e0e27a7c6d9ee04376441e75927c">startDrainPartial</a>(pct, idleGrace);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;}</div><div class="ttc" id="classwangle_1_1ConnectionManager_1_1DrainHelper_html_a266a566a8490f231840080d738217959"><div class="ttname"><a href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a266a566a8490f231840080d738217959">wangle::ConnectionManager::DrainHelper::getShutdownState</a></div><div class="ttdeci">ShutdownState getShutdownState()</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00194">ConnectionManager.h:194</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_1_1DrainHelper_html_aba08e0e27a7c6d9ee04376441e75927c"><div class="ttname"><a href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#aba08e0e27a7c6d9ee04376441e75927c">wangle::ConnectionManager::DrainHelper::startDrainPartial</a></div><div class="ttdeci">void startDrainPartial(double pct, std::chrono::milliseconds idleGrace)</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8cpp_source.html#l00150">ConnectionManager.cpp:150</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_af80bfb251153dbac30f78ae2fad6c3d5ab50339a10e1de285ac99d4c3990b8693"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5ab50339a10e1de285ac99d4c3990b8693">wangle::ConnectionManager::ShutdownState::NONE</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a4c4b8ddd3bf266b1579f8a798594b6a3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">wangle::ConnectionManager::drainHelper_</a></div><div class="ttdeci">DrainHelper drainHelper_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00280">ConnectionManager.h:280</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a489de84ff1c406b9532b6d47b0aa4c51"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::dropAllConnections </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destroy all connections Managed by this <a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a>, even the ones that are busy. </p>

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00255">255</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>

<p>References <a class="el" href="FizzClientCommand_8cpp_source.html#l00225">callback_</a>, <a class="el" href="HHWheelTimer_8h_source.html#l00092">folly::HHWheelTimer::Callback::cancelTimeout()</a>, <a class="el" href="classwangle_1_1ManagedConnection.html#a62c7d7ad9c2e0db1e4b4f9cfc47934f3">wangle::ManagedConnection::dropConnection()</a>, <a class="el" href="classwangle_1_1ManagedConnection.html#ac84df815c65bf99769934570214cfc9b">wangle::ManagedConnection::dumpConnectionState()</a>, <a class="el" href="composition__2_8cpp_source.html#l00034">g()</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">i</a>, and <a class="el" href="ManagedConnection_8h_source.html#l00151">wangle::ManagedConnection::setConnectionManager()</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00071">makeUnique()</a>.</p>
<div class="fragment"><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                      {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  DestructorGuard <a class="code" href="composition__2_8cpp.html#afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe">g</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="comment">// Signal the drain helper in case that has not happened before.</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a29c6020d456fc0a91daaa9c99d6531b5">stopDrainingForShutdown</a>();</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="comment">// Iterate through our connection list, and drop each connection.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  VLOG_IF(4, <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.empty()) &lt;&lt; <span class="stringliteral">&quot;no connections to drop&quot;</span>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  VLOG_IF(2, !<a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.empty()) &lt;&lt; <span class="stringliteral">&quot;connections to drop: &quot;</span> &lt;&lt; <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.size();</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">while</span> (!<a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.empty()) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    ManagedConnection&amp; conn = <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.front();</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.pop_front();</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    conn.cancelTimeout();</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    conn.setConnectionManager(<span class="keyword">nullptr</span>);</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// For debugging purposes, dump information about the first few</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="comment">// connections.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> MAX_CONNS_TO_DUMP = 2;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (++i &lt;= MAX_CONNS_TO_DUMP) {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      conn.dumpConnectionState(3);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    conn.dropConnection();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">drainIterator_</a> = <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.end();</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">idleIterator_</a> = <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.end();</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">drainHelper_</a>.<a class="code" href="classfolly_1_1EventBase_1_1LoopCallback.html#a2acd9352956b309677572284f5666d31">cancelLoopCallback</a>();</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">callback_</a>) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">callback_</a>-&gt;<a class="code" href="classwangle_1_1ConnectionManager_1_1Callback.html#a89ab277036265aa7e63fc543625f4f64">onEmpty</a>(*<span class="keyword">this</span>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;}</div><div class="ttc" id="classwangle_1_1ConnectionManager_1_1Callback_html_a89ab277036265aa7e63fc543625f4f64"><div class="ttname"><a href="classwangle_1_1ConnectionManager_1_1Callback.html#a89ab277036265aa7e63fc543625f4f64">wangle::ConnectionManager::Callback::onEmpty</a></div><div class="ttdeci">virtual void onEmpty(const ConnectionManager &amp;cm)=0</div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_html_a7e98b8a17c0aad30ba64d47b74e2a6c1"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">gtest_output_test_golden_lin.txt:83</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a29c6020d456fc0a91daaa9c99d6531b5"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a29c6020d456fc0a91daaa9c99d6531b5">wangle::ConnectionManager::stopDrainingForShutdown</a></div><div class="ttdeci">void stopDrainingForShutdown()</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8cpp_source.html#l00249">ConnectionManager.cpp:249</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a25552f7d0b1cbbb6ae092dd007624a59"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">wangle::ConnectionManager::drainIterator_</a></div><div class="ttdeci">ConnectionIterator drainIterator_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00278">ConnectionManager.h:278</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_1_1LoopCallback_html_a2acd9352956b309677572284f5666d31"><div class="ttname"><a href="classfolly_1_1EventBase_1_1LoopCallback.html#a2acd9352956b309677572284f5666d31">folly::EventBase::LoopCallback::cancelLoopCallback</a></div><div class="ttdeci">void cancelLoopCallback()</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00155">EventBase.h:155</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a7b3089a18654b27e4e71da75f18fc1ba"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">wangle::ConnectionManager::callback_</a></div><div class="ttdeci">Callback * callback_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00272">ConnectionManager.h:272</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a966316e3af90f2bbe3586c8c86441a86"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">wangle::ConnectionManager::idleIterator_</a></div><div class="ttdeci">ConnectionIterator idleIterator_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00279">ConnectionManager.h:279</a></div></div>
<div class="ttc" id="composition__2_8cpp_html_afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe"><div class="ttname"><a href="composition__2_8cpp.html#afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe">g</a></div><div class="ttdeci">g_t g(f_t)</div><div class="ttdef"><b>Definition:</b> <a href="composition__2_8cpp_source.html#l00034">composition_2.cpp:34</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_afad97fed27dd88b97a2043d26f55e6e3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">wangle::ConnectionManager::conns_</a></div><div class="ttdeci">folly::CountedIntrusiveList&lt; ManagedConnection,&amp;ManagedConnection::listHook_ &gt; conns_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00269">ConnectionManager.h:269</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a4c4b8ddd3bf266b1579f8a798594b6a3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">wangle::ConnectionManager::drainHelper_</a></div><div class="ttdeci">DrainHelper drainHelper_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00280">ConnectionManager.h:280</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a50a79340e094e2ddcf180f766add5364"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::dropConnections </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>pct</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Force-stop "pct" (0.0 to 1.0) of remaining client connections, regardless of whether they are busy or idle. </p>

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00289">289</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>

<p>References <a class="el" href="classwangle_1_1ManagedConnection.html#a62c7d7ad9c2e0db1e4b4f9cfc47934f3">wangle::ManagedConnection::dropConnection()</a>, <a class="el" href="composition__2_8cpp_source.html#l00034">g()</a>, and <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">i</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00071">makeUnique()</a>.</p>
<div class="fragment"><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                                             {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  DestructorGuard <a class="code" href="composition__2_8cpp.html#afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe">g</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// Signal the drain helper in case that has not happened before.</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a29c6020d456fc0a91daaa9c99d6531b5">stopDrainingForShutdown</a>();</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> N = <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.size();</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">size_t</span> numToDrop = std::max&lt;size_t&gt;(0, std::min&lt;size_t&gt;(N, N * pct));</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; numToDrop &amp;&amp; !<a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.empty(); <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++) {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    ManagedConnection&amp; conn = <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.front();</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a272f0d1f15108aec51f212fed824d74c">removeConnection</a>(&amp;conn);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    conn.dropConnection();</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;}</div><div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_html_a7e98b8a17c0aad30ba64d47b74e2a6c1"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">gtest_output_test_golden_lin.txt:83</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a29c6020d456fc0a91daaa9c99d6531b5"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a29c6020d456fc0a91daaa9c99d6531b5">wangle::ConnectionManager::stopDrainingForShutdown</a></div><div class="ttdeci">void stopDrainingForShutdown()</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8cpp_source.html#l00249">ConnectionManager.cpp:249</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a272f0d1f15108aec51f212fed824d74c"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a272f0d1f15108aec51f212fed824d74c">wangle::ConnectionManager::removeConnection</a></div><div class="ttdeci">void removeConnection(ManagedConnection *connection)</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8cpp_source.html#l00105">ConnectionManager.cpp:105</a></div></div>
<div class="ttc" id="composition__2_8cpp_html_afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe"><div class="ttname"><a href="composition__2_8cpp.html#afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe">g</a></div><div class="ttdeci">g_t g(f_t)</div><div class="ttdef"><b>Definition:</b> <a href="composition__2_8cpp_source.html#l00034">composition_2.cpp:34</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_afad97fed27dd88b97a2043d26f55e6e3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">wangle::ConnectionManager::conns_</a></div><div class="ttdeci">folly::CountedIntrusiveList&lt; ManagedConnection,&amp;ManagedConnection::listHook_ &gt; conns_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00269">ConnectionManager.h:269</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afc0e52edc0e12cb8be5df04ccd199d84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t wangle::ConnectionManager::dropIdleConnections </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>num</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>try to drop num idle connections to release system resources. Return the actual number of dropped idle connections </p>

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00333">333</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>

<p>References <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc_source.html#l00176">count</a>, and <a class="el" href="classwangle_1_1ManagedConnection.html#a62c7d7ad9c2e0db1e4b4f9cfc47934f3">wangle::ManagedConnection::dropConnection()</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00153">setLoweredIdleTimeout()</a>.</p>
<div class="fragment"><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                                                 {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  VLOG(4) &lt;&lt; <span class="stringliteral">&quot;attempt to drop &quot;</span> &lt;&lt; num &lt;&lt; <span class="stringliteral">&quot; idle connections&quot;</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1ConnectionManager.html#a2ebd2ff3cbdd3b30b30a3d0e85dc403f">idleConnEarlyDropThreshold_</a> &gt;= <a class="code" href="classwangle_1_1ConnectionManager.html#a39515cf7efe2c8039615838e3e014b39">timeout_</a>) {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc.html#afd9db40e3361ae09188795e8cbe19752">count</a> = 0;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">while</span>(count &lt; num) {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keyword">auto</span> it = <a class="code" href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">idleIterator_</a>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> (it == <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.end()) {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc.html#afd9db40e3361ae09188795e8cbe19752">count</a>; <span class="comment">// no more idle session</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keyword">auto</span> idleTime = it-&gt;getIdleTime();</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (idleTime == std::chrono::milliseconds(0) ||</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;          idleTime &lt;= <a class="code" href="classwangle_1_1ConnectionManager.html#a2ebd2ff3cbdd3b30b30a3d0e85dc403f">idleConnEarlyDropThreshold_</a>) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      VLOG(4) &lt;&lt; <span class="stringliteral">&quot;conn&#39;s idletime: &quot;</span> &lt;&lt; idleTime.count()</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, earlyDropThreshold: &quot;</span> &lt;&lt; <a class="code" href="classwangle_1_1ConnectionManager.html#a2ebd2ff3cbdd3b30b30a3d0e85dc403f">idleConnEarlyDropThreshold_</a>.count()</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;, attempt to drop &quot;</span> &lt;&lt; count &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; num;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc.html#afd9db40e3361ae09188795e8cbe19752">count</a>; <span class="comment">// idleTime cannot be further reduced</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    ManagedConnection&amp; conn = *it;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">idleIterator_</a>++;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    conn.dropConnection();</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    count++;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  }</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc.html#afd9db40e3361ae09188795e8cbe19752">count</a>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;}</div><div class="ttc" id="classwangle_1_1ConnectionManager_html_a966316e3af90f2bbe3586c8c86441a86"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">wangle::ConnectionManager::idleIterator_</a></div><div class="ttdeci">ConnectionIterator idleIterator_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00279">ConnectionManager.h:279</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc_html_afd9db40e3361ae09188795e8cbe19752"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc.html#afd9db40e3361ae09188795e8cbe19752">count</a></div><div class="ttdeci">int * count</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__stress__test_8cc_source.html#l00176">gmock_stress_test.cc:176</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a39515cf7efe2c8039615838e3e014b39"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a39515cf7efe2c8039615838e3e014b39">wangle::ConnectionManager::timeout_</a></div><div class="ttdeci">std::chrono::milliseconds timeout_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00287">ConnectionManager.h:287</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_afad97fed27dd88b97a2043d26f55e6e3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">wangle::ConnectionManager::conns_</a></div><div class="ttdeci">folly::CountedIntrusiveList&lt; ManagedConnection,&amp;ManagedConnection::listHook_ &gt; conns_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00269">ConnectionManager.h:269</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a2ebd2ff3cbdd3b30b30a3d0e85dc403f"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a2ebd2ff3cbdd3b30b30a3d0e85dc403f">wangle::ConnectionManager::idleConnEarlyDropThreshold_</a></div><div class="ttdeci">std::chrono::milliseconds idleConnEarlyDropThreshold_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00298">ConnectionManager.h:298</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac96f20a8cd142b4df99dced93e9796ab"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::milliseconds wangle::ConnectionManager::getDefaultTimeout </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00149">149</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

<p>References <a class="el" href="ConnectionManager_8h_source.html#l00287">timeout_</a>.</p>

<p>Referenced by <a class="el" href="ManagedConnection_8cpp_source.html#l00034">wangle::ManagedConnection::resetTimeout()</a>.</p>
<div class="fragment"><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                                  {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classwangle_1_1ConnectionManager.html#a39515cf7efe2c8039615838e3e014b39">timeout_</a>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  }</div><div class="ttc" id="classwangle_1_1ConnectionManager_html_a39515cf7efe2c8039615838e3e014b39"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a39515cf7efe2c8039615838e3e014b39">wangle::ConnectionManager::timeout_</a></div><div class="ttdeci">std::chrono::milliseconds timeout_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00287">ConnectionManager.h:287</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3922e888aac50a29504a1753a7ac127b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t wangle::ConnectionManager::getNumConnections </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00138">138</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

<p>References <a class="el" href="ConnectionManager_8h_source.html#l00269">conns_</a>.</p>
<div class="fragment"><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;{ <span class="keywordflow">return</span> <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.size(); }</div><div class="ttc" id="classwangle_1_1ConnectionManager_html_afad97fed27dd88b97a2043d26f55e6e3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">wangle::ConnectionManager::conns_</a></div><div class="ttdeci">folly::CountedIntrusiveList&lt; ManagedConnection,&amp;ManagedConnection::listHook_ &gt; conns_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00269">ConnectionManager.h:269</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4ca38c705696fd91cdc8440298417763"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::idleGracefulTimeoutExpired </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00214">wangle::ConnectionManager::DrainHelper::timeoutExpired()</a>.</p>

</div>
</div>
<a class="anchor" id="a3d9d919513552b57d6430935f2b54aad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::initiateGracefulShutdown </td>
          <td>(</td>
          <td class="paramtype">std::chrono::milliseconds&#160;</td>
          <td class="paramname"><em>idleGrace</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00131">131</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>

<p>References <a class="el" href="namespacewangle.html#a0a21718cd725845364471663b9b45823ab50339a10e1de285ac99d4c3990b8693">wangle::NONE</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00071">makeUnique()</a>.</p>
<div class="fragment"><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                                   {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  VLOG(3) &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">&quot; initiateGracefulShutdown with nconns=&quot;</span> &lt;&lt; <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.size();</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">drainHelper_</a>.<a class="code" href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a266a566a8490f231840080d738217959">getShutdownState</a>() != <a class="code" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5ab50339a10e1de285ac99d4c3990b8693">ShutdownState::NONE</a>) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    VLOG(3) &lt;&lt; <span class="stringliteral">&quot;Ignoring redundant call to initiateGracefulShutdown&quot;</span>;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">drainHelper_</a>.<a class="code" href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a3ce60d98e0f55cdbf13d49bf92e47d16">startDrainAll</a>(idleGrace);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div><div class="ttc" id="classwangle_1_1ConnectionManager_1_1DrainHelper_html_a266a566a8490f231840080d738217959"><div class="ttname"><a href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a266a566a8490f231840080d738217959">wangle::ConnectionManager::DrainHelper::getShutdownState</a></div><div class="ttdeci">ShutdownState getShutdownState()</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00194">ConnectionManager.h:194</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_1_1DrainHelper_html_a3ce60d98e0f55cdbf13d49bf92e47d16"><div class="ttname"><a href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a3ce60d98e0f55cdbf13d49bf92e47d16">wangle::ConnectionManager::DrainHelper::startDrainAll</a></div><div class="ttdeci">void startDrainAll(std::chrono::milliseconds idleGrace)</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8cpp_source.html#l00157">ConnectionManager.cpp:157</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_afad97fed27dd88b97a2043d26f55e6e3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">wangle::ConnectionManager::conns_</a></div><div class="ttdeci">folly::CountedIntrusiveList&lt; ManagedConnection,&amp;ManagedConnection::listHook_ &gt; conns_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00269">ConnectionManager.h:269</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_af80bfb251153dbac30f78ae2fad6c3d5ab50339a10e1de285ac99d4c3990b8693"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5ab50339a10e1de285ac99d4c3990b8693">wangle::ConnectionManager::ShutdownState::NONE</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a4c4b8ddd3bf266b1579f8a798594b6a3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">wangle::ConnectionManager::drainHelper_</a></div><div class="ttdeci">DrainHelper drainHelper_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00280">ConnectionManager.h:280</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae2799d2a5bbfdbfce60fa9d51c5e316e"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename F &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::iterateConns </td>
          <td>(</td>
          <td class="paramtype">F&#160;</td>
          <td class="paramname"><em>func</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00141">141</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

<p>References <a class="el" href="ConnectionManager_8h_source.html#l00269">conns_</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                            {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keyword">auto</span> it = <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.begin();</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">while</span> ( it != <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.end()) {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      func(&amp;(*it));</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      it++;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  }</div><div class="ttc" id="classwangle_1_1ConnectionManager_html_afad97fed27dd88b97a2043d26f55e6e3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">wangle::ConnectionManager::conns_</a></div><div class="ttdeci">folly::CountedIntrusiveList&lt; ManagedConnection,&amp;ManagedConnection::listHook_ &gt; conns_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00269">ConnectionManager.h:269</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8fa72870400b6da9079cf7b66f40187e"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename... Args&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classwangle_1_1ConnectionManager.html#a6a562d1f774a7678d9a73bbe70c7cdef">UniquePtr</a> wangle::ConnectionManager::makeUnique </td>
          <td>(</td>
          <td class="paramtype">Args &amp;&amp;...&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns a new instance of <a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a> wrapped in a unique_ptr </p>

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00071">71</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

<p>References <a class="el" href="ConnectionManager_8cpp_source.html#l00040">addConnection()</a>, <a class="el" href="classwangle_1_1ConnectionManager.html#a8ce47720a1d0ba11f8aeae2d05dd0514">ConnectionManager()</a>, <a class="el" href="ConnectionManager_8cpp_source.html#l00141">drainConnections()</a>, <a class="el" href="ConnectionManager_8cpp_source.html#l00255">dropAllConnections()</a>, <a class="el" href="ConnectionManager_8cpp_source.html#l00289">dropConnections()</a>, <a class="el" href="ConnectionManager_8cpp_source.html#l00131">initiateGracefulShutdown()</a>, <a class="el" href="ConnectionManager_8cpp_source.html#l00105">removeConnection()</a>, <a class="el" href="ConnectionManager_8cpp_source.html#l00091">scheduleTimeout()</a>, and <a class="el" href="namespacefolly_1_1detail.html#a87c55c2d12ad5b5dc9b7416bbed13720a90272dda245ae1fb3cf197e91a8689dc">folly::detail::timeout</a>.</p>

<p>Referenced by <a class="el" href="Acceptor_8cpp_source.html#l00126">wangle::Acceptor::initDownstreamConnectionManager()</a>, and <a class="el" href="HTTPUpstreamSessionTest_8cpp_source.html#l01319">TEST_F()</a>.</p>
<div class="fragment"><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                                              {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classwangle_1_1ConnectionManager.html#a6a562d1f774a7678d9a73bbe70c7cdef">UniquePtr</a>(<span class="keyword">new</span> <a class="code" href="classwangle_1_1ConnectionManager.html#a8ce47720a1d0ba11f8aeae2d05dd0514">ConnectionManager</a>(std::forward&lt;Args&gt;(args)...));</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  }</div><div class="ttc" id="classwangle_1_1ConnectionManager_html_a8ce47720a1d0ba11f8aeae2d05dd0514"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a8ce47720a1d0ba11f8aeae2d05dd0514">wangle::ConnectionManager::ConnectionManager</a></div><div class="ttdeci">ConnectionManager(folly::EventBase *eventBase, std::chrono::milliseconds timeout, Callback *callback=nullptr)</div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a6a562d1f774a7678d9a73bbe70c7cdef"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a6a562d1f774a7678d9a73bbe70c7cdef">wangle::ConnectionManager::UniquePtr</a></div><div class="ttdeci">std::unique_ptr&lt; ConnectionManager, Destructor &gt; UniquePtr</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00063">ConnectionManager.h:63</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9c6d2dcb319d9de84535ed8f30a5aa8a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::onActivated </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a> &amp;&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>ManagedConnection::Callbacks </p>

<p>Implements <a class="el" href="classwangle_1_1ManagedConnection_1_1Callback.html#a8b76eb03e91ec8f09e766eedb3c4a48a">wangle::ManagedConnection::Callback</a>.</p>

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00305">305</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>

<p>Referenced by <a class="el" href="HTTPSession_8cpp_source.html#l02555">proxygen::HTTPSession::createTransaction()</a>, and <a class="el" href="ConnectionManager_8h_source.html#l00153">setLoweredIdleTimeout()</a>.</p>
<div class="fragment"><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                                                      {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="keyword">auto</span> it = <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.iterator_to(conn);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordflow">if</span> (it == <a class="code" href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">idleIterator_</a>) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">idleIterator_</a>++;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.erase(it);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.push_front(conn);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div><div class="ttc" id="classwangle_1_1ConnectionManager_html_a966316e3af90f2bbe3586c8c86441a86"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">wangle::ConnectionManager::idleIterator_</a></div><div class="ttdeci">ConnectionIterator idleIterator_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00279">ConnectionManager.h:279</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_afad97fed27dd88b97a2043d26f55e6e3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">wangle::ConnectionManager::conns_</a></div><div class="ttdeci">folly::CountedIntrusiveList&lt; ManagedConnection,&amp;ManagedConnection::listHook_ &gt; conns_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00269">ConnectionManager.h:269</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab1f9d364c8f329725cba312afd2000c9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::onDeactivated </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a> &amp;&#160;</td>
          <td class="paramname"><em>conn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implements <a class="el" href="classwangle_1_1ManagedConnection_1_1Callback.html#af098dc6027c40a585e0563a0a87e77dc">wangle::ManagedConnection::Callback</a>.</p>

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00315">315</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>

<p>Referenced by <a class="el" href="HTTPSession_8cpp_source.html#l01896">proxygen::HTTPSession::detach()</a>, and <a class="el" href="ConnectionManager_8h_source.html#l00153">setLoweredIdleTimeout()</a>.</p>
<div class="fragment"><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                                        {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <span class="keyword">auto</span> it = <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.iterator_to(conn);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="keywordtype">bool</span> moveDrainIter = <span class="keyword">false</span>;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">if</span> (it == <a class="code" href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">drainIterator_</a>) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">drainIterator_</a>++;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    moveDrainIter = <span class="keyword">true</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.erase(it);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.push_back(conn);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">idleIterator_</a> == <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.end()) {</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">idleIterator_</a>--;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keywordflow">if</span> (moveDrainIter &amp;&amp; <a class="code" href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">drainIterator_</a> == <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.end()) {</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">drainIterator_</a>--;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;}</div><div class="ttc" id="classwangle_1_1ConnectionManager_html_a25552f7d0b1cbbb6ae092dd007624a59"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">wangle::ConnectionManager::drainIterator_</a></div><div class="ttdeci">ConnectionIterator drainIterator_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00278">ConnectionManager.h:278</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a966316e3af90f2bbe3586c8c86441a86"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">wangle::ConnectionManager::idleIterator_</a></div><div class="ttdeci">ConnectionIterator idleIterator_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00279">ConnectionManager.h:279</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_afad97fed27dd88b97a2043d26f55e6e3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">wangle::ConnectionManager::conns_</a></div><div class="ttdeci">folly::CountedIntrusiveList&lt; ManagedConnection,&amp;ManagedConnection::listHook_ &gt; conns_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00269">ConnectionManager.h:269</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afbd2ae54b5b3a67bc5df7a73097471ca"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a>&amp; wangle::ConnectionManager::operator= </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a> &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a272f0d1f15108aec51f212fed824d74c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::removeConnection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a> *&#160;</td>
          <td class="paramname"><em>connection</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Remove a connection from this <a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a> and, if applicable, cancel the pending timeout callback that the <a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a> has scheduled for the connection.</p>
<dl class="section note"><dt>Note</dt><dd>This method does NOT destroy the connection. </dd></dl>

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00105">105</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>

<p>References <a class="el" href="FizzClientCommand_8cpp_source.html#l00225">callback_</a>, <a class="el" href="HHWheelTimer_8h_source.html#l00092">folly::HHWheelTimer::Callback::cancelTimeout()</a>, <a class="el" href="ManagedConnection_8h_source.html#l00133">wangle::ManagedConnection::getConnectionManager()</a>, <a class="el" href="ConnectionCounter_8h_source.html#l00047">wangle::SimpleConnectionCounter::getNumConnections()</a>, and <a class="el" href="ManagedConnection_8h_source.html#l00151">wangle::ManagedConnection::setConnectionManager()</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8cpp_source.html#l00040">addConnection()</a>, <a class="el" href="ConnectionManager_8h_source.html#l00071">makeUnique()</a>, and <a class="el" href="ManagedConnection_8cpp_source.html#l00027">wangle::ManagedConnection::~ManagedConnection()</a>.</p>
<div class="fragment"><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                                                                 {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">if</span> (connection-&gt;getConnectionManager() == <span class="keyword">this</span>) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    connection-&gt;cancelTimeout();</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    connection-&gt;setConnectionManager(<span class="keyword">nullptr</span>);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// Un-link the connection from our list, being careful to keep the iterator</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// that we&#39;re using for idle shedding valid</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keyword">auto</span> it = <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.iterator_to(*connection);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">if</span> (it == <a class="code" href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">drainIterator_</a>) {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      ++<a class="code" href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">drainIterator_</a>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">if</span> (it == <a class="code" href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">idleIterator_</a>) {</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      ++<a class="code" href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">idleIterator_</a>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    }</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">conns_</a>.erase(it);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">callback_</a>) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <a class="code" href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">callback_</a>-&gt;<a class="code" href="classwangle_1_1ConnectionManager_1_1Callback.html#aa9bb16b38f0ae697ac474922e4a83186">onConnectionRemoved</a>(connection);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1ConnectionManager.html#a3922e888aac50a29504a1753a7ac127b">getNumConnections</a>() == 0) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <a class="code" href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">callback_</a>-&gt;<a class="code" href="classwangle_1_1ConnectionManager_1_1Callback.html#a89ab277036265aa7e63fc543625f4f64">onEmpty</a>(*<span class="keyword">this</span>);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      }</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div><div class="ttc" id="classwangle_1_1ConnectionManager_1_1Callback_html_a89ab277036265aa7e63fc543625f4f64"><div class="ttname"><a href="classwangle_1_1ConnectionManager_1_1Callback.html#a89ab277036265aa7e63fc543625f4f64">wangle::ConnectionManager::Callback::onEmpty</a></div><div class="ttdeci">virtual void onEmpty(const ConnectionManager &amp;cm)=0</div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_1_1Callback_html_aa9bb16b38f0ae697ac474922e4a83186"><div class="ttname"><a href="classwangle_1_1ConnectionManager_1_1Callback.html#aa9bb16b38f0ae697ac474922e4a83186">wangle::ConnectionManager::Callback::onConnectionRemoved</a></div><div class="ttdeci">virtual void onConnectionRemoved(const ManagedConnection *conn)=0</div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a25552f7d0b1cbbb6ae092dd007624a59"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a25552f7d0b1cbbb6ae092dd007624a59">wangle::ConnectionManager::drainIterator_</a></div><div class="ttdeci">ConnectionIterator drainIterator_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00278">ConnectionManager.h:278</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a3922e888aac50a29504a1753a7ac127b"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a3922e888aac50a29504a1753a7ac127b">wangle::ConnectionManager::getNumConnections</a></div><div class="ttdeci">size_t getNumConnections() const </div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00138">ConnectionManager.h:138</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a7b3089a18654b27e4e71da75f18fc1ba"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a7b3089a18654b27e4e71da75f18fc1ba">wangle::ConnectionManager::callback_</a></div><div class="ttdeci">Callback * callback_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00272">ConnectionManager.h:272</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a966316e3af90f2bbe3586c8c86441a86"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a966316e3af90f2bbe3586c8c86441a86">wangle::ConnectionManager::idleIterator_</a></div><div class="ttdeci">ConnectionIterator idleIterator_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00279">ConnectionManager.h:279</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_afad97fed27dd88b97a2043d26f55e6e3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#afad97fed27dd88b97a2043d26f55e6e3">wangle::ConnectionManager::conns_</a></div><div class="ttdeci">folly::CountedIntrusiveList&lt; ManagedConnection,&amp;ManagedConnection::listHook_ &gt; conns_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00269">ConnectionManager.h:269</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a28fef5a57c7c328fdad539f567e00bf9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::scheduleTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a> *const&#160;</td>
          <td class="paramname"><em>connection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::chrono::milliseconds&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Schedule a timeout callback for a connection. </p>

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00091">91</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00071">makeUnique()</a>, <a class="el" href="ManagedConnection_8cpp_source.html#l00041">wangle::ManagedConnection::resetTimeoutTo()</a>, <a class="el" href="ManagedConnection_8cpp_source.html#l00048">wangle::ManagedConnection::scheduleTimeout()</a>, and <a class="el" href="AcceptorHandshakeManager_8cpp_source.html#l00070">wangle::AcceptorHandshakeManager::startHandshakeTimeout()</a>.</p>
<div class="fragment"><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                                   {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">if</span> (timeout &gt; std::chrono::milliseconds(0)) {</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a8e62e294c76c47219def3ee815025363">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#afedcfb0ece654c202aa16ccb61a34249">timer</a>().<a class="code" href="classfolly_1_1HHWheelTimer.html#ab4fead46bb46f5a4de978097f864c519">scheduleTimeout</a>(connection, timeout);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;}</div><div class="ttc" id="classwangle_1_1ConnectionManager_html_a8e62e294c76c47219def3ee815025363"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a8e62e294c76c47219def3ee815025363">wangle::ConnectionManager::eventBase_</a></div><div class="ttdeci">folly::EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00275">ConnectionManager.h:275</a></div></div>
<div class="ttc" id="classfolly_1_1HHWheelTimer_html_ab4fead46bb46f5a4de978097f864c519"><div class="ttname"><a href="classfolly_1_1HHWheelTimer.html#ab4fead46bb46f5a4de978097f864c519">folly::HHWheelTimer::scheduleTimeout</a></div><div class="ttdeci">void scheduleTimeout(Callback *callback, std::chrono::milliseconds timeout)</div><div class="ttdef"><b>Definition:</b> <a href="HHWheelTimer_8cpp_source.html#l00144">HHWheelTimer.cpp:144</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_afedcfb0ece654c202aa16ccb61a34249"><div class="ttname"><a href="classfolly_1_1EventBase.html#afedcfb0ece654c202aa16ccb61a34249">folly::EventBase::timer</a></div><div class="ttdeci">HHWheelTimer &amp; timer()</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00526">EventBase.h:526</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab97b8e977d389c40240cddf8eccf3988"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::scheduleTimeout </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1HHWheelTimer_1_1Callback.html">folly::HHWheelTimer::Callback</a> *&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::chrono::milliseconds&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00098">98</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                                 {</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a8e62e294c76c47219def3ee815025363">eventBase_</a>-&gt;<a class="code" href="classfolly_1_1EventBase.html#afedcfb0ece654c202aa16ccb61a34249">timer</a>().<a class="code" href="classfolly_1_1HHWheelTimer.html#ab4fead46bb46f5a4de978097f864c519">scheduleTimeout</a>(callback, timeout);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;}</div><div class="ttc" id="classwangle_1_1ConnectionManager_html_a8e62e294c76c47219def3ee815025363"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a8e62e294c76c47219def3ee815025363">wangle::ConnectionManager::eventBase_</a></div><div class="ttdeci">folly::EventBase * eventBase_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00275">ConnectionManager.h:275</a></div></div>
<div class="ttc" id="classfolly_1_1HHWheelTimer_html_ab4fead46bb46f5a4de978097f864c519"><div class="ttname"><a href="classfolly_1_1HHWheelTimer.html#ab4fead46bb46f5a4de978097f864c519">folly::HHWheelTimer::scheduleTimeout</a></div><div class="ttdeci">void scheduleTimeout(Callback *callback, std::chrono::milliseconds timeout)</div><div class="ttdef"><b>Definition:</b> <a href="HHWheelTimer_8cpp_source.html#l00144">HHWheelTimer.cpp:144</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_afedcfb0ece654c202aa16ccb61a34249"><div class="ttname"><a href="classfolly_1_1EventBase.html#afedcfb0ece654c202aa16ccb61a34249">folly::EventBase::timer</a></div><div class="ttdeci">HHWheelTimer &amp; timer()</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00526">EventBase.h:526</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a16abdef698128af9e1b75537b6b7e0f7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::setLoweredIdleTimeout </td>
          <td>(</td>
          <td class="paramtype">std::chrono::milliseconds&#160;</td>
          <td class="paramname"><em>timeout</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00153">153</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

<p>References <a class="el" href="ConnectionManager_8cpp_source.html#l00333">dropIdleConnections()</a>, <a class="el" href="ConnectionManager_8h_source.html#l00298">idleConnEarlyDropThreshold_</a>, <a class="el" href="ConnectionManager_8cpp_source.html#l00305">onActivated()</a>, <a class="el" href="ConnectionManager_8cpp_source.html#l00315">onDeactivated()</a>, and <a class="el" href="ConnectionManager_8h_source.html#l00287">timeout_</a>.</p>
<div class="fragment"><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                                                            {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    CHECK(timeout &gt;= std::chrono::milliseconds(0));</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    CHECK(timeout &lt;= <a class="code" href="classwangle_1_1ConnectionManager.html#a39515cf7efe2c8039615838e3e014b39">timeout_</a>);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="classwangle_1_1ConnectionManager.html#a2ebd2ff3cbdd3b30b30a3d0e85dc403f">idleConnEarlyDropThreshold_</a> = <a class="code" href="namespacefolly_1_1detail.html#a87c55c2d12ad5b5dc9b7416bbed13720a90272dda245ae1fb3cf197e91a8689dc">timeout</a>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  }</div><div class="ttc" id="namespacefolly_1_1detail_html_a87c55c2d12ad5b5dc9b7416bbed13720a90272dda245ae1fb3cf197e91a8689dc"><div class="ttname"><a href="namespacefolly_1_1detail.html#a87c55c2d12ad5b5dc9b7416bbed13720a90272dda245ae1fb3cf197e91a8689dc">folly::detail::spin_result::timeout</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a39515cf7efe2c8039615838e3e014b39"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a39515cf7efe2c8039615838e3e014b39">wangle::ConnectionManager::timeout_</a></div><div class="ttdeci">std::chrono::milliseconds timeout_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00287">ConnectionManager.h:287</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a2ebd2ff3cbdd3b30b30a3d0e85dc403f"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a2ebd2ff3cbdd3b30b30a3d0e85dc403f">wangle::ConnectionManager::idleConnEarlyDropThreshold_</a></div><div class="ttdeci">std::chrono::milliseconds idleConnEarlyDropThreshold_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00298">ConnectionManager.h:298</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a29c6020d456fc0a91daaa9c99d6531b5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::ConnectionManager::stopDrainingForShutdown </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Signal the drain helper that we are about to start dropping connections. </p>

<p>Definition at line <a class="el" href="ConnectionManager_8cpp_source.html#l00249">249</a> of file <a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                                                {</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">drainHelper_</a>.<a class="code" href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a3e7391299534d514fea8216ffd7a276e">setShutdownState</a>(<a class="code" href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5a1b49e15882f26e1c712d294718131681">ShutdownState::CLOSE_WHEN_IDLE_COMPLETE</a>);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  <a class="code" href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">drainHelper_</a>.<a class="code" href="classfolly_1_1AsyncTimeout.html#a2080a127e6087755e7d603883bebfd55">cancelTimeout</a>();</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncTimeout_html_a2080a127e6087755e7d603883bebfd55"><div class="ttname"><a href="classfolly_1_1AsyncTimeout.html#a2080a127e6087755e7d603883bebfd55">folly::AsyncTimeout::cancelTimeout</a></div><div class="ttdeci">void cancelTimeout()</div><div class="ttdef"><b>Definition:</b> <a href="AsyncTimeout_8cpp_source.html#l00084">AsyncTimeout.cpp:84</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_af80bfb251153dbac30f78ae2fad6c3d5a1b49e15882f26e1c712d294718131681"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#af80bfb251153dbac30f78ae2fad6c3d5a1b49e15882f26e1c712d294718131681">wangle::ConnectionManager::ShutdownState::CLOSE_WHEN_IDLE_COMPLETE</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_1_1DrainHelper_html_a3e7391299534d514fea8216ffd7a276e"><div class="ttname"><a href="classwangle_1_1ConnectionManager_1_1DrainHelper.html#a3e7391299534d514fea8216ffd7a276e">wangle::ConnectionManager::DrainHelper::setShutdownState</a></div><div class="ttdeci">void setShutdownState(ShutdownState state)</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00202">ConnectionManager.h:202</a></div></div>
<div class="ttc" id="classwangle_1_1ConnectionManager_html_a4c4b8ddd3bf266b1579f8a798594b6a3"><div class="ttname"><a href="classwangle_1_1ConnectionManager.html#a4c4b8ddd3bf266b1579f8a798594b6a3">wangle::ConnectionManager::drainHelper_</a></div><div class="ttdeci">DrainHelper drainHelper_</div><div class="ttdef"><b>Definition:</b> <a href="ConnectionManager_8h_source.html#l00280">ConnectionManager.h:280</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a7b3089a18654b27e4e71da75f18fc1ba"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classwangle_1_1ConnectionManager_1_1Callback.html">Callback</a>* wangle::ConnectionManager::callback_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Optional callback to notify of state changes </p>

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00272">272</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

</div>
</div>
<a class="anchor" id="afad97fed27dd88b97a2043d26f55e6e3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacefolly.html#a92871ba6503747f5c7767deaf44cbf66">folly::CountedIntrusiveList</a>&lt; <a class="el" href="classwangle_1_1ManagedConnection.html">ManagedConnection</a>,&amp;<a class="el" href="classwangle_1_1ManagedConnection.html#a54fe30e311f8b05c1c07d4363c05214f">ManagedConnection::listHook_</a>&gt; wangle::ConnectionManager::conns_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>All the managed connections. idleIterator_ seperates them into two parts: idle and busy ones. [<a class="el" href="namespacefolly_1_1test.html#a8dadea8eef3a86a23af2016a11e75afc">conns_.begin()</a>, idleIterator_) are the busy ones, while [idleIterator_, <a class="el" href="namespacefolly_1_1test.html#a0917528775d48fd53a51907e08c14adf">conns_.end()</a>) are the idle one. Moreover, the idle ones are organized in the decreasing idle time order. </p>

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00269">269</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00138">getNumConnections()</a>, and <a class="el" href="ConnectionManager_8h_source.html#l00141">iterateConns()</a>.</p>

</div>
</div>
<a class="anchor" id="a4c4b8ddd3bf266b1579f8a798594b6a3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classwangle_1_1ConnectionManager_1_1DrainHelper.html">DrainHelper</a> wangle::ConnectionManager::drainHelper_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00280">280</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

</div>
</div>
<a class="anchor" id="a25552f7d0b1cbbb6ae092dd007624a59"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classwangle_1_1ConnectionManager.html#a681123264b3430519d7e691b90bd3e74">ConnectionIterator</a> wangle::ConnectionManager::drainIterator_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Iterator to the next connection to shed; used by <a class="el" href="classwangle_1_1ConnectionManager.html#a4ba2253a566a49634d812867c2e59d5b">drainAllConnections()</a> </p>

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00278">278</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8e62e294c76c47219def3ee815025363"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1EventBase.html">folly::EventBase</a>* wangle::ConnectionManager::eventBase_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Event base in which we run </p>

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00275">275</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2ebd2ff3cbdd3b30b30a3d0e85dc403f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::milliseconds wangle::ConnectionManager::idleConnEarlyDropThreshold_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The idle connections can be closed earlier that their idle timeout when any system resource limit is reached. This feature can be considerred as a pre load shedding stage for the system, and can be easily disabled by setting idleConnEarlyDropThreshold_ to defaultIdleTimeout_. Also, idleConnEarlyDropThreshold_ can be used to bottom the idle timeout. That is, connection manager will not early drop the idle connections whose idle time is less than idleConnEarlyDropThreshold_. </p>

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00298">298</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00153">setLoweredIdleTimeout()</a>.</p>

</div>
</div>
<a class="anchor" id="a966316e3af90f2bbe3586c8c86441a86"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classwangle_1_1ConnectionManager.html#a681123264b3430519d7e691b90bd3e74">ConnectionIterator</a> wangle::ConnectionManager::idleIterator_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00279">279</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

</div>
</div>
<a class="anchor" id="aaeb98bde257f7bf1c4dc2a1f4205b9ca"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool wangle::ConnectionManager::notifyPendingShutdown_ {true}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00281">281</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

</div>
</div>
<a class="anchor" id="a39515cf7efe2c8039615838e3e014b39"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::chrono::milliseconds wangle::ConnectionManager::timeout_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>the default idle timeout for downstream sessions when no system resource limit is reached </p>

<p>Definition at line <a class="el" href="ConnectionManager_8h_source.html#l00287">287</a> of file <a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a>.</p>

<p>Referenced by <a class="el" href="ConnectionManager_8h_source.html#l00149">getDefaultTimeout()</a>, and <a class="el" href="ConnectionManager_8h_source.html#l00153">setLoweredIdleTimeout()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/wangle/wangle/acceptor/<a class="el" href="ConnectionManager_8h_source.html">ConnectionManager.h</a></li>
<li>proxygen/wangle/wangle/acceptor/<a class="el" href="ConnectionManager_8cpp_source.html">ConnectionManager.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacewangle.html">wangle</a></li><li class="navelem"><a class="el" href="classwangle_1_1ConnectionManager.html">ConnectionManager</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
