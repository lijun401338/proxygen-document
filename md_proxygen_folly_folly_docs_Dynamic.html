<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: `folly/dynamic.h`</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_proxygen_folly_folly_docs_Dynamic.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">`folly/dynamic.h` </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><code>folly/dynamic.h</code> provides a runtime dynamically typed value for C++, similar to the way languages with runtime type systems work (e.g. Python). It can hold types from a predetermined set of types (ints, bools, arrays of other dynamics, etc), similar to something like <code>boost::variant</code>, but the syntax is intended to be a little more like using the native type directly.</p>
<p>To use <code>dynamic</code>, you need to be using gcc 4.6 or later. You'll want to include <code>folly/dynamic.h</code> (or perhaps also <code>folly/json.h</code>).</p>
<h3>Overview</h3>
<hr/>
<p>Here are some code samples to get started (assumes a <code>using <a class="el" href="structfolly_1_1dynamic.html">folly::dynamic</a>;</code> was used):</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;dynamic twelve = 12; // creates a dynamic that holds an integer</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;dynamic str = &quot;string&quot;; // yep, this one is an fbstring</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;// A few other types.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;dynamic nul = nullptr;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;dynamic boolean = false;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;// Arrays can be initialized with dynamic::array.</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;dynamic array = dynamic::array(&quot;array &quot;, &quot;of &quot;, 4, &quot; elements&quot;);</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;assert(array.size() == 4);</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;dynamic emptyArray = dynamic::array;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;assert(emptyArray.empty());</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;// Maps from dynamics to dynamics are called objects.  The</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;// dynamic::object constant is how you make an empty map from dynamics</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;// to dynamics.</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;dynamic map = dynamic::object;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;map[&quot;something&quot;] = 12;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;map[&quot;another_something&quot;] = map[&quot;something&quot;] * 2;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;// Dynamic objects may be intialized this way</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;dynamic map2 = dynamic::object(&quot;something&quot;, 12)(&quot;another_something&quot;, 24);</div></div><!-- fragment --><h3>Runtime Type Checking and Conversions</h3>
<hr/>
<p>Any operation on a dynamic requires checking at runtime that the type is compatible with the operation. If it isn't, you'll get a <code><a class="el" href="structfolly_1_1TypeError.html">folly::TypeError</a></code>. Other exceptions can also be thrown if you try to do something impossible (e.g. if you put a very large 64-bit integer in and try to read it out as a double).</p>
<p>More examples should hopefully clarify this:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;dynamic dint = 42;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;dynamic str = &quot;foo&quot;;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;dynamic anotherStr = str + &quot;something&quot;; // fine</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;dynamic thisThrows = str + dint; // TypeError is raised</div></div><!-- fragment --><p>Explicit type conversions can be requested for some of the basic types:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;dynamic dint = 12345678;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;dynamic doub = dint.asDouble(); // doub will hold 12345678.0</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;dynamic str = dint.asString(); // str == &quot;12345678&quot;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;dynamic hugeInt = std::numeric_limits&lt;int64_t&gt;::max();</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;dynamic hugeDoub = hugeInt.asDouble();  // throws a folly/Conv.h error,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;                                        // since it can&#39;t fit in a double</div></div><!-- fragment --><p>For more complicated conversions, see <a class="el" href="DynamicConverter_8md.html">DynamicConverter</a>.</p>
<h3>Iteration and Lookup</h3>
<hr/>
<p>You can iterate over dynamic arrays as you would over any C++ sequence container.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;dynamic array = dynamic::array(2, 3, &quot;foo&quot;);</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;for (auto&amp; val : array) {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  doSomethingWith(val);</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div></div><!-- fragment --><p>You can iterate over dynamic maps by calling <code>items()</code>, <code>keys()</code>, <code><a class="el" href="PushmiBenchmarks_8cpp.html#a4e506a3ad8385688fda41fbd279ac064">values()</a></code>, which behave similarly to the homonymous methods of Python dictionaries.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;dynamic obj = dynamic::object(2, 3)(&quot;hello&quot;, &quot;world&quot;)(&quot;x&quot;, 4);</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;for (auto&amp; pair : obj.items()) {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  // Key is pair.first, value is pair.second</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  processKey(pair.first);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  processValue(pair.second);</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;for (auto&amp; key : obj.keys()) {</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  processKey(key);</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;}</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;for (auto&amp; value : obj.values()) {</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  processValue(value);</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;}</div></div><!-- fragment --><p>You can find an element by key in a dynamic map using the <code>find()</code> method, which returns an iterator compatible with <code>items()</code>:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;dynamic obj = dynamic::object(2, 3)(&quot;hello&quot;, &quot;world&quot;)(&quot;x&quot;, 4);</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;auto pos = obj.find(&quot;hello&quot;);</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;// pos-&gt;first is &quot;hello&quot;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;// pos-&gt;second is &quot;world&quot;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;auto pos = obj.find(&quot;no_such_key&quot;);</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;// pos == obj.items().end()</div></div><!-- fragment --><h3>Use for JSON</h3>
<hr/>
<p>The original motivation for implementing this type was to try to make dealing with json documents in C++ almost as easy as it is in languages with dynamic type systems (php or javascript, etc). The reader can judge whether we're anywhere near that goal, but here's what it looks like:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// Parsing JSON strings and using them.</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;std::string jsonDocument = R&quot;({&quot;key&quot;:12,&quot;key2&quot;:[false, null, true, &quot;yay&quot;]})&quot;;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;dynamic parsed = folly::parseJson(jsonDocument);</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;assert(parsed[&quot;key&quot;] == 12);</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;assert(parsed[&quot;key2&quot;][0] == false);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;assert(parsed[&quot;key2&quot;][1] == nullptr);</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;// Building the same document programatically.</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;dynamic sonOfAJ = dynamic::object</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  (&quot;key&quot;, 12)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  (&quot;key2&quot;, dynamic::array(false, nullptr, true, &quot;yay&quot;));</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;// Printing.  (See also folly::toPrettyJson)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;auto str = folly::toJson(sonOfAJ);</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;assert(jsonDocument.compare(str) == 0);</div></div><!-- fragment --><h3>Performance</h3>
<hr/>
<p>Dynamic typing is more expensive than static typing, even when you do it in C++. ;)</p>
<p>However, some effort has been made to keep <code><a class="el" href="structfolly_1_1dynamic.html">folly::dynamic</a></code> and the json (de)serialization at least reasonably performant for common cases. The heap is only used for arrays and objects, and move construction is fully supported. String formatting internally also uses the highly performant <code><a class="el" href="namespacefolly.html#a005f91db4ecc55675cf5ad7ba25ec24d">folly::to</a>&lt;&gt;</code> (see <code>folly/Conv.h</code>).</p>
<p><a class="el" href="structA.html">A</a> trade off to keep in mind though, is that <code>sizeof(folly::dynamic)</code> is 64 bytes. You probably don't want to use it if you need to allocate large numbers of them (prefer static types, etc).</p>
<h3>Some Design Rationale</h3>
<hr/>
<p><b>Q. Why doesn't a dynamic string support <a class="el" href="namespacefolly_1_1test.html#a8dadea8eef3a86a23af2016a11e75afc">begin()</a>, <a class="el" href="namespacefolly_1_1test.html#a0917528775d48fd53a51907e08c14adf">end()</a>, and operator[]?</b></p>
<p>The value_type of a dynamic iterator is <code>dynamic</code>, and <code>operator[]</code> (or the <code>at()</code> function) has to return a reference to a dynamic. If we wanted this to work for strings, this would mean we'd have to support dynamics with a character type, and moreover that the internal representation of strings would be such that we can hand out references to dynamic as accessors on individual characters. There are a lot of potential efficiency drawbacks with this, and it seems like a feature that is not needed too often in practice.</p>
<p><b>Q. Isn't this just a poor imitation of the C# language feature?</b></p>
<p>Pretty much. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
