<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: Log Handlers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_proxygen_folly_folly_logging_docs_LogHandlers.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Log Handlers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>LogHandler</code> class defines the interface for classes that wish to be notified of log messages.</p>
<p><code>LogHandler</code> objects can be attached to specific log categories to be notified about log messages sent to that category or any of its children categories. Attaching a <code>LogHandler</code> to the root category will cause it to be notified about every enabled log message.</p>
<h1>Built-in Log Handlers</h1>
<p>The logging library currently provides a few basic built-in <code>LogHandler</code> implementations.</p>
<h2><code>stream</code> Handler Type</h2>
<p>In the <a class="el" href="Config_8md.html">configuration settings</a>, you can use the <code>stream</code> type to define a log handler that will write to <code>stdout</code> or <code>stderr</code>. The <code>stream</code> property of the log handler specifies which stream to write to. For example, the following defines a handler named <code>myhandler</code> that writes to stderr</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;myhandler=stream:stream=stderr</div></div><!-- fragment --><h2><code>file</code> Handler Type</h2>
<p><a class="el" href="structA.html">A</a> <code>file</code> handler type is also provided that appends log messages to a file on disk. The <code>path</code> option controls which file to write to. For example:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;myhandler=file:path=/var/log/my.log</div></div><!-- fragment --><p>However, note that the <code>file</code> handler is currently not registered by default by <code><a class="el" href="namespacefolly.html#ad600cbf415e4a37d30ddf07b0c41609d">folly::initLogging()</a></code>. This log handler allows appending to arbitrary files based on the configuration settings. You should only enable this handler type if you trust the source of your configuration string. (For instance, this handler is potentially unsafe if your program runs with elevated privileges but users with lower privilege levels can write to your configuration file.)</p>
<p>The following code snippet can be used to explicitly enable this log handler type. It can be called before <code><a class="el" href="namespacefolly.html#ad600cbf415e4a37d30ddf07b0c41609d">initLogging()</a></code> to support the <code>file</code> handler type in the configuration string passed to <code><a class="el" href="namespacefolly.html#ad600cbf415e4a37d30ddf07b0c41609d">initLogging()</a></code>.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;folly::LoggerDB::get()-&gt;registerHandlerFactory(</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;      std::make_unique&lt;folly::FileHandlerFactory&gt;());</div></div><!-- fragment --><h2>Handler Options</h2>
<p>The built-in handler types also accept several options to control their behavior. These include:</p>
<h3><code>async</code></h3>
<p>The <code>async</code> option controls whether log messages should be written asynchronously in a separate thread (when <code>async</code> is true) or immediately in the thread that generated the log messages (when <code>async</code> is false).</p>
<p>This mainly affects the behavior when log messages are being generated faster than they can be written to the output file or stream:</p>
<ul>
<li>Using <code>async=true</code> will ensure that your program never blocks waiting to write the messages. Instead, the handler will start dropping log messages when this occurs. When it is able to catch up it will emit a message indicating how many messages were dropped.</li>
<li>Using <code>async=false</code> will ensure that no log messages are dropped, at the expense of blocking your program's normal processing until the log messages can be written.</li>
</ul>
<p>One additional consideration is that <code>async=false</code> will ensure that all log messages have been flushed if your program crashes. With <code>async=true</code> it is possible to lose some recent messages on program crash. For instance, if one thread logs a message and then dereferences a null pointer, <code>async=false</code> will ensure that the log message has been flushed before the thread can proceed to dereference the null pointer. However with <code>async=true</code> the logging I/O thread may not have flushed the log message by the time the thread that generated the message crashes.</p>
<p>With <code>async=true</code>, the <code>max_buffer_size</code> option controls how much log data may buffered in memory before dropping new log messages. This option specifies the maximum number of bytes of unflushed log data to keep. New log messages that would trigger this limit to be exceeded will be discarded. (Log messages are either entirely kept or discarded; partial messages are never kept.)</p>
<h3><code>formatter</code></h3>
<p>The <code>formatter</code> parameter controls how log messages should be formatted.</p>
<p>Currently the only built-in log formatter is <code>glog</code>, which formats log messages similarly to <a href="https://github.com/google/glog">glog</a>. Additional formatters may be added in the future, and it is also possible to implement your own <code>LogFormatter</code> class.</p>
<h1>Default Handler Configuration</h1>
<p>By default <code><a class="el" href="namespacefolly.html#ad600cbf415e4a37d30ddf07b0c41609d">initLogging()</a></code> creates a single log handler named <code>default</code>. This log handler is installed on the root log category, and logs all messages to stderr using a message format similar to that used by <a href="https://github.com/google/glog">glog</a>.</p>
<p>This <code>default</code> log handler has the <code>async</code> option disabled by default. This means that <code><a class="el" href="namespacefolly.html#ad600cbf415e4a37d30ddf07b0c41609d">initLogging()</a></code> will not spawn a separate logging I/O thread by default. However, log messages may delay normal program processing if they are being generated faster than they can be written to stderr.</p>
<p>High performance programs that want to avoid performance hiccups caused by logging may wish to enable the <code>async</code> option on the default log handler. This can easily be changed with the logging configuration string. For instance, the following string sets the root category's log level to <code>WARN</code> and enables the <code>async</code> option on the default log handler:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;WARN; default:async=true</div></div><!-- fragment --><h1>Custom Log Handlers</h1>
<p>It is possible to define your own custom <code>LogHandler</code> class should you choose to. The <code>LogHandlerFactory</code> API enables you to create your own custom <code>LogHandler</code> types from configuration settings parsed by <code><a class="el" href="namespacefolly.html#a6fa97de296c2a5f29f40abce96a98a83">parseLogConfig()</a></code>. You can use <code><a class="el" href="namespacefolly_1_1pushmi_1_1operators.html#a3fb4b634ea259cf94b63687a25b3f505">LoggerDB::get()</a>-&gt;registerHandlerFactory()</code> to register your own custom log handler type.</p>
<h2><code>StandardLogHandler</code></h2>
<p>The <code>StandardLogHandler</code> class is an implementation of <code>LogHandler</code> that splits log message processing into two steps: formatting the message to a string, and then writing that string somewhere.</p>
<p>It uses a <code>LogFormatter</code> class to perform the message formatting, and a <code>LogWriter</code> class to write the formatted message.</p>
<p>You can provide only a custom <code>LogFormatter</code> or <code>LogWriter</code> implementation if you want to customize one of these two steps without providing a full <code>LogHandler</code> implementation of your own.</p>
<p>The <code>StandardLogHandlerFactory</code> class can then be used to implement your own custom <code>LogHandlerFactory</code> that creates a <code>StandardLogHandler</code> with your custom log formatter or writer type. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
