<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: Logging Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_proxygen_folly_folly_logging_docs_Config.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Logging Configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview </h2>
<p>The logging library is normally configured using configuration strings.</p>
<p>In its most basic format, the configuration string consists of a comma separated list of <code>CATEGORY=LEVEL</code> pairs, e.g.:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;folly=INFO,folly.io.async=DBG2</div></div><!-- fragment --><p><a class="el" href="structA.html">A</a> log level name can also be specified by itself to affect the root log category:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;WARN</div></div><!-- fragment --><p>These are the two forms that users will probably use most often for customizing log levels via command line arguments. Additional settings, including log handler settings, can also be included. The syntax is documented more completely in the <a href="#basic-configuration-syntax">Basic Configuration Syntax</a> section.</p>
<p>Log configuration can also be specified using JSON as well. If the log configuration string starts with a leading <code>{</code> character (optionally after leading whitespace), it is parsed as a JSON object. The JSON configuration format is documented in the <a href="#json-configuration-syntax">JSON Configuration Syntax</a> section.</p>
<p>In general the basic configuration syntax is convenient for controlling log levels, and making minor log handler setting changes (such as controlling if logging goes to stdout or stderr, and whether it is logged asynchronously or not). However the JSON format is easier to use to describe more complicated settings.</p>
<h2>Basic Configuration Syntax </h2>
<p>The basic configuration format is parsed using <code><a class="el" href="namespacefolly.html#a6fa97de296c2a5f29f40abce96a98a83">parseLogConfig()</a></code>.</p>
<p>The basic format string is separated with semicolons. Everything up to the first semicolon specifies LogCategory configurations. Each remaining semicolon-separated section defines a LogHandler configuration.</p>
<p>To keep the basic format simple, it does not support any form of character escape sequences. If you need to define a log category whose name includes a special character like a comma or semicolon use the JSON format instead.</p>
<h3>Grammar Overview</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;config&gt; ::= &lt;category_configs&gt; &lt;handler_configs&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;&lt;category_configs&gt; ::= &lt;category_config&gt;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;                     | &lt;category_config&gt; &quot;,&quot; &lt;category_configs&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;                     | &lt;empty_string&gt;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&lt;handler_configs&gt; ::= &quot;;&quot; &lt;handler_config&gt;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;                    | &quot;;&quot; &lt;handler_config&gt; &lt;handler_configs&gt;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;                    | &lt;empty_string&gt;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;category_config&gt; ::= &lt;cat_level_config&gt; &lt;handler_list&gt;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&lt;cat_level_config&gt; ::= &lt;level&gt;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;                     | &lt;catgory_name&gt; &quot;=&quot; &lt;level&gt;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                     | &lt;catgory_name&gt; &quot;:=&quot; &lt;level&gt;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&lt;handler_list&gt; ::= &quot;:&quot; &lt;handler_name&gt; &lt;handler_list&gt;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;                 | &lt;empty_string&gt;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;&lt;handler_config&gt; ::= &lt;handler_name&gt; &quot;=&quot; &lt;handler_type&gt; &quot;:&quot; &lt;handler_options&gt;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;                   | &lt;handler_name&gt; &quot;:&quot; &lt;handler_options&gt;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;&lt;handler_options&gt; ::= &quot;,&quot; &lt;option_name&gt; &quot;=&quot; &lt;option_value&gt; &lt;handler_options&gt;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                    | &lt;empty_string&gt;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;&lt;catgory_name&gt; ::= &lt;atom&gt;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;&lt;handler_name&gt; ::= &lt;atom&gt;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;&lt;handler_type&gt; ::= &lt;atom&gt;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;&lt;option_name&gt; ::= &lt;atom&gt;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;&lt;option_value&gt; ::= &lt;atom&gt;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;&lt;atom&gt; ::= any sequence of characters except &quot;;&quot;, &quot;,&quot;, &quot;=&quot;, or &quot;:&quot;,</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;           with leading and trailing whitespace ignored</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;&lt;level&gt; ::= &lt;log_level_string&gt;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;          | &lt;positive_integer&gt;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;&lt;log_level_string&gt; ::= any one of the strings accepted by logLevelToString()</div></div><!-- fragment --><h3>Log Category Configuration</h3>
<p>The log category configurations are a comma-separated list. Each element in this list has the form</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;NAME=LEVEL:HANDLER1:HANDLER2</div></div><!-- fragment --><p>The log category name and '=' sign can be omitted, in which case the setting applies to the root log category. The root log category can also be explicitly named either using the empty string or the name ".".</p>
<p>The NAME and LEVEL can also be separated with ":=" instead of "=", which disables log level inheritance for this category. This forces category's effective log level to be the exact level specified, even if its parent category has a more verbose level setting.</p>
<p>The log handler settings for a log category can be omitted, in which case the existing log handlers for this category will be left unchanged when updating the LoggerDB settings. Specifying an empty log handler list (a trailing ':' with no log handlers following) will cause the log handler list for this category to be cleared instead.</p>
<h3>Log Handler Configuration</h3>
<p>Each log handler configuration section takes the form</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;NAME=TYPE:OPTION1=VALUE1,OPTION2=VALUE2</div></div><!-- fragment --><p>NAME specifies the log handler name, and TYPE specifies the log handler type. <a class="el" href="structA.html">A</a> comma separated list of name=value options may follow the log handler name and type. The option list will be passed to the LogHandlerFactory for the specified handler type.</p>
<p>The log handler type may be omitted to update the settings of an existing log handler object:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;NAME:OPTION1=VALUE1</div></div><!-- fragment --><p><a class="el" href="structA.html">A</a> log handler with this name must already exist. Options specified in the configuration will be updated with their new values, and any option names not mentioned will be left unchanged.</p>
<h3>Examples</h3>
<p>Example log configuration strings:</p>
<ul>
<li><p class="startli"><code>ERROR</code></p>
<p class="startli">Sets the root log category level to ERR. (Note that <code>ERROR</code> is allowed in configuration strings as an alias for the <code>LogLevel::ERR</code> value.)</p>
</li>
<li><p class="startli"><code>folly=INFO,<a class="el" href="namespacefolly_1_1io.html">folly.io</a>=DBG2</code></p>
<p class="startli">Sets the "folly" log category level to INFO, and the "folly.io" log category level to DBG2.</p>
</li>
<li><p class="startli"><code>folly=DBG2,<a class="el" href="namespacefolly_1_1io.html">folly.io</a>:=INFO</code></p>
<p class="startli">Sets the "folly" log category level to DBG2, and the "folly.io" log category level to INFO, and prevent it from inheriting its effective log level from its parent category. DBG2 log messages sent to "folly.io" will therefore be discarded, even though they are enabled for one of its parent categories.</p>
</li>
<li><p class="startli"><code>ERROR:stderr, folly=INFO; stderr=stream:stream=stderr</code></p>
<p class="startli">Sets the root log category level to ERROR, and sets its handler list to use the "stderr" handler. Sets the folly log level to INFO. Defines a log handler named "stderr" which writes to stderr.</p>
</li>
<li><p class="startli"><code>ERROR:x,folly=INFO:y;x=stream:stream=stderr;y=<a href="file:path=/tmp/y.log">file:path=/tmp/y.log</a></code></p>
<p class="startli">Defines two log handlers: "x" which writes to stderr and "y" which writes to the file /tmp/y.log Sets the root log catgory level to ERROR, and configures it to use the "x" handler. Sets the log level for the "folly" category to INFO and configures it to use the "y" handler.</p>
</li>
<li><p class="startli"><code>ERROR:default:x; default=stream:stream=stderr; x=<a href="file:path=/tmp/x.log">file:path=/tmp/x.log</a></code></p>
<p class="startli">Defines two log handlers: "default" which writes to stderr and "x" which writes to the file /tmp/x.log Sets the root log catgory level to ERROR, and configures it to use both the "default" and "x" handlers.</p>
</li>
<li><p class="startli"><code>ERROR:</code></p>
<p class="startli">Sets the root log category level to ERR, and removes any log handlers configured for it. Explicitly specifying an empty list of handlers (with a ':' followed by no handlers) will update the handlers for this category to the empty list. Not specifying handler information at all (no ':') will leave any pre-existing handlers as-is.</p>
</li>
<li><p class="startli"><code>;default=stream:stream=stdout</code></p>
<p class="startli">Does not change any log category settings, and defines a "default" handler that writes to stdout. This format is useful to update log handler settings if the "default" handler already exists and is attached to existing log categories.</p>
</li>
<li><p class="startli"><code>ERROR; stderr:async=true</code></p>
<p class="startli">Sets the root log category level to ERR, and sets the "async" property to true on the "stderr" handler. <a class="el" href="structA.html">A</a> log handler named "stderr" must already exist. Therefore this configuration string is only valid to use with <code>LoggerDB::updateConfig()</code>, and cannot be used with <code>LoggerDB::resetConfig()</code>.</p>
</li>
<li><p class="startli"><code>INFO; default:async=true,sync_level=WARN</code></p>
<p class="startli">Sets the root log category level to INFO, and sets the "async" property to true and "sync_level" property to WARN. Setting "async" property ensures that we enable asynchronous logging but the "sync_level" flag specifies that all logs of the level WARN and above are processed synchronously. This can help ensure that all logs of the level WARN or above are persisted before a potential crash while ensuring that all logs below the level WARN are non-blocking.</p>
</li>
</ul>
<h2>JSON Configuration Syntax </h2>
<p>The <code><a class="el" href="namespacefolly.html#a6fa97de296c2a5f29f40abce96a98a83">parseLogConfig()</a></code> function, which parses the basic configuration string syntax, will also accept a JSON object string as input. However, you can also use <code><a class="el" href="namespacefolly.html#a628866900f8146d9a00cb5871208858f">parseLogConfigJson()</a></code> to explicitly parse the input as JSON, and not accept the basic configuration string syntax.</p>
<p>The input string is parsed using relaxed JSON parsing, allowing C and C++ style comments, as well as trailing commas.</p>
<p>The JSON configuration string must be a JSON object data type, with two optional members: <code>categories</code> and <code>handlers</code>. Any additional members besides these two are ignored.</p>
<h3>Log Category Configuration</h3>
<p>If present, the <code>categories</code> member of the top-level object should be a JSON object mapping log category names to configuration settings for that log category.</p>
<p>The value of each element in <code>categories</code> should also be a JSON object with the following fields:</p>
<ul>
<li><p class="startli"><code>level</code></p>
<p class="startli">This field is required. It should be a string or positive integer value specifying the log level for this category.</p>
</li>
<li><p class="startli"><code>inherit</code></p>
<p class="startli">This should be a boolean value indicating if this category should inherit its effective log level from its parent category if its parent has a more verbose log level setting.</p>
<p class="startli">This field is optional, and defaults to true if not present.</p>
</li>
</ul>
<p>Alternatively, the value for a log category may be a plain string or integer instead of a JSON object, in which case case the string or integer is treated as the log level for that category, with the inherit setting enabled.</p>
<h3>Log Handler Configuration</h3>
<p>If present, the <code>handlers</code> member of the top-level object should be a JSON object mapping log handler names to configuration settings for that log handler.</p>
<p>The value of each element in <code>handlers</code> should also be a JSON object with the following fields:</p>
<ul>
<li><p class="startli"><code>type</code></p>
<p class="startli">This field should be a string containing the name of the log handler type. This type name must correspond to <code>LogHandlerFactory</code> type registered with the <code>LoggerDB</code>.</p>
<p class="startli">If this field is not present then this configuration will be used to update an existing log handler. <a class="el" href="structA.html">A</a> log handler with this name must already exist. The values from the <code>options</code> field will be merged into the existing log handler options.</p>
</li>
<li><p class="startli"><code>options</code></p>
<p class="startli">This field is optional. If present, it should be a JSON object containing string-to-string mappings to be passed to the <code>LogHandlerFactory</code> for constructing this log handler.</p>
</li>
</ul>
<h3>Example</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;categories&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;foo&quot;: { &quot;level&quot;: &quot;INFO&quot;, &quot;handlers&quot;: [&quot;stderr&quot;] },</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &quot;foo.only_fatal&quot;: { &quot;level&quot;: &quot;FATAL&quot;, &quot;inherit&quot;: false }</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  }</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &quot;handlers&quot;: {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &quot;stderr&quot;: {</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;type&quot;: &quot;stream&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      &quot;options&quot;: {</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        &quot;stream&quot;: &quot;stderr&quot;,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        &quot;async&quot;: true,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        &quot;sync_level&quot;: &quot;WARN&quot;,</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &quot;max_buffer_size&quot;: 4096000</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;      }</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    }</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  }</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;}</div></div><!-- fragment --><h2>Custom Configuration Mechanisms </h2>
<p>Internally the the <code>LogConfig</code> class represents configuration settings for the folly logging library. Users of the logging library can also programmatically construct their own <code>LogConfig</code> objects and use the <code>LoggerDB::updateConfig()</code> and <code>LoggerDB::resetConfig()</code> APIs to apply the configuration changes.</p>
<p>You can also directly manipulate the log level and other settings on <code>LogCategory</code> objects.</p>
<p>While it is possible to also manually create new <code>LogHandler</code> objects, it is generally preferred to do this using the <code>LoggerDB::updateConfig()</code> and <code>LoggerDB::resetConfig()</code> APIs. If you manually create a new <code>LogHandler</code> and directly attach it to some categories the <code>LoggerDB::getConfig()</code> call will not be able to return complete information for your manually created log handler, since it does not have a name or handler type that can be included in the configuration. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
