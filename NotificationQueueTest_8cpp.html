<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: proxygen/folly/folly/io/async/test/NotificationQueueTest.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('NotificationQueueTest_8cpp.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">NotificationQueueTest.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="NotificationQueue_8h_source.html">folly/io/async/NotificationQueue.h</a>&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;list&gt;</code><br />
<code>#include &lt;thread&gt;</code><br />
<code>#include &lt;<a class="el" href="ScopedEventBaseThread_8h_source.html">folly/io/async/ScopedEventBaseThread.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="GTest_8h_source.html">folly/portability/GTest.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="synchronization_2Baton_8h_source.html">folly/synchronization/Baton.h</a>&gt;</code><br />
<code>#include &lt;sys/wait.h&gt;</code><br />
</div>
<p><a href="NotificationQueueTest_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classQueueConsumer.html">QueueConsumer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classQueueTest.html">QueueTest</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a794b6e13f14e672c05d797a17fba4570"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="classfolly_1_1NotificationQueue.html">NotificationQueue</a>&lt; int &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#a794b6e13f14e672c05d797a17fba4570">IntQueue</a></td></tr>
<tr class="separator:a794b6e13f14e672c05d797a17fba4570"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa03f92835bdf986aa0bf09647524915b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#aa03f92835bdf986aa0bf09647524915b">TEST</a> (NotificationQueueTest, ConsumeUntilDrained)</td></tr>
<tr class="separator:aa03f92835bdf986aa0bf09647524915b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5289f95450bd0116d17386edfafb293"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#ac5289f95450bd0116d17386edfafb293">TEST</a> (NotificationQueueTest, ConsumeUntilDrainedStress)</td></tr>
<tr class="separator:ac5289f95450bd0116d17386edfafb293"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dba95be889b653ec136267ce69f1785"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#a0dba95be889b653ec136267ce69f1785">TEST</a> (NotificationQueueTest, SendOnePipe)</td></tr>
<tr class="separator:a0dba95be889b653ec136267ce69f1785"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac48229c0729c29d997a76662e8b76e6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#aac48229c0729c29d997a76662e8b76e6">TEST</a> (NotificationQueueTest, PutMessagesPipe)</td></tr>
<tr class="separator:aac48229c0729c29d997a76662e8b76e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51993e4279deb1c7fef2804f9bcb7a98"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#a51993e4279deb1c7fef2804f9bcb7a98">TEST</a> (NotificationQueueTest, MultiConsumerPipe)</td></tr>
<tr class="separator:a51993e4279deb1c7fef2804f9bcb7a98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cce759ee234072093873dc50057c1ee"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#a6cce759ee234072093873dc50057c1ee">TEST</a> (NotificationQueueTest, MaxQueueSizePipe)</td></tr>
<tr class="separator:a6cce759ee234072093873dc50057c1ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a508dd6cec397fa276fd1a77da461a36e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#a508dd6cec397fa276fd1a77da461a36e">TEST</a> (NotificationQueueTest, MaxReadAtOncePipe)</td></tr>
<tr class="separator:a508dd6cec397fa276fd1a77da461a36e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b16b5f9290da48c74374875332b588e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#a8b16b5f9290da48c74374875332b588e">TEST</a> (NotificationQueueTest, DestroyCallbackPipe)</td></tr>
<tr class="separator:a8b16b5f9290da48c74374875332b588e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a895b8f96f77882a37a23d6ff3b4778d6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#a895b8f96f77882a37a23d6ff3b4778d6">TEST</a> (NotificationQueueTest, UseAfterFork)</td></tr>
<tr class="separator:a895b8f96f77882a37a23d6ff3b4778d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79364e92a6a0fa3066a6289334cf6e92"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="NotificationQueueTest_8cpp.html#a79364e92a6a0fa3066a6289334cf6e92">TEST</a> (NotificationQueueConsumer, make)</td></tr>
<tr class="separator:a79364e92a6a0fa3066a6289334cf6e92"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a794b6e13f14e672c05d797a17fba4570"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="classfolly_1_1NotificationQueue.html">NotificationQueue</a>&lt;int&gt; <a class="el" href="NotificationQueueTest_8cpp.html#a794b6e13f14e672c05d797a17fba4570">IntQueue</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00036">36</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aa03f92835bdf986aa0bf09647524915b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST </td>
          <td>(</td>
          <td class="paramtype">NotificationQueueTest&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ConsumeUntilDrained&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00408">408</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

<p>References <a class="el" href="NotificationQueue_8h_source.html#l00848">folly::NotificationQueue&lt; MessageT &gt;::Consumer::consumeUntilDrained()</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01922">EXPECT_EQ</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01862">EXPECT_FALSE</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01843">EXPECT_THROW</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01859">EXPECT_TRUE</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00049">QueueConsumer::fn</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">i</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00050">QueueConsumer::messages</a>, <a class="el" href="NotificationQueue_8h_source.html#l00408">folly::NotificationQueue&lt; MessageT &gt;::putMessage()</a>, <a class="el" href="NotificationQueue_8h_source.html#l00416">folly::NotificationQueue&lt; MessageT &gt;::putMessages()</a>, <a class="el" href="NotificationQueue_8h_source.html#l00168">folly::NotificationQueue&lt; MessageT &gt;::Consumer::setMaxReadAtOnce()</a>, <a class="el" href="NotificationQueue_8h_source.html#l00114">folly::NotificationQueue&lt; MessageT &gt;::Consumer::startConsuming()</a>, <a class="el" href="NotificationQueue_8h_source.html#l00377">folly::NotificationQueue&lt; MessageT &gt;::tryPutMessage()</a>, and <a class="el" href="NotificationQueue_8h_source.html#l00390">folly::NotificationQueue&lt; MessageT &gt;::tryPutMessageNoThrow()</a>.</p>

<p>Referenced by <a class="el" href="NotificationQueueTest_8cpp_source.html#l00455">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                                                 {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">// Basic tests: make sure we</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="comment">// - drain all the messages</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="comment">// - ignore any maxReadAtOnce</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="comment">// - can&#39;t add messages during draining</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <a class="code" href="classfolly_1_1EventBase.html">EventBase</a> eventBase;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <a class="code" href="classfolly_1_1NotificationQueue.html">IntQueue</a> queue;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <a class="code" href="classQueueConsumer.html">QueueConsumer</a> consumer;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  consumer.<a class="code" href="classQueueConsumer.html#a15a703da8ccc4b67c0d31103de9026f9">fn</a> = [&amp;](<span class="keywordtype">int</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>) {</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a789842b4475eed948e6fd18390d5a859">EXPECT_THROW</a>(queue.<a class="code" href="classfolly_1_1NotificationQueue.html#a0cafd6b565ea4c768926f5144fe71132">tryPutMessage</a>(<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>), std::runtime_error);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#aeb6c7ae89f440c90c1a1815951c836da">EXPECT_FALSE</a>(queue.<a class="code" href="classfolly_1_1NotificationQueue.html#a237dd8599a83b3e52206306731ad0c33">tryPutMessageNoThrow</a>(<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>));</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a789842b4475eed948e6fd18390d5a859">EXPECT_THROW</a>(queue.<a class="code" href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">putMessage</a>(<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>), std::runtime_error);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    std::vector&lt;int&gt; ints{1, 2, 3};</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a789842b4475eed948e6fd18390d5a859">EXPECT_THROW</a>(</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        queue.<a class="code" href="classfolly_1_1NotificationQueue.html#aed65dca418bd23f142b791938ac00527">putMessages</a>(ints.begin(), ints.end()), std::runtime_error);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  };</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  consumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a5d50d4d03ad7c4fea23922175cf1f8e6">setMaxReadAtOnce</a>(10); <span class="comment">// We should ignore this</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  consumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a863f5ff25d0e48eb6f95dcfdf5e99101">startConsuming</a>(&amp;eventBase, &amp;queue);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; 20; <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>++) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    queue.<a class="code" href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">putMessage</a>(<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  }</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ac33e7cdfb5d44a7a0f0ab552eb5c3c6a">EXPECT_TRUE</a>(consumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a63bd1f4d224c201e8a8cea0ec6a10bbf">consumeUntilDrained</a>());</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(20, consumer.<a class="code" href="classQueueConsumer.html#a89dd8f6fa10c7c0092c95030a185a4ff">messages</a>.size());</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="comment">// Make sure there can only be one drainer at once</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <a class="code" href="classfolly_1_1Baton.html">folly::Baton&lt;&gt;</a> callbackBaton, threadStartBaton;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  consumer.<a class="code" href="classQueueConsumer.html#a15a703da8ccc4b67c0d31103de9026f9">fn</a> = [&amp;](<span class="keywordtype">int</span> <span class="comment">/* i */</span>) { callbackBaton.wait(); };</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <a class="code" href="classQueueConsumer.html">QueueConsumer</a> competingConsumer;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  competingConsumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a863f5ff25d0e48eb6f95dcfdf5e99101">startConsuming</a>(&amp;eventBase, &amp;queue);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  queue.<a class="code" href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">putMessage</a>(1);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;  atomic&lt;bool&gt; raceA{<span class="keyword">false</span>};</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  atomic&lt;bool&gt; raceB{<span class="keyword">false</span>};</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  <span class="keywordtype">size_t</span> numConsA = 0;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <span class="keywordtype">size_t</span> numConsB = 0;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keyword">auto</span> thread = std::thread([&amp;] {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    threadStartBaton.post();</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    raceB = consumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a63bd1f4d224c201e8a8cea0ec6a10bbf">consumeUntilDrained</a>(&amp;numConsB) &amp;&amp; numConsB;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  });</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  threadStartBaton.wait();</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  raceA = competingConsumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a63bd1f4d224c201e8a8cea0ec6a10bbf">consumeUntilDrained</a>(&amp;numConsA) &amp;&amp; numConsA;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;  callbackBaton.post();</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  thread.join();</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#aeb6c7ae89f440c90c1a1815951c836da">EXPECT_FALSE</a>(raceA &amp;&amp; raceB);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ac33e7cdfb5d44a7a0f0ab552eb5c3c6a">EXPECT_TRUE</a>(raceA || raceB);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ac33e7cdfb5d44a7a0f0ab552eb5c3c6a">EXPECT_TRUE</a>(raceA ^ raceB);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;}</div><div class="ttc" id="classfolly_1_1NotificationQueue_1_1Consumer_html_a5d50d4d03ad7c4fea23922175cf1f8e6"><div class="ttname"><a href="classfolly_1_1NotificationQueue_1_1Consumer.html#a5d50d4d03ad7c4fea23922175cf1f8e6">folly::NotificationQueue::Consumer::setMaxReadAtOnce</a></div><div class="ttdeci">void setMaxReadAtOnce(uint32_t maxAtOnce)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00168">NotificationQueue.h:168</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_html_a7e98b8a17c0aad30ba64d47b74e2a6c1"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">gtest_output_test_golden_lin.txt:83</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_a789842b4475eed948e6fd18390d5a859"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a789842b4475eed948e6fd18390d5a859">EXPECT_THROW</a></div><div class="ttdeci">#define EXPECT_THROW(statement, expected_exception)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01843">gtest.h:1843</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_a4159019abda84f5366acdb7604ff220a"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a></div><div class="ttdeci">#define EXPECT_EQ(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01922">gtest.h:1922</a></div></div>
<div class="ttc" id="classQueueConsumer_html"><div class="ttname"><a href="classQueueConsumer.html">QueueConsumer</a></div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueueTest_8cpp_source.html#l00038">NotificationQueueTest.cpp:38</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html_add1de011f690908b0582ae97a9dd981e"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">folly::NotificationQueue::putMessage</a></div><div class="ttdeci">void putMessage(MessageTT &amp;&amp;message)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00408">NotificationQueue.h:408</a></div></div>
<div class="ttc" id="classQueueConsumer_html_a15a703da8ccc4b67c0d31103de9026f9"><div class="ttname"><a href="classQueueConsumer.html#a15a703da8ccc4b67c0d31103de9026f9">QueueConsumer::fn</a></div><div class="ttdeci">std::function&lt; void(int)&gt; fn</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueueTest_8cpp_source.html#l00049">NotificationQueueTest.cpp:49</a></div></div>
<div class="ttc" id="classfolly_1_1Baton_html"><div class="ttname"><a href="classfolly_1_1Baton.html">folly::Baton</a></div><div class="ttdef"><b>Definition:</b> <a href="synchronization_2Baton_8h_source.html#l00056">Baton.h:56</a></div></div>
<div class="ttc" id="classQueueConsumer_html_a89dd8f6fa10c7c0092c95030a185a4ff"><div class="ttname"><a href="classQueueConsumer.html#a89dd8f6fa10c7c0092c95030a185a4ff">QueueConsumer::messages</a></div><div class="ttdeci">std::deque&lt; int &gt; messages</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueueTest_8cpp_source.html#l00050">NotificationQueueTest.cpp:50</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html">folly::NotificationQueue</a></div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00056">EventBase.h:56</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html_a237dd8599a83b3e52206306731ad0c33"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#a237dd8599a83b3e52206306731ad0c33">folly::NotificationQueue::tryPutMessageNoThrow</a></div><div class="ttdeci">bool tryPutMessageNoThrow(MessageTT &amp;&amp;message)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00390">NotificationQueue.h:390</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html_aed65dca418bd23f142b791938ac00527"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#aed65dca418bd23f142b791938ac00527">folly::NotificationQueue::putMessages</a></div><div class="ttdeci">void putMessages(InputIteratorT first, InputIteratorT last)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00416">NotificationQueue.h:416</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html"><div class="ttname"><a href="classfolly_1_1EventBase.html">folly::EventBase</a></div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00128">EventBase.h:128</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_ac33e7cdfb5d44a7a0f0ab552eb5c3c6a"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ac33e7cdfb5d44a7a0f0ab552eb5c3c6a">EXPECT_TRUE</a></div><div class="ttdeci">#define EXPECT_TRUE(condition)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01859">gtest.h:1859</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_aeb6c7ae89f440c90c1a1815951c836da"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#aeb6c7ae89f440c90c1a1815951c836da">EXPECT_FALSE</a></div><div class="ttdeci">#define EXPECT_FALSE(condition)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01862">gtest.h:1862</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_1_1Consumer_html_a863f5ff25d0e48eb6f95dcfdf5e99101"><div class="ttname"><a href="classfolly_1_1NotificationQueue_1_1Consumer.html#a863f5ff25d0e48eb6f95dcfdf5e99101">folly::NotificationQueue::Consumer::startConsuming</a></div><div class="ttdeci">void startConsuming(EventBase *eventBase, NotificationQueue *queue)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00114">NotificationQueue.h:114</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_1_1Consumer_html_a63bd1f4d224c201e8a8cea0ec6a10bbf"><div class="ttname"><a href="classfolly_1_1NotificationQueue_1_1Consumer.html#a63bd1f4d224c201e8a8cea0ec6a10bbf">folly::NotificationQueue::Consumer::consumeUntilDrained</a></div><div class="ttdeci">bool consumeUntilDrained(size_t *numConsumed=nullptr) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00848">NotificationQueue.h:848</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html_a0cafd6b565ea4c768926f5144fe71132"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#a0cafd6b565ea4c768926f5144fe71132">folly::NotificationQueue::tryPutMessage</a></div><div class="ttdeci">void tryPutMessage(MessageTT &amp;&amp;message)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00377">NotificationQueue.h:377</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac5289f95450bd0116d17386edfafb293"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST </td>
          <td>(</td>
          <td class="paramtype">NotificationQueueTest&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ConsumeUntilDrainedStress&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00455">455</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

<p>References <a class="el" href="NotificationQueue_8h_source.html#l00848">folly::NotificationQueue&lt; MessageT &gt;::Consumer::consumeUntilDrained()</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00349">QueueTest::destroyCallback()</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01922">EXPECT_EQ</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01862">EXPECT_FALSE</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01843">EXPECT_THROW</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01859">EXPECT_TRUE</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00049">QueueConsumer::fn</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">i</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00218">QueueTest::maxQueueSize()</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00275">QueueTest::maxReadAtOnce()</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00050">QueueConsumer::messages</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00138">QueueTest::multiConsumer()</a>, <a class="el" href="NotificationQueue_8h_source.html#l00408">folly::NotificationQueue&lt; MessageT &gt;::putMessage()</a>, <a class="el" href="NotificationQueue_8h_source.html#l00416">folly::NotificationQueue&lt; MessageT &gt;::putMessages()</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00070">QueueTest::sendOne()</a>, <a class="el" href="NotificationQueue_8h_source.html#l00168">folly::NotificationQueue&lt; MessageT &gt;::Consumer::setMaxReadAtOnce()</a>, <a class="el" href="NotificationQueue_8h_source.html#l00114">folly::NotificationQueue&lt; MessageT &gt;::Consumer::startConsuming()</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00408">TEST()</a>, <a class="el" href="NotificationQueue_8h_source.html#l00377">folly::NotificationQueue&lt; MessageT &gt;::tryPutMessage()</a>, and <a class="el" href="NotificationQueue_8h_source.html#l00390">folly::NotificationQueue&lt; MessageT &gt;::tryPutMessageNoThrow()</a>.</p>
<div class="fragment"><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                                       {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; 1 &lt;&lt; 8; ++<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>) {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// Basic tests: make sure we</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">// - drain all the messages</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">// - ignore any maxReadAtOnce</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// - can&#39;t add messages during draining</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <a class="code" href="classfolly_1_1EventBase.html">EventBase</a> eventBase;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <a class="code" href="classfolly_1_1NotificationQueue.html">IntQueue</a> queue;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="classQueueConsumer.html">QueueConsumer</a> consumer;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    consumer.<a class="code" href="classQueueConsumer.html#a15a703da8ccc4b67c0d31103de9026f9">fn</a> = [&amp;](<span class="keywordtype">int</span> j) {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a789842b4475eed948e6fd18390d5a859">EXPECT_THROW</a>(queue.<a class="code" href="classfolly_1_1NotificationQueue.html#a0cafd6b565ea4c768926f5144fe71132">tryPutMessage</a>(j), std::runtime_error);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#aeb6c7ae89f440c90c1a1815951c836da">EXPECT_FALSE</a>(queue.<a class="code" href="classfolly_1_1NotificationQueue.html#a237dd8599a83b3e52206306731ad0c33">tryPutMessageNoThrow</a>(j));</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a789842b4475eed948e6fd18390d5a859">EXPECT_THROW</a>(queue.<a class="code" href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">putMessage</a>(j), std::runtime_error);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      std::vector&lt;int&gt; ints{1, 2, 3};</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a789842b4475eed948e6fd18390d5a859">EXPECT_THROW</a>(</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;          queue.<a class="code" href="classfolly_1_1NotificationQueue.html#aed65dca418bd23f142b791938ac00527">putMessages</a>(ints.begin(), ints.end()), std::runtime_error);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    };</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    consumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a5d50d4d03ad7c4fea23922175cf1f8e6">setMaxReadAtOnce</a>(10); <span class="comment">// We should ignore this</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    consumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a863f5ff25d0e48eb6f95dcfdf5e99101">startConsuming</a>(&amp;eventBase, &amp;queue);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; 20; j++) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      queue.<a class="code" href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">putMessage</a>(j);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ac33e7cdfb5d44a7a0f0ab552eb5c3c6a">EXPECT_TRUE</a>(consumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a63bd1f4d224c201e8a8cea0ec6a10bbf">consumeUntilDrained</a>());</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(20, consumer.<a class="code" href="classQueueConsumer.html#a89dd8f6fa10c7c0092c95030a185a4ff">messages</a>.size());</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="comment">// Make sure there can only be one drainer at once</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <a class="code" href="classfolly_1_1Baton.html">folly::Baton&lt;&gt;</a> callbackBaton, threadStartBaton;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    consumer.<a class="code" href="classQueueConsumer.html#a15a703da8ccc4b67c0d31103de9026f9">fn</a> = [&amp;](<span class="keywordtype">int</span> <span class="comment">/* i */</span>) { callbackBaton.wait(); };</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <a class="code" href="classQueueConsumer.html">QueueConsumer</a> competingConsumer;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    competingConsumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a863f5ff25d0e48eb6f95dcfdf5e99101">startConsuming</a>(&amp;eventBase, &amp;queue);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    queue.<a class="code" href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">putMessage</a>(1);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    atomic&lt;bool&gt; raceA{<span class="keyword">false</span>};</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    atomic&lt;bool&gt; raceB{<span class="keyword">false</span>};</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordtype">size_t</span> numConsA = 0;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordtype">size_t</span> numConsB = 0;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keyword">auto</span> thread = std::thread([&amp;] {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      threadStartBaton.post();</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      raceB = consumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a63bd1f4d224c201e8a8cea0ec6a10bbf">consumeUntilDrained</a>(&amp;numConsB) &amp;&amp; numConsB;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    });</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    threadStartBaton.wait();</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    raceA = competingConsumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a63bd1f4d224c201e8a8cea0ec6a10bbf">consumeUntilDrained</a>(&amp;numConsA) &amp;&amp; numConsA;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    callbackBaton.post();</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    thread.join();</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#aeb6c7ae89f440c90c1a1815951c836da">EXPECT_FALSE</a>(raceA &amp;&amp; raceB);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ac33e7cdfb5d44a7a0f0ab552eb5c3c6a">EXPECT_TRUE</a>(raceA || raceB);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ac33e7cdfb5d44a7a0f0ab552eb5c3c6a">EXPECT_TRUE</a>(raceA ^ raceB);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  }</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;}</div><div class="ttc" id="classfolly_1_1NotificationQueue_1_1Consumer_html_a5d50d4d03ad7c4fea23922175cf1f8e6"><div class="ttname"><a href="classfolly_1_1NotificationQueue_1_1Consumer.html#a5d50d4d03ad7c4fea23922175cf1f8e6">folly::NotificationQueue::Consumer::setMaxReadAtOnce</a></div><div class="ttdeci">void setMaxReadAtOnce(uint32_t maxAtOnce)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00168">NotificationQueue.h:168</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_html_a7e98b8a17c0aad30ba64d47b74e2a6c1"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">gtest_output_test_golden_lin.txt:83</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_a789842b4475eed948e6fd18390d5a859"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a789842b4475eed948e6fd18390d5a859">EXPECT_THROW</a></div><div class="ttdeci">#define EXPECT_THROW(statement, expected_exception)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01843">gtest.h:1843</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_a4159019abda84f5366acdb7604ff220a"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a></div><div class="ttdeci">#define EXPECT_EQ(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01922">gtest.h:1922</a></div></div>
<div class="ttc" id="classQueueConsumer_html"><div class="ttname"><a href="classQueueConsumer.html">QueueConsumer</a></div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueueTest_8cpp_source.html#l00038">NotificationQueueTest.cpp:38</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html_add1de011f690908b0582ae97a9dd981e"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">folly::NotificationQueue::putMessage</a></div><div class="ttdeci">void putMessage(MessageTT &amp;&amp;message)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00408">NotificationQueue.h:408</a></div></div>
<div class="ttc" id="classQueueConsumer_html_a15a703da8ccc4b67c0d31103de9026f9"><div class="ttname"><a href="classQueueConsumer.html#a15a703da8ccc4b67c0d31103de9026f9">QueueConsumer::fn</a></div><div class="ttdeci">std::function&lt; void(int)&gt; fn</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueueTest_8cpp_source.html#l00049">NotificationQueueTest.cpp:49</a></div></div>
<div class="ttc" id="classfolly_1_1Baton_html"><div class="ttname"><a href="classfolly_1_1Baton.html">folly::Baton</a></div><div class="ttdef"><b>Definition:</b> <a href="synchronization_2Baton_8h_source.html#l00056">Baton.h:56</a></div></div>
<div class="ttc" id="classQueueConsumer_html_a89dd8f6fa10c7c0092c95030a185a4ff"><div class="ttname"><a href="classQueueConsumer.html#a89dd8f6fa10c7c0092c95030a185a4ff">QueueConsumer::messages</a></div><div class="ttdeci">std::deque&lt; int &gt; messages</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueueTest_8cpp_source.html#l00050">NotificationQueueTest.cpp:50</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html">folly::NotificationQueue</a></div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00056">EventBase.h:56</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html_a237dd8599a83b3e52206306731ad0c33"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#a237dd8599a83b3e52206306731ad0c33">folly::NotificationQueue::tryPutMessageNoThrow</a></div><div class="ttdeci">bool tryPutMessageNoThrow(MessageTT &amp;&amp;message)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00390">NotificationQueue.h:390</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html_aed65dca418bd23f142b791938ac00527"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#aed65dca418bd23f142b791938ac00527">folly::NotificationQueue::putMessages</a></div><div class="ttdeci">void putMessages(InputIteratorT first, InputIteratorT last)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00416">NotificationQueue.h:416</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html"><div class="ttname"><a href="classfolly_1_1EventBase.html">folly::EventBase</a></div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00128">EventBase.h:128</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_ac33e7cdfb5d44a7a0f0ab552eb5c3c6a"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ac33e7cdfb5d44a7a0f0ab552eb5c3c6a">EXPECT_TRUE</a></div><div class="ttdeci">#define EXPECT_TRUE(condition)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01859">gtest.h:1859</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_aeb6c7ae89f440c90c1a1815951c836da"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#aeb6c7ae89f440c90c1a1815951c836da">EXPECT_FALSE</a></div><div class="ttdeci">#define EXPECT_FALSE(condition)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01862">gtest.h:1862</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_1_1Consumer_html_a863f5ff25d0e48eb6f95dcfdf5e99101"><div class="ttname"><a href="classfolly_1_1NotificationQueue_1_1Consumer.html#a863f5ff25d0e48eb6f95dcfdf5e99101">folly::NotificationQueue::Consumer::startConsuming</a></div><div class="ttdeci">void startConsuming(EventBase *eventBase, NotificationQueue *queue)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00114">NotificationQueue.h:114</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_1_1Consumer_html_a63bd1f4d224c201e8a8cea0ec6a10bbf"><div class="ttname"><a href="classfolly_1_1NotificationQueue_1_1Consumer.html#a63bd1f4d224c201e8a8cea0ec6a10bbf">folly::NotificationQueue::Consumer::consumeUntilDrained</a></div><div class="ttdeci">bool consumeUntilDrained(size_t *numConsumed=nullptr) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00848">NotificationQueue.h:848</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html_a0cafd6b565ea4c768926f5144fe71132"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#a0cafd6b565ea4c768926f5144fe71132">folly::NotificationQueue::tryPutMessage</a></div><div class="ttdeci">void tryPutMessage(MessageTT &amp;&amp;message)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00377">NotificationQueue.h:377</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0dba95be889b653ec136267ce69f1785"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST </td>
          <td>(</td>
          <td class="paramtype">NotificationQueueTest&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SendOnePipe&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00536">536</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

<p>References <a class="el" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue&lt; MessageT &gt;::PIPE</a>, and <a class="el" href="NotificationQueueTest_8cpp_source.html#l00070">QueueTest::sendOne()</a>.</p>
<div class="fragment"><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                                         {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <a class="code" href="classQueueTest.html">QueueTest</a> qt(0, <a class="code" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">IntQueue::FdType::PIPE</a>);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  qt.sendOne();</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;}</div><div class="ttc" id="classfolly_1_1NotificationQueue_html_abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue::FdType::PIPE</a></div></div>
<div class="ttc" id="classQueueTest_html"><div class="ttname"><a href="classQueueTest.html">QueueTest</a></div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2samples_2sample3__unittest_8cc_source.html#l00070">sample3_unittest.cc:70</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aac48229c0729c29d997a76662e8b76e6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST </td>
          <td>(</td>
          <td class="paramtype">NotificationQueueTest&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PutMessagesPipe&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00541">541</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

<p>References <a class="el" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue&lt; MessageT &gt;::PIPE</a>, and <a class="el" href="NotificationQueueTest_8cpp_source.html#l00070">QueueTest::sendOne()</a>.</p>
<div class="fragment"><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                             {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <a class="code" href="classQueueTest.html">QueueTest</a> qt(0, <a class="code" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">IntQueue::FdType::PIPE</a>);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  qt.sendOne();</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;}</div><div class="ttc" id="classfolly_1_1NotificationQueue_html_abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue::FdType::PIPE</a></div></div>
<div class="ttc" id="classQueueTest_html"><div class="ttname"><a href="classQueueTest.html">QueueTest</a></div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2samples_2sample3__unittest_8cc_source.html#l00070">sample3_unittest.cc:70</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a51993e4279deb1c7fef2804f9bcb7a98"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST </td>
          <td>(</td>
          <td class="paramtype">NotificationQueueTest&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">MultiConsumerPipe&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00546">546</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

<p>References <a class="el" href="NotificationQueueTest_8cpp_source.html#l00138">QueueTest::multiConsumer()</a>, and <a class="el" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue&lt; MessageT &gt;::PIPE</a>.</p>
<div class="fragment"><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                               {</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <a class="code" href="classQueueTest.html">QueueTest</a> qt(0, <a class="code" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">IntQueue::FdType::PIPE</a>);</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  qt.multiConsumer();</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;}</div><div class="ttc" id="classfolly_1_1NotificationQueue_html_abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue::FdType::PIPE</a></div></div>
<div class="ttc" id="classQueueTest_html"><div class="ttname"><a href="classQueueTest.html">QueueTest</a></div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2samples_2sample3__unittest_8cc_source.html#l00070">sample3_unittest.cc:70</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6cce759ee234072093873dc50057c1ee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST </td>
          <td>(</td>
          <td class="paramtype">NotificationQueueTest&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">MaxQueueSizePipe&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00551">551</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

<p>References <a class="el" href="NotificationQueueTest_8cpp_source.html#l00218">QueueTest::maxQueueSize()</a>, and <a class="el" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue&lt; MessageT &gt;::PIPE</a>.</p>
<div class="fragment"><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                              {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  <a class="code" href="classQueueTest.html">QueueTest</a> qt(5, <a class="code" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">IntQueue::FdType::PIPE</a>);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;  qt.maxQueueSize();</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;}</div><div class="ttc" id="classfolly_1_1NotificationQueue_html_abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue::FdType::PIPE</a></div></div>
<div class="ttc" id="classQueueTest_html"><div class="ttname"><a href="classQueueTest.html">QueueTest</a></div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2samples_2sample3__unittest_8cc_source.html#l00070">sample3_unittest.cc:70</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a508dd6cec397fa276fd1a77da461a36e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST </td>
          <td>(</td>
          <td class="paramtype">NotificationQueueTest&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">MaxReadAtOncePipe&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00556">556</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

<p>References <a class="el" href="NotificationQueueTest_8cpp_source.html#l00275">QueueTest::maxReadAtOnce()</a>, and <a class="el" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue&lt; MessageT &gt;::PIPE</a>.</p>
<div class="fragment"><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                                               {</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <a class="code" href="classQueueTest.html">QueueTest</a> qt(0, <a class="code" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">IntQueue::FdType::PIPE</a>);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  qt.maxReadAtOnce();</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;}</div><div class="ttc" id="classfolly_1_1NotificationQueue_html_abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue::FdType::PIPE</a></div></div>
<div class="ttc" id="classQueueTest_html"><div class="ttname"><a href="classQueueTest.html">QueueTest</a></div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2samples_2sample3__unittest_8cc_source.html#l00070">sample3_unittest.cc:70</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8b16b5f9290da48c74374875332b588e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST </td>
          <td>(</td>
          <td class="paramtype">NotificationQueueTest&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DestroyCallbackPipe&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00561">561</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

<p>References <a class="el" href="NotificationQueueTest_8cpp_source.html#l00349">QueueTest::destroyCallback()</a>, and <a class="el" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue&lt; MessageT &gt;::PIPE</a>.</p>
<div class="fragment"><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                                                 {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  <a class="code" href="classQueueTest.html">QueueTest</a> qt(0, <a class="code" href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">IntQueue::FdType::PIPE</a>);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  qt.destroyCallback();</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;}</div><div class="ttc" id="classfolly_1_1NotificationQueue_html_abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#abe52eeab87904e0fc0f70445c3fc97dea6e2dc574a6f6213a0bdee18a31b714fd">folly::NotificationQueue::FdType::PIPE</a></div></div>
<div class="ttc" id="classQueueTest_html"><div class="ttname"><a href="classQueueTest.html">QueueTest</a></div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2samples_2sample3__unittest_8cc_source.html#l00070">sample3_unittest.cc:70</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a895b8f96f77882a37a23d6ff3b4778d6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST </td>
          <td>(</td>
          <td class="paramtype">NotificationQueueTest&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UseAfterFork&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00575">575</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

<p>References <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01922">EXPECT_EQ</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01859">EXPECT_TRUE</a>, <a class="el" href="ScopedEventBaseThread_8h_source.html#l00049">folly::ScopedEventBaseThread::getEventBase()</a>, <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa551b723eafd6a31d444fcb2f5920fbd3">folly::INFO</a>, <a class="el" href="NotificationQueueTest_8cpp_source.html#l00050">QueueConsumer::messages</a>, <a class="el" href="NotificationQueue_8h_source.html#l00408">folly::NotificationQueue&lt; MessageT &gt;::putMessage()</a>, <a class="el" href="EventBase_8h_source.html#l00794">folly::EventBase::runInEventBaseThread()</a>, and <a class="el" href="NotificationQueue_8h_source.html#l00114">folly::NotificationQueue&lt; MessageT &gt;::Consumer::startConsuming()</a>.</p>
<div class="fragment"><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                                          {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <a class="code" href="classfolly_1_1NotificationQueue.html">IntQueue</a> queue;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keywordtype">int</span> childStatus = 0;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <a class="code" href="classQueueConsumer.html">QueueConsumer</a> consumer;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="comment">// Boost sets a custom SIGCHLD handler, which fails the test if a child</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="comment">// process exits abnormally.  We don&#39;t want this.</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  signal(SIGCHLD, SIG_DFL);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="comment">// Log some info so users reading the test output aren&#39;t confused</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="comment">// by the child process&#39; crash log messages.</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;This test makes sure the child process crashes.  &quot;</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Error log messagges and a backtrace are expected.&quot;</span>;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="comment">// Start a separate thread consuming from the queue</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <a class="code" href="classfolly_1_1ScopedEventBaseThread.html">ScopedEventBaseThread</a> t1;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    t1.<a class="code" href="classfolly_1_1ScopedEventBaseThread.html#a8c79965a8607cd513745c1f6d28fd4df">getEventBase</a>()-&gt;<a class="code" href="classfolly_1_1EventBase.html#a064e4b74656102dbb6b9dccc7ffeb8cf">runInEventBaseThread</a>(</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        [&amp;] { consumer.<a class="code" href="classfolly_1_1NotificationQueue_1_1Consumer.html#a863f5ff25d0e48eb6f95dcfdf5e99101">startConsuming</a>(t1.<a class="code" href="classfolly_1_1ScopedEventBaseThread.html#a8c79965a8607cd513745c1f6d28fd4df">getEventBase</a>(), &amp;queue); });</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">// Send a message to it, just for sanity checking</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    queue.<a class="code" href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">putMessage</a>(1234);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">// Fork</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    pid_t pid = fork();</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span> (pid == 0) {</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <span class="comment">// The boost test framework installs signal handlers to catch errors.</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <span class="comment">// We only want to catch in the parent.  In the child let SIGABRT crash</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="comment">// us normally.</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      signal(SIGABRT, SIG_DFL);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="comment">// Child.</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="comment">// We&#39;re horrible people, so we try to send a message to the queue</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="comment">// that is being consumed in the parent process.</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="comment">//</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <span class="comment">// The putMessage() call should catch this error, and crash our process.</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      queue.<a class="code" href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">putMessage</a>(9876);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="comment">// We shouldn&#39;t reach here.</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      _exit(0);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    PCHECK(pid &gt; 0);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="comment">// Parent.  Wait for the child to exit.</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keyword">auto</span> waited = waitpid(pid, &amp;childStatus, 0);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(pid, waited);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="comment">// Send another message to the queue before we terminate the thread.</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    queue.<a class="code" href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">putMessage</a>(5678);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="comment">// The child process should have crashed when it tried to call putMessage()</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <span class="comment">// on our NotificationQueue.</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ac33e7cdfb5d44a7a0f0ab552eb5c3c6a">EXPECT_TRUE</a>(WIFSIGNALED(childStatus));</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(SIGABRT, WTERMSIG(childStatus));</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  <span class="comment">// Make sure the parent saw the expected messages.</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// It should have gotten 1234 and 5678 from the parent process, but not</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// 9876 from the child.</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(2, consumer.<a class="code" href="classQueueConsumer.html#a89dd8f6fa10c7c0092c95030a185a4ff">messages</a>.size());</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(1234, consumer.<a class="code" href="classQueueConsumer.html#a89dd8f6fa10c7c0092c95030a185a4ff">messages</a>.front());</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  consumer.<a class="code" href="classQueueConsumer.html#a89dd8f6fa10c7c0092c95030a185a4ff">messages</a>.pop_front();</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(5678, consumer.<a class="code" href="classQueueConsumer.html#a89dd8f6fa10c7c0092c95030a185a4ff">messages</a>.front());</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  consumer.<a class="code" href="classQueueConsumer.html#a89dd8f6fa10c7c0092c95030a185a4ff">messages</a>.pop_front();</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;}</div><div class="ttc" id="classfolly_1_1ScopedEventBaseThread_html_a8c79965a8607cd513745c1f6d28fd4df"><div class="ttname"><a href="classfolly_1_1ScopedEventBaseThread.html#a8c79965a8607cd513745c1f6d28fd4df">folly::ScopedEventBaseThread::getEventBase</a></div><div class="ttdeci">EventBase * getEventBase() const </div><div class="ttdef"><b>Definition:</b> <a href="ScopedEventBaseThread_8h_source.html#l00049">ScopedEventBaseThread.h:49</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_a4159019abda84f5366acdb7604ff220a"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a></div><div class="ttdeci">#define EXPECT_EQ(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01922">gtest.h:1922</a></div></div>
<div class="ttc" id="classQueueConsumer_html"><div class="ttname"><a href="classQueueConsumer.html">QueueConsumer</a></div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueueTest_8cpp_source.html#l00038">NotificationQueueTest.cpp:38</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html_add1de011f690908b0582ae97a9dd981e"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html#add1de011f690908b0582ae97a9dd981e">folly::NotificationQueue::putMessage</a></div><div class="ttdeci">void putMessage(MessageTT &amp;&amp;message)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00408">NotificationQueue.h:408</a></div></div>
<div class="ttc" id="classQueueConsumer_html_a89dd8f6fa10c7c0092c95030a185a4ff"><div class="ttname"><a href="classQueueConsumer.html#a89dd8f6fa10c7c0092c95030a185a4ff">QueueConsumer::messages</a></div><div class="ttdeci">std::deque&lt; int &gt; messages</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueueTest_8cpp_source.html#l00050">NotificationQueueTest.cpp:50</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a064e4b74656102dbb6b9dccc7ffeb8cf"><div class="ttname"><a href="classfolly_1_1EventBase.html#a064e4b74656102dbb6b9dccc7ffeb8cf">folly::EventBase::runInEventBaseThread</a></div><div class="ttdeci">bool runInEventBaseThread(void(*fn)(T *), T *arg)</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00794">EventBase.h:794</a></div></div>
<div class="ttc" id="classfolly_1_1ScopedEventBaseThread_html"><div class="ttname"><a href="classfolly_1_1ScopedEventBaseThread.html">folly::ScopedEventBaseThread</a></div><div class="ttdef"><b>Definition:</b> <a href="ScopedEventBaseThread_8h_source.html#l00039">ScopedEventBaseThread.h:39</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html">folly::NotificationQueue</a></div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00056">EventBase.h:56</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_ac33e7cdfb5d44a7a0f0ab552eb5c3c6a"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#ac33e7cdfb5d44a7a0f0ab552eb5c3c6a">EXPECT_TRUE</a></div><div class="ttdeci">#define EXPECT_TRUE(condition)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01859">gtest.h:1859</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_1_1Consumer_html_a863f5ff25d0e48eb6f95dcfdf5e99101"><div class="ttname"><a href="classfolly_1_1NotificationQueue_1_1Consumer.html#a863f5ff25d0e48eb6f95dcfdf5e99101">folly::NotificationQueue::Consumer::startConsuming</a></div><div class="ttdeci">void startConsuming(EventBase *eventBase, NotificationQueue *queue)</div><div class="ttdef"><b>Definition:</b> <a href="NotificationQueue_8h_source.html#l00114">NotificationQueue.h:114</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a79364e92a6a0fa3066a6289334cf6e92"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TEST </td>
          <td>(</td>
          <td class="paramtype">NotificationQueueConsumer&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">make&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="NotificationQueueTest_8cpp_source.html#l00641">641</a> of file <a class="el" href="NotificationQueueTest_8cpp_source.html">NotificationQueueTest.cpp</a>.</p>

<p>References <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01922">EXPECT_EQ</a>, <a class="el" href="EventBase_8cpp_source.html#l00271">folly::EventBase::loopOnce()</a>, <a class="el" href="extension__points_8h_source.html#l00040">folly::pushmi::__adl::noexcept()</a>, <a class="el" href="NotificationQueue_8h_source.html#l00377">folly::NotificationQueue&lt; MessageT &gt;::tryPutMessage()</a>, and <a class="el" href="Conv_8cpp_source.html#l00050">value</a>.</p>
<div class="fragment"><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                                      {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="keywordtype">int</span> <a class="code" href="Conv_8cpp.html#a2f6ac1714c34743067351b0d2a64162b">value</a> = 0;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <a class="code" href="classfolly_1_1EventBase.html">EventBase</a> evb;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <a class="code" href="classfolly_1_1NotificationQueue.html">NotificationQueue&lt;int&gt;</a> queue(32);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keyword">auto</span> consumer =</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      decltype(queue)::Consumer::make([&amp;](int&amp;&amp; msg) <a class="code" href="namespacefolly_1_1pushmi_1_1____adl.html#af474005039e5722873e3ac4d0f93ae6b">noexcept</a> { value = msg; });</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  consumer-&gt;startConsuming(&amp;evb, &amp;queue);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  <span class="keywordtype">int</span> <span class="keyword">const</span> newValue = 10;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  queue.tryPutMessage(newValue);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  evb.<a class="code" href="classfolly_1_1EventBase.html#a73967f738470c77247ac89cc97d0c303">loopOnce</a>();</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a>(newValue, value);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;}</div><div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_html_a4159019abda84f5366acdb7604ff220a"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h.html#a4159019abda84f5366acdb7604ff220a">EXPECT_EQ</a></div><div class="ttdeci">#define EXPECT_EQ(val1, val2)</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2include_2gtest_2gtest_8h_source.html#l01922">gtest.h:1922</a></div></div>
<div class="ttc" id="namespacefolly_1_1pushmi_1_1____adl_html_af474005039e5722873e3ac4d0f93ae6b"><div class="ttname"><a href="namespacefolly_1_1pushmi_1_1____adl.html#af474005039e5722873e3ac4d0f93ae6b">folly::pushmi::__adl::noexcept</a></div><div class="ttdeci">requires E e noexcept(noexcept(s.error(std::move(e))))</div><div class="ttdef"><b>Definition:</b> <a href="extension__points_8h_source.html#l00040">extension_points.h:40</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html_a73967f738470c77247ac89cc97d0c303"><div class="ttname"><a href="classfolly_1_1EventBase.html#a73967f738470c77247ac89cc97d0c303">folly::EventBase::loopOnce</a></div><div class="ttdeci">bool loopOnce(int flags=0)</div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8cpp_source.html#l00271">EventBase.cpp:271</a></div></div>
<div class="ttc" id="classfolly_1_1NotificationQueue_html"><div class="ttname"><a href="classfolly_1_1NotificationQueue.html">folly::NotificationQueue</a></div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00056">EventBase.h:56</a></div></div>
<div class="ttc" id="Conv_8cpp_html_a2f6ac1714c34743067351b0d2a64162b"><div class="ttname"><a href="Conv_8cpp.html#a2f6ac1714c34743067351b0d2a64162b">value</a></div><div class="ttdeci">static const char *const value</div><div class="ttdef"><b>Definition:</b> <a href="Conv_8cpp_source.html#l00050">Conv.cpp:50</a></div></div>
<div class="ttc" id="classfolly_1_1EventBase_html"><div class="ttname"><a href="classfolly_1_1EventBase.html">folly::EventBase</a></div><div class="ttdef"><b>Definition:</b> <a href="EventBase_8h_source.html#l00128">EventBase.h:128</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d333e33cf903653326082c1f32e03be5.html">proxygen</a></li><li class="navelem"><a class="el" href="dir_32ce190710b1753ff87b781fbaae9b47.html">folly</a></li><li class="navelem"><a class="el" href="dir_dcf8e1233ba68571c5027662569cd1d9.html">folly</a></li><li class="navelem"><a class="el" href="dir_8b8cdcef1613958d35fc1de7b2d6bb26.html">io</a></li><li class="navelem"><a class="el" href="dir_539f767ad421989063a43e032c2d9ec2.html">async</a></li><li class="navelem"><a class="el" href="dir_4aa706ae502ad6856b62fbb20230f9a9.html">test</a></li><li class="navelem"><a class="el" href="NotificationQueueTest_8cpp.html">NotificationQueueTest.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
