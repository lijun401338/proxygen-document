<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: wangle::SSLSessionCacheManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classwangle_1_1SSLSessionCacheManager.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="classwangle_1_1SSLSessionCacheManager-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">wangle::SSLSessionCacheManager Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for wangle::SSLSessionCacheManager:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classwangle_1_1SSLSessionCacheManager.png" usemap="#wangle::SSLSessionCacheManager_map" alt=""/>
  <map id="wangle::SSLSessionCacheManager_map" name="wangle::SSLSessionCacheManager_map">
</map>
 </div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a4030f258e176ee2884d7caf5cdfcdf50"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a4030f258e176ee2884d7caf5cdfcdf50">SSLSessionCacheManager</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> maxCacheSize, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> cacheCullSize, <a class="el" href="classfolly_1_1SSLContext.html">folly::SSLContext</a> *ctx, const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;<a class="el" href="wangle_2__build_2CMakeCache_8txt.html#a261f9f58ccbeaa962c4e675e4212c9cc">context</a>, <a class="el" href="classwangle_1_1SSLStats.html">SSLStats</a> *stats, const std::shared_ptr&lt; <a class="el" href="classwangle_1_1SSLCacheProvider.html">SSLCacheProvider</a> &gt; &amp;externalCache)</td></tr>
<tr class="separator:a4030f258e176ee2884d7caf5cdfcdf50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4acc297a239539b392ee966eefb9972d"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a4acc297a239539b392ee966eefb9972d">~SSLSessionCacheManager</a> ()</td></tr>
<tr class="separator:a4acc297a239539b392ee966eefb9972d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0c513a984f910c3193b123cf6b9c671"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#ab0c513a984f910c3193b123cf6b9c671">onGetSuccess</a> (<a class="el" href="structwangle_1_1SSLCacheProvider_1_1CacheContext.html">SSLCacheProvider::CacheContext</a> *cacheCtx, const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;<a class="el" href="Crc32CombineDetail_8cpp.html#aeaa7b1832e5d1cbfc21edb15bbe1700e">value</a>)</td></tr>
<tr class="separator:ab0c513a984f910c3193b123cf6b9c671"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cfb7cd671df4cbdd796de02b46b2d87"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a0cfb7cd671df4cbdd796de02b46b2d87">onGetSuccess</a> (<a class="el" href="structwangle_1_1SSLCacheProvider_1_1CacheContext.html">SSLCacheProvider::CacheContext</a> *cacheCtx, std::unique_ptr&lt; <a class="el" href="classfolly_1_1IOBuf.html">folly::IOBuf</a> &gt; valueBuf)</td></tr>
<tr class="separator:a0cfb7cd671df4cbdd796de02b46b2d87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abedd37c8a05961d8c8e37cb911bef961"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#abedd37c8a05961d8c8e37cb911bef961">onGetFailure</a> (<a class="el" href="structwangle_1_1SSLCacheProvider_1_1CacheContext.html">SSLCacheProvider::CacheContext</a> *cacheCtx)</td></tr>
<tr class="separator:abedd37c8a05961d8c8e37cb911bef961"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a6990e623fc028f0d0a54340fc5dcf282"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a6990e623fc028f0d0a54340fc5dcf282">shutdown</a> ()</td></tr>
<tr class="separator:a6990e623fc028f0d0a54340fc5dcf282"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a6750166829ba3d015e4c196c220e26d1"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a6750166829ba3d015e4c196c220e26d1">session_callback_arg_session_id_t</a> = unsigned char *</td></tr>
<tr class="separator:a6750166829ba3d015e4c196c220e26d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a7875fadfb0c9841875d1557db1f3f688"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a7875fadfb0c9841875d1557db1f3f688">newSession</a> (SSL *ssl, SSL_SESSION *session)</td></tr>
<tr class="separator:a7875fadfb0c9841875d1557db1f3f688"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ae2a8e403dd721b385da32a729be891"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a1ae2a8e403dd721b385da32a729be891">removeSession</a> (SSL_CTX *ctx, SSL_SESSION *session)</td></tr>
<tr class="separator:a1ae2a8e403dd721b385da32a729be891"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83bdcd3d13f7ad7b2f5dfe49b899fa0a"><td class="memItemLeft" align="right" valign="top">SSL_SESSION *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a83bdcd3d13f7ad7b2f5dfe49b899fa0a">getSession</a> (SSL *ssl, unsigned char *session_id, int id_len, int *copyflag)</td></tr>
<tr class="separator:a83bdcd3d13f7ad7b2f5dfe49b899fa0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d4ec5034ad29321233488242a76c1d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a3d4ec5034ad29321233488242a76c1d0">restoreSession</a> (<a class="el" href="structwangle_1_1SSLCacheProvider_1_1CacheContext.html">SSLCacheProvider::CacheContext</a> *cacheCtx, const <a class="el" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *<a class="el" href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a>, size_t length)</td></tr>
<tr class="separator:a3d4ec5034ad29321233488242a76c1d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1f2a70730492fd434d8d2ccdc0c456e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#aa1f2a70730492fd434d8d2ccdc0c456e">storeCacheRecord</a> (const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;sessionId, SSL_SESSION *session)</td></tr>
<tr class="separator:aa1f2a70730492fd434d8d2ccdc0c456e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a487067933f097a8efce51889aa7e8135"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a487067933f097a8efce51889aa7e8135">lookupCacheRecord</a> (const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;sessionId, <a class="el" href="classfolly_1_1AsyncSSLSocket.html">folly::AsyncSSLSocket</a> *sslSock)</td></tr>
<tr class="separator:a487067933f097a8efce51889aa7e8135"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67af0257227b9da91b6dd9c75d2ad385"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a67af0257227b9da91b6dd9c75d2ad385">restartSSLAccept</a> (const <a class="el" href="structwangle_1_1SSLCacheProvider_1_1CacheContext.html">SSLCacheProvider::CacheContext</a> *cacheCtx)</td></tr>
<tr class="separator:a67af0257227b9da91b6dd9c75d2ad385"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:ad2a3a11cce3fc2dc84f1edcd628002b6"><td class="memItemLeft" align="right" valign="top">static std::shared_ptr&lt; <a class="el" href="classwangle_1_1ShardedLocalSSLSessionCache.html">ShardedLocalSSLSessionCache</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#ad2a3a11cce3fc2dc84f1edcd628002b6">getLocalCache</a> (<a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> maxCacheSize, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> cacheCullSize)</td></tr>
<tr class="separator:ad2a3a11cce3fc2dc84f1edcd628002b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab86668d2e7540dfaf1513923901acd0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#aab86668d2e7540dfaf1513923901acd0">newSessionCallback</a> (SSL *ssl, SSL_SESSION *session)</td></tr>
<tr class="separator:aab86668d2e7540dfaf1513923901acd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1eb1f59969ce55c6430c9513c08d94df"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a1eb1f59969ce55c6430c9513c08d94df">removeSessionCallback</a> (SSL_CTX *ctx, SSL_SESSION *session)</td></tr>
<tr class="separator:a1eb1f59969ce55c6430c9513c08d94df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af46bd1080f372bcb52a2dd94dbe632db"><td class="memItemLeft" align="right" valign="top">static SSL_SESSION *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#af46bd1080f372bcb52a2dd94dbe632db">getSessionCallback</a> (SSL *ssl, <a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a6750166829ba3d015e4c196c220e26d1">session_callback_arg_session_id_t</a> session_id, int id_len, int *copyflag)</td></tr>
<tr class="separator:af46bd1080f372bcb52a2dd94dbe632db"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a6d35a60340079b67a2c27902f7c92582"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1SSLContext.html">folly::SSLContext</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a6d35a60340079b67a2c27902f7c92582">ctx_</a></td></tr>
<tr class="separator:a6d35a60340079b67a2c27902f7c92582"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82362860809195346ceb14d0d7244723"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="classwangle_1_1ShardedLocalSSLSessionCache.html">ShardedLocalSSLSessionCache</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">localCache_</a></td></tr>
<tr class="separator:a82362860809195346ceb14d0d7244723"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ddd9d4a1dfe828d72d0ace4f177c7ab"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacewangle.html#a52d3b2210f9ff1b6ba79406ab96fd1ee">PendingLookupMap</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a1ddd9d4a1dfe828d72d0ace4f177c7ab">pendingLookups_</a></td></tr>
<tr class="separator:a1ddd9d4a1dfe828d72d0ace4f177c7ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bfee6a9b648a4727b99e07ee6952215"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classwangle_1_1SSLStats.html">SSLStats</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a> {<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>}</td></tr>
<tr class="separator:a7bfee6a9b648a4727b99e07ee6952215"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac32ec93581a2791a54775e0c3d38b6b7"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="classwangle_1_1SSLCacheProvider.html">SSLCacheProvider</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">externalCache_</a></td></tr>
<tr class="separator:ac32ec93581a2791a54775e0c3d38b6b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a775dcfb94da7e8fe23c9ac7ce9d544cc"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="ConstexprMathBenchmark_8cpp.html#afd12020da5a235dfcf0c3c748fb5baed">int32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a775dcfb94da7e8fe23c9ac7ce9d544cc">sExDataIndex_</a> = -1</td></tr>
<tr class="separator:a775dcfb94da7e8fe23c9ac7ce9d544cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0af543b1ed171ddd2984d09382328a26"><td class="memItemLeft" align="right" valign="top">static std::shared_ptr&lt; <a class="el" href="classwangle_1_1ShardedLocalSSLSessionCache.html">ShardedLocalSSLSessionCache</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a0af543b1ed171ddd2984d09382328a26">sCache_</a></td></tr>
<tr class="separator:a0af543b1ed171ddd2984d09382328a26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a741d657aee7873108395ea6f9c295bf5"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="OpenSSLThreading_8cpp.html#a1be3f7fa26e4521098de5f1ec0f865f3">std::mutex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a741d657aee7873108395ea6f9c295bf5">sCacheLock_</a></td></tr>
<tr class="separator:a741d657aee7873108395ea6f9c295bf5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classwangle_1_1SSLSessionCacheManager.html">SSLSessionCacheManager</a> handles all stateful session caching. There is an instance of this object per SSL VIP per thread, with a 1:1 correlation with SSL_CTX. The cache can work locally or in concert with an external cache to share sessions across instances.</p>
<p>There is a single in memory session cache shared by all VIPs. The cache is split into N buckets (currently 16) with a separate lock per bucket. The VIP ID is hashed and stored as part of the session to handle the (very unlikely) case of session ID collision.</p>
<p>When a new SSL session is created, it is added to the LRU cache and sent to the external cache to be stored. The external cache expiration is equal to the SSL session's expiration.</p>
<p>When a resume request is received, <a class="el" href="classwangle_1_1SSLSessionCacheManager.html">SSLSessionCacheManager</a> first looks in the local LRU cache for the VIP. If there is a miss there, an asynchronous request for this session is dispatched to the external cache. When the external cache query returns, the LRU cache is updated if the session was found, and the SSL_accept call is resumed.</p>
<p>If additional resume requests for the same session ID arrive in the same thread while the request is pending, the 2nd - Nth callers attach to the original external cache requests and are resumed when it comes back. No attempt is made to coalesce external cache requests for the same session ID in different worker threads. Previous work did this, but the complexity was deemed to outweigh the potential savings. </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8h_source.html#l00136">136</a> of file <a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="a6750166829ba3d015e4c196c220e26d1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a6750166829ba3d015e4c196c220e26d1">wangle::SSLSessionCacheManager::session_callback_arg_session_id_t</a> =  unsigned char*</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8h_source.html#l00255">255</a> of file <a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a4030f258e176ee2884d7caf5cdfcdf50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">wangle::SSLSessionCacheManager::SSLSessionCacheManager </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>maxCacheSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>cacheCullSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfolly_1_1SSLContext.html">folly::SSLContext</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classwangle_1_1SSLStats.html">SSLStats</a> *&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::shared_ptr&lt; <a class="el" href="classwangle_1_1SSLCacheProvider.html">SSLCacheProvider</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>externalCache</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructor. SSL session related callbacks will be set on the underlying SSL_CTX. vipId is assumed to a unique string identifying the VIP and must be the same on all servers that wish to share sessions via the same external cache. </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00142">142</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00182">getLocalCache()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00257">getSessionCallback()</a>, <a class="el" href="SSLContext_8h_source.html#l00503">folly::SSLContext::getSSLCtx()</a>, <a class="el" href="SSLUtil_8h_source.html#l00074">wangle::SSLUtil::getSSLCtxExIndex()</a>, <a class="el" href="SSLSessionCacheManager_8h_source.html#l00188">localCache_</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00195">newSessionCallback()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00228">removeSessionCallback()</a>, <a class="el" href="SSLContext_8cpp_source.html#l00526">folly::SSLContext::setSessionCacheContext()</a>, and <a class="el" href="SSLSessionCacheManager_8h_source.html#l00264">sExDataIndex_</a>.</p>
<div class="fragment"><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                                       :</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a6d35a60340079b67a2c27902f7c92582">ctx_</a>(ctx),</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a>(stats),</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">externalCache_</a>(externalCache) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  SSL_CTX* sslCtx = ctx-&gt;<a class="code" href="classfolly_1_1SSLContext.html#a3f7525cc5fbb77c79147b2494c3f4087">getSSLCtx</a>();</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <a class="code" href="classwangle_1_1SSLUtil.html#a9674236e36ce3f1f380722d684550da0">SSLUtil::getSSLCtxExIndex</a>(&amp;<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a775dcfb94da7e8fe23c9ac7ce9d544cc">sExDataIndex_</a>);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  SSL_CTX_set_ex_data(sslCtx, <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a775dcfb94da7e8fe23c9ac7ce9d544cc">sExDataIndex_</a>, <span class="keyword">this</span>);</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  SSL_CTX_sess_set_new_cb(sslCtx, <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#aab86668d2e7540dfaf1513923901acd0">SSLSessionCacheManager::newSessionCallback</a>);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  SSL_CTX_sess_set_get_cb(sslCtx, <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#af46bd1080f372bcb52a2dd94dbe632db">SSLSessionCacheManager::getSessionCallback</a>);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  SSL_CTX_sess_set_remove_cb(sslCtx,</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                             <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a1eb1f59969ce55c6430c9513c08d94df">SSLSessionCacheManager::removeSessionCallback</a>);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <span class="keywordflow">if</span> (!FLAGS_dcache_unit_test &amp;&amp; !<a class="code" href="fizz_2build___2CMakeCache_8txt.html#a261f9f58ccbeaa962c4e675e4212c9cc">context</a>.empty()) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="comment">// Use the passed in context</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    ctx-&gt;<a class="code" href="classfolly_1_1SSLContext.html#aba94495c384a5f74122e5e1b7aeec94a">setSessionCacheContext</a>(<a class="code" href="fizz_2build___2CMakeCache_8txt.html#a261f9f58ccbeaa962c4e675e4212c9cc">context</a>);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  SSL_CTX_set_session_cache_mode(sslCtx, SSL_SESS_CACHE_NO_INTERNAL</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                 | SSL_SESS_CACHE_SERVER);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">localCache_</a> = <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#ad2a3a11cce3fc2dc84f1edcd628002b6">SSLSessionCacheManager::getLocalCache</a>(maxCacheSize,</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                                      cacheCullSize);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a775dcfb94da7e8fe23c9ac7ce9d544cc"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a775dcfb94da7e8fe23c9ac7ce9d544cc">wangle::SSLSessionCacheManager::sExDataIndex_</a></div><div class="ttdeci">static int32_t sExDataIndex_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00264">SSLSessionCacheManager.h:264</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_af46bd1080f372bcb52a2dd94dbe632db"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#af46bd1080f372bcb52a2dd94dbe632db">wangle::SSLSessionCacheManager::getSessionCallback</a></div><div class="ttdeci">static SSL_SESSION * getSessionCallback(SSL *ssl, session_callback_arg_session_id_t session_id, int id_len, int *copyflag)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00257">SSLSessionCacheManager.cpp:257</a></div></div>
<div class="ttc" id="fizz_2build___2CMakeCache_8txt_html_a261f9f58ccbeaa962c4e675e4212c9cc"><div class="ttname"><a href="fizz_2build___2CMakeCache_8txt.html#a261f9f58ccbeaa962c4e675e4212c9cc">context</a></div><div class="ttdeci">context</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2CMakeCache_8txt_source.html#l00563">CMakeCache.txt:563</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a1eb1f59969ce55c6430c9513c08d94df"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a1eb1f59969ce55c6430c9513c08d94df">wangle::SSLSessionCacheManager::removeSessionCallback</a></div><div class="ttdeci">static void removeSessionCallback(SSL_CTX *ctx, SSL_SESSION *session)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00228">SSLSessionCacheManager.cpp:228</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_ad2a3a11cce3fc2dc84f1edcd628002b6"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#ad2a3a11cce3fc2dc84f1edcd628002b6">wangle::SSLSessionCacheManager::getLocalCache</a></div><div class="ttdeci">static std::shared_ptr&lt; ShardedLocalSSLSessionCache &gt; getLocalCache(uint32_t maxCacheSize, uint32_t cacheCullSize)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00182">SSLSessionCacheManager.cpp:182</a></div></div>
<div class="ttc" id="classwangle_1_1SSLUtil_html_a9674236e36ce3f1f380722d684550da0"><div class="ttname"><a href="classwangle_1_1SSLUtil.html#a9674236e36ce3f1f380722d684550da0">wangle::SSLUtil::getSSLCtxExIndex</a></div><div class="ttdeci">static void getSSLCtxExIndex(int *pindex)</div><div class="ttdef"><b>Definition:</b> <a href="SSLUtil_8h_source.html#l00074">SSLUtil.h:74</a></div></div>
<div class="ttc" id="classfolly_1_1SSLContext_html_a3f7525cc5fbb77c79147b2494c3f4087"><div class="ttname"><a href="classfolly_1_1SSLContext.html#a3f7525cc5fbb77c79147b2494c3f4087">folly::SSLContext::getSSLCtx</a></div><div class="ttdeci">SSL_CTX * getSSLCtx() const </div><div class="ttdef"><b>Definition:</b> <a href="SSLContext_8h_source.html#l00503">SSLContext.h:503</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_aab86668d2e7540dfaf1513923901acd0"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#aab86668d2e7540dfaf1513923901acd0">wangle::SSLSessionCacheManager::newSessionCallback</a></div><div class="ttdeci">static int newSessionCallback(SSL *ssl, SSL_SESSION *session)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00195">SSLSessionCacheManager.cpp:195</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a82362860809195346ceb14d0d7244723"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">wangle::SSLSessionCacheManager::localCache_</a></div><div class="ttdeci">std::shared_ptr&lt; ShardedLocalSSLSessionCache &gt; localCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00188">SSLSessionCacheManager.h:188</a></div></div>
<div class="ttc" id="classfolly_1_1SSLContext_html_aba94495c384a5f74122e5e1b7aeec94a"><div class="ttname"><a href="classfolly_1_1SSLContext.html#aba94495c384a5f74122e5e1b7aeec94a">folly::SSLContext::setSessionCacheContext</a></div><div class="ttdeci">void setSessionCacheContext(const std::string &amp;context)</div><div class="ttdef"><b>Definition:</b> <a href="SSLContext_8cpp_source.html#l00526">SSLContext.cpp:526</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a7bfee6a9b648a4727b99e07ee6952215"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">wangle::SSLSessionCacheManager::stats_</a></div><div class="ttdeci">SSLStats * stats_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00190">SSLSessionCacheManager.h:190</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_ac32ec93581a2791a54775e0c3d38b6b7"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">wangle::SSLSessionCacheManager::externalCache_</a></div><div class="ttdeci">std::shared_ptr&lt; SSLCacheProvider &gt; externalCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00191">SSLSessionCacheManager.h:191</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a6d35a60340079b67a2c27902f7c92582"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a6d35a60340079b67a2c27902f7c92582">wangle::SSLSessionCacheManager::ctx_</a></div><div class="ttdeci">folly::SSLContext * ctx_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00187">SSLSessionCacheManager.h:187</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4acc297a239539b392ee966eefb9972d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">wangle::SSLSessionCacheManager::~SSLSessionCacheManager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00174">174</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                                                {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ad2a3a11cce3fc2dc84f1edcd628002b6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classshared__ptr.html">shared_ptr</a>&lt; <a class="el" href="classwangle_1_1ShardedLocalSSLSessionCache.html">ShardedLocalSSLSessionCache</a> &gt; wangle::SSLSessionCacheManager::getLocalCache </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>maxCacheSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a>&#160;</td>
          <td class="paramname"><em>cacheCullSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get or create the LRU cache for the given VIP ID </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00182">182</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="composition__2_8cpp_source.html#l00034">g()</a>, <a class="el" href="SSLSessionCacheManager_8h_source.html#l00265">sCache_</a>, and <a class="el" href="SSLSessionCacheManager_8h_source.html#l00266">sCacheLock_</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00142">SSLSessionCacheManager()</a>.</p>
<div class="fragment"><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                          {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  std::lock_guard&lt;std::mutex&gt; <a class="code" href="composition__2_8cpp.html#afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe">g</a>(<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a741d657aee7873108395ea6f9c295bf5">sCacheLock_</a>);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a0af543b1ed171ddd2984d09382328a26">sCache_</a>) {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a0af543b1ed171ddd2984d09382328a26">sCache_</a>.reset(<span class="keyword">new</span> ShardedLocalSSLSessionCache(NUM_CACHE_BUCKETS,</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                                  maxCacheSize,</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                                  cacheCullSize));</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a0af543b1ed171ddd2984d09382328a26">sCache_</a>;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a0af543b1ed171ddd2984d09382328a26"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a0af543b1ed171ddd2984d09382328a26">wangle::SSLSessionCacheManager::sCache_</a></div><div class="ttdeci">static std::shared_ptr&lt; ShardedLocalSSLSessionCache &gt; sCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00265">SSLSessionCacheManager.h:265</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a741d657aee7873108395ea6f9c295bf5"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a741d657aee7873108395ea6f9c295bf5">wangle::SSLSessionCacheManager::sCacheLock_</a></div><div class="ttdeci">static std::mutex sCacheLock_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00266">SSLSessionCacheManager.h:266</a></div></div>
<div class="ttc" id="composition__2_8cpp_html_afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe"><div class="ttname"><a href="composition__2_8cpp.html#afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe">g</a></div><div class="ttdeci">g_t g(f_t)</div><div class="ttdef"><b>Definition:</b> <a href="composition__2_8cpp_source.html#l00034">composition_2.cpp:34</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a83bdcd3d13f7ad7b2f5dfe49b899fa0a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SSL_SESSION * wangle::SSLSessionCacheManager::getSession </td>
          <td>(</td>
          <td class="paramtype">SSL *&#160;</td>
          <td class="paramname"><em>ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>session_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>copyflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Invoked by openssl when a client requests a stateful session resumption. Triggers a lookup in our local cache and potentially an asynchronous request to an external cache. </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00272">272</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="SSLSessionCacheManager_8h_source.html#l00191">externalCache_</a>, <a class="el" href="AsyncSocket_8h_source.html#l00335">folly::AsyncSocket::getFd()</a>, <a class="el" href="AsyncSSLSocket_8cpp_source.html#l00645">folly::AsyncSSLSocket::getFromSSL()</a>, <a class="el" href="SSLUtil_8h_source.html#l00150">wangle::SSLUtil::hexlify()</a>, <a class="el" href="SSLSessionCacheManager_8h_source.html#l00188">localCache_</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00387">lookupCacheRecord()</a>, <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>, <a class="el" href="FiberManagerInternal_8h_source.html#l00517">folly::fibers::onFiber()</a>, <a class="el" href="SSLSessionCacheManager_8h_source.html#l00189">pendingLookups_</a>, <a class="el" href="classwangle_1_1SSLStats.html#ad0bccd144f30ce5408bb9d82e05c8482">wangle::SSLStats::recordSSLSession()</a>, <a class="el" href="AsyncSSLSocket_8h_source.html#l00518">folly::AsyncSSLSocket::setSessionIDResumed()</a>, <a class="el" href="SSLSessionCacheManager_8h_source.html#l00190">stats_</a>, and <a class="el" href="Conv_8cpp_source.html#l00212">string</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00257">getSessionCallback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                   {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  VLOG(7) &lt;&lt; <span class="stringliteral">&quot;SSL get session callback&quot;</span>;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="namespacefolly_1_1ssl.html#a6e99ac281f83187c3075a966c3bef755">folly::ssl::SSLSessionUniquePtr</a> session;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="keywordtype">bool</span> foreign = <span class="keyword">false</span>;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <a class="code" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> missReason;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordflow">if</span> (id_len &lt; MIN_SESSION_ID_LENGTH) {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// We didn&#39;t generate this session so it&#39;s going to be a miss.</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// This doesn&#39;t get logged or counted in the stats.</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordtype">string</span> sessionId((<span class="keywordtype">char</span>*)session_id, id_len);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <a class="code" href="classfolly_1_1AsyncSSLSocket.html">AsyncSSLSocket</a>* sslSocket = <a class="code" href="classfolly_1_1AsyncSSLSocket.html#ade718e1f3d111fafaf53b6378833b212">AsyncSSLSocket::getFromSSL</a>(ssl);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  assert(sslSocket != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">// look it up in the local cache first</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  session.reset(<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">localCache_</a>-&gt;lookupSession(sessionId));</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="preprocessor">#ifdef SSL_SESSION_CB_WOULD_BLOCK</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">if</span> (session == <span class="keyword">nullptr</span> &amp;&amp; <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">externalCache_</a>) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// external cache might have the session</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    foreign = <span class="keyword">true</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (!SSL_want_sess_cache_lookup(ssl)) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      missReason = <span class="stringliteral">&quot;reason: No async cache support;&quot;</span>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      PendingLookupMap::iterator pit = <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a1ddd9d4a1dfe828d72d0ace4f177c7ab">pendingLookups_</a>.find(sessionId);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">if</span> (pit == <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a1ddd9d4a1dfe828d72d0ace4f177c7ab">pendingLookups_</a>.end()) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keyword">auto</span> result = <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a1ddd9d4a1dfe828d72d0ace4f177c7ab">pendingLookups_</a>.emplace(sessionId, PendingLookup());</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="comment">// initiate fetch</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        VLOG(4) &lt;&lt; <span class="stringliteral">&quot;Get SSL session [Pending]: Initiate Fetch; fd=&quot;</span> &lt;&lt;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          sslSocket-&gt;<a class="code" href="classfolly_1_1AsyncSocket.html#a3746aa7c3ac4a0e4406daf1f9be51955">getFd</a>() &lt;&lt; <span class="stringliteral">&quot; id=&quot;</span> &lt;&lt; <a class="code" href="classwangle_1_1SSLUtil.html#a30dd25c5937473e46d5dee35c1e5d634">SSLUtil::hexlify</a>(sessionId);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a487067933f097a8efce51889aa7e8135">lookupCacheRecord</a>(sessionId, sslSocket)) {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;          <span class="comment">// response is pending</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;          *copyflag = SSL_SESSION_CB_WOULD_BLOCK;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          missReason = <span class="stringliteral">&quot;reason: failed to send lookup request;&quot;</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;          <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a1ddd9d4a1dfe828d72d0ace4f177c7ab">pendingLookups_</a>.erase(result.first);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        }</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="comment">// A lookup was already initiated from this thread</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">if</span> (pit-&gt;second.request_in_progress) {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;          <span class="comment">// Someone else initiated the request, attach</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;          VLOG(4) &lt;&lt; <span class="stringliteral">&quot;Get SSL session [Pending]: Request in progess: attach; &quot;</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="stringliteral">&quot;fd=&quot;</span> &lt;&lt; sslSocket-&gt;<a class="code" href="classfolly_1_1AsyncSocket.html#a3746aa7c3ac4a0e4406daf1f9be51955">getFd</a>() &lt;&lt; <span class="stringliteral">&quot; id=&quot;</span> &lt;&lt;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <a class="code" href="classwangle_1_1SSLUtil.html#a30dd25c5937473e46d5dee35c1e5d634">SSLUtil::hexlify</a>(sessionId);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;          std::unique_ptr&lt;DelayedDestruction::DestructorGuard&gt; dg(</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keyword">new</span> DelayedDestruction::DestructorGuard(sslSocket));</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;          pit-&gt;second.waiters.emplace_back(sslSocket, <a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(dg));</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;          *copyflag = SSL_SESSION_CB_WOULD_BLOCK;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="comment">// request is complete</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        session.reset(</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            pit-&gt;second.session); <span class="comment">// nullptr if our friend didn&#39;t have it</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">if</span> (session) {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;          SSL_SESSION_up_ref(session.get());</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  }</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="preprocessor">#elif FOLLY_OPENSSL_IS_110</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="keywordflow">if</span> (session == <span class="keyword">nullptr</span> &amp;&amp; <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">externalCache_</a>) {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    foreign = <span class="keyword">true</span>;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    DCHECK(<a class="code" href="namespacefolly_1_1fibers.html#a341d0742a33f0b37fbff8dfe610dce7c">folly::fibers::onFiber</a>());</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      session = <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">externalCache_</a>-&gt;getFuture(sessionId).get();</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      missReason = folly::to&lt;std::string&gt;(<span class="stringliteral">&quot;reason: &quot;</span>, e.what(), <span class="stringliteral">&quot;;&quot;</span>);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">if</span> (session) {</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">localCache_</a>-&gt;storeSession(sessionId, session.get(), <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a>);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      SSL_SESSION_up_ref(session.get());</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  }</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordtype">bool</span> hit = (session != <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a>) {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a>-&gt;<a class="code" href="classwangle_1_1SSLStats.html#ad0bccd144f30ce5408bb9d82e05c8482">recordSSLSession</a>(<span class="keyword">false</span>, hit, foreign);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  }</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">if</span> (hit) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    sslSocket-&gt;<a class="code" href="classfolly_1_1AsyncSSLSocket.html#ada69046281a1e687ffd151fca1f99ac2">setSessionIDResumed</a>(<span class="keyword">true</span>);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  VLOG(4) &lt;&lt; <span class="stringliteral">&quot;Get SSL session [&quot;</span> &lt;&lt; ((hit) ? <span class="stringliteral">&quot;Hit&quot;</span> : <span class="stringliteral">&quot;Miss&quot;</span>)</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;          &lt;&lt; <span class="stringliteral">&quot;]: &quot;</span> &lt;&lt; ((foreign) ? <span class="stringliteral">&quot;external&quot;</span> : <span class="stringliteral">&quot;local&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; cache; &quot;</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;          &lt;&lt; missReason &lt;&lt; <span class="stringliteral">&quot;fd=&quot;</span> &lt;&lt; sslSocket-&gt;<a class="code" href="classfolly_1_1AsyncSocket.html#a3746aa7c3ac4a0e4406daf1f9be51955">getFd</a>()</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;          &lt;&lt; <span class="stringliteral">&quot; id=&quot;</span> &lt;&lt; <a class="code" href="classwangle_1_1SSLUtil.html#a30dd25c5937473e46d5dee35c1e5d634">SSLUtil::hexlify</a>(sessionId);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="comment">// We already bumped the refcount</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  *copyflag = 0;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">return</span> session.release();</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;}</div><div class="ttc" id="classfolly_1_1AsyncSSLSocket_html"><div class="ttname"><a href="classfolly_1_1AsyncSSLSocket.html">folly::AsyncSSLSocket</a></div><div class="ttdef"><b>Definition:</b> <a href="AsyncSSLSocket_8h_source.html#l00070">AsyncSSLSocket.h:70</a></div></div>
<div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncSSLSocket_html_ada69046281a1e687ffd151fca1f99ac2"><div class="ttname"><a href="classfolly_1_1AsyncSSLSocket.html#ada69046281a1e687ffd151fca1f99ac2">folly::AsyncSSLSocket::setSessionIDResumed</a></div><div class="ttdeci">void setSessionIDResumed(bool resumed)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncSSLSocket_8h_source.html#l00518">AsyncSSLSocket.h:518</a></div></div>
<div class="ttc" id="classwangle_1_1SSLStats_html_ad0bccd144f30ce5408bb9d82e05c8482"><div class="ttname"><a href="classwangle_1_1SSLStats.html#ad0bccd144f30ce5408bb9d82e05c8482">wangle::SSLStats::recordSSLSession</a></div><div class="ttdeci">virtual void recordSSLSession(bool sessionNew, bool sessionHit, bool foreign) noexcept=0</div></div>
<div class="ttc" id="namespacefolly_1_1fibers_html_a341d0742a33f0b37fbff8dfe610dce7c"><div class="ttname"><a href="namespacefolly_1_1fibers.html#a341d0742a33f0b37fbff8dfe610dce7c">folly::fibers::onFiber</a></div><div class="ttdeci">bool onFiber()</div><div class="ttdef"><b>Definition:</b> <a href="FiberManagerInternal_8h_source.html#l00517">FiberManagerInternal.h:517</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a1ddd9d4a1dfe828d72d0ace4f177c7ab"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a1ddd9d4a1dfe828d72d0ace4f177c7ab">wangle::SSLSessionCacheManager::pendingLookups_</a></div><div class="ttdeci">PendingLookupMap pendingLookups_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00189">SSLSessionCacheManager.h:189</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncSocket_html_a3746aa7c3ac4a0e4406daf1f9be51955"><div class="ttname"><a href="classfolly_1_1AsyncSocket.html#a3746aa7c3ac4a0e4406daf1f9be51955">folly::AsyncSocket::getFd</a></div><div class="ttdeci">virtual int getFd() const </div><div class="ttdef"><b>Definition:</b> <a href="AsyncSocket_8h_source.html#l00335">AsyncSocket.h:335</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a82362860809195346ceb14d0d7244723"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">wangle::SSLSessionCacheManager::localCache_</a></div><div class="ttdeci">std::shared_ptr&lt; ShardedLocalSSLSessionCache &gt; localCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00188">SSLSessionCacheManager.h:188</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a7bfee6a9b648a4727b99e07ee6952215"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">wangle::SSLSessionCacheManager::stats_</a></div><div class="ttdeci">SSLStats * stats_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00190">SSLSessionCacheManager.h:190</a></div></div>
<div class="ttc" id="Conv_8cpp_html_ae1adbce218e7a9d09164012443191d24"><div class="ttname"><a href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">string</a></div><div class="ttdeci">const char * string</div><div class="ttdef"><b>Definition:</b> <a href="Conv_8cpp_source.html#l00212">Conv.cpp:212</a></div></div>
<div class="ttc" id="classwangle_1_1SSLUtil_html_a30dd25c5937473e46d5dee35c1e5d634"><div class="ttname"><a href="classwangle_1_1SSLUtil.html#a30dd25c5937473e46d5dee35c1e5d634">wangle::SSLUtil::hexlify</a></div><div class="ttdeci">static std::string hexlify(const std::string &amp;binary)</div><div class="ttdef"><b>Definition:</b> <a href="SSLUtil_8h_source.html#l00150">SSLUtil.h:150</a></div></div>
<div class="ttc" id="namespacefolly_1_1ssl_html_a6e99ac281f83187c3075a966c3bef755"><div class="ttname"><a href="namespacefolly_1_1ssl.html#a6e99ac281f83187c3075a966c3bef755">folly::ssl::SSLSessionUniquePtr</a></div><div class="ttdeci">std::unique_ptr&lt; SSL_SESSION, SSLSessionDeleter &gt; SSLSessionUniquePtr</div><div class="ttdef"><b>Definition:</b> <a href="OpenSSLPtrTypes_8h_source.html#l00113">OpenSSLPtrTypes.h:113</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_ac32ec93581a2791a54775e0c3d38b6b7"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">wangle::SSLSessionCacheManager::externalCache_</a></div><div class="ttdeci">std::shared_ptr&lt; SSLCacheProvider &gt; externalCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00191">SSLSessionCacheManager.h:191</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a487067933f097a8efce51889aa7e8135"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a487067933f097a8efce51889aa7e8135">wangle::SSLSessionCacheManager::lookupCacheRecord</a></div><div class="ttdeci">bool lookupCacheRecord(const std::string &amp;sessionId, folly::AsyncSSLSocket *sslSock)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00387">SSLSessionCacheManager.cpp:387</a></div></div>
<div class="ttc" id="classfolly_1_1AsyncSSLSocket_html_ade718e1f3d111fafaf53b6378833b212"><div class="ttname"><a href="classfolly_1_1AsyncSSLSocket.html#ade718e1f3d111fafaf53b6378833b212">folly::AsyncSSLSocket::getFromSSL</a></div><div class="ttdeci">static AsyncSSLSocket * getFromSSL(const SSL *ssl)</div><div class="ttdef"><b>Definition:</b> <a href="AsyncSSLSocket_8cpp_source.html#l00645">AsyncSSLSocket.cpp:645</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af46bd1080f372bcb52a2dd94dbe632db"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">SSL_SESSION * wangle::SSLSessionCacheManager::getSessionCallback </td>
          <td>(</td>
          <td class="paramtype">SSL *&#160;</td>
          <td class="paramname"><em>ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html#a6750166829ba3d015e4c196c220e26d1">session_callback_arg_session_id_t</a>&#160;</td>
          <td class="paramname"><em>session_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>id_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>copyflag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00257">257</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc">folly::FATAL</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00272">getSession()</a>, and <a class="el" href="SSLSessionCacheManager_8h_source.html#l00264">sExDataIndex_</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00142">SSLSessionCacheManager()</a>.</p>
<div class="fragment"><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                   {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a4030f258e176ee2884d7caf5cdfcdf50">SSLSessionCacheManager</a>* manager = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  SSL_CTX* ctx = SSL_get_SSL_CTX(ssl);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  manager = (<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a4030f258e176ee2884d7caf5cdfcdf50">SSLSessionCacheManager</a>*)SSL_CTX_get_ex_data(ctx, <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a775dcfb94da7e8fe23c9ac7ce9d544cc">sExDataIndex_</a>);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="keywordflow">if</span> (manager == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    LOG(FATAL) &lt;&lt; <span class="stringliteral">&quot;Null SSLSessionCacheManager in callback&quot;</span>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  }</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">return</span> manager-&gt;getSession(ssl, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)sess_id, id_len, copyflag);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a775dcfb94da7e8fe23c9ac7ce9d544cc"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a775dcfb94da7e8fe23c9ac7ce9d544cc">wangle::SSLSessionCacheManager::sExDataIndex_</a></div><div class="ttdeci">static int32_t sExDataIndex_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00264">SSLSessionCacheManager.h:264</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a4030f258e176ee2884d7caf5cdfcdf50"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a4030f258e176ee2884d7caf5cdfcdf50">wangle::SSLSessionCacheManager::SSLSessionCacheManager</a></div><div class="ttdeci">SSLSessionCacheManager(uint32_t maxCacheSize, uint32_t cacheCullSize, folly::SSLContext *ctx, const std::string &amp;context, SSLStats *stats, const std::shared_ptr&lt; SSLCacheProvider &gt; &amp;externalCache)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00142">SSLSessionCacheManager.cpp:142</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a487067933f097a8efce51889aa7e8135"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool wangle::SSLSessionCacheManager::lookupCacheRecord </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;&#160;</td>
          <td class="paramname"><em>sessionId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfolly_1_1AsyncSSLSocket.html">folly::AsyncSSLSocket</a> *&#160;</td>
          <td class="paramname"><em>sslSock</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Lookup a session in the external cache for the specified SSL socket. </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00387">387</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="SSLSessionCacheManager_8h_source.html#l00191">externalCache_</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00272">getSession()</a>.</p>
<div class="fragment"><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                                                                          {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keyword">auto</span> cacheCtx = <span class="keyword">new</span> SSLCacheProvider::CacheContext();</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  cacheCtx-&gt;sessionId = sessionId;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  cacheCtx-&gt;session = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  cacheCtx-&gt;sslSocket = sslSocket;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  cacheCtx-&gt;guard.reset(</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;      <span class="keyword">new</span> DelayedDestruction::DestructorGuard(cacheCtx-&gt;sslSocket));</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  cacheCtx-&gt;manager = <span class="keyword">this</span>;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordtype">bool</span> res = <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">externalCache_</a>-&gt;getAsync(sessionId, cacheCtx);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">if</span> (!res) {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keyword">delete</span> cacheCtx;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_ac32ec93581a2791a54775e0c3d38b6b7"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">wangle::SSLSessionCacheManager::externalCache_</a></div><div class="ttdeci">std::shared_ptr&lt; SSLCacheProvider &gt; externalCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00191">SSLSessionCacheManager.h:191</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7875fadfb0c9841875d1557db1f3f688"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int wangle::SSLSessionCacheManager::newSession </td>
          <td>(</td>
          <td class="paramtype">SSL *&#160;</td>
          <td class="paramname"><em>ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL_SESSION *&#160;</td>
          <td class="paramname"><em>session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Invoked by openssl when a new SSL session is created </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00207">207</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="SSLSessionCacheManager_8h_source.html#l00191">externalCache_</a>, <a class="el" href="SSLUtil_8h_source.html#l00150">wangle::SSLUtil::hexlify()</a>, <a class="el" href="SSLSessionCacheManager_8h_source.html#l00188">localCache_</a>, <a class="el" href="classwangle_1_1SSLStats.html#ad0bccd144f30ce5408bb9d82e05c8482">wangle::SSLStats::recordSSLSession()</a>, <a class="el" href="SSLSessionCacheManager_8h_source.html#l00190">stats_</a>, and <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00375">storeCacheRecord()</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00195">newSessionCallback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                                                                 {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sessIdLen = 0;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* sessId = SSL_SESSION_get_id(session, &amp;sessIdLen);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordtype">string</span> sessionId((<span class="keywordtype">char</span>*) sessId, sessIdLen);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  VLOG(4) &lt;&lt; <span class="stringliteral">&quot;New SSL session; id=&quot;</span> &lt;&lt; <a class="code" href="classwangle_1_1SSLUtil.html#a30dd25c5937473e46d5dee35c1e5d634">SSLUtil::hexlify</a>(sessionId);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a>) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a>-&gt;<a class="code" href="classwangle_1_1SSLStats.html#ad0bccd144f30ce5408bb9d82e05c8482">recordSSLSession</a>(<span class="keyword">true</span> <span class="comment">/* new session */</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">localCache_</a>-&gt;storeSession(sessionId, session, <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a>);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">externalCache_</a>) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    VLOG(4) &lt;&lt; <span class="stringliteral">&quot;New SSL session: send session to external cache; id=&quot;</span> &lt;&lt;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;      <a class="code" href="classwangle_1_1SSLUtil.html#a30dd25c5937473e46d5dee35c1e5d634">SSLUtil::hexlify</a>(sessionId);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#aa1f2a70730492fd434d8d2ccdc0c456e">storeCacheRecord</a>(sessionId, session);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_aa1f2a70730492fd434d8d2ccdc0c456e"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#aa1f2a70730492fd434d8d2ccdc0c456e">wangle::SSLSessionCacheManager::storeCacheRecord</a></div><div class="ttdeci">bool storeCacheRecord(const std::string &amp;sessionId, SSL_SESSION *session)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00375">SSLSessionCacheManager.cpp:375</a></div></div>
<div class="ttc" id="classwangle_1_1SSLStats_html_ad0bccd144f30ce5408bb9d82e05c8482"><div class="ttname"><a href="classwangle_1_1SSLStats.html#ad0bccd144f30ce5408bb9d82e05c8482">wangle::SSLStats::recordSSLSession</a></div><div class="ttdeci">virtual void recordSSLSession(bool sessionNew, bool sessionHit, bool foreign) noexcept=0</div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a82362860809195346ceb14d0d7244723"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">wangle::SSLSessionCacheManager::localCache_</a></div><div class="ttdeci">std::shared_ptr&lt; ShardedLocalSSLSessionCache &gt; localCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00188">SSLSessionCacheManager.h:188</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a7bfee6a9b648a4727b99e07ee6952215"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">wangle::SSLSessionCacheManager::stats_</a></div><div class="ttdeci">SSLStats * stats_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00190">SSLSessionCacheManager.h:190</a></div></div>
<div class="ttc" id="classwangle_1_1SSLUtil_html_a30dd25c5937473e46d5dee35c1e5d634"><div class="ttname"><a href="classwangle_1_1SSLUtil.html#a30dd25c5937473e46d5dee35c1e5d634">wangle::SSLUtil::hexlify</a></div><div class="ttdeci">static std::string hexlify(const std::string &amp;binary)</div><div class="ttdef"><b>Definition:</b> <a href="SSLUtil_8h_source.html#l00150">SSLUtil.h:150</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_ac32ec93581a2791a54775e0c3d38b6b7"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">wangle::SSLSessionCacheManager::externalCache_</a></div><div class="ttdeci">std::shared_ptr&lt; SSLCacheProvider &gt; externalCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00191">SSLSessionCacheManager.h:191</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aab86668d2e7540dfaf1513923901acd0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int wangle::SSLSessionCacheManager::newSessionCallback </td>
          <td>(</td>
          <td class="paramtype">SSL *&#160;</td>
          <td class="paramname"><em>ssl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL_SESSION *&#160;</td>
          <td class="paramname"><em>session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>static functions registered as callbacks to openssl via SSL_CTX_sess_set_new/get/remove_cb </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00195">195</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc">folly::FATAL</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00207">newSession()</a>, and <a class="el" href="SSLSessionCacheManager_8h_source.html#l00264">sExDataIndex_</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00142">SSLSessionCacheManager()</a>.</p>
<div class="fragment"><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                                                             {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a4030f258e176ee2884d7caf5cdfcdf50">SSLSessionCacheManager</a>* manager = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  SSL_CTX* ctx = SSL_get_SSL_CTX(ssl);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  manager = (<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a4030f258e176ee2884d7caf5cdfcdf50">SSLSessionCacheManager</a> *)SSL_CTX_get_ex_data(ctx, <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a775dcfb94da7e8fe23c9ac7ce9d544cc">sExDataIndex_</a>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">if</span> (manager == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    LOG(FATAL) &lt;&lt; <span class="stringliteral">&quot;Null SSLSessionCacheManager in callback&quot;</span>;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">return</span> manager-&gt;newSession(ssl, session);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a775dcfb94da7e8fe23c9ac7ce9d544cc"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a775dcfb94da7e8fe23c9ac7ce9d544cc">wangle::SSLSessionCacheManager::sExDataIndex_</a></div><div class="ttdeci">static int32_t sExDataIndex_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00264">SSLSessionCacheManager.h:264</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a4030f258e176ee2884d7caf5cdfcdf50"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a4030f258e176ee2884d7caf5cdfcdf50">wangle::SSLSessionCacheManager::SSLSessionCacheManager</a></div><div class="ttdeci">SSLSessionCacheManager(uint32_t maxCacheSize, uint32_t cacheCullSize, folly::SSLContext *ctx, const std::string &amp;context, SSLStats *stats, const std::shared_ptr&lt; SSLCacheProvider &gt; &amp;externalCache)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00142">SSLSessionCacheManager.cpp:142</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abedd37c8a05961d8c8e37cb911bef961"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::SSLSessionCacheManager::onGetFailure </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwangle_1_1SSLCacheProvider_1_1CacheContext.html">SSLCacheProvider::CacheContext</a> *&#160;</td>
          <td class="paramname"><em>cacheCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback for ExternalCache to call when an async get fails, either because the requested session is not in the external cache or because of an error. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>The context that was passed to the async get request </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00450">450</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00403">restartSSLAccept()</a>.</p>
<div class="fragment"><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                            {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a67af0257227b9da91b6dd9c75d2ad385">restartSSLAccept</a>(cacheCtx);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  <span class="keyword">delete</span> cacheCtx;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a67af0257227b9da91b6dd9c75d2ad385"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a67af0257227b9da91b6dd9c75d2ad385">wangle::SSLSessionCacheManager::restartSSLAccept</a></div><div class="ttdeci">void restartSSLAccept(const SSLCacheProvider::CacheContext *cacheCtx)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00403">SSLSessionCacheManager.cpp:403</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab0c513a984f910c3193b123cf6b9c671"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::SSLSessionCacheManager::onGetSuccess </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwangle_1_1SSLCacheProvider_1_1CacheContext.html">SSLCacheProvider::CacheContext</a> *&#160;</td>
          <td class="paramname"><em>cacheCtx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback for ExternalCache to call when an async get succeeds </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>The context that was passed to the async get request </td></tr>
    <tr><td class="paramname">value</td><td>Serialized session </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00434">434</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00420">restoreSession()</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00178">uint8_t</a>.</p>
<div class="fragment"><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                            {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a3d4ec5034ad29321233488242a76c1d0">restoreSession</a>(cacheCtx, (<a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>*)<a class="code" href="Conv_8cpp.html#a2f6ac1714c34743067351b0d2a64162b">value</a>.data(), <a class="code" href="Conv_8cpp.html#a2f6ac1714c34743067351b0d2a64162b">value</a>.length());</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;}</div><div class="ttc" id="ConstexprMathBenchmark_8cpp_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00178">ConstexprMathBenchmark.cpp:178</a></div></div>
<div class="ttc" id="Conv_8cpp_html_a2f6ac1714c34743067351b0d2a64162b"><div class="ttname"><a href="Conv_8cpp.html#a2f6ac1714c34743067351b0d2a64162b">value</a></div><div class="ttdeci">static const char *const value</div><div class="ttdef"><b>Definition:</b> <a href="Conv_8cpp_source.html#l00050">Conv.cpp:50</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a3d4ec5034ad29321233488242a76c1d0"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a3d4ec5034ad29321233488242a76c1d0">wangle::SSLSessionCacheManager::restoreSession</a></div><div class="ttdeci">void restoreSession(SSLCacheProvider::CacheContext *cacheCtx, const uint8_t *data, size_t length)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00420">SSLSessionCacheManager.cpp:420</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0cfb7cd671df4cbdd796de02b46b2d87"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::SSLSessionCacheManager::onGetSuccess </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwangle_1_1SSLCacheProvider_1_1CacheContext.html">SSLCacheProvider::CacheContext</a> *&#160;</td>
          <td class="paramname"><em>cacheCtx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; <a class="el" href="classfolly_1_1IOBuf.html">folly::IOBuf</a> &gt;&#160;</td>
          <td class="paramname"><em>valueBuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback for ExternalCache to call when an async get succeeds </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>The context that was passed to the async get request </td></tr>
    <tr><td class="paramname">valueBuf</td><td>Serialized session stored in <a class="el" href="classfolly_1_1IOBuf.html">folly::IOBuf</a>, this should NOT be called with valueBuf == nullptr. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00440">440</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="IOBuf_8h_source.html#l01095">folly::IOBuf::coalesce()</a>, <a class="el" href="IOBuf_8h_source.html#l00499">folly::IOBuf::data()</a>, <a class="el" href="IOBuf_8h_source.html#l00533">folly::IOBuf::length()</a>, and <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00420">restoreSession()</a>.</p>
<div class="fragment"><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                                        {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">if</span> (!valueBuf) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  valueBuf-&gt;<a class="code" href="classfolly_1_1IOBuf.html#a14e1b052db29b117a9a91374a5fd1f56">coalesce</a>();</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a3d4ec5034ad29321233488242a76c1d0">restoreSession</a>(cacheCtx, valueBuf-&gt;<a class="code" href="classfolly_1_1IOBuf.html#af71f6f5efabbcddf8ec6dada00f5eebf">data</a>(), valueBuf-&gt;<a class="code" href="classfolly_1_1IOBuf.html#a7772f21059d7cde7f30341dfbb162e4a">length</a>());</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;}</div><div class="ttc" id="classfolly_1_1IOBuf_html_a14e1b052db29b117a9a91374a5fd1f56"><div class="ttname"><a href="classfolly_1_1IOBuf.html#a14e1b052db29b117a9a91374a5fd1f56">folly::IOBuf::coalesce</a></div><div class="ttdeci">ByteRange coalesce()</div><div class="ttdef"><b>Definition:</b> <a href="IOBuf_8h_source.html#l01095">IOBuf.h:1095</a></div></div>
<div class="ttc" id="classfolly_1_1IOBuf_html_af71f6f5efabbcddf8ec6dada00f5eebf"><div class="ttname"><a href="classfolly_1_1IOBuf.html#af71f6f5efabbcddf8ec6dada00f5eebf">folly::IOBuf::data</a></div><div class="ttdeci">const uint8_t * data() const </div><div class="ttdef"><b>Definition:</b> <a href="IOBuf_8h_source.html#l00499">IOBuf.h:499</a></div></div>
<div class="ttc" id="classfolly_1_1IOBuf_html_a7772f21059d7cde7f30341dfbb162e4a"><div class="ttname"><a href="classfolly_1_1IOBuf.html#a7772f21059d7cde7f30341dfbb162e4a">folly::IOBuf::length</a></div><div class="ttdeci">std::size_t length() const </div><div class="ttdef"><b>Definition:</b> <a href="IOBuf_8h_source.html#l00533">IOBuf.h:533</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a3d4ec5034ad29321233488242a76c1d0"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a3d4ec5034ad29321233488242a76c1d0">wangle::SSLSessionCacheManager::restoreSession</a></div><div class="ttdeci">void restoreSession(SSLCacheProvider::CacheContext *cacheCtx, const uint8_t *data, size_t length)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00420">SSLSessionCacheManager.cpp:420</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1ae2a8e403dd721b385da32a729be891"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::SSLSessionCacheManager::removeSession </td>
          <td>(</td>
          <td class="paramtype">SSL_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL_SESSION *&#160;</td>
          <td class="paramname"><em>session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Invoked by openssl when an SSL session is ejected from its internal cache. This can't be invoked in the current implementation because SSL's internal caching is disabled. </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00239">239</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="SSLUtil_8h_source.html#l00150">wangle::SSLUtil::hexlify()</a>, <a class="el" href="SSLSessionCacheManager_8h_source.html#l00188">localCache_</a>, <a class="el" href="classwangle_1_1SSLStats.html#ad488031f656daf5664bfec70a1fd8376">wangle::SSLStats::recordSSLSessionRemove()</a>, and <a class="el" href="SSLSessionCacheManager_8h_source.html#l00190">stats_</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00228">removeSessionCallback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                                                                 {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sessIdLen = 0;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* sessId = SSL_SESSION_get_id(session, &amp;sessIdLen);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordtype">string</span> sessionId((<span class="keywordtype">char</span>*) sessId, sessIdLen);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="comment">// This hook is only called from SSL when the internal session cache needs to</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="comment">// flush sessions.  Since we run with the internal cache disabled, this should</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <span class="comment">// never be called</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  VLOG(3) &lt;&lt; <span class="stringliteral">&quot;Remove SSL session; id=&quot;</span> &lt;&lt; <a class="code" href="classwangle_1_1SSLUtil.html#a30dd25c5937473e46d5dee35c1e5d634">SSLUtil::hexlify</a>(sessionId);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">localCache_</a>-&gt;removeSession(sessionId);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a>) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a>-&gt;<a class="code" href="classwangle_1_1SSLStats.html#ad488031f656daf5664bfec70a1fd8376">recordSSLSessionRemove</a>();</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  }</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLStats_html_ad488031f656daf5664bfec70a1fd8376"><div class="ttname"><a href="classwangle_1_1SSLStats.html#ad488031f656daf5664bfec70a1fd8376">wangle::SSLStats::recordSSLSessionRemove</a></div><div class="ttdeci">virtual void recordSSLSessionRemove() noexcept=0</div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a82362860809195346ceb14d0d7244723"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">wangle::SSLSessionCacheManager::localCache_</a></div><div class="ttdeci">std::shared_ptr&lt; ShardedLocalSSLSessionCache &gt; localCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00188">SSLSessionCacheManager.h:188</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a7bfee6a9b648a4727b99e07ee6952215"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">wangle::SSLSessionCacheManager::stats_</a></div><div class="ttdeci">SSLStats * stats_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00190">SSLSessionCacheManager.h:190</a></div></div>
<div class="ttc" id="classwangle_1_1SSLUtil_html_a30dd25c5937473e46d5dee35c1e5d634"><div class="ttname"><a href="classwangle_1_1SSLUtil.html#a30dd25c5937473e46d5dee35c1e5d634">wangle::SSLUtil::hexlify</a></div><div class="ttdeci">static std::string hexlify(const std::string &amp;binary)</div><div class="ttdef"><b>Definition:</b> <a href="SSLUtil_8h_source.html#l00150">SSLUtil.h:150</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1eb1f59969ce55c6430c9513c08d94df"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::SSLSessionCacheManager::removeSessionCallback </td>
          <td>(</td>
          <td class="paramtype">SSL_CTX *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL_SESSION *&#160;</td>
          <td class="paramname"><em>session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00228">228</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="namespacefolly.html#a925db14fdb0096fe395f6acc43118f4aa19da7170bea36556dde582519795f3fc">folly::FATAL</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00239">removeSession()</a>, and <a class="el" href="SSLSessionCacheManager_8h_source.html#l00264">sExDataIndex_</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00142">SSLSessionCacheManager()</a>.</p>
<div class="fragment"><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                                                                         {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a4030f258e176ee2884d7caf5cdfcdf50">SSLSessionCacheManager</a>* manager = <span class="keyword">nullptr</span>;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  manager = (<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a4030f258e176ee2884d7caf5cdfcdf50">SSLSessionCacheManager</a> *)SSL_CTX_get_ex_data(ctx, <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a775dcfb94da7e8fe23c9ac7ce9d544cc">sExDataIndex_</a>);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">if</span> (manager == <span class="keyword">nullptr</span>) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    LOG(FATAL) &lt;&lt; <span class="stringliteral">&quot;Null SSLSessionCacheManager in callback&quot;</span>;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <span class="keywordflow">return</span> manager-&gt;removeSession(ctx, session);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a775dcfb94da7e8fe23c9ac7ce9d544cc"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a775dcfb94da7e8fe23c9ac7ce9d544cc">wangle::SSLSessionCacheManager::sExDataIndex_</a></div><div class="ttdeci">static int32_t sExDataIndex_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00264">SSLSessionCacheManager.h:264</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a4030f258e176ee2884d7caf5cdfcdf50"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a4030f258e176ee2884d7caf5cdfcdf50">wangle::SSLSessionCacheManager::SSLSessionCacheManager</a></div><div class="ttdeci">SSLSessionCacheManager(uint32_t maxCacheSize, uint32_t cacheCullSize, folly::SSLContext *ctx, const std::string &amp;context, SSLStats *stats, const std::shared_ptr&lt; SSLCacheProvider &gt; &amp;externalCache)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00142">SSLSessionCacheManager.cpp:142</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a67af0257227b9da91b6dd9c75d2ad385"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::SSLSessionCacheManager::restartSSLAccept </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structwangle_1_1SSLCacheProvider_1_1CacheContext.html">SSLCacheProvider::CacheContext</a> *&#160;</td>
          <td class="paramname"><em>cacheCtx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Restart all clients waiting for the answer to an external cache query </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00403">403</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="SSLSessionCacheManager_8h_source.html#l00189">pendingLookups_</a>, <a class="el" href="AsyncSSLSocket_8cpp_source.html#l01084">folly::AsyncSSLSocket::restartSSLAccept()</a>, <a class="el" href="SSLCacheProvider_8h_source.html#l00036">wangle::SSLCacheProvider::CacheContext::session</a>, <a class="el" href="SSLCacheProvider_8h_source.html#l00035">wangle::SSLCacheProvider::CacheContext::sessionId</a>, and <a class="el" href="SSLCacheProvider_8h_source.html#l00038">wangle::SSLCacheProvider::CacheContext::sslSocket</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00450">onGetFailure()</a>, and <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00420">restoreSession()</a>.</p>
<div class="fragment"><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                                                  {</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  PendingLookupMap::iterator pit = <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a1ddd9d4a1dfe828d72d0ace4f177c7ab">pendingLookups_</a>.find(cacheCtx-&gt;sessionId);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  CHECK(pit != <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a1ddd9d4a1dfe828d72d0ace4f177c7ab">pendingLookups_</a>.end());</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  pit-&gt;second.request_in_progress = <span class="keyword">false</span>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  pit-&gt;second.session = cacheCtx-&gt;session;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  VLOG(7) &lt;&lt; <span class="stringliteral">&quot;Restart SSL accept&quot;</span>;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  cacheCtx-&gt;sslSocket-&gt;restartSSLAccept();</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; attachedLookup: pit-&gt;second.waiters) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">// Wake up anyone else who was waiting for this session</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    VLOG(4) &lt;&lt; <span class="stringliteral">&quot;Restart SSL accept (waiters) for fd=&quot;</span> &lt;&lt;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      attachedLookup.first-&gt;getFd();</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    attachedLookup.first-&gt;restartSSLAccept();</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  }</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a1ddd9d4a1dfe828d72d0ace4f177c7ab">pendingLookups_</a>.erase(pit);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a1ddd9d4a1dfe828d72d0ace4f177c7ab"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a1ddd9d4a1dfe828d72d0ace4f177c7ab">wangle::SSLSessionCacheManager::pendingLookups_</a></div><div class="ttdeci">PendingLookupMap pendingLookups_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00189">SSLSessionCacheManager.h:189</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3d4ec5034ad29321233488242a76c1d0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::SSLSessionCacheManager::restoreSession </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structwangle_1_1SSLCacheProvider_1_1CacheContext.html">SSLCacheProvider::CacheContext</a> *&#160;</td>
          <td class="paramname"><em>cacheCtx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Invoked by onGetSuccess callback, to restore session from cache. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>The context that was passed to the async get request </td></tr>
    <tr><td class="paramname">data</td><td>Buffer that stores serialized session </td></tr>
    <tr><td class="paramname">length</td><td>Buffer size </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00420">420</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="SSLSessionCacheManager_8h_source.html#l00188">localCache_</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00403">restartSSLAccept()</a>, <a class="el" href="SSLCacheProvider_8h_source.html#l00036">wangle::SSLCacheProvider::CacheContext::session</a>, <a class="el" href="SSLCacheProvider_8h_source.html#l00035">wangle::SSLCacheProvider::CacheContext::sessionId</a>, and <a class="el" href="SSLSessionCacheManager_8h_source.html#l00190">stats_</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00434">onGetSuccess()</a>.</p>
<div class="fragment"><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                   {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  cacheCtx-&gt;session = d2i_SSL_SESSION(<span class="keyword">nullptr</span>, &amp;<a class="code" href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a>, length);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a67af0257227b9da91b6dd9c75d2ad385">restartSSLAccept</a>(cacheCtx);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="comment">/* Insert in the LRU after restarting all clients.  The stats logic</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">   * in getSession would treat this as a local hit otherwise.</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">localCache_</a>-&gt;storeSession(cacheCtx-&gt;sessionId, cacheCtx-&gt;session, <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">stats_</a>);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keyword">delete</span> cacheCtx;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a67af0257227b9da91b6dd9c75d2ad385"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a67af0257227b9da91b6dd9c75d2ad385">wangle::SSLSessionCacheManager::restartSSLAccept</a></div><div class="ttdeci">void restartSSLAccept(const SSLCacheProvider::CacheContext *cacheCtx)</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8cpp_source.html#l00403">SSLSessionCacheManager.cpp:403</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a82362860809195346ceb14d0d7244723"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a82362860809195346ceb14d0d7244723">wangle::SSLSessionCacheManager::localCache_</a></div><div class="ttdeci">std::shared_ptr&lt; ShardedLocalSSLSessionCache &gt; localCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00188">SSLSessionCacheManager.h:188</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a7bfee6a9b648a4727b99e07ee6952215"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a7bfee6a9b648a4727b99e07ee6952215">wangle::SSLSessionCacheManager::stats_</a></div><div class="ttdeci">SSLStats * stats_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00190">SSLSessionCacheManager.h:190</a></div></div>
<div class="ttc" id="Fingerprint_8cpp_html_a4f1b470245cdebf82b7a560640fb6d56"><div class="ttname"><a href="Fingerprint_8cpp.html#a4f1b470245cdebf82b7a560640fb6d56">data</a></div><div class="ttdeci">static constexpr uint64_t data[1]</div><div class="ttdef"><b>Definition:</b> <a href="Fingerprint_8cpp_source.html#l00043">Fingerprint.cpp:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6990e623fc028f0d0a54340fc5dcf282"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void wangle::SSLSessionCacheManager::shutdown </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Call this on shutdown to release the global instance of the <a class="el" href="classwangle_1_1ShardedLocalSSLSessionCache.html">ShardedLocalSSLSessionCache</a>. </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00177">177</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="composition__2_8cpp_source.html#l00034">g()</a>, <a class="el" href="SSLSessionCacheManager_8h_source.html#l00265">sCache_</a>, and <a class="el" href="SSLSessionCacheManager_8h_source.html#l00266">sCacheLock_</a>.</p>
<div class="fragment"><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                      {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  std::lock_guard&lt;std::mutex&gt; <a class="code" href="composition__2_8cpp.html#afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe">g</a>(<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a741d657aee7873108395ea6f9c295bf5">sCacheLock_</a>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a0af543b1ed171ddd2984d09382328a26">sCache_</a>.reset();</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;}</div><div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a0af543b1ed171ddd2984d09382328a26"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a0af543b1ed171ddd2984d09382328a26">wangle::SSLSessionCacheManager::sCache_</a></div><div class="ttdeci">static std::shared_ptr&lt; ShardedLocalSSLSessionCache &gt; sCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00265">SSLSessionCacheManager.h:265</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a741d657aee7873108395ea6f9c295bf5"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a741d657aee7873108395ea6f9c295bf5">wangle::SSLSessionCacheManager::sCacheLock_</a></div><div class="ttdeci">static std::mutex sCacheLock_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00266">SSLSessionCacheManager.h:266</a></div></div>
<div class="ttc" id="composition__2_8cpp_html_afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe"><div class="ttname"><a href="composition__2_8cpp.html#afb3bcbfaaa4d6a3b4ab3e3c4c2cbcfbe">g</a></div><div class="ttdeci">g_t g(f_t)</div><div class="ttdef"><b>Definition:</b> <a href="composition__2_8cpp_source.html#l00034">composition_2.cpp:34</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa1f2a70730492fd434d8d2ccdc0c456e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool wangle::SSLSessionCacheManager::storeCacheRecord </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;&#160;</td>
          <td class="paramname"><em>sessionId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">SSL_SESSION *&#160;</td>
          <td class="paramname"><em>session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Store a new session record in the external cache </p>

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00375">375</a> of file <a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a>.</p>

<p>References <a class="el" href="SSLSessionCacheManager_8h_source.html#l00187">ctx_</a>, <a class="el" href="ThreadPoolExecutorTest_8cpp_source.html#l00266">expiration()</a>, <a class="el" href="SSLSessionCacheManager_8h_source.html#l00191">externalCache_</a>, <a class="el" href="SSLContext_8h_source.html#l00503">folly::SSLContext::getSSLCtx()</a>, <a class="el" href="Conv_8cpp_source.html#l00212">string</a>, <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00186">uint32_t</a>, and <a class="el" href="ConstexprMathBenchmark_8cpp_source.html#l00178">uint8_t</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00207">newSession()</a>.</p>
<div class="fragment"><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                                                    {</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <a class="code" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> sessionString;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <a class="code" href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a> sessionLen = i2d_SSL_SESSION(session, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  sessionString.resize(sessionLen);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a>* cp = (<a class="code" href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a> *)sessionString.data();</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  i2d_SSL_SESSION(session, &amp;cp);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="keywordtype">size_t</span> <a class="code" href="ThreadPoolExecutorTest_8cpp.html#aa0075c0a3668827a8cbf0376308b7d86">expiration</a> = SSL_CTX_get_timeout(<a class="code" href="classwangle_1_1SSLSessionCacheManager.html#a6d35a60340079b67a2c27902f7c92582">ctx_</a>-&gt;<a class="code" href="classfolly_1_1SSLContext.html#a3f7525cc5fbb77c79147b2494c3f4087">getSSLCtx</a>());</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">externalCache_</a>-&gt;setAsync(sessionId, sessionString,</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                                  std::chrono::seconds(expiration));</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;}</div><div class="ttc" id="ThreadPoolExecutorTest_8cpp_html_aa0075c0a3668827a8cbf0376308b7d86"><div class="ttname"><a href="ThreadPoolExecutorTest_8cpp.html#aa0075c0a3668827a8cbf0376308b7d86">expiration</a></div><div class="ttdeci">static void expiration()</div><div class="ttdef"><b>Definition:</b> <a href="ThreadPoolExecutorTest_8cpp_source.html#l00266">ThreadPoolExecutorTest.cpp:266</a></div></div>
<div class="ttc" id="classfolly_1_1SSLContext_html_a3f7525cc5fbb77c79147b2494c3f4087"><div class="ttname"><a href="classfolly_1_1SSLContext.html#a3f7525cc5fbb77c79147b2494c3f4087">folly::SSLContext::getSSLCtx</a></div><div class="ttdeci">SSL_CTX * getSSLCtx() const </div><div class="ttdef"><b>Definition:</b> <a href="SSLContext_8h_source.html#l00503">SSLContext.h:503</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_ae1affc9ca37cfb624959c866a73f83c2"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#ae1affc9ca37cfb624959c866a73f83c2">uint8_t</a></div><div class="ttdeci">uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00178">ConstexprMathBenchmark.cpp:178</a></div></div>
<div class="ttc" id="Conv_8cpp_html_ae1adbce218e7a9d09164012443191d24"><div class="ttname"><a href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">string</a></div><div class="ttdeci">const char * string</div><div class="ttdef"><b>Definition:</b> <a href="Conv_8cpp_source.html#l00212">Conv.cpp:212</a></div></div>
<div class="ttc" id="ConstexprMathBenchmark_8cpp_html_a09a1e304d66d35dd47daffee9731edaa"><div class="ttname"><a href="ConstexprMathBenchmark_8cpp.html#a09a1e304d66d35dd47daffee9731edaa">uint32_t</a></div><div class="ttdeci">uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="ConstexprMathBenchmark_8cpp_source.html#l00186">ConstexprMathBenchmark.cpp:186</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_ac32ec93581a2791a54775e0c3d38b6b7"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#ac32ec93581a2791a54775e0c3d38b6b7">wangle::SSLSessionCacheManager::externalCache_</a></div><div class="ttdeci">std::shared_ptr&lt; SSLCacheProvider &gt; externalCache_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00191">SSLSessionCacheManager.h:191</a></div></div>
<div class="ttc" id="classwangle_1_1SSLSessionCacheManager_html_a6d35a60340079b67a2c27902f7c92582"><div class="ttname"><a href="classwangle_1_1SSLSessionCacheManager.html#a6d35a60340079b67a2c27902f7c92582">wangle::SSLSessionCacheManager::ctx_</a></div><div class="ttdeci">folly::SSLContext * ctx_</div><div class="ttdef"><b>Definition:</b> <a href="SSLSessionCacheManager_8h_source.html#l00187">SSLSessionCacheManager.h:187</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a6d35a60340079b67a2c27902f7c92582"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1SSLContext.html">folly::SSLContext</a>* wangle::SSLSessionCacheManager::ctx_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8h_source.html#l00187">187</a> of file <a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00375">storeCacheRecord()</a>.</p>

</div>
</div>
<a class="anchor" id="ac32ec93581a2791a54775e0c3d38b6b7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="classwangle_1_1SSLCacheProvider.html">SSLCacheProvider</a>&gt; wangle::SSLSessionCacheManager::externalCache_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8h_source.html#l00191">191</a> of file <a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00272">getSession()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00387">lookupCacheRecord()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00207">newSession()</a>, and <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00375">storeCacheRecord()</a>.</p>

</div>
</div>
<a class="anchor" id="a82362860809195346ceb14d0d7244723"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="classwangle_1_1ShardedLocalSSLSessionCache.html">ShardedLocalSSLSessionCache</a>&gt; wangle::SSLSessionCacheManager::localCache_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8h_source.html#l00188">188</a> of file <a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00272">getSession()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00207">newSession()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00239">removeSession()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00420">restoreSession()</a>, and <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00142">SSLSessionCacheManager()</a>.</p>

</div>
</div>
<a class="anchor" id="a1ddd9d4a1dfe828d72d0ace4f177c7ab"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacewangle.html#a52d3b2210f9ff1b6ba79406ab96fd1ee">PendingLookupMap</a> wangle::SSLSessionCacheManager::pendingLookups_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8h_source.html#l00189">189</a> of file <a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00272">getSession()</a>, and <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00403">restartSSLAccept()</a>.</p>

</div>
</div>
<a class="anchor" id="a0af543b1ed171ddd2984d09382328a26"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classshared__ptr.html">shared_ptr</a>&lt; <a class="el" href="classwangle_1_1ShardedLocalSSLSessionCache.html">ShardedLocalSSLSessionCache</a> &gt; wangle::SSLSessionCacheManager::sCache_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8h_source.html#l00265">265</a> of file <a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00182">getLocalCache()</a>, and <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00177">shutdown()</a>.</p>

</div>
</div>
<a class="anchor" id="a741d657aee7873108395ea6f9c295bf5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="OpenSSLThreading_8cpp.html#a1be3f7fa26e4521098de5f1ec0f865f3">std::mutex</a> wangle::SSLSessionCacheManager::sCacheLock_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8h_source.html#l00266">266</a> of file <a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00182">getLocalCache()</a>, and <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00177">shutdown()</a>.</p>

</div>
</div>
<a class="anchor" id="a775dcfb94da7e8fe23c9ac7ce9d544cc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int wangle::SSLSessionCacheManager::sExDataIndex_ = -1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8h_source.html#l00264">264</a> of file <a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00257">getSessionCallback()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00195">newSessionCallback()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00228">removeSessionCallback()</a>, and <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00142">SSLSessionCacheManager()</a>.</p>

</div>
</div>
<a class="anchor" id="a7bfee6a9b648a4727b99e07ee6952215"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classwangle_1_1SSLStats.html">SSLStats</a>* wangle::SSLSessionCacheManager::stats_ {<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="SSLSessionCacheManager_8h_source.html#l00190">190</a> of file <a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a>.</p>

<p>Referenced by <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00272">getSession()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00207">newSession()</a>, <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00239">removeSession()</a>, and <a class="el" href="SSLSessionCacheManager_8cpp_source.html#l00420">restoreSession()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/wangle/wangle/ssl/<a class="el" href="SSLSessionCacheManager_8h_source.html">SSLSessionCacheManager.h</a></li>
<li>proxygen/wangle/wangle/ssl/<a class="el" href="SSLSessionCacheManager_8cpp_source.html">SSLSessionCacheManager.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacewangle.html">wangle</a></li><li class="navelem"><a class="el" href="classwangle_1_1SSLSessionCacheManager.html">SSLSessionCacheManager</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
