<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: folly::Subprocess Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classfolly_1_1Subprocess.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classfolly_1_1Subprocess-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">folly::Subprocess Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1Subprocess_1_1ChildPipe.html">ChildPipe</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1Subprocess_1_1DangerousPostForkPreExecCallback.html">DangerousPostForkPreExecCallback</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfolly_1_1Subprocess_1_1Pipe.html">Pipe</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess_1_1ReadLinesCallback.html">ReadLinesCallback</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ab03a812d35c7d02a8c72d6f9e4ebf537"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#ab03a812d35c7d02a8c72d6f9e4ebf537">FdCallback</a> = <a class="el" href="classfolly_1_1Function.html">folly::Function</a>&lt; bool(int, int)&gt;</td></tr>
<tr class="separator:ab03a812d35c7d02a8c72d6f9e4ebf537"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ad99ab580fe005bd85df0f41f08034d6d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#ad99ab580fe005bd85df0f41f08034d6d">Subprocess</a> (const <a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> &amp;)=delete</td></tr>
<tr class="separator:ad99ab580fe005bd85df0f41f08034d6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab3d3eafaad023d6d149a7f32f183c20"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#aab3d3eafaad023d6d149a7f32f183c20">operator=</a> (const <a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> &amp;)=delete</td></tr>
<tr class="separator:aab3d3eafaad023d6d149a7f32f183c20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a11e6a7d809313eb90f548e1658d51b88"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a11e6a7d809313eb90f548e1658d51b88">Subprocess</a> (<a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> &amp;&amp;)=default</td></tr>
<tr class="separator:a11e6a7d809313eb90f548e1658d51b88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab69f93dfbfe9af840ca0a34317bd5298"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#ab69f93dfbfe9af840ca0a34317bd5298">operator=</a> (<a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> &amp;&amp;)=default</td></tr>
<tr class="separator:ab69f93dfbfe9af840ca0a34317bd5298"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaffb02f7a5f42ab2199ff17c6605354d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#aaffb02f7a5f42ab2199ff17c6605354d">Subprocess</a> ()</td></tr>
<tr class="separator:aaffb02f7a5f42ab2199ff17c6605354d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a790442a4e0159343aa55fa5302121213"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a790442a4e0159343aa55fa5302121213">Subprocess</a> (const std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; &amp;<a class="el" href="ConstexprMathBenchmark_8cpp.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, const <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;options=<a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a>(), const char *executable=<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>, const std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; *env=<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>)</td></tr>
<tr class="separator:a790442a4e0159343aa55fa5302121213"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a235bda43fa9aa2c473177c9b55e54f40"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a235bda43fa9aa2c473177c9b55e54f40">~Subprocess</a> ()</td></tr>
<tr class="separator:a235bda43fa9aa2c473177c9b55e54f40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaf6b70daaf023ca3da7e6703638c443"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#afaf6b70daaf023ca3da7e6703638c443">Subprocess</a> (const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;<a class="el" href="wangle_2__build_2gtest_2tmp_2gtest-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a>, const <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;options=<a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a>(), const std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; *env=<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>)</td></tr>
<tr class="separator:afaf6b70daaf023ca3da7e6703638c443"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5059c9911c06b01cd4867f672c08292a"><td class="memItemLeft" align="right" valign="top">pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a5059c9911c06b01cd4867f672c08292a">pid</a> () const </td></tr>
<tr class="separator:a5059c9911c06b01cd4867f672c08292a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47cd912367e2a179756a8abf79c15bac"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1ProcessReturnCode.html">ProcessReturnCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a47cd912367e2a179756a8abf79c15bac">returnCode</a> () const </td></tr>
<tr class="separator:a47cd912367e2a179756a8abf79c15bac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47c806c1bc054d667def55fd8bbb4cbd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1ProcessReturnCode.html">ProcessReturnCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a47c806c1bc054d667def55fd8bbb4cbd">poll</a> (struct rusage *ru=<a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a>)</td></tr>
<tr class="separator:a47c806c1bc054d667def55fd8bbb4cbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad81a528d05c10731cb92ab0fddc1f168"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#ad81a528d05c10731cb92ab0fddc1f168">pollChecked</a> ()</td></tr>
<tr class="separator:ad81a528d05c10731cb92ab0fddc1f168"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca2924e7e672dee645ddb7634efa5bd2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1ProcessReturnCode.html">ProcessReturnCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">wait</a> ()</td></tr>
<tr class="separator:aca2924e7e672dee645ddb7634efa5bd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abde3899b23e9711f39fe9e6d6461f2a9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#abde3899b23e9711f39fe9e6d6461f2a9">waitChecked</a> ()</td></tr>
<tr class="separator:abde3899b23e9711f39fe9e6d6461f2a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87c3f4502dfd923e235592e3249ae382"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a87c3f4502dfd923e235592e3249ae382">sendSignal</a> (int signal)</td></tr>
<tr class="separator:a87c3f4502dfd923e235592e3249ae382"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac39c69859d5ac3f8fc9e251a918107a2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#ac39c69859d5ac3f8fc9e251a918107a2">terminate</a> ()</td></tr>
<tr class="separator:ac39c69859d5ac3f8fc9e251a918107a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80ce26ad11196252de015cadfae66510"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a80ce26ad11196252de015cadfae66510">kill</a> ()</td></tr>
<tr class="separator:a80ce26ad11196252de015cadfae66510"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b29ab71d11a0d2169b7e81fd590679e"><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="classfolly_1_1IOBufQueue.html">IOBufQueue</a>, <a class="el" href="classfolly_1_1IOBufQueue.html">IOBufQueue</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a1b29ab71d11a0d2169b7e81fd590679e">communicateIOBuf</a> (<a class="el" href="classfolly_1_1IOBufQueue.html">IOBufQueue</a> input=<a class="el" href="classfolly_1_1IOBufQueue.html">IOBufQueue</a>())</td></tr>
<tr class="separator:a1b29ab71d11a0d2169b7e81fd590679e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28a252e66fe53d1a86016d46f8b417ed"><td class="memItemLeft" align="right" valign="top">std::pair&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a>, <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate</a> (<a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">StringPiece</a> input=<a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">StringPiece</a>())</td></tr>
<tr class="separator:a28a252e66fe53d1a86016d46f8b417ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa47e634e06932b3c202ecb2099ea9d3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#aaa47e634e06932b3c202ecb2099ea9d3">communicate</a> (<a class="el" href="classfolly_1_1Subprocess.html#ab03a812d35c7d02a8c72d6f9e4ebf537">FdCallback</a> readCallback, <a class="el" href="classfolly_1_1Subprocess.html#ab03a812d35c7d02a8c72d6f9e4ebf537">FdCallback</a> writeCallback)</td></tr>
<tr class="separator:aaa47e634e06932b3c202ecb2099ea9d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf3a44001b0a204f5ea9706bd3604525"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#acf3a44001b0a204f5ea9706bd3604525">enableNotifications</a> (int childFd, bool enabled)</td></tr>
<tr class="separator:acf3a44001b0a204f5ea9706bd3604525"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13a6e92aa089ed83e27a7d98ab36eb25"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a13a6e92aa089ed83e27a7d98ab36eb25">notificationsEnabled</a> (int childFd) const </td></tr>
<tr class="separator:a13a6e92aa089ed83e27a7d98ab36eb25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace171ce984779cfb26eef4ad397a35e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#ace171ce984779cfb26eef4ad397a35e5">closeParentFd</a> (int childFd)</td></tr>
<tr class="separator:ace171ce984779cfb26eef4ad397a35e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ec688cc2025bf3df3950144b2fe43ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a1ec688cc2025bf3df3950144b2fe43ff">setAllNonBlocking</a> ()</td></tr>
<tr class="separator:a1ec688cc2025bf3df3950144b2fe43ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f2c79adb219ecd653be9a59560f26c1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">parentFd</a> (int childFd) const </td></tr>
<tr class="separator:a6f2c79adb219ecd653be9a59560f26c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98011a4cbc052f85c303b37d7d3d5ccb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a98011a4cbc052f85c303b37d7d3d5ccb">stdinFd</a> () const </td></tr>
<tr class="separator:a98011a4cbc052f85c303b37d7d3d5ccb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d2b6778b29c7d44d85260fe09919212"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a8d2b6778b29c7d44d85260fe09919212">stdoutFd</a> () const </td></tr>
<tr class="separator:a8d2b6778b29c7d44d85260fe09919212"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5f9ae1cd03f31e9f9421f152f075222"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#ad5f9ae1cd03f31e9f9421f152f075222">stderrFd</a> () const </td></tr>
<tr class="separator:ad5f9ae1cd03f31e9f9421f152f075222"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23732fe54ab2d62e342820441d5b0052"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structfolly_1_1Subprocess_1_1ChildPipe.html">ChildPipe</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a23732fe54ab2d62e342820441d5b0052">takeOwnershipOfPipes</a> ()</td></tr>
<tr class="separator:a23732fe54ab2d62e342820441d5b0052"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ac6b701fb39b6f0fa89481d6c6144ac77"><td class="memTemplParams" colspan="2">template&lt;class Callback &gt; </td></tr>
<tr class="memitem:ac6b701fb39b6f0fa89481d6c6144ac77"><td class="memTemplItemLeft" align="right" valign="top">static auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#ac6b701fb39b6f0fa89481d6c6144ac77">readLinesCallback</a> (Callback &amp;&amp;fdLineCb, <a class="el" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a> maxLineLength=0, char delimiter= '\n', <a class="el" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a> bufSize=1024) -&gt; <a class="el" href="classfolly_1_1Subprocess_1_1ReadLinesCallback.html">ReadLinesCallback</a>&lt; typename std::decay&lt; Callback &gt;::<a class="el" href="ClientProtocol_8cpp.html#afb6f25e8ca4d7adb175ad413430bbb90">type</a> &gt;</td></tr>
<tr class="separator:ac6b701fb39b6f0fa89481d6c6144ac77"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a85bd2d9070a17d31725b2c56f6e74055"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a85bd2d9070a17d31725b2c56f6e74055">CLOSE</a> = -1</td></tr>
<tr class="separator:a85bd2d9070a17d31725b2c56f6e74055"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6214cf4ed74633db1bb01fd835083121"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a6214cf4ed74633db1bb01fd835083121">PIPE</a> = -2</td></tr>
<tr class="separator:a6214cf4ed74633db1bb01fd835083121"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d10f614635d4508855b7318edcc0611"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a6d10f614635d4508855b7318edcc0611">PIPE_IN</a> = -3</td></tr>
<tr class="separator:a6d10f614635d4508855b7318edcc0611"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0885fa8239b874b8c6d05b92a57f442e"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a0885fa8239b874b8c6d05b92a57f442e">PIPE_OUT</a> = -4</td></tr>
<tr class="separator:a0885fa8239b874b8c6d05b92a57f442e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a69b7492efbeaf1fb9c264a38f1127421"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a69b7492efbeaf1fb9c264a38f1127421">spawn</a> (std::unique_ptr&lt; const char *[]&gt; <a class="el" href="ConstexprMathBenchmark_8cpp.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, const char *executable, const <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;options, const std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; *env)</td></tr>
<tr class="separator:a69b7492efbeaf1fb9c264a38f1127421"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a998b022d0dc22d80f12924e09f1be16b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a998b022d0dc22d80f12924e09f1be16b">spawnInternal</a> (std::unique_ptr&lt; const char *[]&gt; <a class="el" href="ConstexprMathBenchmark_8cpp.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, const char *executable, <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;options, const std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; *env, int errFd)</td></tr>
<tr class="separator:a998b022d0dc22d80f12924e09f1be16b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55f5e898eb4d21d9795ca2d0a890b6de"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a55f5e898eb4d21d9795ca2d0a890b6de">prepareChild</a> (const <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;options, const sigset_t *sigmask, const char *childDir) const </td></tr>
<tr class="separator:a55f5e898eb4d21d9795ca2d0a890b6de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf78334bf1b8a878159210b338283535"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#abf78334bf1b8a878159210b338283535">runChild</a> (const char *executable, char **<a class="el" href="ConstexprMathBenchmark_8cpp.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, char **env, const <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;options) const </td></tr>
<tr class="separator:abf78334bf1b8a878159210b338283535"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a36d7cbc257412f87a435bd5422bbc3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a9a36d7cbc257412f87a435bd5422bbc3">readChildErrorPipe</a> (int pfd, const char *executable)</td></tr>
<tr class="separator:a9a36d7cbc257412f87a435bd5422bbc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39d1489b545f03262b00046ba8ab42ee"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">findByChildFd</a> (const int childFd) const </td></tr>
<tr class="separator:a39d1489b545f03262b00046ba8ab42ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ad259adb8e0a99987161b63ac7fea4e81"><td class="memItemLeft" align="right" valign="top">pid_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a> {-1}</td></tr>
<tr class="separator:ad259adb8e0a99987161b63ac7fea4e81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca1747e2265c3da92641434b16c77f03"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classfolly_1_1ProcessReturnCode.html">ProcessReturnCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a></td></tr>
<tr class="separator:aca1747e2265c3da92641434b16c77f03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1105b24f5523c282910b4cecac6c7cca"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="structfolly_1_1Subprocess_1_1Pipe.html">Pipe</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a></td></tr>
<tr class="separator:a1105b24f5523c282910b4cecac6c7cca"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a>. </p>

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00269">269</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="ab03a812d35c7d02a8c72d6f9e4ebf537"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classfolly_1_1Subprocess.html#ab03a812d35c7d02a8c72d6f9e4ebf537">folly::Subprocess::FdCallback</a> =  <a class="el" href="classfolly_1_1Function.html">folly::Function</a>&lt;bool(int, int)&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Communicate with the child until all pipes to/from the child are closed.</p>
<p>== Semantics ==</p>
<p>readCallback(pfd, cfd) will be called whenever there's data available on any pipe <em>from</em> the child (PIPE_OUT). pfd is the file descriptor in the parent (that you use to read from); cfd is the file descriptor in the child (used for identifying the stream; 1 = child's standard output, 2 = child's standard error, etc)</p>
<p>writeCallback(pfd, cfd) will be called whenever a pipe <em>to</em> the child is writable (PIPE_IN). pfd is the file descriptor in the parent (that you use to write to); cfd is the file descriptor in the child (used for identifying the stream; 0 = child's standard input, etc)</p>
<p>The read and write callbacks must read from / write to pfd and return false during normal operation. Return true to tell <a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate()</a> to close the pipe. For readCallback, this might send SIGPIPE to the child, or make its writes fail with EPIPE, so you should generally avoid returning true unless you've reached end-of-file.</p>
<p><a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate()</a> returns when all pipes to/from the child are closed; the child might stay alive after that, so you must still <a class="el" href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">wait()</a>. Conversely, the child may quit long before its pipes are closed, since its descendants can keep them alive forever.</p>
<p>Most users won't need to use this callback version; the simpler version of communicate (which buffers data in memory) will probably work fine.</p>
<p>== Things you must get correct ==</p>
<p>1) You MUST consume all data passed to readCallback (or return true to close the pipe). Similarly, you MUST write to a writable pipe (or return true to close the pipe). To do otherwise is an error that can result in a deadlock. You must do this even for pipes you are not interested in.</p>
<p>2) pfd is nonblocking, so be prepared for <a class="el" href="namespacefizz_1_1detail.html#a36dc6280bf4d04bce115a7055a78abac">read()</a> / <a class="el" href="namespacefizz_1_1detail.html#a40ead2543c07ad500214ec9dd760b706">write()</a> to return -1 and set errno to EAGAIN (in which case you should return false). Use <a class="el" href="namespacefolly.html#a77ddd583d220e05a3d7218109b6409e1">readNoInt()</a> from FileUtil.h to handle interrupted reads for you.</p>
<p>3) Your callbacks MUST NOT call any of the <a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> methods that manipulate the pipe FDs. Check the docblocks, but, for example, neither closeParentFd (return true instead) nor takeOwnershipOfPipes are safe. Stick to reading/writing from pfd, as appropriate.</p>
<p>== Good to know ==</p>
<p>1) See <a class="el" href="classfolly_1_1Subprocess_1_1ReadLinesCallback.html">ReadLinesCallback</a> for an easy way to consume the child's output streams line-by-line (or tokenized by another delimiter).</p>
<p>2) "Wait until the descendants close the pipes" is usually the behavior you want, since the descendants may have something to say even if the immediate child is dead. If you need to be able to force-close all parent FDs, <a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate()</a> will NOT work for you. Do it your own way by using <a class="el" href="classfolly_1_1Subprocess.html#a23732fe54ab2d62e342820441d5b0052">takeOwnershipOfPipes()</a>.</p>
<p>Why not? You can return "true" from your callbacks to sever active pipes, but inactive ones can remain open indefinitely. It is impossible to safely close inactive pipes while another thread is blocked in <a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate()</a>. This is BY DESIGN. Racing <a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate()</a>'s read/write callbacks can result in wrong I/O and data corruption. This class would need internal synchronization and timeouts, a poor and expensive implementation choice, in order to make <a class="el" href="classfolly_1_1Subprocess.html#ace171ce984779cfb26eef4ad397a35e5">closeParentFd()</a> thread-safe. </p>

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00718">718</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ad99ab580fe005bd85df0f41f08034d6d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::Subprocess::Subprocess </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a11e6a7d809313eb90f548e1658d51b88"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::Subprocess::Subprocess </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> &amp;&amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aaffb02f7a5f42ab2199ff17c6605354d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">folly::Subprocess::Subprocess </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create an uninitialized subprocess.</p>
<p>In this state it can only be destroyed, or assigned to using the move assignment operator. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00188">188</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;{}</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a790442a4e0159343aa55fa5302121213"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::Subprocess::Subprocess </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em> = <code><a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a>()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>executable</em> = <code><a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a></code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; *&#160;</td>
          <td class="paramname"><em>env</em> = <code><a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Create a subprocess from the given arguments. argv[0] must be listed. If not-null, executable must be the actual executable being used (otherwise it's the same as argv[0]).</p>
<p>If env is not-null, it must contain name=value strings to be used as the child's environment; otherwise, we inherit the environment from the parent. env must be null if options.usePath is set. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00190">190</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                     {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="keywordflow">if</span> (argv.empty()) {</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;argv must not be empty&quot;</span>);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keywordflow">if</span> (!executable) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    executable = argv[0].c_str();</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  }</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#a69b7492efbeaf1fb9c264a38f1127421">spawn</a>(cloneStrings(argv), executable, options, env);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_a69b7492efbeaf1fb9c264a38f1127421"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a69b7492efbeaf1fb9c264a38f1127421">folly::Subprocess::spawn</a></div><div class="ttdeci">void spawn(std::unique_ptr&lt; const char *[]&gt; argv, const char *executable, const Options &amp;options, const std::vector&lt; std::string &gt; *env)</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00249">Subprocess.cpp:249</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a235bda43fa9aa2c473177c9b55e54f40"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">folly::Subprocess::~Subprocess </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00216">216</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="Subprocess_8h_source.html#l00135">folly::ProcessReturnCode::RUNNING</a>.</p>
<div class="fragment"><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  CHECK_NE(<a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a>.<a class="code" href="classfolly_1_1ProcessReturnCode.html#afb4b6bf5391499394eb098616345a971">state</a>(), <a class="code" href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">ProcessReturnCode::RUNNING</a>)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      &lt;&lt; <span class="stringliteral">&quot;Subprocess destroyed without reaping child&quot;</span>;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div><div class="ttc" id="classfolly_1_1ProcessReturnCode_html_afb4b6bf5391499394eb098616345a971"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#afb4b6bf5391499394eb098616345a971">folly::ProcessReturnCode::state</a></div><div class="ttdeci">State state() const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00074">Subprocess.cpp:74</a></div></div>
<div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">folly::ProcessReturnCode::RUNNING</a></div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00135">Subprocess.h:135</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_aca1747e2265c3da92641434b16c77f03"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">folly::Subprocess::returnCode_</a></div><div class="ttdeci">ProcessReturnCode returnCode_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00942">Subprocess.h:942</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afaf6b70daaf023ca3da7e6703638c443"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">folly::Subprocess::Subprocess </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &amp;&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em> = <code><a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a>()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; *&#160;</td>
          <td class="paramname"><em>env</em> = <code><a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Create a subprocess run as a shell command (as shell -c 'command')</p>
<p>The shell to use is taken from the environment variable $SHELL, or /bin/sh if $SHELL is unset. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00204">204</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="SmallLocksBenchmark_8cpp_source.html#l00430">argv</a>, and <a class="el" href="Subprocess_8h_source.html#l00490">folly::Subprocess::Options::usePath_</a>.</p>
<div class="fragment"><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                                     {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  <span class="keywordflow">if</span> (options.usePath_) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">throw</span> std::invalid_argument(<span class="stringliteral">&quot;usePath() not allowed when running in shell&quot;</span>);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  std::vector&lt;std::string&gt; <a class="code" href="SmallLocksBenchmark_8cpp.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a> = {<span class="stringliteral">&quot;/bin/sh&quot;</span>, <span class="stringliteral">&quot;-c&quot;</span>, <a class="code" href="fizz_2build___2gtest_2tmp_2gtest-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a>};</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#a69b7492efbeaf1fb9c264a38f1127421">spawn</a>(cloneStrings(argv), argv[0].c_str(), options, env);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_a69b7492efbeaf1fb9c264a38f1127421"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a69b7492efbeaf1fb9c264a38f1127421">folly::Subprocess::spawn</a></div><div class="ttdeci">void spawn(std::unique_ptr&lt; const char *[]&gt; argv, const char *executable, const Options &amp;options, const std::vector&lt; std::string &gt; *env)</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00249">Subprocess.cpp:249</a></div></div>
<div class="ttc" id="SmallLocksBenchmark_8cpp_html_af2efa898e9eed6fe6715279cb1ec35b0"><div class="ttname"><a href="SmallLocksBenchmark_8cpp.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a></div><div class="ttdeci">char ** argv</div><div class="ttdef"><b>Definition:</b> <a href="SmallLocksBenchmark_8cpp_source.html#l00430">SmallLocksBenchmark.cpp:430</a></div></div>
<div class="ttc" id="fizz_2build___2gtest_2tmp_2gtest-cfgcmd_8txt_html_adfc5ba7e22f5e4a6221c12a70503bef3"><div class="ttname"><a href="fizz_2build___2gtest_2tmp_2gtest-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a></div><div class="ttdeci">cmd</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2tmp_2gtest-cfgcmd_8txt_source.html#l00001">gtest-cfgcmd.txt:1</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ace171ce984779cfb26eef4ad397a35e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::Subprocess::closeParentFd </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>childFd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Close the parent file descriptor given a file descriptor in the child. DO NOT USE from <a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate()</a> callbacks; make them return true instead. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00901">901</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                                          {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="keywordtype">int</span> idx = <a class="code" href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">findByChildFd</a>(childFd);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>[idx].pipe.close(); <span class="comment">// May throw</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.erase(<a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.begin() + idx);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_a39d1489b545f03262b00046ba8ab42ee"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">folly::Subprocess::findByChildFd</a></div><div class="ttdeci">size_t findByChildFd(const int childFd) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00889">Subprocess.cpp:889</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1105b24f5523c282910b4cecac6c7cca"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">folly::Subprocess::pipes_</a></div><div class="ttdeci">std::vector&lt; Pipe &gt; pipes_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00970">Subprocess.h:970</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a28a252e66fe53d1a86016d46f8b417ed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a>, <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; folly::Subprocess::communicate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">StringPiece</a>&#160;</td>
          <td class="paramname"><em>input</em> = <code><a class="el" href="namespacefolly.html#af8d3e3eb9accef5470823e6353f60140">StringPiece</a>()</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00740">740</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="Range_8h_source.html#l00446">folly::Range&lt; Iter &gt;::data()</a>, <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>, <a class="el" href="Range_8h_source.html#l00431">folly::Range&lt; Iter &gt;::size()</a>, and <a class="el" href="IOBufQueue_8cpp_source.html#l00194">folly::IOBufQueue::wrapBuffer()</a>.</p>

<p>Referenced by <a class="el" href="SubprocessTest_8cpp_source.html#l00206">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                                                                       {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  IOBufQueue inputQueue;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  inputQueue.wrapBuffer(input.data(), input.size());</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <span class="keyword">auto</span> outQueues = <a class="code" href="classfolly_1_1Subprocess.html#a1b29ab71d11a0d2169b7e81fd590679e">communicateIOBuf</a>(<a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(inputQueue));</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keyword">auto</span> outBufs =</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      std::make_pair(outQueues.first.move(), outQueues.second.move());</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  std::pair&lt;std::string, std::string&gt; out;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keywordflow">if</span> (outBufs.first) {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    outBufs.first-&gt;coalesce();</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    out.first.assign(</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        reinterpret_cast&lt;const char*&gt;(outBufs.first-&gt;data()),</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        outBufs.first-&gt;length());</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  }</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="keywordflow">if</span> (outBufs.second) {</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    outBufs.second-&gt;coalesce();</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    out.second.assign(</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        reinterpret_cast&lt;const char*&gt;(outBufs.second-&gt;data()),</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        outBufs.second-&gt;length());</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  }</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordflow">return</span> out;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1b29ab71d11a0d2169b7e81fd590679e"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1b29ab71d11a0d2169b7e81fd590679e">folly::Subprocess::communicateIOBuf</a></div><div class="ttdeci">std::pair&lt; IOBufQueue, IOBufQueue &gt; communicateIOBuf(IOBufQueue input=IOBufQueue())</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00763">Subprocess.cpp:763</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaa47e634e06932b3c202ecb2099ea9d3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::Subprocess::communicate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1Subprocess.html#ab03a812d35c7d02a8c72d6f9e4ebf537">FdCallback</a>&#160;</td>
          <td class="paramname"><em>readCallback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfolly_1_1Subprocess.html#ab03a812d35c7d02a8c72d6f9e4ebf537">FdCallback</a>&#160;</td>
          <td class="paramname"><em>writeCallback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00801">801</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="folly_2folly_2Exception_8h_source.html#l00101">folly::checkUnixError()</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">i</a>, <a class="el" href="NetOps_8cpp_source.html#l00141">folly::netops::poll()</a>, and <a class="el" href="Subprocess_8h_source.html#l00135">folly::ProcessReturnCode::RUNNING</a>.</p>
<div class="fragment"><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                              {</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="comment">// This serves to prevent wait() followed by communicate(), but if you</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="comment">// legitimately need that, send a patch to delete this line.</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a>.<a class="code" href="classfolly_1_1ProcessReturnCode.html#a9f4f16586f84d2b8b1b10d75a2d7697e">enforce</a>(<a class="code" href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">ProcessReturnCode::RUNNING</a>);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#a1ec688cc2025bf3df3950144b2fe43ff">setAllNonBlocking</a>();</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  std::vector&lt;pollfd&gt; fds;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  fds.reserve(<a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.size());</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  std::vector&lt;size_t&gt; toClose; <span class="comment">// indexes into pipes_</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  toClose.reserve(<a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.size());</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordflow">while</span> (!<a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.empty()) {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    fds.clear();</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    toClose.clear();</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; p : <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>) {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      pollfd pfd;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      pfd.fd = p.pipe.fd();</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="comment">// Yes, backwards, PIPE_IN / PIPE_OUT are defined from the</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="comment">// child&#39;s point of view.</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      <span class="keywordflow">if</span> (!p.enabled) {</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="comment">// Still keeping fd in watched set so we get notified of POLLHUP /</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="comment">// POLLERR</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        pfd.events = 0;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p.direction == <a class="code" href="classfolly_1_1Subprocess.html#a6d10f614635d4508855b7318edcc0611">PIPE_IN</a>) {</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        pfd.events = POLLOUT;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        pfd.events = POLLIN;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      }</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;      fds.push_back(pfd);</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    }</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordtype">int</span> r;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      r = <a class="code" href="classfolly_1_1Subprocess.html#a47c806c1bc054d667def55fd8bbb4cbd">::poll</a>(fds.data(), fds.size(), -1);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    } <span class="keywordflow">while</span> (r == -1 &amp;&amp; errno == EINTR);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(r, <span class="stringliteral">&quot;poll&quot;</span>);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> = 0; <a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a> &lt; pipes_.size(); ++<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>) {</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <span class="keyword">auto</span>&amp; p = pipes_[<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>];</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <span class="keyword">auto</span> <a class="code" href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">parentFd</a> = p.pipe.fd();</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;      DCHECK_EQ(fds[<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>].fd, <a class="code" href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">parentFd</a>);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <span class="keywordtype">short</span> events = fds[<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>].revents;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      <span class="keywordtype">bool</span> closed = <span class="keyword">false</span>;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="keywordflow">if</span> (events &amp; POLLOUT) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        DCHECK(!(events &amp; POLLIN));</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="keywordflow">if</span> (writeCallback(<a class="code" href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">parentFd</a>, p.childFd)) {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;          toClose.push_back(<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;          closed = <span class="keyword">true</span>;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        }</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      }</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="comment">// Call read callback on POLLHUP, to give it a chance to read (and act</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <span class="comment">// on) end of file</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <span class="keywordflow">if</span> (events &amp; (POLLIN | POLLHUP)) {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        DCHECK(!(events &amp; POLLOUT));</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <span class="keywordflow">if</span> (readCallback(<a class="code" href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">parentFd</a>, p.childFd)) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;          toClose.push_back(<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;          closed = <span class="keyword">true</span>;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      }</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <span class="keywordflow">if</span> ((events &amp; (POLLHUP | POLLERR)) &amp;&amp; !closed) {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        toClose.push_back(<a class="code" href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a>);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        closed = <span class="keyword">true</span>;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      }</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    }</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <span class="comment">// Close the fds in reverse order so the indexes hold after erase()</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idx : boost::adaptors::reverse(toClose)) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="keyword">auto</span> pos = pipes_.begin() + idx;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      pos-&gt;pipe.close(); <span class="comment">// Throws on error</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      pipes_.erase(pos);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    }</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  }</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;}</div><div class="ttc" id="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_html_a7e98b8a17c0aad30ba64d47b74e2a6c1"><div class="ttname"><a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt.html#a7e98b8a17c0aad30ba64d47b74e2a6c1">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googletest_2test_2gtest__output__test__golden__lin_8txt_source.html#l00083">gtest_output_test_golden_lin.txt:83</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1105b24f5523c282910b4cecac6c7cca"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">folly::Subprocess::pipes_</a></div><div class="ttdeci">std::vector&lt; Pipe &gt; pipes_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00970">Subprocess.h:970</a></div></div>
<div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">folly::ProcessReturnCode::RUNNING</a></div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00135">Subprocess.h:135</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a6d10f614635d4508855b7318edcc0611"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a6d10f614635d4508855b7318edcc0611">folly::Subprocess::PIPE_IN</a></div><div class="ttdeci">static const int PIPE_IN</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00273">Subprocess.h:273</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_aca1747e2265c3da92641434b16c77f03"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">folly::Subprocess::returnCode_</a></div><div class="ttdeci">ProcessReturnCode returnCode_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00942">Subprocess.h:942</a></div></div>
<div class="ttc" id="namespacefolly_html_af6244d72aa4bdeb215d938ff5f56a6e5"><div class="ttname"><a href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">folly::checkUnixError</a></div><div class="ttdeci">void checkUnixError(ssize_t ret, Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00101">Exception.h:101</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1ec688cc2025bf3df3950144b2fe43ff"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1ec688cc2025bf3df3950144b2fe43ff">folly::Subprocess::setAllNonBlocking</a></div><div class="ttdeci">void setAllNonBlocking()</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00239">Subprocess.cpp:239</a></div></div>
<div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a9f4f16586f84d2b8b1b10d75a2d7697e"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a9f4f16586f84d2b8b1b10d75a2d7697e">folly::ProcessReturnCode::enforce</a></div><div class="ttdeci">void enforce(State state) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00090">Subprocess.cpp:90</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a6f2c79adb219ecd653be9a59560f26c1"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">folly::Subprocess::parentFd</a></div><div class="ttdeci">int parentFd(int childFd) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00869">Subprocess.h:869</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a47c806c1bc054d667def55fd8bbb4cbd"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a47c806c1bc054d667def55fd8bbb4cbd">folly::Subprocess::poll</a></div><div class="ttdeci">ProcessReturnCode poll(struct rusage *ru=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00618">Subprocess.cpp:618</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1b29ab71d11a0d2169b7e81fd590679e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; <a class="el" href="classfolly_1_1IOBufQueue.html">IOBufQueue</a>, <a class="el" href="classfolly_1_1IOBufQueue.html">IOBufQueue</a> &gt; folly::Subprocess::communicateIOBuf </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1IOBufQueue.html">IOBufQueue</a>&#160;</td>
          <td class="paramname"><em>input</em> = <code><a class="el" href="classfolly_1_1IOBufQueue.html">IOBufQueue</a>()</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Communicate with the child until all pipes to/from the child are closed.</p>
<p>The input buffer is written to the process' stdin pipe, and data is read from the stdout and stderr pipes. Non-blocking I/O is performed on all pipes simultaneously to avoid deadlocks.</p>
<p>The stdin pipe will be closed after the full input buffer has been written. An error will be thrown if a non-empty input buffer is supplied but stdin was not configured as a pipe.</p>
<p>Returns a pair of buffers containing the data read from stdout and stderr. If stdout or stderr is not a pipe, an empty <a class="el" href="classfolly_1_1IOBuf.html">IOBuf</a> queue will be returned for the respective buffer.</p>
<p>Note that <a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate()</a> and <a class="el" href="classfolly_1_1Subprocess.html#a1b29ab71d11a0d2169b7e81fd590679e">communicateIOBuf()</a> both return when all pipes to/from the child are closed; the child might stay alive after that, so you must still <a class="el" href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">wait()</a>.</p>
<p><a class="el" href="classfolly_1_1Subprocess.html#a1b29ab71d11a0d2169b7e81fd590679e">communicateIOBuf()</a> uses <a class="el" href="classfolly_1_1IOBufQueue.html">IOBufQueue</a> for buffering (which has the advantage that it won't try to allocate all data at once), but it does store the subprocess's entire output in memory before returning.</p>
<p><a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate()</a> uses strings for simplicity. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00763">763</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="IOBufQueue_8h_source.html#l00503">folly::IOBufQueue::empty()</a>, and <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>.</p>

<p>Referenced by <a class="el" href="SubprocessTest_8cpp_source.html#l00391">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                      {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="comment">// If the user supplied a non-empty input buffer, make sure</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="comment">// that stdin is a pipe so we can write the data.</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordflow">if</span> (!input.empty()) {</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="comment">// findByChildFd() will throw std::invalid_argument if no pipe for</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="comment">// STDIN_FILENO exists</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <a class="code" href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">findByChildFd</a>(STDIN_FILENO);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  std::pair&lt;IOBufQueue, IOBufQueue&gt; out;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keyword">auto</span> readCallback = [&amp;](<span class="keywordtype">int</span> pfd, <span class="keywordtype">int</span> cfd) -&gt; <span class="keywordtype">bool</span> {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">if</span> (cfd == STDOUT_FILENO) {</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      <span class="keywordflow">return</span> handleRead(pfd, out.first);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfd == STDERR_FILENO) {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="keywordflow">return</span> handleRead(pfd, out.second);</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="comment">// Don&#39;t close the file descriptor, the child might not like SIGPIPE,</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="comment">// just read and throw the data away.</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordflow">return</span> discardRead(pfd);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  };</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keyword">auto</span> writeCallback = [&amp;](<span class="keywordtype">int</span> pfd, <span class="keywordtype">int</span> cfd) -&gt; <span class="keywordtype">bool</span> {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">if</span> (cfd == STDIN_FILENO) {</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      <span class="keywordflow">return</span> handleWrite(pfd, input);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      <span class="comment">// If we don&#39;t want to write to this fd, just close it.</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    }</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  };</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate</a>(<a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(readCallback), <a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(writeCallback));</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordflow">return</span> out;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_a39d1489b545f03262b00046ba8ab42ee"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">folly::Subprocess::findByChildFd</a></div><div class="ttdeci">size_t findByChildFd(const int childFd) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00889">Subprocess.cpp:889</a></div></div>
<div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a28a252e66fe53d1a86016d46f8b417ed"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">folly::Subprocess::communicate</a></div><div class="ttdeci">std::pair&lt; std::string, std::string &gt; communicate(StringPiece input=StringPiece())</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00740">Subprocess.cpp:740</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acf3a44001b0a204f5ea9706bd3604525"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::Subprocess::enableNotifications </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>childFd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>enabled</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p><a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate()</a> callbacks can use this to temporarily enable/disable notifications (callbacks) for a pipe to/from the child. By default, all are enabled. Useful for "chatty" communication &ndash; you want to disable write callbacks until you receive the expected message.</p>
<p>Disabling a pipe does not free you from the requirement to consume all incoming data. Failing to do so will easily create deadlock bugs.</p>
<p>Throws if the childFd is not known. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00881">881</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>Referenced by <a class="el" href="SubprocessTest_8cpp_source.html#l00491">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                                                              {</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>[<a class="code" href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">findByChildFd</a>(childFd)].enabled = enabled;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_a39d1489b545f03262b00046ba8ab42ee"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">folly::Subprocess::findByChildFd</a></div><div class="ttdeci">size_t findByChildFd(const int childFd) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00889">Subprocess.cpp:889</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1105b24f5523c282910b4cecac6c7cca"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">folly::Subprocess::pipes_</a></div><div class="ttdeci">std::vector&lt; Pipe &gt; pipes_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00970">Subprocess.h:970</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a39d1489b545f03262b00046ba8ab42ee"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t folly::Subprocess::findByChildFd </td>
          <td>(</td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>childFd</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00889">889</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="composition__2_8cpp_source.html#l00074">pipe()</a>.</p>
<div class="fragment"><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                                  {</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="keyword">auto</span> pos = std::lower_bound(</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.begin(), <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.end(), childFd, [](<span class="keyword">const</span> Pipe&amp; <a class="code" href="composition__2_8cpp.html#a352f0fb3a18b03b24f090615f02c8b40">pipe</a>, <span class="keywordtype">int</span> fd) {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordflow">return</span> pipe.childFd &lt; fd;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      });</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordflow">if</span> (pos == <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.end() || pos-&gt;childFd != childFd) {</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">throw</span> std::invalid_argument(</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        folly::to&lt;std::string&gt;(<span class="stringliteral">&quot;child fd not found &quot;</span>, childFd));</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  <span class="keywordflow">return</span> pos - <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.begin();</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_a1105b24f5523c282910b4cecac6c7cca"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">folly::Subprocess::pipes_</a></div><div class="ttdeci">std::vector&lt; Pipe &gt; pipes_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00970">Subprocess.h:970</a></div></div>
<div class="ttc" id="composition__2_8cpp_html_a352f0fb3a18b03b24f090615f02c8b40"><div class="ttname"><a href="composition__2_8cpp.html#a352f0fb3a18b03b24f090615f02c8b40">pipe</a></div><div class="ttdeci">void pipe(CPUExecutor cpu, IOExecutor io)</div><div class="ttdef"><b>Definition:</b> <a href="composition__2_8cpp_source.html#l00074">composition_2.cpp:74</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a80ce26ad11196252de015cadfae66510"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::Subprocess::kill </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00611">611</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;              {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <a class="code" href="classfolly_1_1Subprocess.html#a87c3f4502dfd923e235592e3249ae382">sendSignal</a>(SIGKILL);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  }</div><div class="ttc" id="classfolly_1_1Subprocess_html_a87c3f4502dfd923e235592e3249ae382"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a87c3f4502dfd923e235592e3249ae382">folly::Subprocess::sendSignal</a></div><div class="ttdeci">void sendSignal(int signal)</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00668">Subprocess.cpp:668</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a13a6e92aa089ed83e27a7d98ab36eb25"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::Subprocess::notificationsEnabled </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>childFd</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Are notifications for one pipe to/from child enabled? Throws if the childFd is not known. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00885">885</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                                                       {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>[<a class="code" href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">findByChildFd</a>(childFd)].enabled;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_a39d1489b545f03262b00046ba8ab42ee"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">folly::Subprocess::findByChildFd</a></div><div class="ttdeci">size_t findByChildFd(const int childFd) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00889">Subprocess.cpp:889</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1105b24f5523c282910b4cecac6c7cca"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">folly::Subprocess::pipes_</a></div><div class="ttdeci">std::vector&lt; Pipe &gt; pipes_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00970">Subprocess.h:970</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aab3d3eafaad023d6d149a7f32f183c20"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a>&amp; folly::Subprocess::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> &amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab69f93dfbfe9af840ca0a34317bd5298"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a>&amp; folly::Subprocess::operator= </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> &amp;&amp;&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a6f2c79adb219ecd653be9a59560f26c1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int folly::Subprocess::parentFd </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>childFd</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Get parent file descriptor corresponding to the given file descriptor in the child. Throws if childFd isn't a pipe (PIPE_IN / PIPE_OUT). Do not <a class="el" href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">close()</a> the returned file descriptor; use closeParentFd, above. </p>

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00869">869</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                                  {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>[<a class="code" href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">findByChildFd</a>(childFd)].pipe.fd();</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  }</div><div class="ttc" id="classfolly_1_1Subprocess_html_a39d1489b545f03262b00046ba8ab42ee"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a39d1489b545f03262b00046ba8ab42ee">folly::Subprocess::findByChildFd</a></div><div class="ttdeci">size_t findByChildFd(const int childFd) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00889">Subprocess.cpp:889</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1105b24f5523c282910b4cecac6c7cca"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">folly::Subprocess::pipes_</a></div><div class="ttdeci">std::vector&lt; Pipe &gt; pipes_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00970">Subprocess.h:970</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5059c9911c06b01cd4867f672c08292a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pid_t folly::Subprocess::pid </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return the child's pid, or -1 if the child wasn't successfully spawned or has already been <a class="el" href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">wait()</a>ed upon. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00674">674</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="OptionalTest_8cpp_source.html#l00053">b</a>, <a class="el" href="folly_2folly_2Exception_8h_source.html#l00101">folly::checkUnixError()</a>, <a class="el" href="IOBufQueue_8h_source.html#l00476">folly::IOBufQueue::front()</a>, <a class="el" href="Cursor_8h_source.html#l00436">folly::io::detail::CursorBase&lt; Derived, BufType &gt;::peekBytes()</a>, <a class="el" href="IOBufQueue_8h_source.html#l00380">folly::IOBufQueue::postallocate()</a>, <a class="el" href="IOBufQueue_8h_source.html#l00356">folly::IOBufQueue::preallocate()</a>, <a class="el" href="FileUtil_8cpp_source.html#l00102">folly::readNoInt()</a>, <a class="el" href="IOBufQueue_8cpp_source.html#l00255">folly::IOBufQueue::trimStart()</a>, and <a class="el" href="FileUtil_8cpp_source.html#l00114">folly::writeNoInt()</a>.</p>
<div class="fragment"><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                            {</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a>;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_ad259adb8e0a99987161b63ac7fea4e81"><div class="ttname"><a href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">folly::Subprocess::pid_</a></div><div class="ttdeci">pid_t pid_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00941">Subprocess.h:941</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a47c806c1bc054d667def55fd8bbb4cbd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1ProcessReturnCode.html">ProcessReturnCode</a> folly::Subprocess::poll </td>
          <td>(</td>
          <td class="paramtype">struct rusage *&#160;</td>
          <td class="paramname"><em>ru</em> = <code><a class="el" href="http__parser__cpp_8cpp.html#ab979d9d4b4923f7c54d6caa6e1a61936">nullptr</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Poll the child's status and return it. Return the exit status if the subprocess had quit, or RUNNING otherwise. Throws an std::logic_error if called on a <a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> whose status is no longer RUNNING. No other exceptions are possible. Aborts on egregious violations of contract, e.g. if you wait for the underlying process without going through this <a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> instance. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00618">618</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="Subprocess_8cpp_source.html#l00090">folly::ProcessReturnCode::enforce()</a>, <a class="el" href="Subprocess_8cpp_source.html#l00054">folly::ProcessReturnCode::make()</a>, and <a class="el" href="Subprocess_8h_source.html#l00135">folly::ProcessReturnCode::RUNNING</a>.</p>

<p>Referenced by <a class="el" href="SubprocessTestParentDeathHelper_8cpp_source.html#l00062">runParent()</a>.</p>
<div class="fragment"><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                                                    {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a>.<a class="code" href="classfolly_1_1ProcessReturnCode.html#a9f4f16586f84d2b8b1b10d75a2d7697e">enforce</a>(<a class="code" href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">ProcessReturnCode::RUNNING</a>);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  DCHECK_GT(<a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a>, 0);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <span class="keywordtype">int</span> status;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  pid_t found = ::wait4(<a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a>, &amp;status, WNOHANG, ru);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <span class="comment">// The spec guarantees that EINTR does not occur with WNOHANG, so the only</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <span class="comment">// two remaining errors are ECHILD (other code reaped the child?), or</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <span class="comment">// EINVAL (cosmic rays?), both of which merit an abort:</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  PCHECK(found != -1) &lt;&lt; <span class="stringliteral">&quot;waitpid(&quot;</span> &lt;&lt; <a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a> &lt;&lt; <span class="stringliteral">&quot;, &amp;status, WNOHANG)&quot;</span>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="keywordflow">if</span> (found != 0) {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="comment">// Though the child process had quit, this call does not close the pipes</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">// since its descendants may still be using them.</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a> = <a class="code" href="classfolly_1_1ProcessReturnCode.html#a196cb468ef450009776fdd846a9d66fd">ProcessReturnCode::make</a>(status);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a> = -1;</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  }</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a>;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;}</div><div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a196cb468ef450009776fdd846a9d66fd"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a196cb468ef450009776fdd846a9d66fd">folly::ProcessReturnCode::make</a></div><div class="ttdeci">static ProcessReturnCode make(int status)</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00054">Subprocess.cpp:54</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_ad259adb8e0a99987161b63ac7fea4e81"><div class="ttname"><a href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">folly::Subprocess::pid_</a></div><div class="ttdeci">pid_t pid_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00941">Subprocess.h:941</a></div></div>
<div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">folly::ProcessReturnCode::RUNNING</a></div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00135">Subprocess.h:135</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_aca1747e2265c3da92641434b16c77f03"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">folly::Subprocess::returnCode_</a></div><div class="ttdeci">ProcessReturnCode returnCode_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00942">Subprocess.h:942</a></div></div>
<div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a9f4f16586f84d2b8b1b10d75a2d7697e"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a9f4f16586f84d2b8b1b10d75a2d7697e">folly::ProcessReturnCode::enforce</a></div><div class="ttdeci">void enforce(State state) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00090">Subprocess.cpp:90</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad81a528d05c10731cb92ab0fddc1f168"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool folly::Subprocess::pollChecked </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Poll the child's status. If the process is still running, return false. Otherwise, return true if the process exited with status 0 (success), or throw <a class="el" href="classfolly_1_1CalledProcessError.html">CalledProcessError</a> if the process exited with a non-zero status. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00636">636</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="NetOps_8cpp_source.html#l00141">folly::netops::poll()</a>, and <a class="el" href="Subprocess_8h_source.html#l00135">folly::ProcessReturnCode::RUNNING</a>.</p>
<div class="fragment"><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                             {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classfolly_1_1Subprocess.html#a47c806c1bc054d667def55fd8bbb4cbd">poll</a>().<a class="code" href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a>() == <a class="code" href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">ProcessReturnCode::RUNNING</a>) {</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  checkStatus(<a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a>);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;}</div><div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">folly::ProcessReturnCode::RUNNING</a></div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00135">Subprocess.h:135</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_aca1747e2265c3da92641434b16c77f03"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">folly::Subprocess::returnCode_</a></div><div class="ttdeci">ProcessReturnCode returnCode_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00942">Subprocess.h:942</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a47c806c1bc054d667def55fd8bbb4cbd"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a47c806c1bc054d667def55fd8bbb4cbd">folly::Subprocess::poll</a></div><div class="ttdeci">ProcessReturnCode poll(struct rusage *ru=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00618">Subprocess.cpp:618</a></div></div>
<div class="ttc" id="http__parser_8c_html_adc6e5733fc3c22f0a7b2914188c49c90"><div class="ttname"><a href="http__parser_8c.html#adc6e5733fc3c22f0a7b2914188c49c90">state</a></div><div class="ttdeci">state</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8c_source.html#l00272">http_parser.c:272</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a55f5e898eb4d21d9795ca2d0a890b6de"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Portability_8h.html#a4a2f173e1bec794aa19364144948180d">FOLLY_POP_WARNING</a> int folly::Subprocess::prepareChild </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const sigset_t *&#160;</td>
          <td class="paramname"><em>sigmask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>childDir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00495">495</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="NetOps_8cpp_source.html#l00090">folly::netops::close()</a>, <a class="el" href="Subprocess_8h_source.html#l00489">folly::Subprocess::Options::closeOtherFds_</a>, <a class="el" href="Subprocess_8h_source.html#l00497">folly::Subprocess::Options::dangerousPostForkPreExecCallback_</a>, <a class="el" href="error_8h_source.html#l00048">folly::pushmi::operators::error()</a>, <a class="el" href="Subprocess_8h_source.html#l00488">folly::Subprocess::Options::fdActions_</a>, <a class="el" href="Subprocess_8h_source.html#l00491">folly::Subprocess::Options::processGroupLeader_</a>, and <a class="el" href="Poly_8h_source.html#l01165">folly::sig</a>.</p>
<div class="fragment"><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                                {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="comment">// While all signals are blocked, we must reset their</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="comment">// dispositions to default.</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacefolly.html#a846f42e996d3c9b0252f6cc3907bc08f">sig</a> = 1; <a class="code" href="namespacefolly.html#a846f42e996d3c9b0252f6cc3907bc08f">sig</a> &lt; NSIG; ++<a class="code" href="namespacefolly.html#a846f42e996d3c9b0252f6cc3907bc08f">sig</a>) {</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    ::signal(<a class="code" href="namespacefolly.html#a846f42e996d3c9b0252f6cc3907bc08f">sig</a>, SIG_DFL);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="comment">// Unblock signals; restore signal mask.</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordtype">int</span> r = pthread_sigmask(SIG_SETMASK, sigmask, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">if</span> (r != 0) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="keywordflow">return</span> r; <span class="comment">// pthread_sigmask() returns an errno value</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <span class="comment">// Change the working directory, if one is given</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keywordflow">if</span> (childDir) {</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">if</span> (::chdir(childDir) == -1) {</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">return</span> errno;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    }</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  <span class="comment">// We don&#39;t have to explicitly close the parent&#39;s end of all pipes,</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;  <span class="comment">// as they all have the FD_CLOEXEC flag set and will be closed at</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="comment">// exec time.</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="comment">// Close all fds that we&#39;re supposed to close.</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; p : options.fdActions_) {</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">if</span> (p.second == <a class="code" href="classfolly_1_1Subprocess.html#a85bd2d9070a17d31725b2c56f6e74055">CLOSE</a>) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="keywordflow">if</span> (::<a class="code" href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">close</a>(p.first) == -1) {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordflow">return</span> errno;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      }</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p.second != p.first) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="keywordflow">if</span> (::dup2(p.second, p.first) == -1) {</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <span class="keywordflow">return</span> errno;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;      }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;  }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  <span class="comment">// If requested, close all other file descriptors.  Don&#39;t close</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="comment">// any fds in options.fdActions_, and don&#39;t touch stdin, stdout, stderr.</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="comment">// Ignore errors.</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keywordflow">if</span> (options.closeOtherFds_) {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> fd = getdtablesize() - 1; fd &gt;= 3; --fd) {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="keywordflow">if</span> (options.fdActions_.count(fd) == 0) {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <a class="code" href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">::close</a>(fd);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      }</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="preprocessor">#if __linux__</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="comment">// Opt to receive signal on parent death, if requested</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keywordflow">if</span> (options.parentDeathSignal_ != 0) {</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> parentDeathSignal =</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(options.parentDeathSignal_);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span> (prctl(PR_SET_PDEATHSIG, parentDeathSignal, 0, 0, 0) == -1) {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">return</span> errno;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  <span class="keywordflow">if</span> (options.processGroupLeader_) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">if</span> (setpgrp() == -1) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">return</span> errno;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">// The user callback comes last, so that the child is otherwise all set up.</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keywordflow">if</span> (options.dangerousPostForkPreExecCallback_) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">if</span> (<span class="keywordtype">int</span> <a class="code" href="namespacefolly_1_1pushmi_1_1operators.html#ac0115beba807afb09cef1eedb85cd89e">error</a> = (*options.dangerousPostForkPreExecCallback_)()) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacefolly_1_1pushmi_1_1operators.html#ac0115beba807afb09cef1eedb85cd89e">error</a>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    }</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  }</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1pushmi_1_1operators_html_ac0115beba807afb09cef1eedb85cd89e"><div class="ttname"><a href="namespacefolly_1_1pushmi_1_1operators.html#ac0115beba807afb09cef1eedb85cd89e">folly::pushmi::operators::error</a></div><div class="ttdeci">requires And&lt; SemiMovable&lt; VN &gt;... &gt; &amp;&amp;SemiMovable&lt; E &gt; auto error(E e)</div><div class="ttdef"><b>Definition:</b> <a href="error_8h_source.html#l00048">error.h:48</a></div></div>
<div class="ttc" id="namespacefolly_html_a846f42e996d3c9b0252f6cc3907bc08f"><div class="ttname"><a href="namespacefolly.html#a846f42e996d3c9b0252f6cc3907bc08f">folly::sig</a></div><div class="ttdeci">constexpr detail::Sig&lt; Sig &gt; const sig</div><div class="ttdef"><b>Definition:</b> <a href="Poly_8h_source.html#l01165">Poly.h:1165</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a85bd2d9070a17d31725b2c56f6e74055"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a85bd2d9070a17d31725b2c56f6e74055">folly::Subprocess::CLOSE</a></div><div class="ttdeci">static const int CLOSE</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00271">Subprocess.h:271</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a27d9201e6386937ffded3bfd86f995aa"><div class="ttname"><a href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">folly::netops::close</a></div><div class="ttdeci">int close(NetworkSocket s)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00090">NetOps.cpp:90</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9a36d7cbc257412f87a435bd5422bbc3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::Subprocess::readChildErrorPipe </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pfd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>executable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Read from the error pipe, and throw <a class="el" href="classfolly_1_1SubprocessSpawnError.html">SubprocessSpawnError</a> if the child failed before calling exec(). </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00589">589</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="deadlock_8py_source.html#l00447">deadlock::info()</a>, <a class="el" href="FileUtil_8cpp_source.html#l00102">folly::readNoInt()</a>, <a class="el" href="Subprocess_8cpp_source.html#l00142">folly::SubprocessSpawnError::SubprocessSpawnError()</a>, and <a class="el" href="DistributedMutex-inl_8h_source.html#l00429">folly::detail::distributed_mutex::wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                                                                   {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  ChildErrorInfo <a class="code" href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">info</a>;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="keyword">auto</span> rc = <a class="code" href="namespacefolly.html#a77ddd583d220e05a3d7218109b6409e1">readNoInt</a>(pfd, &amp;info, <span class="keyword">sizeof</span>(info));</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordflow">if</span> (rc == 0) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="comment">// No data means the child executed successfully, and the pipe</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">// was closed due to the close-on-exec flag being set.</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != <span class="keyword">sizeof</span>(ChildErrorInfo)) {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">// An error occurred trying to read from the pipe, or we got a partial read.</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">// Neither of these cases should really occur in practice.</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="comment">// We can&#39;t get any error data from the child in this case, and we don&#39;t</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">// know if it is successfully running or not.  All we can do is to return</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">// normally, as if the child executed successfully.  If something bad</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">// happened the caller should at least get a non-normal exit status from</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">// the child.</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    LOG(ERROR) &lt;&lt; <span class="stringliteral">&quot;unexpected error trying to read from child error pipe &quot;</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;               &lt;&lt; <span class="stringliteral">&quot;rc=&quot;</span> &lt;&lt; rc &lt;&lt; <span class="stringliteral">&quot;, errno=&quot;</span> &lt;&lt; errno;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  }</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  <span class="comment">// We got error data from the child.  The child should exit immediately in</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="comment">// this case, so wait on it to clean up.</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">wait</a>();</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;  <span class="comment">// Throw to signal the error</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  <span class="keywordflow">throw</span> SubprocessSpawnError(executable, info.errCode, info.errnoValue);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;}</div><div class="ttc" id="namespacedeadlock_html_a6cba8e3d51735d7ac2ac91a947f4984b"><div class="ttname"><a href="namespacedeadlock.html#a6cba8e3d51735d7ac2ac91a947f4984b">deadlock.info</a></div><div class="ttdeci">def info()</div><div class="ttdef"><b>Definition:</b> <a href="deadlock_8py_source.html#l00447">deadlock.py:447</a></div></div>
<div class="ttc" id="namespacefolly_html_a77ddd583d220e05a3d7218109b6409e1"><div class="ttname"><a href="namespacefolly.html#a77ddd583d220e05a3d7218109b6409e1">folly::readNoInt</a></div><div class="ttdeci">ssize_t readNoInt(int fd, void *buf, size_t count)</div><div class="ttdef"><b>Definition:</b> <a href="FileUtil_8cpp_source.html#l00102">FileUtil.cpp:102</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_aca2924e7e672dee645ddb7634efa5bd2"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">folly::Subprocess::wait</a></div><div class="ttdeci">ProcessReturnCode wait()</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00644">Subprocess.cpp:644</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac6b701fb39b6f0fa89481d6c6144ac77"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class Callback &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static auto folly::Subprocess::readLinesCallback </td>
          <td>(</td>
          <td class="paramtype">Callback &amp;&amp;&#160;</td>
          <td class="paramname"><em>fdLineCb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a>&#160;</td>
          <td class="paramname"><em>maxLineLength</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>delimiter</em> = <code>'\n'</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ConstexprMathBenchmark_8cpp.html#a5dc34568a989dd90728a4ed499cd9fab">uint64_t</a>&#160;</td>
          <td class="paramname"><em>bufSize</em> = <code>1024</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> -&gt; <a class="el" href="classfolly_1_1Subprocess_1_1ReadLinesCallback.html">ReadLinesCallback</a>&lt;typename std::decay&lt;Callback&gt;::<a class="el" href="ClientProtocol_8cpp.html#afb6f25e8ca4d7adb175ad413430bbb90">type</a>&gt; </td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00816">816</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                                                            {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ClientProtocol_8cpp.html#afb6f25e8ca4d7adb175ad413430bbb90">ReadLinesCallback&lt;typename std::decay&lt;Callback&gt;::type</a>&gt;(</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        std::forward&lt;Callback&gt;(fdLineCb), maxLineLength, delimiter, bufSize);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  }</div><div class="ttc" id="ClientProtocol_8cpp_html_afb6f25e8ca4d7adb175ad413430bbb90"><div class="ttname"><a href="ClientProtocol_8cpp.html#afb6f25e8ca4d7adb175ad413430bbb90">type</a></div><div class="ttdeci">PskType type</div><div class="ttdef"><b>Definition:</b> <a href="ClientProtocol_8cpp_source.html#l00777">ClientProtocol.cpp:777</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a47cd912367e2a179756a8abf79c15bac"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1ProcessReturnCode.html">ProcessReturnCode</a> folly::Subprocess::returnCode </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the child's status (as per <a class="el" href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">wait()</a>) if the process has already been waited on, -1 if the process is still running, or -2 if the process hasn't been successfully started. NOTE that this does not call waitpid() or <a class="el" href="classfolly_1_1Subprocess.html#a47c806c1bc054d667def55fd8bbb4cbd">Subprocess::poll()</a>, but simply returns the status stored in the <a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> object. </p>

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00569">569</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>

<p>References <a class="el" href="NetOps_8cpp_source.html#l00141">folly::netops::poll()</a>, and <a class="el" href="DistributedMutex-inl_8h_source.html#l00429">folly::detail::distributed_mutex::wait()</a>.</p>

<p>Referenced by <a class="el" href="SubprocessTest_8cpp_source.html#l00100">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                                       {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a>;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  }</div><div class="ttc" id="classfolly_1_1Subprocess_html_aca1747e2265c3da92641434b16c77f03"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">folly::Subprocess::returnCode_</a></div><div class="ttdeci">ProcessReturnCode returnCode_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00942">Subprocess.h:942</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abf78334bf1b8a878159210b338283535"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int folly::Subprocess::runChild </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>executable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00575">575</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="Subprocess_8h_source.html#l00490">folly::Subprocess::Options::usePath_</a>.</p>
<div class="fragment"><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                                  {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="comment">// Now, finally, exec.</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordflow">if</span> (options.usePath_) {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    ::execvp(executable, <a class="code" href="SmallLocksBenchmark_8cpp.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    ::execve(executable, <a class="code" href="SmallLocksBenchmark_8cpp.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>, env);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="keywordflow">return</span> errno;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div><div class="ttc" id="SmallLocksBenchmark_8cpp_html_af2efa898e9eed6fe6715279cb1ec35b0"><div class="ttname"><a href="SmallLocksBenchmark_8cpp.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a></div><div class="ttdeci">char ** argv</div><div class="ttdef"><b>Definition:</b> <a href="SmallLocksBenchmark_8cpp_source.html#l00430">SmallLocksBenchmark.cpp:430</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a87c3f4502dfd923e235592e3249ae382"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::Subprocess::sendSignal </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>signal</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Send a signal to the child. Shortcuts for the commonly used Unix signals are below. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00668">668</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="folly_2folly_2Exception_8h_source.html#l00101">folly::checkUnixError()</a>, and <a class="el" href="Subprocess_8h_source.html#l00135">folly::ProcessReturnCode::RUNNING</a>.</p>
<div class="fragment"><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                                      {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a>.<a class="code" href="classfolly_1_1ProcessReturnCode.html#a9f4f16586f84d2b8b1b10d75a2d7697e">enforce</a>(<a class="code" href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">ProcessReturnCode::RUNNING</a>);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="keywordtype">int</span> r = <a class="code" href="classfolly_1_1Subprocess.html#a80ce26ad11196252de015cadfae66510">::kill</a>(<a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a>, signal);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(r, <span class="stringliteral">&quot;kill&quot;</span>);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_a80ce26ad11196252de015cadfae66510"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a80ce26ad11196252de015cadfae66510">folly::Subprocess::kill</a></div><div class="ttdeci">void kill()</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00611">Subprocess.h:611</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_ad259adb8e0a99987161b63ac7fea4e81"><div class="ttname"><a href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">folly::Subprocess::pid_</a></div><div class="ttdeci">pid_t pid_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00941">Subprocess.h:941</a></div></div>
<div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">folly::ProcessReturnCode::RUNNING</a></div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00135">Subprocess.h:135</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_aca1747e2265c3da92641434b16c77f03"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">folly::Subprocess::returnCode_</a></div><div class="ttdeci">ProcessReturnCode returnCode_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00942">Subprocess.h:942</a></div></div>
<div class="ttc" id="namespacefolly_html_af6244d72aa4bdeb215d938ff5f56a6e5"><div class="ttname"><a href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">folly::checkUnixError</a></div><div class="ttdeci">void checkUnixError(ssize_t ret, Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00101">Exception.h:101</a></div></div>
<div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a9f4f16586f84d2b8b1b10d75a2d7697e"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a9f4f16586f84d2b8b1b10d75a2d7697e">folly::ProcessReturnCode::enforce</a></div><div class="ttdeci">void enforce(State state) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00090">Subprocess.cpp:90</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1ec688cc2025bf3df3950144b2fe43ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::Subprocess::setAllNonBlocking </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set all pipes from / to child to be non-blocking. <a class="el" href="classfolly_1_1Subprocess.html#a28a252e66fe53d1a86016d46f8b417ed">communicate()</a> does this for you. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00239">239</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="folly_2folly_2Exception_8h_source.html#l00101">folly::checkUnixError()</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                   {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; p : <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordtype">int</span> fd = p.pipe.fd();</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a> = ::fcntl(fd, F_GETFL);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(flags, <span class="stringliteral">&quot;fcntl&quot;</span>);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordtype">int</span> r = ::fcntl(fd, F_SETFL, flags | O_NONBLOCK);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(r, <span class="stringliteral">&quot;fcntl&quot;</span>);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div><div class="ttc" id="http__parser_8h_html_ab6b306ef981f5e21bb41ea2c2dbe8cd9"><div class="ttname"><a href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a></div><div class="ttdeci">flags</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8h_source.html#l00127">http_parser.h:127</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1105b24f5523c282910b4cecac6c7cca"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">folly::Subprocess::pipes_</a></div><div class="ttdeci">std::vector&lt; Pipe &gt; pipes_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00970">Subprocess.h:970</a></div></div>
<div class="ttc" id="namespacefolly_html_af6244d72aa4bdeb215d938ff5f56a6e5"><div class="ttname"><a href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">folly::checkUnixError</a></div><div class="ttdeci">void checkUnixError(ssize_t ret, Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00101">Exception.h:101</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a69b7492efbeaf1fb9c264a38f1127421"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::Subprocess::spawn </td>
          <td>(</td>
          <td class="paramtype">std::unique_ptr&lt; const char *[]&gt;&#160;</td>
          <td class="paramname"><em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>executable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; *&#160;</td>
          <td class="paramname"><em>env</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00249">249</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="SmallLocksBenchmark_8cpp_source.html#l00430">argv</a>, <a class="el" href="folly_2folly_2Exception_8h_source.html#l00101">folly::checkUnixError()</a>, <a class="el" href="NetOps_8cpp_source.html#l00090">folly::netops::close()</a>, <a class="el" href="Subprocess_8h_source.html#l00492">folly::Subprocess::Options::detach_</a>, <a class="el" href="Portability_8h_source.html#l00181">FOLLY_GCC_DISABLE_WARNING</a>, <a class="el" href="Portability_8h_source.html#l00178">FOLLY_PUSH_WARNING</a>, <a class="el" href="ScopeGuard_8h_source.html#l00184">folly::makeGuard()</a>, <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>, <a class="el" href="composition__2_8cpp_source.html#l00074">pipe()</a>, <a class="el" href="ScopeGuard_8h_source.html#l00274">SCOPE_EXIT</a>, <a class="el" href="Subprocess_8h_source.html#l00490">folly::Subprocess::Options::usePath_</a>, and <a class="el" href="DistributedMutex-inl_8h_source.html#l00429">folly::detail::distributed_mutex::wait()</a>.</p>
<div class="fragment"><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                     {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">if</span> (optionsIn.usePath_ &amp;&amp; env) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">throw</span> std::invalid_argument(</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="stringliteral">&quot;usePath() not allowed when overriding environment&quot;</span>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="comment">// Make a copy, we&#39;ll mutate options</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  Options options(optionsIn);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="comment">// On error, close all pipes_ (ignoring errors, but that seems fine here).</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keyword">auto</span> pipesGuard = <a class="code" href="namespacefolly.html#a507704cb8cb20963bc6ef5a2f871ab2a">makeGuard</a>([<span class="keyword">this</span>] { <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.clear(); });</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  <span class="comment">// Create a pipe to use to receive error information from the child,</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  <span class="comment">// in case it fails before calling exec()</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordtype">int</span> errFds[2];</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="preprocessor">#if FOLLY_HAVE_PIPE2</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(::pipe2(errFds, O_CLOEXEC), <span class="stringliteral">&quot;pipe2&quot;</span>);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(::<a class="code" href="composition__2_8cpp.html#a352f0fb3a18b03b24f090615f02c8b40">pipe</a>(errFds), <span class="stringliteral">&quot;pipe&quot;</span>);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <a class="code" href="ScopeGuard_8h.html#a175c354c3e38222bc00ce5df5e6d431d">SCOPE_EXIT</a> {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    CHECK_ERR(::<a class="code" href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">close</a>(errFds[0]));</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">if</span> (errFds[1] &gt;= 0) {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      CHECK_ERR(::<a class="code" href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">close</a>(errFds[1]));</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  };</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="preprocessor">#if !FOLLY_HAVE_PIPE2</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="comment">// Ask the child to close the read end of the error pipe.</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(fcntl(errFds[0], F_SETFD, FD_CLOEXEC), <span class="stringliteral">&quot;set FD_CLOEXEC&quot;</span>);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">// Set the close-on-exec flag on the write side of the pipe.</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">// This way the pipe will be closed automatically in the child if execve()</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// succeeds.  If the exec fails the child can write error information to the</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="comment">// pipe.</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(fcntl(errFds[1], F_SETFD, FD_CLOEXEC), <span class="stringliteral">&quot;set FD_CLOEXEC&quot;</span>);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">// Perform the actual work of setting up pipes then forking and</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">// executing the child.</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#a998b022d0dc22d80f12924e09f1be16b">spawnInternal</a>(<a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(argv), executable, options, env, errFds[1]);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">// After spawnInternal() returns the child is alive.  We have to be very</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">// careful about throwing after this point.  We are inside the constructor,</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">// so if we throw the Subprocess object will have never existed, and the</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">// destructor will never be called.</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="comment">// We should only throw if we got an error via the errFd, and we know the</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="comment">// child has exited and can be immediately waited for.  In all other cases,</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="comment">// we have no way of cleaning up the child.</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="comment">// Close writable side of the errFd pipe in the parent process</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  CHECK_ERR(::<a class="code" href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">close</a>(errFds[1]));</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  errFds[1] = -1;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="comment">// Read from the errFd pipe, to tell if the child ran into any errors before</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="comment">// calling exec()</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#a9a36d7cbc257412f87a435bd5422bbc3">readChildErrorPipe</a>(errFds[0], executable);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">// If we spawned a detached child, wait on the intermediate child process.</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="comment">// It always exits immediately.</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">if</span> (options.detach_) {</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <a class="code" href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">wait</a>();</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  }</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  <span class="comment">// We have fully succeeded now, so release the guard on pipes_</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  pipesGuard.dismiss();</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_a9a36d7cbc257412f87a435bd5422bbc3"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a9a36d7cbc257412f87a435bd5422bbc3">folly::Subprocess::readChildErrorPipe</a></div><div class="ttdeci">void readChildErrorPipe(int pfd, const char *executable)</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00589">Subprocess.cpp:589</a></div></div>
<div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="ScopeGuard_8h_html_a175c354c3e38222bc00ce5df5e6d431d"><div class="ttname"><a href="ScopeGuard_8h.html#a175c354c3e38222bc00ce5df5e6d431d">SCOPE_EXIT</a></div><div class="ttdeci">#define SCOPE_EXIT</div><div class="ttdef"><b>Definition:</b> <a href="ScopeGuard_8h_source.html#l00274">ScopeGuard.h:274</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1105b24f5523c282910b4cecac6c7cca"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">folly::Subprocess::pipes_</a></div><div class="ttdeci">std::vector&lt; Pipe &gt; pipes_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00970">Subprocess.h:970</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a998b022d0dc22d80f12924e09f1be16b"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a998b022d0dc22d80f12924e09f1be16b">folly::Subprocess::spawnInternal</a></div><div class="ttdeci">void spawnInternal(std::unique_ptr&lt; const char *[]&gt; argv, const char *executable, Options &amp;options, const std::vector&lt; std::string &gt; *env, int errFd)</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00327">Subprocess.cpp:327</a></div></div>
<div class="ttc" id="namespacefolly_html_af6244d72aa4bdeb215d938ff5f56a6e5"><div class="ttname"><a href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">folly::checkUnixError</a></div><div class="ttdeci">void checkUnixError(ssize_t ret, Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00101">Exception.h:101</a></div></div>
<div class="ttc" id="namespacefolly_html_a507704cb8cb20963bc6ef5a2f871ab2a"><div class="ttname"><a href="namespacefolly.html#a507704cb8cb20963bc6ef5a2f871ab2a">folly::makeGuard</a></div><div class="ttdeci">FOLLY_NODISCARD detail::ScopeGuardImplDecay&lt; F, true &gt; makeGuard(F &amp;&amp;f) noexcept(noexcept(detail::ScopeGuardImplDecay&lt; F, true &gt;(static_cast&lt; F &amp;&amp; &gt;(f))))</div><div class="ttdef"><b>Definition:</b> <a href="ScopeGuard_8h_source.html#l00184">ScopeGuard.h:184</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_aca2924e7e672dee645ddb7634efa5bd2"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">folly::Subprocess::wait</a></div><div class="ttdeci">ProcessReturnCode wait()</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00644">Subprocess.cpp:644</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a27d9201e6386937ffded3bfd86f995aa"><div class="ttname"><a href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">folly::netops::close</a></div><div class="ttdeci">int close(NetworkSocket s)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00090">NetOps.cpp:90</a></div></div>
<div class="ttc" id="composition__2_8cpp_html_a352f0fb3a18b03b24f090615f02c8b40"><div class="ttname"><a href="composition__2_8cpp.html#a352f0fb3a18b03b24f090615f02c8b40">pipe</a></div><div class="ttdeci">void pipe(CPUExecutor cpu, IOExecutor io)</div><div class="ttdef"><b>Definition:</b> <a href="composition__2_8cpp_source.html#l00074">composition_2.cpp:74</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a998b022d0dc22d80f12924e09f1be16b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Portability_8h.html#a7f4463769c98ffb786751dd9946773df">FOLLY_PUSH_WARNING</a> void folly::Subprocess::spawnInternal </td>
          <td>(</td>
          <td class="paramtype">std::unique_ptr&lt; const char *[]&gt;&#160;</td>
          <td class="paramname"><em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>executable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classfolly_1_1Subprocess_1_1Options.html">Options</a> &amp;&#160;</td>
          <td class="paramname"><em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="Conv_8cpp.html#ae1adbce218e7a9d09164012443191d24">std::string</a> &gt; *&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>errFd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00327">327</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="folly_2folly_2Exception_8h_source.html#l00083">folly::checkPosixError()</a>, <a class="el" href="folly_2folly_2Exception_8h_source.html#l00101">folly::checkUnixError()</a>, <a class="el" href="Subprocess_8h_source.html#l00952">folly::Subprocess::Pipe::childFd</a>, <a class="el" href="NetOps_8cpp_source.html#l00090">folly::netops::close()</a>, <a class="el" href="Subprocess_8h_source.html#l00953">folly::Subprocess::Pipe::direction</a>, <a class="el" href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__leak__test_8py_source.html#l00045">gmock_leak_test::environ</a>, <a class="el" href="String_8cpp_source.html#l00463">folly::errnoStr()</a>, <a class="el" href="Subprocess_8h_source.html#l00258">folly::SubprocessSpawnError::errnoValue()</a>, <a class="el" href="Portability_8h_source.html#l00179">FOLLY_POP_WARNING</a>, <a class="el" href="Subprocess_8cpp_source.html#l00050">kChildFailure</a>, <a class="el" href="Subprocess_8cpp_source.html#l00049">kExecFailure</a>, <a class="el" href="Subprocess_8h_source.html#l00144">folly::ProcessReturnCode::makeRunning()</a>, <a class="el" href="composition__2_8cpp_source.html#l00074">pipe()</a>, <a class="el" href="Subprocess_8h_source.html#l00951">folly::Subprocess::Pipe::pipe</a>, <a class="el" href="SubprocessTestParentDeathHelper_8cpp_source.html#l00044">runChild()</a>, and <a class="el" href="ScopeGuard_8h_source.html#l00274">SCOPE_EXIT</a>.</p>
<div class="fragment"><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;               {</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">// Parent work, pre-fork: create pipes</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  std::vector&lt;int&gt; childFds;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="comment">// Close all of the childFds as we leave this scope</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <a class="code" href="ScopeGuard_8h.html#a175c354c3e38222bc00ce5df5e6d431d">SCOPE_EXIT</a> {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">// These are only pipes, closing them shouldn&#39;t fail</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cfd : childFds) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      CHECK_ERR(::<a class="code" href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">close</a>(cfd));</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  };</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="keywordtype">int</span> r;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; p : options.fdActions_) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">if</span> (p.second == <a class="code" href="classfolly_1_1Subprocess.html#a6d10f614635d4508855b7318edcc0611">PIPE_IN</a> || p.second == <a class="code" href="classfolly_1_1Subprocess.html#a0885fa8239b874b8c6d05b92a57f442e">PIPE_OUT</a>) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordtype">int</span> fds[2];</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <span class="comment">// We&#39;re setting both ends of the pipe as close-on-exec. The child</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="comment">// doesn&#39;t need to reset the flag on its end, as we always dup2() the fd,</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="comment">// and dup2() fds don&#39;t share the close-on-exec flag.</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="preprocessor">#if FOLLY_HAVE_PIPE2</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="comment">// If possible, set close-on-exec atomically. Otherwise, a concurrent</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <span class="comment">// Subprocess invocation can fork() between &quot;pipe&quot; and &quot;fnctl&quot;,</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <span class="comment">// causing FDs to leak.</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      r = ::pipe2(fds, O_CLOEXEC);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(r, <span class="stringliteral">&quot;pipe2&quot;</span>);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      r = <a class="code" href="composition__2_8cpp.html#a352f0fb3a18b03b24f090615f02c8b40">::pipe</a>(fds);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(r, <span class="stringliteral">&quot;pipe&quot;</span>);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      r = fcntl(fds[0], F_SETFD, FD_CLOEXEC);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(r, <span class="stringliteral">&quot;set FD_CLOEXEC&quot;</span>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      r = fcntl(fds[1], F_SETFD, FD_CLOEXEC);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(r, <span class="stringliteral">&quot;set FD_CLOEXEC&quot;</span>);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.emplace_back();</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      Pipe&amp; <a class="code" href="composition__2_8cpp.html#a352f0fb3a18b03b24f090615f02c8b40">pipe</a> = <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.back();</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      pipe.direction = p.second;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordtype">int</span> cfd;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordflow">if</span> (p.second == <a class="code" href="classfolly_1_1Subprocess.html#a6d10f614635d4508855b7318edcc0611">PIPE_IN</a>) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="comment">// Child gets reading end</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        pipe.pipe = <a class="code" href="classfolly_1_1File.html">folly::File</a>(fds[1], <span class="comment">/*ownsFd=*/</span><span class="keyword">true</span>);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        cfd = fds[0];</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        pipe.pipe = <a class="code" href="classfolly_1_1File.html">folly::File</a>(fds[0], <span class="comment">/*ownsFd=*/</span><span class="keyword">true</span>);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        cfd = fds[1];</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      p.second = cfd; <span class="comment">// ensure it gets dup2()ed</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      pipe.childFd = p.first;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      childFds.push_back(cfd);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  }</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <span class="comment">// This should already be sorted, as options.fdActions_ is</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  DCHECK(std::is_sorted(<a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.begin(), <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>.end()));</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">// Note that the const casts below are legit, per</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">// http://pubs.opengroup.org/onlinepubs/009695399/functions/exec.html</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordtype">char</span>** argVec = <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>**<span class="keyword">&gt;</span>(argv.get());</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="comment">// Set up environment</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  std::unique_ptr&lt;const char*[]&gt; envHolder;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordtype">char</span>** envVec;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">if</span> (env) {</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    envHolder = cloneStrings(*env);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    envVec = <span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>**<span class="keyword">&gt;</span>(envHolder.get());</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    envVec = <a class="code" href="namespacegmock__leak__test.html#a9437a2d2e3bde77354e5c6443ef129f8">environ</a>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  }</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="comment">// Block all signals around vfork; see http://ewontfix.com/7/.</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  <span class="comment">// As the child may run in the same address space as the parent until</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  <span class="comment">// the actual execve() system call, any (custom) signal handlers that</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <span class="comment">// the parent has might alter parent&#39;s memory if invoked in the child,</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="comment">// with undefined results.  So we block all signals in the parent before</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="comment">// vfork(), which will cause them to be blocked in the child as well (we</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="comment">// rely on the fact that Linux, just like all sane implementations, only</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="comment">// clones the calling thread).  Then, in the child, we reset all signals</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  <span class="comment">// to their default dispositions (while still blocked), and unblock them</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="comment">// (so the exec()ed process inherits the parent&#39;s signal mask)</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  <span class="comment">// The parent also unblocks all signals as soon as vfork() returns.</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  sigset_t allBlocked;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  r = sigfillset(&amp;allBlocked);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(r, <span class="stringliteral">&quot;sigfillset&quot;</span>);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  sigset_t oldSignals;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  r = pthread_sigmask(SIG_SETMASK, &amp;allBlocked, &amp;oldSignals);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <a class="code" href="namespacefolly.html#a9e367f145f64c33d16540d98798d94fc">checkPosixError</a>(r, <span class="stringliteral">&quot;pthread_sigmask&quot;</span>);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <a class="code" href="ScopeGuard_8h.html#a175c354c3e38222bc00ce5df5e6d431d">SCOPE_EXIT</a> {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// Restore signal mask</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    r = pthread_sigmask(SIG_SETMASK, &amp;oldSignals, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    CHECK_EQ(r, 0) &lt;&lt; <span class="stringliteral">&quot;pthread_sigmask: &quot;</span> &lt;&lt; <a class="code" href="namespacefolly.html#ad904a601e206bb84a84f7f68302ac92f">errnoStr</a>(r); <span class="comment">// shouldn&#39;t fail</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  };</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">// Call c_str() here, as it&#39;s not necessarily safe after fork.</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* childDir =</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      options.childDir_.empty() ? <span class="keyword">nullptr</span> : options.childDir_.c_str();</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  pid_t <a class="code" href="classfolly_1_1Subprocess.html#a5059c9911c06b01cd4867f672c08292a">pid</a>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="preprocessor">#ifdef __linux__</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordflow">if</span> (options.cloneFlags_) {</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    pid = syscall(SYS_clone, *options.cloneFlags_, 0, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> (options.detach_) {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="comment">// If we are detaching we must use fork() instead of vfork() for the first</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="comment">// fork, since we aren&#39;t going to simply call exec() in the child.</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      pid = fork();</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      pid = vfork();</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    }</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="preprocessor">#ifdef __linux__</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  }</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <a class="code" href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">checkUnixError</a>(pid, errno, <span class="stringliteral">&quot;failed to fork&quot;</span>);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">if</span> (pid == 0) {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// Fork a second time if detach_ was requested.</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">// This must be done before signals are restored in prepareChild()</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span> (options.detach_) {</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="preprocessor">#ifdef __linux__</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="keywordflow">if</span> (options.cloneFlags_) {</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        pid = syscall(SYS_clone, *options.cloneFlags_, 0, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        pid = vfork();</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="preprocessor">#ifdef __linux__</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      }</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <span class="keywordflow">if</span> (pid == -1) {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="comment">// Inform our parent process of the error so it can throw in the parent.</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        childError(errFd, <a class="code" href="Subprocess_8cpp.html#ae85a6139e0ec8dbb049733e3c78bc2f5">kChildFailure</a>, errno);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pid != 0) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">// We are the intermediate process.  Exit immediately.</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="comment">// Our child will still inform the original parent of success/failure</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="comment">// through errFd.  The pid of the grandchild process never gets</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="comment">// propagated back up to the original parent.  In the future we could</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="comment">// potentially send it back using errFd if we needed to.</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        _exit(0);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="Subprocess_8cpp.html#ab78a8e14b1ed8af9a3ab22879ba64873">errnoValue</a> = <a class="code" href="classfolly_1_1Subprocess.html#a55f5e898eb4d21d9795ca2d0a890b6de">prepareChild</a>(options, &amp;oldSignals, childDir);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> (errnoValue != 0) {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      childError(errFd, <a class="code" href="Subprocess_8cpp.html#ae85a6139e0ec8dbb049733e3c78bc2f5">kChildFailure</a>, errnoValue);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    errnoValue = <a class="code" href="classfolly_1_1Subprocess.html#abf78334bf1b8a878159210b338283535">runChild</a>(executable, argVec, envVec, options);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="comment">// If we get here, exec() failed.</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    childError(errFd, <a class="code" href="Subprocess_8cpp.html#a379ac6befc940fa7149803ad41f9ab57">kExecFailure</a>, errnoValue);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="comment">// Child is alive.  We have to be very careful about throwing after this</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">// point.  We are inside the constructor, so if we throw the Subprocess</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">// object will have never existed, and the destructor will never be called.</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">// We should only throw if we got an error via the errFd, and we know the</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">// child has exited and can be immediately waited for.  In all other cases,</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="comment">// we have no way of cleaning up the child.</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a> = <a class="code" href="classfolly_1_1Subprocess.html#a5059c9911c06b01cd4867f672c08292a">pid</a>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a> = <a class="code" href="classfolly_1_1ProcessReturnCode.html#aaafb3cff0737171a0ef5b3c44a509cb2">ProcessReturnCode::makeRunning</a>();</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;}</div><div class="ttc" id="classfolly_1_1ProcessReturnCode_html_aaafb3cff0737171a0ef5b3c44a509cb2"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#aaafb3cff0737171a0ef5b3c44a509cb2">folly::ProcessReturnCode::makeRunning</a></div><div class="ttdeci">static ProcessReturnCode makeRunning()</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00144">Subprocess.h:144</a></div></div>
<div class="ttc" id="classfolly_1_1File_html"><div class="ttname"><a href="classfolly_1_1File.html">folly::File</a></div><div class="ttdef"><b>Definition:</b> <a href="File_8h_source.html#l00037">File.h:37</a></div></div>
<div class="ttc" id="Subprocess_8cpp_html_a379ac6befc940fa7149803ad41f9ab57"><div class="ttname"><a href="Subprocess_8cpp.html#a379ac6befc940fa7149803ad41f9ab57">kExecFailure</a></div><div class="ttdeci">constexpr int kExecFailure</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00049">Subprocess.cpp:49</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_ad259adb8e0a99987161b63ac7fea4e81"><div class="ttname"><a href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">folly::Subprocess::pid_</a></div><div class="ttdeci">pid_t pid_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00941">Subprocess.h:941</a></div></div>
<div class="ttc" id="ScopeGuard_8h_html_a175c354c3e38222bc00ce5df5e6d431d"><div class="ttname"><a href="ScopeGuard_8h.html#a175c354c3e38222bc00ce5df5e6d431d">SCOPE_EXIT</a></div><div class="ttdeci">#define SCOPE_EXIT</div><div class="ttdef"><b>Definition:</b> <a href="ScopeGuard_8h_source.html#l00274">ScopeGuard.h:274</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1105b24f5523c282910b4cecac6c7cca"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">folly::Subprocess::pipes_</a></div><div class="ttdeci">std::vector&lt; Pipe &gt; pipes_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00970">Subprocess.h:970</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a0885fa8239b874b8c6d05b92a57f442e"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a0885fa8239b874b8c6d05b92a57f442e">folly::Subprocess::PIPE_OUT</a></div><div class="ttdeci">static const int PIPE_OUT</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00274">Subprocess.h:274</a></div></div>
<div class="ttc" id="namespacegmock__leak__test_html_a9437a2d2e3bde77354e5c6443ef129f8"><div class="ttname"><a href="namespacegmock__leak__test.html#a9437a2d2e3bde77354e5c6443ef129f8">gmock_leak_test.environ</a></div><div class="ttdeci">environ</div><div class="ttdef"><b>Definition:</b> <a href="fizz_2build___2gtest_2src_2gtest_2googlemock_2test_2gmock__leak__test_8py_source.html#l00045">gmock_leak_test.py:45</a></div></div>
<div class="ttc" id="namespacefolly_html_a9e367f145f64c33d16540d98798d94fc"><div class="ttname"><a href="namespacefolly.html#a9e367f145f64c33d16540d98798d94fc">folly::checkPosixError</a></div><div class="ttdeci">void checkPosixError(int err, Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00083">Exception.h:83</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_abf78334bf1b8a878159210b338283535"><div class="ttname"><a href="classfolly_1_1Subprocess.html#abf78334bf1b8a878159210b338283535">folly::Subprocess::runChild</a></div><div class="ttdeci">int runChild(const char *executable, char **argv, char **env, const Options &amp;options) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00575">Subprocess.cpp:575</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a6d10f614635d4508855b7318edcc0611"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a6d10f614635d4508855b7318edcc0611">folly::Subprocess::PIPE_IN</a></div><div class="ttdeci">static const int PIPE_IN</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00273">Subprocess.h:273</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_aca1747e2265c3da92641434b16c77f03"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">folly::Subprocess::returnCode_</a></div><div class="ttdeci">ProcessReturnCode returnCode_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00942">Subprocess.h:942</a></div></div>
<div class="ttc" id="namespacefolly_html_ad904a601e206bb84a84f7f68302ac92f"><div class="ttname"><a href="namespacefolly.html#ad904a601e206bb84a84f7f68302ac92f">folly::errnoStr</a></div><div class="ttdeci">fbstring errnoStr(int err)</div><div class="ttdef"><b>Definition:</b> <a href="String_8cpp_source.html#l00463">String.cpp:463</a></div></div>
<div class="ttc" id="namespacefolly_html_af6244d72aa4bdeb215d938ff5f56a6e5"><div class="ttname"><a href="namespacefolly.html#af6244d72aa4bdeb215d938ff5f56a6e5">folly::checkUnixError</a></div><div class="ttdeci">void checkUnixError(ssize_t ret, Args &amp;&amp;...args)</div><div class="ttdef"><b>Definition:</b> <a href="folly_2folly_2Exception_8h_source.html#l00101">Exception.h:101</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a55f5e898eb4d21d9795ca2d0a890b6de"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a55f5e898eb4d21d9795ca2d0a890b6de">folly::Subprocess::prepareChild</a></div><div class="ttdeci">int prepareChild(const Options &amp;options, const sigset_t *sigmask, const char *childDir) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00495">Subprocess.cpp:495</a></div></div>
<div class="ttc" id="Subprocess_8cpp_html_ab78a8e14b1ed8af9a3ab22879ba64873"><div class="ttname"><a href="Subprocess_8cpp.html#ab78a8e14b1ed8af9a3ab22879ba64873">errnoValue</a></div><div class="ttdeci">int errnoValue</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00225">Subprocess.cpp:225</a></div></div>
<div class="ttc" id="namespacefolly_1_1netops_html_a27d9201e6386937ffded3bfd86f995aa"><div class="ttname"><a href="namespacefolly_1_1netops.html#a27d9201e6386937ffded3bfd86f995aa">folly::netops::close</a></div><div class="ttdeci">int close(NetworkSocket s)</div><div class="ttdef"><b>Definition:</b> <a href="NetOps_8cpp_source.html#l00090">NetOps.cpp:90</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a5059c9911c06b01cd4867f672c08292a"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a5059c9911c06b01cd4867f672c08292a">folly::Subprocess::pid</a></div><div class="ttdeci">pid_t pid() const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00674">Subprocess.cpp:674</a></div></div>
<div class="ttc" id="Subprocess_8cpp_html_ae85a6139e0ec8dbb049733e3c78bc2f5"><div class="ttname"><a href="Subprocess_8cpp.html#ae85a6139e0ec8dbb049733e3c78bc2f5">kChildFailure</a></div><div class="ttdeci">constexpr int kChildFailure</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00050">Subprocess.cpp:50</a></div></div>
<div class="ttc" id="composition__2_8cpp_html_a352f0fb3a18b03b24f090615f02c8b40"><div class="ttname"><a href="composition__2_8cpp.html#a352f0fb3a18b03b24f090615f02c8b40">pipe</a></div><div class="ttdeci">void pipe(CPUExecutor cpu, IOExecutor io)</div><div class="ttdef"><b>Definition:</b> <a href="composition__2_8cpp_source.html#l00074">composition_2.cpp:74</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad5f9ae1cd03f31e9f9421f152f075222"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int folly::Subprocess::stderrFd </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00878">878</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                       {</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">parentFd</a>(2);</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  }</div><div class="ttc" id="classfolly_1_1Subprocess_html_a6f2c79adb219ecd653be9a59560f26c1"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">folly::Subprocess::parentFd</a></div><div class="ttdeci">int parentFd(int childFd) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00869">Subprocess.h:869</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a98011a4cbc052f85c303b37d7d3d5ccb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int folly::Subprocess::stdinFd </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00872">872</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                      {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">parentFd</a>(0);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  }</div><div class="ttc" id="classfolly_1_1Subprocess_html_a6f2c79adb219ecd653be9a59560f26c1"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">folly::Subprocess::parentFd</a></div><div class="ttdeci">int parentFd(int childFd) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00869">Subprocess.h:869</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8d2b6778b29c7d44d85260fe09919212"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int folly::Subprocess::stdoutFd </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00875">875</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>

<p>Referenced by <a class="el" href="SubprocessTest_8cpp_source.html#l00291">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                       {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">parentFd</a>(1);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  }</div><div class="ttc" id="classfolly_1_1Subprocess_html_a6f2c79adb219ecd653be9a59560f26c1"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a6f2c79adb219ecd653be9a59560f26c1">folly::Subprocess::parentFd</a></div><div class="ttdeci">int parentFd(int childFd) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00869">Subprocess.h:869</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a23732fe54ab2d62e342820441d5b0052"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="structfolly_1_1Subprocess_1_1ChildPipe.html">Subprocess::ChildPipe</a> &gt; folly::Subprocess::takeOwnershipOfPipes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00907">907</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="Base-inl_8h_source.html#l02567">folly::gen::move</a>, and <a class="el" href="ExceptionWrapper_8h_source.html#l00644">folly::swap()</a>.</p>

<p>Referenced by <a class="el" href="SubprocessTest_8cpp_source.html#l00575">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                                                                {</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  std::vector&lt;Subprocess::ChildPipe&gt; pipes;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; p : <a class="code" href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">pipes_</a>) {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    pipes.emplace_back(p.childFd, <a class="code" href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">std::move</a>(p.pipe));</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  <span class="comment">// release memory</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  std::vector&lt;Pipe&gt;().<a class="code" href="namespacefolly.html#aeba3d37f451c13053fa511f1630e5b28">swap</a>(pipes_);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keywordflow">return</span> pipes;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;}</div><div class="ttc" id="namespacefolly_1_1gen_html_ac24ec252b1b738a40c274285527c193f"><div class="ttname"><a href="namespacefolly_1_1gen.html#ac24ec252b1b738a40c274285527c193f">folly::gen::move</a></div><div class="ttdeci">constexpr detail::Map&lt; Move &gt; move</div><div class="ttdef"><b>Definition:</b> <a href="Base-inl_8h_source.html#l02567">Base-inl.h:2567</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_a1105b24f5523c282910b4cecac6c7cca"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a1105b24f5523c282910b4cecac6c7cca">folly::Subprocess::pipes_</a></div><div class="ttdeci">std::vector&lt; Pipe &gt; pipes_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00970">Subprocess.h:970</a></div></div>
<div class="ttc" id="namespacefolly_html_aeba3d37f451c13053fa511f1630e5b28"><div class="ttname"><a href="namespacefolly.html#aeba3d37f451c13053fa511f1630e5b28">folly::swap</a></div><div class="ttdeci">void swap(exception_wrapper &amp;a, exception_wrapper &amp;b) noexcept</div><div class="ttdef"><b>Definition:</b> <a href="ExceptionWrapper_8h_source.html#l00644">ExceptionWrapper.h:644</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac39c69859d5ac3f8fc9e251a918107a2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void folly::Subprocess::terminate </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00608">608</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                   {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <a class="code" href="classfolly_1_1Subprocess.html#a87c3f4502dfd923e235592e3249ae382">sendSignal</a>(SIGTERM);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  }</div><div class="ttc" id="classfolly_1_1Subprocess_html_a87c3f4502dfd923e235592e3249ae382"><div class="ttname"><a href="classfolly_1_1Subprocess.html#a87c3f4502dfd923e235592e3249ae382">folly::Subprocess::sendSignal</a></div><div class="ttdeci">void sendSignal(int signal)</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00668">Subprocess.cpp:668</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aca2924e7e672dee645ddb7634efa5bd2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1ProcessReturnCode.html">ProcessReturnCode</a> folly::Subprocess::wait </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Wait for the process to terminate and return its status. Like <a class="el" href="classfolly_1_1Subprocess.html#a47c806c1bc054d667def55fd8bbb4cbd">poll()</a>, the only exception this can throw is std::logic_error if you call this on a <a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a> whose status is RUNNING. Aborts on egregious violations of contract, like an out-of-band waitpid(p.pid(), 0, 0). </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00644">644</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="Subprocess_8cpp_source.html#l00090">folly::ProcessReturnCode::enforce()</a>, <a class="el" href="Subprocess_8cpp_source.html#l00054">folly::ProcessReturnCode::make()</a>, and <a class="el" href="Subprocess_8h_source.html#l00135">folly::ProcessReturnCode::RUNNING</a>.</p>

<p>Referenced by <a class="el" href="SubprocessTest_8cpp_source.html#l00100">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                                   {</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a>.<a class="code" href="classfolly_1_1ProcessReturnCode.html#a9f4f16586f84d2b8b1b10d75a2d7697e">enforce</a>(<a class="code" href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">ProcessReturnCode::RUNNING</a>);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  DCHECK_GT(<a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a>, 0);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keywordtype">int</span> status;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  pid_t found;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    found = ::waitpid(<a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a>, &amp;status, 0);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;  } <span class="keywordflow">while</span> (found == -1 &amp;&amp; errno == EINTR);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  <span class="comment">// The only two remaining errors are ECHILD (other code reaped the</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <span class="comment">// child?), or EINVAL (cosmic rays?), and both merit an abort:</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  PCHECK(found != -1) &lt;&lt; <span class="stringliteral">&quot;waitpid(&quot;</span> &lt;&lt; <a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a> &lt;&lt; <span class="stringliteral">&quot;, &amp;status, WNOHANG)&quot;</span>;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="comment">// Though the child process had quit, this call does not close the pipes</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <span class="comment">// since its descendants may still be using them.</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  DCHECK_EQ(found, <a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a>);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a> = <a class="code" href="classfolly_1_1ProcessReturnCode.html#a196cb468ef450009776fdd846a9d66fd">ProcessReturnCode::make</a>(status);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">pid_</a> = -1;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;}</div><div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a196cb468ef450009776fdd846a9d66fd"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a196cb468ef450009776fdd846a9d66fd">folly::ProcessReturnCode::make</a></div><div class="ttdeci">static ProcessReturnCode make(int status)</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00054">Subprocess.cpp:54</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_ad259adb8e0a99987161b63ac7fea4e81"><div class="ttname"><a href="classfolly_1_1Subprocess.html#ad259adb8e0a99987161b63ac7fea4e81">folly::Subprocess::pid_</a></div><div class="ttdeci">pid_t pid_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00941">Subprocess.h:941</a></div></div>
<div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a7399284901b703d26b7ee2defaa4f273a4886c4e5201e4c19eb87c839fa907d15">folly::ProcessReturnCode::RUNNING</a></div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00135">Subprocess.h:135</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_aca1747e2265c3da92641434b16c77f03"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">folly::Subprocess::returnCode_</a></div><div class="ttdeci">ProcessReturnCode returnCode_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00942">Subprocess.h:942</a></div></div>
<div class="ttc" id="classfolly_1_1ProcessReturnCode_html_a9f4f16586f84d2b8b1b10d75a2d7697e"><div class="ttname"><a href="classfolly_1_1ProcessReturnCode.html#a9f4f16586f84d2b8b1b10d75a2d7697e">folly::ProcessReturnCode::enforce</a></div><div class="ttdeci">void enforce(State state) const </div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00090">Subprocess.cpp:90</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="abde3899b23e9711f39fe9e6d6461f2a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void folly::Subprocess::waitChecked </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Wait for the process to terminate, throw if unsuccessful. </p>

<p>Definition at line <a class="el" href="Subprocess_8cpp_source.html#l00663">663</a> of file <a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a>.</p>

<p>References <a class="el" href="DistributedMutex-inl_8h_source.html#l00429">folly::detail::distributed_mutex::wait()</a>.</p>

<p>Referenced by <a class="el" href="SubprocessTest_8cpp_source.html#l00047">TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                             {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;  <a class="code" href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">wait</a>();</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  checkStatus(<a class="code" href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">returnCode_</a>);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;}</div><div class="ttc" id="classfolly_1_1Subprocess_html_aca1747e2265c3da92641434b16c77f03"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca1747e2265c3da92641434b16c77f03">folly::Subprocess::returnCode_</a></div><div class="ttdeci">ProcessReturnCode returnCode_</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8h_source.html#l00942">Subprocess.h:942</a></div></div>
<div class="ttc" id="classfolly_1_1Subprocess_html_aca2924e7e672dee645ddb7634efa5bd2"><div class="ttname"><a href="classfolly_1_1Subprocess.html#aca2924e7e672dee645ddb7634efa5bd2">folly::Subprocess::wait</a></div><div class="ttdeci">ProcessReturnCode wait()</div><div class="ttdef"><b>Definition:</b> <a href="Subprocess_8cpp_source.html#l00644">Subprocess.cpp:644</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a85bd2d9070a17d31725b2c56f6e74055"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int folly::Subprocess::CLOSE = -1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00271">271</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad259adb8e0a99987161b63ac7fea4e81"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pid_t folly::Subprocess::pid_ {-1}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00941">941</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6214cf4ed74633db1bb01fd835083121"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int folly::Subprocess::PIPE = -2</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00272">272</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>

<p>Referenced by <a class="el" href="Subprocess_8cpp_source.html#l00173">folly::Subprocess::Options::fd()</a>.</p>

</div>
</div>
<a class="anchor" id="a6d10f614635d4508855b7318edcc0611"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int folly::Subprocess::PIPE_IN = -3</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00273">273</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>

<p>Referenced by <a class="el" href="Subprocess_8cpp_source.html#l00173">folly::Subprocess::Options::fd()</a>.</p>

</div>
</div>
<a class="anchor" id="a0885fa8239b874b8c6d05b92a57f442e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int folly::Subprocess::PIPE_OUT = -4</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00274">274</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>

<p>Referenced by <a class="el" href="Subprocess_8cpp_source.html#l00173">folly::Subprocess::Options::fd()</a>.</p>

</div>
</div>
<a class="anchor" id="a1105b24f5523c282910b4cecac6c7cca"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;<a class="el" href="structfolly_1_1Subprocess_1_1Pipe.html">Pipe</a>&gt; folly::Subprocess::pipes_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00970">970</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>

</div>
</div>
<a class="anchor" id="aca1747e2265c3da92641434b16c77f03"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classfolly_1_1ProcessReturnCode.html">ProcessReturnCode</a> folly::Subprocess::returnCode_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Subprocess_8h_source.html#l00942">942</a> of file <a class="el" href="Subprocess_8h_source.html">Subprocess.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>proxygen/folly/folly/<a class="el" href="Subprocess_8h_source.html">Subprocess.h</a></li>
<li>proxygen/folly/folly/<a class="el" href="Subprocess_8cpp_source.html">Subprocess.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacefolly.html">folly</a></li><li class="navelem"><a class="el" href="classfolly_1_1Subprocess.html">Subprocess</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
