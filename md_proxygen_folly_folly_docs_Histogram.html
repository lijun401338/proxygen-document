<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>proxygen: `folly/stats/Histogram.h`</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">proxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_proxygen_folly_folly_docs_Histogram.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">`folly/stats/Histogram.h` </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3>Classes</h3>
<hr/>
<h4><code>Histogram</code></h4>
<p><code>Histogram.h</code> defines a simple histogram class, templated on the type of data you want to store. This class is useful for tracking a large stream of data points, where you want to remember the overall distribution of the data, but do not need to remember each data point individually.</p>
<p>Each histogram bucket stores the number of data points that fell in the bucket, as well as the overall sum of the data points in the bucket. Note that no overflow checking is performed, so if you have a bucket with a large number of very large values, it may overflow and cause inaccurate data for this bucket. As such, the histogram class is not well suited to storing data points with very large values. However, it works very well for smaller data points such as request latencies, request or response sizes, etc.</p>
<p>In addition to providing access to the raw bucket data, the <code>Histogram</code> class also provides methods for estimating percentile values. This allows you to estimate the median value (the 50th percentile) and other values such as the 95th or 99th percentiles.</p>
<p>All of the buckets have the same width. The number of buckets and bucket width is fixed for the lifetime of the histogram. As such, you do need to know your expected data range ahead of time in order to have accurate statistics. The histogram does keep one bucket to store all data points that fall below the histogram minimum, and one bucket for the data points above the maximum. However, because these buckets don't have a good lower/upper bound, percentile estimates in these buckets may be inaccurate.</p>
<h4><code>HistogramBuckets</code></h4>
<p>The <code>Histogram</code> class is built on top of <code>HistogramBuckets</code>. <code>HistogramBuckets</code> provides an API very similar to <code>Histogram</code>, but allows a user-defined bucket class. This allows users to implement more complex histogram types that store more than just the count and sum in each bucket.</p>
<p>When computing percentile estimates <code>HistogramBuckets</code> allows user-defined functions for computing the average value and data count in each bucket. This allows you to define more complex buckets which may have multiple different ways of computing the average value and the count.</p>
<p>For example, one use case could be tracking timeseries data in each bucket. Each set of timeseries data can have independent data in the bucket, which can show how the data distribution is changing over time.</p>
<h3>Example Usage</h3>
<hr/>
<p>Say we have code that sends many requests to remote services, and want to generate a histogram showing how long the requests take. The following code will initialize histogram with 50 buckets, tracking values between 0 and 5000. (There are 50 buckets since the bucket width is specified as 100. If the bucket width is not an even multiple of the histogram range, the last bucket will simply be shorter than the others.)</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;folly::Histogram&lt;int64_t&gt; latencies(100, 0, 5000);</div></div><!-- fragment --><p>The <a class="el" href="BucketedTimeSeriesBenchmark_8cpp.html#ad918836e73760f948751c3835f74c193">addValue()</a> method is used to add values to the histogram. Each time a request finishes we can add its latency to the histogram:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;latencies.addValue(now - startTime);</div></div><!-- fragment --><p>You can access each of the histogram buckets to display the overall distribution. Note that bucket 0 tracks all data points that were below the specified histogram minimum, and the last bucket tracks the data points that were above the maximum.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;auto numBuckets = latencies.getNumBuckets();</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;cout &lt;&lt; &quot;Below min: &quot; &lt;&lt; latencies.getBucketByIndex(0).count &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;for (unsigned int n = 1; n &lt; numBuckets - 1; ++n) {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  cout &lt;&lt; latencies.getBucketMin(n) &lt;&lt; &quot;-&quot; &lt;&lt; latencies.getBucketMax(n)</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;       &lt;&lt; &quot;: &quot; &lt;&lt; latencies.getBucketByIndex(n).count &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;}</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;cout &lt;&lt; &quot;Above max: &quot;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;     &lt;&lt; latencies.getBucketByIndex(numBuckets - 1).count &lt;&lt; &quot;\n&quot;;</div></div><!-- fragment --><p>You can also use the <code>getPercentileEstimate()</code> method to estimate the value at the Nth percentile in the distribution. For example, to estimate the median, as well as the 95th and 99th percentile values:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;int64_t median = latencies.getPercentileEstimate(0.5);</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;int64_t p95 = latencies.getPercentileEstimate(0.95);</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;int64_t p99 = latencies.getPercentileEstimate(0.99);</div></div><!-- fragment --><h3>Thread Safety</h3>
<hr/>
<p>Note that <code>Histogram</code> and <code>HistogramBuckets</code> objects are not thread-safe. If you wish to access a single <code>Histogram</code> from multiple threads, you must perform your own locking to ensure that multiple threads do not access it at the same time. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
